/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";(new function(){let t=!1;this.elm={body:e("body"),title:e("head > title"),sidebar:{left:e("div#sidebar"),right:null}},this.run=()=>{n();const t=this.helper.template.loading().appendTo(this.elm.body);this.elm.body.addClass(e.cl.initLoading),this.helper.model.init().then((()=>this.helper.i18n.init())).then((()=>(this.elm.body.parent("html").attr("dir",this.helper.i18n.isRtl()?"rtl":"ltr"),this.helper.font.init(),this.helper.stylesheet.init({defaultVal:!0}),this.helper.i18n.parseHtml(document),this.elm.title.text(this.elm.title.text()+" - "+this.helper.i18n.get("extension_name")),this.helper.stylesheet.addStylesheets(["onboarding"],e(document))))).then((()=>{this.elm.body.removeClass(e.cl.building),this.elm.sidebar.right=e(this.elm.sidebar.left[0].outerHTML).appendTo(this.elm.body),this.elm.sidebar.right.attr(e.attr.position,"right"),i(),o(),s(),a(),l(),r(),d(),e.delay(500).then((()=>(this.elm.body.removeClass(e.cl.initLoading),h("intro"),e.delay(300)))).then((()=>{t.remove()}))}))};const n=()=>{this.helper={i18n:new e.I18nHelper(this),font:new e.FontHelper(this),stylesheet:new e.StylesheetHelper(this),template:new e.TemplateHelper(this),model:new e.ModelHelper(this)}},i=()=>{e(window).on("beforeunload",(()=>{t&&this.helper.model.call("reinitialize")}))},o=()=>{e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='intro'] a").on("click",(t=>{t.preventDefault(),e(t.currentTarget).hasClass(e.cl.onboarding.skip)?b():c()}))},s=()=>{e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='position'] a").on("mouseenter click",(n=>{n.preventDefault();const i=e(n.currentTarget).attr(e.attr.value);this.elm.body.attr(e.attr.position,i),Object.values(this.elm.sidebar).forEach((t=>{t.removeClass(e.cl.visible)})),this.elm.sidebar[i].addClass(e.cl.visible),"click"===n.type&&this.helper.model.setData({"b/sidebarPosition":i}).then((()=>{t=!0,c()}))})).on("mouseleave",(t=>{const n=e(t.currentTarget).parent();e.delay().then((()=>{n.hasClass(e.cl.visible)&&Object.values(this.elm.sidebar).forEach((t=>{t.removeClass(e.cl.visible)}))}))}))},a=()=>{e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='surface'] a").on("mouseenter click",(n=>{n.preventDefault();const i=e(n.currentTarget).attr(e.attr.value),o=this.helper.model.getDefaultColors();if(this.elm.body.attr(e.attr.onboarding.surface,i),"click"===n.type){const n=this.helper.model.getData("a/styles");n.colorScheme=o.colorScheme[i],n.textColor=o.textColor[i],n.bookmarksDirColor=o.textColor[i],n.sidebarMaskColor=o.sidebarMaskColor[i],n.hoverColor=o.hoverColor[i],Object.values(this.elm.sidebar).forEach((t=>{t.removeClass(e.cl.visible)})),this.helper.model.setData({"a/darkMode":"dark"===i,"a/styles":n}).then((()=>{t=!0,c()}))}})).on("mouseleave",(t=>{const n=e(t.currentTarget).parent();e.delay().then((()=>{n.hasClass(e.cl.visible)&&this.elm.body.removeAttr(e.attr.onboarding.surface)}))}))},l=()=>{e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='openAction'] a").on("mouseenter click",(n=>{n.preventDefault();const i=e(n.currentTarget).attr(e.attr.value);i&&("click"===n.type?(this.elm.body.addClass(e.cl.onboarding.hideOpenTypeIcon),this.helper.model.setData({"b/openAction":i}).then((()=>{t=!0,b()}))):(this.elm.body.removeClass(e.cl.onboarding.hideOpenTypeIcon),this.elm.body.attr(e.attr.onboarding.openType,"icon"===i?"icon":"mouse")))})).on("mouseleave",(t=>{e(t.currentTarget).parent("section").hasClass(e.cl.visible)&&this.elm.body.addClass(e.cl.onboarding.hideOpenTypeIcon)}))},r=()=>{e(document).on(e.opts.events.sidebarOpened,(()=>{e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='finished']").hasClass(e.cl.visible)||(this.elm.body.addClass(e.cl.onboarding.hideOpenTypeIcon),p())}))},d=()=>{e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='finished'] a").on("click",(t=>{t.preventDefault(),e(t.currentTarget).hasClass(e.cl.onboarding.settings)?location.href=e.api.extension.getURL("html/settings.html"):e(t.currentTarget).hasClass(e.cl.onboarding.appearance)?location.href=e.api.extension.getURL("html/settings.html")+"#appearance_sidebar":e(t.currentTarget).hasClass(e.cl.onboarding.toggleArea)&&(location.href=e.api.extension.getURL("html/settings.html")+"#sidebar_toggle_area")}))},c=()=>{const t=e("section."+e.cl.onboarding.slide+"."+e.cl.visible).next("section."+e.cl.onboarding.slide).attr(e.attr.name);h(t)},h=t=>{e("section."+e.cl.onboarding.slide+"."+e.cl.visible).removeClass(e.cl.visible),e.delay(300).then((()=>{const n=e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='"+t+"']").addClass(e.cl.visible).prevAll("section."+e.cl.onboarding.slide).length()+1;this.helper.model.call("track",{name:"action",value:{name:"onboarding",value:n+"_"+t},always:!0})}))},p=()=>{h("finished");const t=this.helper.model.getData(["b/openAction","b/sidebarPosition"]),n=e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='finished'] p."+e.cl.info);if("icon"===t.openAction)n.remove();else{const e=this.helper.i18n.get("onboarding_"+t.sidebarPosition);n.children("span").text(this.helper.i18n.get("onboarding_finish_notice",[e]))}},b=()=>{h("handson"),m(),Object.values(this.elm.sidebar).forEach((t=>{t.removeClass(e.cl.visible)}));const t=e("section."+e.cl.onboarding.slide+"["+e.attr.name+"='handson']"),n=this.helper.model.getData(["b/openAction","b/sidebarPosition"]);if(this.elm.body.attr(e.attr.position,n.sidebarPosition),"icon"===n.openAction)e("<p></p>").text(this.helper.i18n.get("onboarding_handson_icon_desc")).appendTo(t);else{const i=this.helper.i18n.get("onboarding_"+n.sidebarPosition);if(e("<p></p>").text(this.helper.i18n.get("onboarding_handson_mouse_desc_1",[i])).appendTo(t),"mousemove"!==n.openAction){const i=this.helper.i18n.get("onboarding_"+("contextmenu"===n.openAction?"right":"left"));e("<p></p>").text(this.helper.i18n.get("onboarding_handson_mouse_desc_2",[i])).appendTo(t)}}e.delay(300).then((()=>{this.elm.body.removeClass(e.cl.onboarding.hideOpenTypeIcon),this.elm.body.attr(e.attr.onboarding.openType,"icon"===n.openAction?"icon":"mouse")}))},m=()=>{e.opts.manifest.content_scripts[0].css.forEach((t=>{e("head").append("<link href='"+e.api.extension.getURL(t)+"' type='text/css' rel='stylesheet' />")}));const t=(n=0)=>{const i=e.opts.manifest.content_scripts[0].js[n];if(void 0!==i){const e=document.createElement("script");document.head.appendChild(e),e.onload=()=>t(n+1),e.src="/"+i}};t()}}).run()})(jsu);