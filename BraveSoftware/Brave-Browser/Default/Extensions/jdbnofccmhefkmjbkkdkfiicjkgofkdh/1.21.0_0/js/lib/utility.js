/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";e.UtilityHelper=function(t){this.openUrl=async(e,n="default",i=!0)=>{if("about:blank"!==e.url)if(t.helper.model.setData({"u/lastOpened":e.id,"u/performReopening":i&&e.reopenSidebar||!1}),"incognito"===n)await t.helper.model.call("openLink",{href:e.url,incognito:!0});else if("newWindow"===n)await t.helper.model.call("openLink",{href:e.url,newWindow:!0});else{const r="newTab"===n;e.url.startsWith("javascript:")&&!1===r?location.href=e.url:await t.helper.model.call("openLink",{parentId:e.parentId,id:e.id,href:e.url,newTab:"newTab"===n,position:t.helper.model.getData("b/newTabPosition"),active:i})}},this.openAllBookmarks=async e=>{const n=t.helper.model.getData("b/newTabPosition");"afterCurrent"!==n&&"beforeFirst"!==n||e.reverse();for(const t of e)await this.openUrl(t,"newTab",!1)},this.isBackgroundConnected=()=>{try{const t=e.api.runtime.connect();if(t)return t.disconnect(),!0}catch(e){}return!1},this.triggerEvent=(t,n={},i=null)=>{(i||document).dispatchEvent(new CustomEvent(e.opts.events[t],{detail:n,bubbles:!0,cancelable:!1}))},this.copyToClipboard=n=>{const i=e("<textarea></textarea>").text(n).appendTo(t.elm.iframeBody);i[0].select();let r=!1;try{r=t.elm.iframe[0].contentDocument.execCommand("copy")}catch(e){}return i.remove(),r},this.isUrlOnBlacklist=e=>{if(!e||0===e.trim().length)return!0;let t=!1;return["about:","https?://192.168.","192.168.","https?://localhost","localhost","https?://127.0.0.","127.0.0.","javascript:","file://","chrome://","edge://","extension://","chrome-extension://"].some((n=>{if(0===e.search(new RegExp(n,"gi")))return t=!0,!0})),t},this.getSortList=()=>({custom:{dir:"ASC"},alphabetical:{dir:"ASC"},mostUsed:{dir:"DESC"},recentlyUsed:{dir:"DESC"},recentlyAdded:{dir:"DESC"}}),this.sortEntries=(e,n)=>{if(e.length>1){const i=t.helper.i18n.getLocaleSortCollator(),r=(t,i)=>{e.sort(((e,r)=>{const a=!!e.children,o=!!r.children;return"custom"!==n.name&&a!==o?a?-1:1:(t===n.dir?1:-1)*i(e,r)}))};switch(n.name){case"custom":r("ASC",((e,t)=>e.index-t.index));break;case"alphabetical":r("ASC",((e,t)=>i.compare(e.title,t.title)));break;case"recentlyAdded":r("DESC",((e,t)=>t.dateAdded-e.dateAdded));break;case"mostUsed":{const e=t.helper.model.getData("u/mostViewedPerMonth");r("DESC",((n,r)=>{const a=t.helper.entry.getDataById(n.id),o=t.helper.entry.getDataById(r.id),s=a?a.views[e?"perMonth":"total"]:0,l=o?o.views[e?"perMonth":"total"]:0;return s===l?i.compare(n.title,r.title):l-s}));break}case"recentlyUsed":r("DESC",((e,n)=>{const r=t.helper.entry.getDataById(e.id),a=t.helper.entry.getDataById(n.id),o=r?r.views.lastView:0,s=a?a.views.lastView:0;return o===s?i.compare(e.title,n.title):s-o}))}}},this.isWindowed=()=>window.screenX>100||window.screenY>50||Math.abs(window.screen.availWidth-window.innerWidth)>50||window.navigator&&window.navigator&&window.navigator.userAgent&&window.navigator.userAgent&&window.navigator.userAgent.search(/[/\s-_]mobile[/\s-_]/i)>-1,this.isWebapp=()=>window.matchMedia("(display-mode: standalone)").matches}})(jsu);