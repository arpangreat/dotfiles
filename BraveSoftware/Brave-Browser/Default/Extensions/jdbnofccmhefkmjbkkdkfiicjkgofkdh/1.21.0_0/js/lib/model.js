/*! (c) Philipp KÃ¶nig under GPL-3.0 */
(e=>{"use strict";e.ModelHelper=function(t){const o={default:{textColor:{light:"#646464",dark:"#c8c8c8"},sidebarMaskColor:{light:"rgba(255, 255, 255, 0.8)",dark:"rgba(0, 0, 0, 0.6)"},hoverColor:{light:"#f5f5f5",dark:"#555555"},colorScheme:{light:"#1b82f1",dark:"#1f4d80"},foregroundColor:{light:"#ffffff",dark:"#333333"},icon:{forLight:"#555555",forDark:"#ffffff"}},glass:{sidebarMaskColor:{light:"rgba(0, 0, 0, 0)",dark:"rgba(0, 0, 0, 0)"},overlayMaskColor:{light:"rgba(255, 255, 255, 0.5)",dark:"rgba(0, 0, 0, 0.3)"},textColor:{light:"#444444",dark:"#dfdfdf"},hoverColor:{light:"rgba(0, 0, 0, 0.05)",dark:"rgba(255, 255, 255, 0.1)"}}},r={u:{openStates:{},hiddenEntries:{},additionalInfo:{},scrollPos:0,separators:{},customCss:"",pinnedEntries:{},lockPinned:!0,translationHelp:!0,translationThanked:!1,performReopening:!1,entryAmounts:{},lastOpened:null,sort:{name:"custom",dir:"ASC"},mostViewedPerMonth:!1,viewAsTree:!0},b:{animations:!0,preventPageScroll:!1,toggleArea:{width:2,widthWindowed:20,height:100,top:0},blacklist:[],whitelist:[],sidebarPosition:"left",openAction:"mousedown",newTab:"foreground",newTabPosition:"afterCurrent",visibility:"always",linkAction:"current",dirAccordion:!1,reopenSidebar:!1,preventWindowed:!1,preventWebapp:!0,rememberState:"openStatesAndPos",rememberOpenStatesSubDirectories:!0,newEntryPosition:"append",tooltipDelay:.5,tooltipContent:"all",tooltipAdditionalInfo:!0,dndCreationDialog:!1,closeOnTabChange:!0,openChildrenWarnLimit:10,dirOpenDuration:.4,scrollBarHide:1.5,openDelay:0,closeTimeout:1,dndOpenDirDelay:.5},a:{theme:"default",showIndicator:!0,showIndicatorIcon:!0,darkMode:!1,highContrast:!1,directoryArrows:!1,showBookmarkIcons:!0,showDirectoryIcons:!0,devModeIconBadge:!0,styles:{colorScheme:o.default.colorScheme.light,foregroundColor:o.default.foregroundColor.light,textColor:o.default.textColor.light,hoverColor:o.default.hoverColor.light,indicatorWidth:"24px",indicatorIconSize:"24px",indicatorIconColor:"#ffffff",indicatorColor:"rgba(0,0,0,0.5)",iconShape:"bookmark",iconColor:"auto",sidebarWidth:"350px",sidebarHeaderHeight:"50px",sidebarMaskColor:o.default.sidebarMaskColor.light,bookmarksFontSize:"14px",directoriesIconSize:"16px",bookmarksIconSize:"16px",bookmarksLineHeight:"38px",bookmarksDirIcon:"dir-1",bookmarksDirColor:o.default.textColor.light,bookmarksDirIndentation:"25px",bookmarksHorizontalPadding:"16px",scrollBarWidth:"11px",tooltipFontSize:"9px",overlayMaskColor:"rgba(0,0,0,0.5)",overlayHeaderHeight:"50px",fontFamily:"default",backgroundTransparency:.8,backgroundBlur:"7px"}},n:{override:!1,faviconShape:"new-1",faviconColor:"#646464",faviconBackground:"transparent",faviconPadding:10,autoOpen:!0,focusOmnibox:!1,searchField:"show",searchEngine:"google",searchEngineCustom:{title:"",homepage:"",queryUrl:""},gridType:"topPages",gridMaxCols:4,gridMaxRows:2,customGridLinks:[],topLinks:[],topLinksPosition:"right",website:""}};let a={},i=null,n=null;const s={};this.init=()=>new Promise((e=>{i=null,Promise.all([l(),c()]).then(e)}));const l=()=>new Promise((t=>{n&&n.disconnect(),n=e.api.runtime.connect(null,{name:"background"}),n.onMessage.addListener((e=>{s[e.uid]&&(s[e.uid](e.result),delete s[e.uid])})),t()})),c=()=>new Promise((t=>{const o=["utility","behaviour","appearance","newtab"],r={},n=o.length;let s=0;o.forEach((o=>{e.api.storage["utility"===o?"local":"sync"].get([o],(e=>{r[o]=e[o]||{},++s===n&&(a=r,null===i?this.call("userType").then((e=>{e&&e.userType&&(i=e.userType),t()})):t())}))}))})),d=e=>{switch(e){case"u":return"utility";case"b":return"behaviour";case"a":return"appearance";case"n":return"newtab"}return null};this.getUserType=()=>i,this.getAllData=()=>a,this.getDefaultData=()=>{const e={};return Object.entries(r).forEach((([t,o])=>{const r=d(t);r&&(e[r]=o)})),e},this.getDefaultColors=(e="default")=>Object.assign({},o.default,o[e]),this.getData=(e,o=!1)=>{let i=e;"string"==typeof i&&(i=[i]);let n={};if(i.forEach((e=>{const i=e.split("/")[0],s=e.split("/")[1];let l=null;const c=d(i);c&&a[c]&&(!0===o||void 0===a[c][s]?void 0!==r[i]&&void 0!==r[i][s]&&(l=r[i][s]):l=a[c][s]);const h=location.href.search(/chrome-extension:\/\//)>-1&&location.pathname.search(/settings\.html$/)>-1;if("b/toggleArea"===e&&matchMedia("(min-resolution: 1.25dppx)").matches&&!1===h&&(l=Object.assign({},l),Object.keys(l).forEach((e=>{e.startsWith("width")&&l[e]++}))),"a/styles"===e&&(l=Object.assign({},r.a.styles,l),t.helper.font&&t.helper.font.isLoaded())){const e=t.helper.font.getFontInfo(o?"default":"config");l.fontFamily=e.name,Object.assign(l,e.fontWeights)}n[s]=l})),"string"==typeof e){const t=e.split("/")[1];n=n[t]}return n},this.setData=t=>new Promise((o=>{c().then((()=>{Object.keys(t).forEach((e=>{const o=e.split("/")[0],r=e.split("/")[1],i=t[e];switch(o){case"u":a.utility[r]=i;break;case"b":a.behaviour[r]=i;break;case"a":a.appearance[r]=i;break;case"n":a.newtab[r]=i}}));let r=0;const i=(e=1)=>{r+=e,r>=4&&o()};try{e.api.storage.local.set({utility:a.utility},(()=>{e.api.runtime.lastError,i()})),e.api.storage.sync.set({behaviour:a.behaviour,appearance:a.appearance,newtab:a.newtab},(()=>{e.api.runtime.lastError,i(3)}))}catch(e){o()}}))})),this.call=(e,t={})=>new Promise((o=>{t.type=e,t.uid=e+"_"+JSON.stringify(t)+"_"+ +new Date+Math.random().toString(36).substr(2,12),s[t.uid]=e=>{o(e)},n.postMessage(t)}))}})(jsu);