(function(e){function t(t){for(var r,s,i=t[0],c=t[1],u=t[2],l=0,f=[];l<i.length;l++)s=i[l],o[s]&&f.push(o[s][0]),o[s]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);d&&d(t);while(f.length)f.shift()();return a.push.apply(a,u||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var c=n[i];0!==o[c]&&(r=!1)}r&&(a.splice(t--,1),e=s(s.s=n[0]))}return e}var r={},o={background:0},a=[];function s(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=r,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(n,r,function(t){return e[t]}.bind(null,r));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],c=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var d=c;a.push([3,"chunk-vendors"]),n()})({"0887":function(e,t){window.scenes=[{id:"ocean",name:{"zh-Hans":"海浪","zh-Hant":"海洋",en:"Ocean"},sound_url:"https://pics.tide.moreless.io/chrome/scene_ocean.mp3",cover_url:"http://pics.tide.moreless.io/preset_img/preset_focus_ocean.jpeg",scene_masks:["170,170,170,0.56","8,8,8,0.56"],primary_color:"21,95,106,1"},{id:"rain",name:{"zh-Hans":"雨天","zh-Hant":"雨天",en:"Rain"},sound_url:"https://pics.tide.moreless.io/chrome/scene_rain.mp3",cover_url:"http://pics.tide.moreless.io/preset_img/preset_focus_rain.jpeg",scene_masks:["157,211,255,0.56","0,40,80,0.56"],primary_color:"28,53,23,1"},{id:"forest",name:{"zh-Hans":"森林","zh-Hant":"森林",en:"Forest"},sound_url:"https://pics.tide.moreless.io/chrome/scene_forest.mp3",cover_url:"http://pics.tide.moreless.io/scenes/ln1kjd0GnkYXV_LsgFjOlsQRav5j",scene_masks:["145,255,199,0.56","0,60,0,0.56"],primary_color:"6, 39, 12, 1"},{id:"muse",name:{"zh-Hans":"冥想","zh-Hant":"冥想",en:"Muse"},sound_url:"https://pics.tide.moreless.io/chrome/scene_meditation.mp3",cover_url:"http://pics.tide.moreless.io/preset_img/preset_focus_muse.jpeg",scene_masks:["234,189,255,0.56","33,2,63,0.56"],primary_color:"96,91,90,1"},{id:"cafe",name:{"zh-Hans":"咖啡","zh-Hant":"咖啡店",en:"Café"},sound_url:"https://pics.tide.moreless.io/chrome/scene_coffee.mp3",cover_url:"http://pics.tide.moreless.io/scenes/FsHwADXbmEVcvdx7arLfykNsk-k6",scene_masks:["255,158,128,0.56","123,29,0,0.56"],primary_color:"30,30,30,1.0"}]},3:function(e,t,n){e.exports=n("fe77")},fe77:function(e,t,n){"use strict";n.r(t);n("96cf");var r=n("3b8d"),o=(n("6762"),n("2fdb"),n("cadf"),n("551c"),n("f751"),n("097d"),n("795b")),a=n.n(o),s=n("bc3a"),i=n.n(s),c=n("4328"),u=n.n(c),d=localStorage.getItem("env"),l="https://tide-api.moreless.io";"dev"===d&&(l="https://tide-api.moreless.io");var f={baseURL:l,withCredentials:!0,headers:{Accept:"application/json","Content-Type":"application/json","ML-AppID":7},data:{},paramsSerializer:function(e){return u.a.stringify(e,{indices:!1})}},p=i.a.create(f);p.interceptors.response.use(function(e){return e.data?e.data:{msg:"ok"}},function(e){return e.response?a.a.reject(e.response.data):a.a.reject({code:-1,msg:e.message})}),window.request=p;var m=n("faa1");(function(){var e=new m["EventEmitter"],t=!1,n=[],r=!1,o=!1,a=!1,s=15e5,i=3e5,c=12e5,u=4,d=0;function l(){chrome.storage.sync.set({settings:{immersiveMode:t,whiteList:n,workMode:r,autoFocus:o,autoBreak:a,focusDuration:s,breakDuration:i,longBreakDuration:c,longBreakFrequency:u,autoFocusCycle:d}})}chrome.storage.onChanged.addListener(function(e){if(e.settings){var l=e.settings.newValue;t=l.immersiveMode,n=l.whiteList,r=l.workMode,o=l.autoFocus,a=l.autoBreak,s=l.focusDuration,i=l.breakDuration,c=l.longBreakDuration,u=l.longBreakFrequency,d=l.autoFocusCycle}}),chrome.storage.sync.get("settings",function(l){if(l.settings){var f=l.settings;t=f.immersiveMode,n=f.whiteList,r=f.workMode,o=f.autoFocus,a=f.autoBreak,s=f.focusDuration,i=f.breakDuration,c=f.longBreakDuration,u=f.longBreakFrequency,d=f.autoFocusCycle}e.emit("inited")});var f={on:function(t,n){e.on(t,n)},set immersiveMode(e){t!==e&&(t=e,l())},get immersiveMode(){return t},get whiteList(){return new Proxy(n,{set:function(e,t,n){return e[t]=n,l(),!0}})},set workMode(e){r!==e&&(r=e,l())},get workMode(){return r},set autoFocus(e){o!==e&&(o=e,l())},get autoFocus(){return o},set autoBreak(e){a!==e&&(a=e,l())},get autoBreak(){return a},set focusDuration(e){s!==e&&(s=e,l())},get focusDuration(){return s},set breakDuration(e){i!==e&&(i=e,l())},get breakDuration(){return i},set longBreakDuration(e){c!==e&&(c=e,l())},get longBreakDuration(){return c},set longBreakFrequency(e){u!==e&&(u=e,l())},get longBreakFrequency(){return u},set autoFocusCycle(e){d!==e&&(d=e,l())},get autoFocusCycle(){return d}};window.settings=f})();n("ac6a");var g=n("e814"),h=n.n(g),w=(n("6b54"),[]),_=[],v=[],k={this_week_duration:0,this_week_times:0,today_duration:0,today_times:0,total_duration:0,total_times:0};function b(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function y(){var e=new Date,t=e.getDate(),n=e.getMonth(),r=e.getFullYear(),o=new Date(r,n,t),a=new Date(r,n,t,23,59,59);return[o/1e3,a/1e3]}function x(){var e,t,n=new Date,r=n.getDay(),o=n.getDate(),a=n.getMonth(),s=n.getFullYear();return r?(e=new Date(s,a,o-r+1),t=new Date(s,a,o+(7-r),23,59,59)):(e=new Date(s,a,-7),t=new Date(s,a,o,23,59,59)),[e/1e3,t/1e3]}function M(){return R.apply(this,arguments)}function R(){return R=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!userInfos){e.next=6;break}return e.next=3,request({url:"/v1/chrome_ext/users/self/focus/records/report",params:{time_zone_offset:-60*(new Date).getTimezoneOffset(),localtime:h()(+new Date/1e3)}});case 3:t=e.sent,e.next=9;break;case 6:return e.next=8,S();case 8:t=e.sent;case 9:return window.records.data=t,e.abrupt("return",t);case 11:case"end":return e.stop()}},e)})),R.apply(this,arguments)}function D(){window.records.data={this_week_duration:0,this_week_times:0,today_duration:0,today_times:0,total_duration:0,total_times:0}}function O(e,t){switch(arguments.length){case 1:return h()(Math.random()*e+1,10);case 2:return h()(Math.random()*(t-e+1)+e,10);default:return 0}}function j(e){var t=timer.paused_at;_.push({started_at:t,ended_at:e,duration:e-t})}function B(){var e,t=+new Date,n=v.length;e=n?v[n-1].ended_at:timer.started_at,v.push({started_at:e,ended_at:t,scene_id:picker.scenes[picker.current].id})}function F(){_=[],v=[]}function S(){return I.apply(this,arguments)}function I(){return I=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",new a.a(function(e){chrome.storage.local.get("heldRecords",function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(n){var r,o,a,s,i,c,u,d,l;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n.heldRecords?(r=0,o=0,a=0,s=0,i=0,c=0,u=n.heldRecords,d=y(),l=x(),u.forEach(function(e){var t=!1;l[0]<=e.started_at&&e.ended_at<=l[1]?(r+=e.ended_at-e.started_at,o+=1,t=!0):e.started_at<=l[0]&&l[0]<=e.ended_at&&e.ended_at<=l[1]?(r+=e.ended_at-l[0],o+=1,t=!0):l[0]<=e.started_at&&l[1]<=e.ended_at&&(r+=e.ended_at-e.started_at,o+=1,t=!0),t&&(d[0]<=e.started_at&&e.ended_at<=d[1]?(a+=e.ended_at-e.started_at,s+=1):e.started_at<=d[0]&&d[0]<=e.ended_at&&e.ended_at<=d[1]?(a+=e.ended_at-d[0],s+=1):d[0]<=e.started_at&&d[1]<=e.ended_at&&(a+=e.ended_at-e.started_at,s+=1)),i+=e.duration,c+=1}),e({this_week_duration:r,this_week_times:o,today_duration:a,today_times:s,total_duration:i,total_times:c})):e({this_week_duration:0,this_week_times:0,today_duration:0,today_times:0,total_duration:0,total_times:0});case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())}));case 1:case"end":return e.stop()}},e)})),I.apply(this,arguments)}function L(e){return T.apply(this,arguments)}function T(){return T=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,a,s,i,c,u;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=timer.started_at/1e3,r=+new Date/1e3,o=timer.duration-timer.remain,a=20,s=O(50,70),i=15,c=a+s+i,c>100&&(c=100),!(o>=0)){e.next=13;break}return u={started_at:n,ended_at:r,duration:h()(timer.duration/1e3),progress:h()(o/1e3),focus_mode:settings.immersiveMode?"immersive":"normal",finished_type:t?"finish":"giveup",pauses:_.map(function(e){return{started_at:e.started_at/1e3,ended_at:e.ended_at/1e3,duration:h()(e.duration/1e3)}}),base_score:a,negative_score:s,positive_score:i,total_score:c,local_id:b(),version:1,device_id:"chrome",record_at:r,client_platform:"Chrome",client_version:"1.0.1"},e.next=12,C(u);case 12:M();case 13:case"end":return e.stop()}},e)})),T.apply(this,arguments)}function E(e){return q.apply(this,arguments)}function q(){return q=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n,r,o,a,s,i,c,u;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=timer.started_at/1e3,r=+new Date/1e3,o=timer.duration-timer.remain,a=20,s=O(50,70),i=15,c=a+s+i,c>100&&(c=100),!(o>=0)){e.next=13;break}return u={started_at:n,ended_at:r,duration:h()(timer.duration/1e3),progress:h()(o/1e3),focus_mode:"rest",finished_type:t?"finish":"giveup",pauses:_.map(function(e){return{started_at:e.started_at/1e3,ended_at:e.ended_at/1e3,duration:h()(e.duration/1e3)}}),base_score:a,negative_score:s,positive_score:i,total_score:c,local_id:b(),version:1,device_id:"chrome",record_at:r,client_platform:"Chrome",client_version:"1.0.1"},e.next=12,C(u);case 12:M();case 13:case"end":return e.stop()}},e)})),q.apply(this,arguments)}function C(e){return H.apply(this,arguments)}function H(){return H=Object(r["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!userInfos){e.next=11;break}return e.prev=1,e.next=4,request({method:"POST",url:"/v1/chrome_ext/users/self/focus/records",data:{records:[t]}});case 4:e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](1),P(t);case 9:e.next=12;break;case 11:P(t);case 12:case"end":return e.stop()}},e,null,[[1,6]])})),H.apply(this,arguments)}function P(e){w.push(e),w.length>1e4&&w.splice(0,1),chrome.storage.local.set({heldRecords:w})}function z(){return A.apply(this,arguments)}function A(){return A=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:chrome.storage.local.get("heldRecords",function(){var e=Object(r["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!t.heldRecords){e.next=17;break}if(!userInfos){e.next=15;break}return e.prev=2,e.next=5,request({method:"POST",url:"/v1/chrome_ext/users/self/focus/records",data:{records:t.heldRecords}});case 5:w=[],chrome.storage.local.remove("heldRecords"),e.next=13;break;case 9:e.prev=9,e.t0=e["catch"](2),console.log(e.t0),w=t.heldRecords;case 13:e.next=16;break;case 15:w=t.heldRecords;case 16:M();case 17:case"end":return e.stop()}},e,null,[[2,9]])}));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e)})),A.apply(this,arguments)}function U(e,t,n,r){var o=void 0!=window.screenLeft?window.screenLeft:window.screenX,a=void 0!=window.screenTop?window.screenTop:window.screenY,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,i=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,c=s/window.screen.availWidth,u=(s-n)/2/c+o,d=(i-r)/2/c+a,l=window.open(e,t,"toolbar=no,location=no,directories=no,menubar=no,scrollbars=no,resizable=no,status=no, width="+n/c+", height="+r/c+", top="+d+", left="+u);window.focus&&l.focus()}function W(e){return V.apply(this,arguments)}function V(){return V=Object(r["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,t){e.next=5;break}return e.next=4,request({url:"/v1/chrome_ext/users/self"});case 4:t=e.sent;case 5:return window.userInfos=t,e.next=8,pageHistories.syncLogs();case 8:return e.next=10,records.syncRecords();case 10:return e.next=12,records.fetchRecords();case 12:e.next=18;break;case 14:e.prev=14,e.t0=e["catch"](0),window.userInfos=null,window.records.clearRecords();case 18:case"end":return e.stop()}},e,null,[[0,14]])})),V.apply(this,arguments)}function Y(){return N.apply(this,arguments)}function N(){return N=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:U("https://tide-api.moreless.io/static/login?platform=chrome_ext","TideLogin",1024,768);case 1:case"end":return e.stop()}},e)})),N.apply(this,arguments)}function X(e){return J.apply(this,arguments)}function J(){return J=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,request({method:"POST",url:"/v1/chrome_ext/code_login",data:{code:t}});case 2:return n=e.sent,window.userInfos=n,e.next=6,W(n);case 6:return chrome.runtime.sendMessage({type:"logined",userInfos:n}),e.abrupt("return",n);case 8:case"end":return e.stop()}},e)})),J.apply(this,arguments)}function G(e){return Q.apply(this,arguments)}function Q(){return Q=Object(r["a"])(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,request({url:"/v1/chrome_ext/logout",method:"POST",data:t});case 2:window.userInfos=null,chrome.runtime.sendMessage({type:"logout"}),records.clearRecords();case 5:case"end":return e.stop()}},e)})),Q.apply(this,arguments)}function K(){return Z.apply(this,arguments)}function Z(){return Z=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!window.userInfos){e.next=4;break}return e.next=3,request({url:"/v1/chrome_ext/users/self/refresh_token"});case 3:window.userInfos=e.sent;case 4:case"end":return e.stop()}},e)})),Z.apply(this,arguments)}window.records={addPauseDuration:j,addSceneDuration:B,getLocalRecords:S,resetReportData:F,reportedData:L,reportedBreakData:E,fetchRecords:M,clearRecords:D,syncRecords:z,data:k},window.userInfos=null,window.initUserInfos=W,window.loginWithCode=X,window.requestLogin=Y,window.logout=G,window.refreshToken=K;n("28a5");(function(){var e=null,t=+new Date,n=0,o=[];function s(){chrome.storage.local.get("batchStore",function(e){e.batchStore&&u(e.batchStore)})}function i(){return c.apply(this,arguments)}function c(){return c=Object(r["a"])(regeneratorRuntime.mark(function e(){var n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,request({url:"/v1/server_time"});case 2:n=e.sent,r=n.timestamp,t=1e3*r;case 5:case"end":return e.stop()}},e)})),c.apply(this,arguments)}function u(e){return d.apply(this,arguments)}function d(){return d=Object(r["a"])(regeneratorRuntime.mark(function e(t){var n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.map(function(e){return{domain:e.url.split("/")[2],started_at:h()(e.started_at/1e3),duration:h()(e.duration/1e3)}}),!window.userInfos){e.next=14;break}return e.prev=2,e.next=5,request({url:"/v1/chrome_ext/page_histories",method:"POST",data:{records:n,time_zone_offset:-60*(new Date).getTimezoneOffset()}});case 5:o=[],chrome.storage.local.remove("batchStore"),e.next=12;break;case 9:e.prev=9,e.t0=e["catch"](2),o=t;case 12:e.next=15;break;case 14:o=t;case 15:case"end":return e.stop()}},e,null,[[2,9]])})),d.apply(this,arguments)}function l(e){return f.apply(this,arguments)}function f(){return f=Object(r["a"])(regeneratorRuntime.mark(function e(r){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(r.started_at=t+n+performance.now()-r.duration,o.push(r),o.length>1e4&&o.splice(0,1),chrome.storage.local.set({batchStore:o}),!window.userInfos){e.next=7;break}return e.next=7,p();case 7:case"end":return e.stop()}},e)})),f.apply(this,arguments)}function p(){return m.apply(this,arguments)}function m(){return m=Object(r["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:clearTimeout(e),e=setTimeout(Object(r["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,w();case 3:g(),t.next=9;break;case 6:t.prev=6,t.t0=t["catch"](0),console.log(t.t0);case 9:e=null;case 10:case"end":return t.stop()}},t,null,[[0,6]])})),2e3);case 2:case"end":return t.stop()}},t)})),m.apply(this,arguments)}function g(){o=[],chrome.storage.local.remove("batchStore")}function w(){return _.apply(this,arguments)}function _(){return _=Object(r["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return t=o.map(function(e){return{domain:e.url.split("/")[2],started_at:h()(e.started_at/1e3),duration:h()(e.duration/1e3)}}),e.next=3,request({url:"/v1/chrome_ext/page_histories",method:"POST",data:{records:t,time_zone_offset:-60*(new Date).getTimezoneOffset()}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)})),_.apply(this,arguments)}function v(){return new a.a(function(e){chrome.storage.local.get("batchStore",function(){var t=Object(r["a"])(regeneratorRuntime.mark(function t(n){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:n.batchStore?e(n.batchStore):e([]);case 1:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}())})}setInterval(Object(r["a"])(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,request({url:"/v1/server_time"});case 2:r=e.sent,n=1e3*r.timestamp-(t+performance.now());case 4:case"end":return e.stop()}},e)})),36e5),i();var k={addLog:l,syncLogs:s,getLocalLogs:v};window.pageHistories=k})();n("7514");var $=n("5d73"),ee=n.n($),te=n("75fc");(function(){var e=0,t=0,n=[];function r(){if(e=0,n=[],window.settings.workMode)if(window.settings.longBreakFrequency){for(var t=0;t<window.settings.longBreakFrequency-1;t++)n=[].concat(Object(te["a"])(n),["focus","break"]);n=[].concat(Object(te["a"])(n),["focus","long_break"])}else n=["focus","break"];else n=["focus"]}function o(e){chrome.tabs.query({},function(t){var n=!0,r=!1,o=void 0;try{for(var a,s=ee()(t);!(n=(a=s.next()).done);n=!0){var i=a.value;i.url&&function(){var t=i.url.split("/")[2];if(window.settings.immersiveMode){var n=window.settings.whiteList.find(function(e){return t.includes(e)});n||chrome.tabs.sendMessage(i.id,e)}}()}}catch(c){r=!0,o=c}finally{try{n||null==s.return||s.return()}finally{if(r)throw o}}})}r(),window.settings.on("inited",function(){r()}),chrome.storage.onChanged.addListener(function(e){if(e.settings){var n=e.settings.oldValue,o=e.settings.newValue;n?(n.workMode!==o.workMode&&r(),n.focusDuration!==o.focusDuration&&"stop"===window.timer.status&&window.timer.applyStage(),n.breakDuration!==o.breakDuration&&"stop"===window.timer.status&&window.timer.applyStage(),n.longBreakDuration!==o.longBreakDuration&&"stop"===window.timer.status&&window.timer.applyStage(),n.longBreakFrequency!==o.longBreakFrequency&&r(),n.autoFocusCycle!==o.autoFocusCycle&&(t=0)):(r(),window.timer.applyStage())}}),chrome.browserAction.setBadgeBackgroundColor({color:"#8E8E93"}),window.timer=function(){var r={status:"stop",started_at:0,duration:5e3,remain:5e3,immersiveMode:!1},a=null,s=null;function i(){u(),window.dispatchEvent(new Event("timer-start")),"focus"===r.stage&&a&&+new Date>a+36e5&&(e=0)}function c(){r.status="playing";var e=+new Date;records.addPauseDuration(e),r.status="playing";var t=r.remain;clearInterval(s),s=null,s=setInterval(function(){r.remain=t-(+new Date-e);var n=Math.ceil(r.remain/1e3/60).toString();r.remain<=0&&(p(),n=""),"focus"===r.stage?(chrome.browserAction.setBadgeText({text:n}),o({type:"focusing",remain:r.remain})):["break","long_break"].includes(r.stage)&&chrome.browserAction.setBadgeText({text:chrome.i18n.getMessage("badgeTestRest")})},500)}function u(){r.status="playing";var e=+new Date;r.started_at=e,r.status="playing";var t=r.remain;clearInterval(s),s=null,s=setInterval(function(){r.remain=t-(+new Date-e);var n=Math.ceil(r.remain/1e3/60).toString();r.remain<=0&&(p(),n=""),"focus"===r.stage?(chrome.browserAction.setBadgeText({text:n}),o({type:"focusing",remain:r.remain})):["break","long_break"].includes(r.stage)&&chrome.browserAction.setBadgeText({text:chrome.i18n.getMessage("badgeTestRest")})},500)}function d(){clearInterval(s),s=null,r.status="pause",r.paused_at=+new Date}function l(){clearInterval(s),s=null,"focus"===r.stage&&(records.addPauseDuration(+new Date),records.addSceneDuration(),records.reportedData(!1)),r.remain=r.duration,r.status="stop",records.resetReportData(),e=0,t=0,g()}function f(){"focus"!==this.stage&&p(!0)}function p(){var o=arguments.length>0&&void 0!==arguments[0]&&arguments[0],c=window.settings.autoFocusCycle&&t+1>=window.settings.autoFocusCycle;if("focus"===r.stage){var u="long_break"===n[e+1];records.addSceneDuration(),records.reportedData(!0),o||notifications.focusFinish({workMode:window.settings.workMode,autoFocus:window.settings.autoFocus,autoBreak:window.settings.autoBreak},r.duration,records.data.today_times+1,window.settings.longBreakFrequency,c,u)}else records.reportedBreakData(!0),o||(c?notifications.lastBreakFinish({workMode:window.settings.workMode,autoFocus:window.settings.autoFocus,autoBreak:window.settings.autoBreak}):notifications.breakFinish({workMode:window.settings.workMode,autoFocus:window.settings.autoFocus,autoBreak:window.settings.autoBreak}));clearInterval(s),s=null,r.status="finish",records.resetReportData(),window.dispatchEvent(new Event("timer-finish")),"focus"===r.stage&&(a=+new Date),m();var d=n[e];g(),window.settings.workMode&&"focus"===d&&window.settings.autoFocus?(t+=1,!window.settings.autoFocusCycle||t<window.settings.autoFocusCycle?i():t=0):window.settings.workMode&&["break","long_break"].includes(d)&&window.settings.autoBreak&&i()}function m(){e+1>=n.length?e=0:e+=1}function g(){var t=n[e];switch(t){case"focus":r.duration=window.settings.focusDuration,r.remain=window.settings.focusDuration;break;case"break":r.duration=window.settings.breakDuration,r.remain=window.settings.breakDuration;break;case"long_break":r.duration=window.settings.longBreakDuration,r.remain=window.settings.longBreakDuration;break}r.status="stop",r.started_at=0,r.stage=t,chrome.browserAction.setBadgeText({text:""})}function h(){r.status="stop",r.started_at=0,records.resetReportData(),chrome.browserAction.setBadgeText({text:""}),g()}function w(e){window.settings.focusDuration=e,chrome.storage.sync.set({focusDuration:e}),g()}return g(),r.start=i,r.continue=c,r.stop=l,r.pause=d,r.skip=f,r.reset=h,r.setFocusDuration=w,r.applyStage=g,r}()})();n("0887");function ne(){return re.apply(this,arguments)}function re(){return re=Object(r["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,request({url:"/v1/chrome_ext/configs"});case 3:n=e.sent,t=n.scenes,e.next=10;break;case 7:e.prev=7,e.t0=e["catch"](0),t=window.scenes;case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}},e,null,[[0,7]])})),re.apply(this,arguments)}Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,Object(r["a"])(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,ne();case 2:return t=e.sent,n={scenes:t,current:0},r=t.length,n.next=function(){var e=n.current;n.current>=r-1?e=0:e+=1,n.setIndex(e)},n.prev=function(){var e=n.current;n.current<=0?e=r-1:e-=1,n.setIndex(e)},n.setIndex=function(e){n.current!==e&&(records.addSceneDuration(),n.current=e,window.dispatchEvent(new CustomEvent("picker-change",{detail:{current:n.current}})))},e.abrupt("return",n);case 9:case"end":return e.stop()}},e)}))();case 2:window.picker=e.sent;case 3:case"end":return e.stop()}},e)}))(),function(){var e=document.getElementById("audio");function t(e){return n.apply(this,arguments)}function n(){return n=Object(r["a"])(regeneratorRuntime.mark(function t(n){var r,s,i,c,u,d,l,f,p;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(r=e,s=1e3,i=o,c=13,u=r.volume,u!==n){t.next=7;break}return t.abrupt("return",a.a.resolve());case 7:if(d=u>n?"toLower":"toHigher",l=n-u,l&&s&&i&&c){t.next=12;break}return r.volume=n,t.abrupt("return",a.a.resolve());case 12:return f=Math.floor(s/c),p=1,t.abrupt("return",new a.a(function(e){var t=setInterval(function(){var o=u+i(p/f)*l;++p,r.volume=o,("toLower"===d&&r.volume<=n||"toHigher"===d&&r.volume>=n)&&(r.volume=o,clearInterval(t),e())},c)}));case 15:case"end":return t.stop()}},t)})),n.apply(this,arguments)}function o(e){return.5-Math.cos(e*Math.PI)/2}window.player=function(){var n={status:"stop",progress:0,muted:e.muted,setUrl:function(t){if(e.src!==t){var n=!e.paused&&!e.ended;e.src=t,n&&e.play()}},play:function(){e.volume=1,(e.paused||e.ended)&&e.play(),t(1),n.status="playing"},pause:function(){console.log("onPause:",e.paused),e.played&&(e.pause(),n.status="pause")},stop:function(){console.log("stop"),n.status="stop",t(0).then(function(){"stop"===n.status&&e.pause()})},muteOn:function(){e.muted=!1,n.muted=!1},muteOff:function(){e.muted=!0,n.muted=!0}};return e.addEventListener("timeupdate",function(){n.progress=Math.floor(e.currentTime/e.duration*100)},!1),e.addEventListener("play",function(){console.log("play"),window.dispatchEvent(new Event("player-play"))}),e.addEventListener("pause",function(){console.log("pause"),window.dispatchEvent(new Event("player-pause"))}),e.addEventListener("abort",function(){console.log("stop")}),n}()}();var oe=n("768b");(function(){var e=document.getElementById("ring");function t(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function n(e){var t=h()(e/60),n=e%60,r=t%60,o=h()(t/60);return o?"".concat(o," ").concat(chrome.i18n.getMessage("simplifiedHr")," ").concat(r," ").concat(chrome.i18n.getMessage("simplifiedMin")):r?"".concat(r," ").concat(chrome.i18n.getMessage("simplifiedMin")):"".concat(n," ").concat(chrome.i18n.getMessage("simplifiedSec"))}function r(t,n){chrome.notifications.create(t,n),e.play()}function o(e,o,a,s,i,c){var u,d,l=e.workMode,f=e.autoFocus,p=e.autoBreak,m=[];o=n(o/1e3),chrome.i18n.getMessage("notifications_focus_finish_title_0","".concat(s)),l?f&&p?(u=c?chrome.i18n.getMessage("notifications_focus_finish_title_1","".concat(s)):chrome.i18n.getMessage("notifications_focus_finish_title_0","".concat(o)),d=c?chrome.i18n.getMessage("notifications_focus_finish_message_4"):chrome.i18n.getMessage("notifications_focus_finish_message_3")):p?(u=c?chrome.i18n.getMessage("notifications_focus_finish_title_1","".concat(s)):chrome.i18n.getMessage("notifications_focus_finish_title_0","".concat(o)),d=c?chrome.i18n.getMessage("notifications_focus_finish_message_4"):chrome.i18n.getMessage("notifications_focus_finish_message_3")):f?(u=c?chrome.i18n.getMessage("notifications_focus_finish_title_1","".concat(s)):chrome.i18n.getMessage("notifications_focus_finish_title_0","".concat(o)),d=c?chrome.i18n.getMessage("notifications_focus_finish_message_2"):chrome.i18n.getMessage("notifications_focus_finish_message_1"),m=[{title:chrome.i18n.getMessage("notifications_buttons_0")},{title:chrome.i18n.getMessage("notifications_buttons_2")}]):(u=chrome.i18n.getMessage("notifications_focus_finish_title_0","".concat(o)),d=chrome.i18n.getMessage("notifications_focus_finish_message_1"),m=[{title:chrome.i18n.getMessage("notifications_buttons_0")},{title:chrome.i18n.getMessage("notifications_buttons_2")}]):(u=c?chrome.i18n.getMessage("notifications_focus_finish_title_1","".concat(s)):chrome.i18n.getMessage("notifications_focus_finish_title_0","".concat(o)),d=chrome.i18n.getMessage("notifications_focus_finish_message_0","".concat(a))),i&&(u=c?chrome.i18n.getMessage("notifications_focus_finish_title_4","".concat(s)):chrome.i18n.getMessage("notifications_focus_finish_title_3"),m=[{title:chrome.i18n.getMessage("notifications_buttons_0")},{title:chrome.i18n.getMessage("notifications_buttons_3")}]),r("focus_finish|".concat(t()),{type:"basic",iconUrl:"tide_48.png",title:u,message:d,buttons:m})}function a(e){var n,o,a=e.workMode,s=e.autoFocus,i=e.autoBreak,c=[];a&&(s&&i?(n=chrome.i18n.getMessage("notifications_break_finish_title_0"),o=chrome.i18n.getMessage("notifications_break_finish_message_1")):i?(n=chrome.i18n.getMessage("notifications_break_finish_title_0"),o=chrome.i18n.getMessage("notifications_break_finish_message_0"),c=[{title:chrome.i18n.getMessage("notifications_buttons_1")}]):s?(n=chrome.i18n.getMessage("notifications_break_finish_title_0"),o=chrome.i18n.getMessage("notifications_break_finish_message_1")):(n=chrome.i18n.getMessage("notifications_break_finish_title_0"),o=chrome.i18n.getMessage("notifications_break_finish_message_0"),c=[{title:chrome.i18n.getMessage("notifications_buttons_1")}]),r("break_finish|".concat(t()),{type:"basic",iconUrl:"tide_48.png",title:n,message:o,buttons:c}))}function s(e){var n,o,a=e.workMode,s=[];a&&(n=chrome.i18n.getMessage("notifications_break_finish_title_0"),o=chrome.i18n.getMessage("notifications_break_finish_message_2"),s=[{title:chrome.i18n.getMessage("notifications_buttons_4")}],r("break_finish|".concat(t()),{type:"basic",iconUrl:"tide_48.png",title:n,message:o,buttons:s}))}function i(e){switch(e){case 0:timer.start();break;case 1:timer.skip(),timer.start();break;default:break}}function c(e){switch(e){case 0:timer.start();break;default:break}}e.src="https://pics.tide.moreless.io/chrome/notification.mp3",chrome.notifications.onButtonClicked.addListener(function(e,t){var n=e.split("|"),r=Object(oe["a"])(n,1),o=r[0];switch(o){case"focus_finish":i(t);break;case"break_finish":c(t);break;default:break}}),window.notifications={focusFinish:o,breakFinish:a,lastBreakFinish:s}})(),window._gaq=window._gaq||[],window._gaq.push(["_setAccount","UA-75103409-6"]),window._gaq.push(["_trackPageview"]),function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://ssl.google-analytics.com/ga.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}(),window.addEventListener("timer-finish",function(){player.stop()},!1),window.addEventListener("timer-start",function(){setTimeout(function(){"focus"===timer.stage&&player.play()},200)},!1),window.addEventListener("player-play",function(){setTimeout(function(){"playing"!==timer.status&&timer.start()},200)},!1),window.addEventListener("player-pause",function(){setTimeout(function(){"playing"!==timer.status||["break","long_break"].includes(timer.stage)||(settings.immersiveMode?timer.stop():timer.pause())},200)},!1),chrome.runtime.onMessage.addListener(function(e,t){switch(e.type){case"closeCurrentTab":chrome.tabs.remove(t.tab.id);break;case"addViewHistory":pageHistories.addLog(e.log);break;case"stopFocus":timer.stop(),player.stop();break;case"loginWithCode":window.loginWithCode(e.code);break;default:break}}),window.syncData=Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,window.initUserInfos();case 2:window.refreshToken();case 3:case"end":return e.stop()}},e)})),window.syncData(),setInterval(Object(r["a"])(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:window.refreshToken();case 1:case"end":return e.stop()}},e)})),864e5)}});
//# sourceMappingURL=background.js.map