__filename="pages/options_ext.js",define(["./async_bg","./options_base","./options_wnd"],function(n,e,t){"use strict";function o(n){return new Date(+n-6e4*(new Date).getTimezoneOffset()).toJSON().slice(0,-5).replace("T"," ")}function i(e,t){return t&&("omniBlockList"===e||n.Rs.d.Ao([t]))?"$base64:"+btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(n,e){return String.fromCharCode(parseInt(e,16))})):t}function r(n){return n instanceof Array&&(n=n.join("\n").trimRight()),(n=n.replace(/\r\n?/g,"\n").replace(/\xa0/g," ")).replace(/^\$base64:(.*)/gm,function(n,e){try{return decodeURIComponent([].map.call(atob(e),function(n){return"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)}).join(""))}catch(n){}return n})}function s(t,i,s){var c,u,l,a,f,d,m,p,g,v,w,y,h,S,b,C=i.environment,V=C&&C.platform||"",k=C&&parseFloat(C.extension||0)||0,O=k>parseFloat(n.Js.L.St);if(V&&(V=(""+V).slice(0,10)),confirm(n.ls("confirmImport",[n.ls(true!==s?"backupFile":"recommendedFile"),k>1?n.ls("fileVCVer").replace("*",""+k):"",(k>1?n.ls("fileVCVer_2").replace("*",""+k):"")+(O?n.ls("fileVCNewer"):""),V?n.ls("filePlatform",[n.ls(V)||V[0].toUpperCase()+V.slice(1)]):n.ls("commonPlatform"),t?n.ls("atTime",[o(t)]):n.ls("before")]))){for(f in Object.setPrototypeOf(i,null),null==i.vimSync&&(u=(c=n.Js.it("vimSync"))&&confirm(n.ls("keepSyncing")),i.vimSync=u||null,c&&console.log("Before importing: You chose to",u?"keep settings synced.":"stop syncing settings.")),l=function(n,e,t,o){var i=arguments.length>3,r=i?o:t,s=["%s %c%s",n,"color:darkred",e];r="string"!=typeof r||r.length<=72?r:r.slice(0,71).trimRight()+"\u2026",i&&s.push(t),s.push(r),console.log.apply(console,s)},console.group("Import settings at "+o(Date.now())),t>1e4?console.info("load settings saved at %c%s%c.","color:darkblue",o(t),"color:auto"):console.info("load the settings:",s?"recommended.":"saved before."),(a=function(n){return n.split(" ").forEach(function(n){return delete i[n]})})("name time environment author description"),i)"@"===f[0]&&delete i[f];for(d=localStorage,m=n.Js.ct,p=e.Zs.Do,g=d.length;0<=--g;)(f=d.key(g)).includes("|")||f in i||(i[f]=null);for(f in a("findModeRawQuery findModeRawQueryList innerCSS findCSS omniCSS newTabUrl_f hookAccessKeys vomnibarPage_f"),n.Js.$t)f in i&&(i[n.Js.$t[f]]=i[f],delete i[f]);for(w in i.vimSync!==n.Js.it("vimSync")&&(l("import","vimSync",i.vimSync),n.Js.lt("vimSync",i.vimSync),p.vimSync.ws()),void 0!==(v=p.keyMappings)&&(delete p.keyMappings,p.keyMappings=v),p)if(h=i[f=(y=p[w]).Ss],delete i[f],null==h?h=m[f]:("string"==typeof m[f]&&(h=r(h)),h=y.Ps(h,"object"==typeof m[f])),y.u(n.Js.it(f),h)){if(y.bs)continue;y.ws()}else l("import",f,h),n.Js.lt(f,h),f in n.Js.ht&&e.Zs.cs.push(f),y.ws(),y.Ns&&y.Ns();for(f in i)if(null!=(h=i[f]))"string"==typeof m[f]&&(h=r(h)),f in m?n.Js.it(f)!==h&&(n.Js.lt(f,h),l("update",f,h)):(d.setItem(f,h),l("save",f,h));else{if(f in m){if(h=m[f],n.Js.it(f)!==h){n.Js.lt(f,h),l("reset",f,h);continue}h=n.Js.it(f)}else h=d.getItem(f);d.removeItem(f),l("remove",f,":=",h)}n.$("#saveOptions").onclick(false),n.$("#advancedOptionsButton").getAttribute("aria-checked")!==""+n.Js.it("showAdvancedOptions")&&n.$("#advancedOptionsButton").onclick(null,true),console.info("import settings: finished."),console.groupEnd(),(b=(S=window.VApi&&VApi.y().r)&&S.querySelector("#HCls"))&&(b.click(),n.$("#showCommands").click()),window.VApi&&VApi.t({k:202})}else window.VApi&&VApi.t({k:201})}function c(o,i,r){var c,u,l,a,f,d=null,m=null,p="";try{(c=(function(n){function e(){return/a?/.test("")}function t(n){for(var e=n.length;i.length<e;i+=i);return i.slice(0,e)}var o,i,r,s,c,u,l,a=/[^\r\n]+/g;if(!n||!(n=n.trimRight()))return null;i=" ";try{return c=JSON.parse(n.replace(/"(?:\\[^\r\n]|[^"\\\r\n])*"|'(?:\\[^\r\n]|[^'\\\r\n])*'|(?:\/\/|#)[^\r\n]*|\/\*[^]*?\*\//g,function(n){var e=n[0];return"/"===e||"#"===e?n.startsWith("/*")?n.replace(a,t):t(n):n})),e(),c}catch(n){if(o=/\b(?:position (\d+)|line (\d+) column (\d+))/.exec(n+""),e(),!o||!o[0])throw n}return o[2]?(r=+o[2],s=+o[3]):+o[1]>0?(u=n.includes("\r")?n.includes("\r\n")?"\r\n":"\r":"\n",s=(l=n.slice(0,+o[1]).split(u))[(r=l.length)-1].length+1):r=s=1,new SyntaxError(r+":"+s)})(r?i:i.replace(/\xa0/g," ")))instanceof Error?m=c:c?d=c:p=n.ls("notJSON")}catch(n){m=n}return null!=m&&(p=m?(m.message||m)+"":n.ls("exc")+(""!==m?m:n.ls("unknown")),p=(u=/^(\d+):(\d+)$/.exec(p))?n.ls("JSONParseError",[u[1],u[2]]):p),d?(o=+new Date(d.time||("object"==typeof o?+o:o))||0,"Vimium C"!==d.name&&"Vimium++"!==d.name||o<1e4&&o>0?(p=n.ls("notVCJSON"),alert(p)):(l=e.Zs.Do.keyMappings.$s?Promise.resolve():t.loadJS("options_checker.js"),a=o,f=d,void l.then(function(){setTimeout(s,17,a,f,r)}))):alert(p)}var u,l,a,f;n.$("#showCommands").onclick=function n(e){var o,i,r;if(window.VApi&&VApi.z){if(i=VApi.y().r,e&&e.preventDefault(),i&&(o=i.querySelector("#HCls"))&&(r=null!=i.querySelector(".HelpCommandName"),t.click(o),r))return;VApi.p({H:12}),e||setTimeout(function(){var n=VApi.y(),e=n.r&&n.r.querySelector("#HDlg");e&&e.querySelector("#HCls").addEventListener("click",function(){location.hash=""},true)},100)}else"undefined"!=typeof VimiumInjector&&setTimeout(n,120,null)},e.Ds.prototype.Qo=function(e){var t,o,i,r,s,c,u;if(!e||!this.Cr){for(c of(o=/^([:^]?[a-z\-?*]+:\/\/)?((?:[^\/]|\/])+)(\/[^\]].*|\/?$)/,i=/\\\./g,t=this._s()))(s=o.exec(r=c.pattern.replace("(?:[^./]+\\.)*?","*.")))&&s[1]&&s[2]&&(r=s[3]?s[3].replace(i,"."):"",(s=s[2].replace(i,".").split(".")).reverse(),r=s.join(".")+r),c.Rn=r;t.sort(function(n,e){return n.Rn<e.Rn?-1:n.Rn===e.Rn?0:1}),this.as(t),this.ns(),e&&(u=this,this.Cr=setTimeout(function(n,e){n.firstChild.data=e,u.Cr=0},1e3,e,e.firstChild.data),e.firstChild.data=n.ls("o3_2"))}},n.$("#exclusionSortButton").onclick=function(){e.Zs.Do.exclusionRules.Qo(this)},u="",window.addEventListener("unload",function(){u&&URL.revokeObjectURL(u)}),n.$("#exportButton").onclick=function(e){var r,s,c,l,a,f,d,m,p,g,v,w,y,h,S;for(u&&(URL.revokeObjectURL(u),u=""),s=!!e&&(e.ctrlKey||e.metaKey||e.shiftKey),c=new Date,(r=Object.create(null)).name="Vimium C",s||(r["@time"]=c.toLocaleString(),r.time=c.getTime()),r.environment={extension:n.Js.L.St,platform:n.Js.L.Dt},r.environment.chrome=n.f,l=[],a=localStorage,f=n.Js.ct,d=0,m=a.length;d<m;d++)(p=a.key(d)).includes("|")||p.endsWith("_f")||"findModeRawQueryList"===p||p.endsWith("CSS")||l.push(p);for(p of(l.sort(),g=function(e){var t=a.getItem(e);"string"!=typeof f[e]?r[e]=e in f?n.Js.it(e):t:t.includes("\n")?(r[e]=t.split("\n")).push(""):r[e]=t,"string"==typeof f[e]&&(r[e]="string"==typeof r[e]?i(e,r[e]):r[e].map(function(n){return i(e,n)}))},l))g(p);v=JSON.stringify(r,null,"\t")+"\n",w=o(c),"win"===r.environment.platform&&(v=v.replace(/\n/g,"\r\n")),r=null,y="vimium_c-",y+=s?"settings":w.replace(/[\-:]/g,"").replace(" ","_"),y+=".json",h=new Blob([v],{type:"application/json",endings:"native"}),(S=document.createElement("a")).download=y,S.href=URL.createObjectURL(h),t.click(S),u=S.href,console.info("EXPORT settings to %c%s%c at %c%s%c.","color:darkred",y,"color:auto","color:darkblue",w,"color:auto")},(l=n.$("#settingsFile")).onclick=null,l.onchange=function(){var t,o,i,r=this.files[0];this.value="",r&&(t=e.Zs.Do.vimSync.Os?102400:10485760,r.size&&r.size>t?alert(n.ls("JSONTooLarge",[r.name,t/1024])):(o=new FileReader,i=r.lastModified||r.lastModifiedDate||0,o.onload=function(){return c(i,this.result,false)},o.readAsText(r)))},(l=n.$("#importOptions")).onclick=null,l.onchange=function(){n.$("#importButton").focus(),"exported"!==this.value?fetch("../settings-template.json").then(function(n){return n.text()}).then(function(n){return c(0,n,true)}):t.click(n.$("#settingsFile"))},l=null,t.delayed_task&&(f=t.delayed_task,t.clear_delayed_task(),(a=n.$(f[0])).onclick&&a.onclick(f[1]))});