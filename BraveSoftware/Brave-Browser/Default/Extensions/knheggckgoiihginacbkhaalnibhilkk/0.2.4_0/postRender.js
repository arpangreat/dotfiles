(window.webpackJsonp=window.webpackJsonp||[]).push([[7,1],{1135:function(e,t,n){!function(e,t){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var s,o=e[Symbol.iterator]();!(r=(s=o.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(l){i=!0,a=l}finally{try{r||null==o.return||o.return()}finally{if(i)throw a}}return n}}(e,t)||function(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(){}function o(){}t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,o.resetWarningCache=s;var l=function(e,t){return e(t={exports:{}},t.exports),t.exports}((function(e){e.exports=function(){function e(e,t,n,r,i,a){if("SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"!==a){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:o,resetWarningCache:s};return n.PropTypes=n,n}()})),c=function(e){return null!==e&&"object"===n(e)},d=function e(t,n){if(!c(t)||!c(n))return t===n;var r=Array.isArray(t);if(r!==Array.isArray(n))return!1;var i="[object Object]"===Object.prototype.toString.call(t);if(i!==("[object Object]"===Object.prototype.toString.call(n)))return!1;if(!i&&!r)return!1;var a=Object.keys(t),s=Object.keys(n);if(a.length!==s.length)return!1;for(var o={},l=0;l<a.length;l+=1)o[a[l]]=!0;for(var d=0;d<s.length;d+=1)o[s[d]]=!0;var u=Object.keys(o);if(u.length!==a.length)return!1;var p=t,m=n;return u.every((function(t){return e(p[t],m[t])}))},u=function(e){var n=t.useRef(e);return t.useEffect((function(){n.current=e}),[e]),n.current},p=function(e){if(null===e||c(t=e)&&"function"==typeof t.elements&&"function"==typeof t.createToken&&"function"==typeof t.createPaymentMethod&&"function"==typeof t.confirmCardPayment)return e;var t;throw new Error("Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.")},m=function(e){if(function(e){return c(e)&&"function"==typeof e.then}(e))return{tag:"async",stripePromise:Promise.resolve(e).then(p)};var t=p(e);return null===t?{tag:"empty"}:{tag:"sync",stripe:t}},h=t.createContext(null);h.displayName="ElementsContext";var g=function(e){var n=e.stripe,r=e.options,a=e.children,s=t.useRef(!1),o=t.useRef(!0),l=t.useMemo((function(){return m(n)}),[n]),c=i(t.useState((function(){return{stripe:null,elements:null}})),2),p=c[0],g=c[1],b=u(n),f=u(r);return null!==b&&(b!==n&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it."),d(r,f)||console.warn("Unsupported prop change on Elements: You cannot change the `options` prop after setting the `stripe` prop.")),s.current||("sync"===l.tag&&(s.current=!0,g({stripe:l.stripe,elements:l.stripe.elements(r)})),"async"===l.tag&&(s.current=!0,l.stripePromise.then((function(e){e&&o.current&&g({stripe:e,elements:e.elements(r)})})))),t.useEffect((function(){return function(){o.current=!1}}),[]),t.useEffect((function(){var e=p.stripe;e&&e._registerWrapper&&e._registerWrapper({name:"react-stripe-js",version:"1.2.0"})}),[p.stripe]),t.createElement(h.Provider,{value:p},a)};g.propTypes={stripe:l.any,options:l.object};var b=function(e){return function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e}(t.useContext(h),e)},f=function(e){return(0,e.children)(b("mounts <ElementsConsumer>"))};f.propTypes={children:l.func.isRequired};var y=function(e){var n=t.useRef(e);return t.useEffect((function(){n.current=e}),[e]),function(){n.current&&n.current.apply(n,arguments)}},S=function(e){return c(e)?(e.paymentRequest,r(e,["paymentRequest"])):{}},v=function(){},E=function(e,n){var r,i="".concat((r=e).charAt(0).toUpperCase()+r.slice(1),"Element"),a=n?function(e){b("mounts <".concat(i,">"));var n=e.id,r=e.className;return t.createElement("div",{id:n,className:r})}:function(n){var r=n.id,a=n.className,s=n.options,o=void 0===s?{}:s,l=n.onBlur,c=void 0===l?v:l,u=n.onFocus,p=void 0===u?v:u,m=n.onReady,h=void 0===m?v:m,g=n.onChange,f=void 0===g?v:g,E=n.onEscape,M=void 0===E?v:E,w=n.onClick,C=void 0===w?v:w,O=b("mounts <".concat(i,">")).elements,k=t.useRef(null),P=t.useRef(null),T=y(h),D=y(c),I=y(p),j=y(C),x=y(f),B=y(M);t.useLayoutEffect((function(){if(null==k.current&&O&&null!=P.current){var t=O.create(e,o);k.current=t,t.mount(P.current),t.on("ready",(function(){return T(t)})),t.on("change",x),t.on("blur",D),t.on("focus",I),t.on("escape",B),t.on("click",j)}}));var A=t.useRef(o);return t.useEffect((function(){A.current&&A.current.paymentRequest!==o.paymentRequest&&console.warn("Unsupported prop change: options.paymentRequest is not a customizable property.");var e=S(o);0===Object.keys(e).length||d(e,S(A.current))||k.current&&(k.current.update(e),A.current=o)}),[o]),t.useEffect((function(){var e=k.current;return function(){e&&e.destroy()}}),[]),t.createElement("div",{id:r,className:a,ref:P})};return a.propTypes={id:l.string,className:l.string,onChange:l.func,onBlur:l.func,onFocus:l.func,onReady:l.func,onClick:l.func,options:l.object},a.displayName=i,a.__elementType=e,a},M="undefined"==typeof window,w=E("auBankAccount",M),C=E("card",M),O=E("cardNumber",M),k=E("cardExpiry",M),P=E("cardCvc",M),T=E("fpxBank",M),D=E("iban",M),I=E("idealBank",M),j=E("paymentRequestButton",M);e.AuBankAccountElement=w,e.CardCvcElement=P,e.CardElement=C,e.CardExpiryElement=k,e.CardNumberElement=O,e.Elements=g,e.ElementsConsumer=f,e.FpxBankElement=T,e.IbanElement=D,e.IdealBankElement=I,e.PaymentRequestButtonElement=j,e.useElements=function(){return b("calls useElements()").elements},e.useStripe=function(){return b("calls useStripe()").stripe},Object.defineProperty(e,"__esModule",{value:!0})}(t,n(0))},1140:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(367),a=n(3),s=n(45),o=n(11),l=n(350),c=n(1),d=n(746);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class m extends a.a{constructor(){super(...arguments),this.renderModal=()=>{const e=l.a.state;if(e.isOpen)return r.createElement(d.a,{captureSelection:!0,restoreSelection:!this.environment.device.isMobile,autocompleteQuery:e.autocompleteQuery,targets:e.targets,onAutocompleteQueryChange:this.handleAutocompleteQueryChange,onAccept:this.handleAccept,onCancel:this.handleCancel,desktopWidth:220,isAddTo:e.isAddTo,isCreateIn:!1})},this.handleAccept=async e=>{const t=o.c(this.environment);await i.a({environment:this.environment,value:e,transaction:t}),o.b({environment:this.environment,transaction:t})},this.handleCancel=()=>{i.c(this.environment)},this.handleAutocompleteQueryChange=e=>{l.a.state.isOpen&&l.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},l.a.state,{autocompleteQuery:e}))}}renderComponent(){const{device:e}=this.environment,t=l.a.state;return r.createElement(s.c,{popupType:e.isMobile?s.c.PopupType.SlideUp:s.c.PopupType.Popup,alignmentToOrigin:s.c.Alignment.Start,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>i.c(this.environment)})}}t.default=Object(c.h)(m)},1141:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(2),i=n(0),a=n(3),s=n(397),o=n(80),l=n(742),c=n(77),d=n(24),u=n(767),p=n(21),m=n(55),h=n(53),g=n(256),b=n(1657),f=n(122),y=n(79),S=n(342),v=n(45),E=n(772),M=n(65),w=n(361),C=n(616),O=n(1),k=n(92),P=n(39),T=n(258),D=n(20);function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){x(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}const A=["pdf","html","markdown"];class F extends a.a{constructor(){super(...arguments),this.storeTypes={exportTypePopupStore:y.a,pdfFormatPopupStore:y.a},this.renderMenu=()=>{const{device:e}=this.environment;if(!o.a.state.online)return this.renderOffline();const t=s.a.state;let n;return n=e.isMobile?{menuType:p.a.Modal,title:i.createElement(O.b,{id:"exportModal.title",defaultMessage:"Export"}),right:i.createElement(O.b,{id:"exportModal.closeButton.label",defaultMessage:"Close"}),onClickRight:this.handleCancel}:{menuType:p.a.Popup},t.open&&e.isMobile?i.createElement(p.b,Object.assign({},n),i.createElement(m.a,{type:m.a.Type.Vertical,initialFocus:void 0,sections:[{key:"exportOptions",render:e=>i.createElement(d.a,Object.assign({},e)),items:this.getExportOptionsMenuItems(t)},{key:"actions",render:e=>{let{children:t}=e,n=B(e,["children"]);return i.createElement(d.a,Object.assign({isSubmitButton:!0},n),t)},items:[{key:"submit",render:e=>i.createElement(u.a,Object.assign({title:i.createElement(O.b,{id:"exportModal.exportButton.label",defaultMessage:"Export"}),onClick:this.handleSubmit},e)),action:this.handleSubmit}]}]})):t.open?this.renderDesktopModal(t):void 0},this.handleSelectExportType=(e,t)=>{const n=s.a.state;if(!n.open)return;const{exportOptions:r}=n;if(e===r.exportType)return;let i;i=j({},r,"pdf"===e?{exportType:"pdf",pdfFormat:E.g(t)}:{exportType:e}),E.b(this.environment,j({},n,{exportOptions:i}))},this.handleSelectPaperFormat=e=>{const t=s.a.state;t.open&&s.c(t)&&E.b(this.environment,j({},t,{exportOptions:j({},t.exportOptions,{pdfFormat:e})}))},this.handleToggleRecursive=()=>{const e=s.a.state;if(e.open){if(s.c(e)&&!E.a(this.environment))return w.a(this.environment,{from:"export_modal",for:"enterprise"}),void this.handleUpgrade();E.b(this.environment,j({},e,{recursive:!e.recursive}))}},this.handleCancel=()=>{E.c()},this.handleSubmit=()=>{const e=s.a.state;e.open&&(E.c(),e.root.table===M.a?E.f(this.environment,{spaceId:e.root.id,exportOptions:e.exportOptions}):E.d(this.environment,{blockId:e.root.id,recursive:e.recursive,exportOptions:e.exportOptions}))},this.handleUpgrade=()=>{E.c()}}renderComponent(){const{device:e}=this.environment,t=s.a.state;return e.isMobile?i.createElement(v.c,{open:t.open,popupType:v.c.PopupType.SlideUp,origin:i.createElement("div",null),onDismiss:this.handleCancel,render:this.renderMenu}):i.createElement(l.a,{open:t.open,preventHideChildrenWhileOpening:!0,render:this.renderMenu,onDismiss:this.handleCancel})}renderOffline(){return i.createElement("div",{style:this.getOfflineStyle()},i.createElement(O.b,{defaultMessage:"Please go online to export.",id:"exportModal.offlineMessage.description"}))}renderDesktopModal(e){const{device:t,currentUser:n}=this.environment,r=s.c(e)&&!E.a(this.environment);return i.createElement("div",{style:this.getModalWrapStyle()},i.createElement(b.a,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:i.createElement(O.b,{id:"exportModal.exportFormat.description",defaultMessage:"Export format"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>i.createElement(d.a,Object.assign({},e)),items:A.map(t=>this.getBlockExportTypeMenuListItem(t,e,n.id))}]}),s.c(e)&&i.createElement(b.a,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:i.createElement(O.b,{id:"exportModal.pageFormat.description",defaultMessage:"Page format"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>i.createElement(d.a,Object.assign({},e)),items:f.a.map(t=>this.getPaperFormatMenuListItem(t,e))},{key:"otherPaperFormats",render:e=>i.createElement(d.a,Object.assign({topBorder:!0},e)),items:f.b.map(t=>this.getPaperFormatMenuListItem(t,e))}]}),"space"!==e.root.table&&i.createElement(C.a,{requireUpgradeToTier:r&&"enterprise",analyticsName:"export_modal",onClick:this.handleToggleRecursive,render:(n,a)=>i.createElement("div",Object.assign({},n,{style:{display:"flex",alignItems:"center",height:32}}),i.createElement("div",{style:{display:"flex",alignItems:"center",marginRight:"auto",color:this.theme.lightTextColor,fontSize:14}},i.createElement(O.b,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",a&&i.createElement("div",{style:{marginLeft:8}},a)),i.createElement(g.a,{on:e.recursive,isAndroid:t.isAndroid,disabled:r})),renderUpgradeTooltip:()=>i.createElement(T.a,{imageURL:D.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:i.createElement(O.b,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:i.createElement(O.b,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade}),i.createElement("div",{style:{display:"flex",alignItems:"center",marginTop:16}},i.createElement(c.a,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:this.handleCancel},i.createElement(O.b,{defaultMessage:"Cancel",id:"exportModal.cancelButton.label"})),i.createElement(S.a,{onClick:this.handleSubmit},i.createElement(O.b,{defaultMessage:"Export",id:"exportModal.exportButton.label"}))))}getExportOptionsMenuItems(e){const{currentUser:t,device:n}=this.environment;return r.compact([{key:"export type",render:r=>i.createElement(b.a,Object.assign({},r,{isMenuItem:n.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:i.createElement(O.b,{defaultMessage:"Export format",id:"exportModal.exportFormat.description"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>i.createElement(d.a,Object.assign({},e)),items:A.map(n=>this.getBlockExportTypeMenuListItem(n,e,t.id))}]})),action:()=>{this.stores.exportTypePopupStore.setState({open:!0})}},s.c(e)&&{key:"pdf format",render:t=>i.createElement(b.a,Object.assign({},t,{isMenuItem:n.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:i.createElement(O.b,{defaultMessage:"Page format",id:"exportModal.pageFormat.description"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>i.createElement(d.a,Object.assign({},e)),items:f.a.map(t=>this.getPaperFormatMenuListItem(t,e))},{key:"otherPaperFormats",render:e=>i.createElement(d.a,Object.assign({topBorder:!0},e)),items:f.b.map(t=>this.getPaperFormatMenuListItem(t,e))}]})),action:()=>{this.stores.pdfFormatPopupStore.setState({open:!0})}},"space"!==e.root.table&&{key:"recursive",render:t=>{let{onClick:r,key:a}=t,o=B(t,["onClick","key"]);const l=s.c(e)&&!E.a(this.environment);return i.createElement(C.a,{key:a,requireUpgradeToTier:l&&"enterprise",analyticsName:"export_modal",onClick:r,render:(t,r)=>i.createElement(h.a,Object.assign({},Object(k.a)(o,t),{title:i.createElement("div",{style:{display:"flex",alignItems:"center"}},i.createElement(O.b,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",r&&i.createElement("div",{style:{marginLeft:8}},r)),right:i.createElement(g.a,Object.assign({},n.isMobile?{}:Object(k.a)(o,t),{on:e.recursive,isAndroid:n.isAndroid,disabled:l}))})),renderUpgradeTooltip:()=>i.createElement(T.a,{imageURL:D.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:i.createElement(O.b,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:i.createElement(O.b,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade})},action:this.handleToggleRecursive}])}getBlockExportTypeTitle(e){switch(e){case"pdf":return i.createElement(O.b,{id:"exportModal.exportFormatButton.pdf.label",defaultMessage:"PDF"});case"markdown":return i.createElement(O.b,{id:"exportModal.exportFormatButton.markdownAndCSV.label",defaultMessage:"Markdown & CSV"});case"html":return i.createElement(O.b,{id:"exportModal.exportFormatButton.html.label",defaultMessage:"HTML"})}}getPDFFormatTitle(e){switch(e){case"Letter":return i.createElement(O.b,{id:"exportModal.pageFormatButton.letter.label",defaultMessage:"Letter"});case"A3":return i.createElement(O.b,{id:"exportModal.pageFormatButton.a3.label",defaultMessage:"A3"});case"A4":return i.createElement(O.b,{id:"exportModal.pageFormatButton.a4.label",defaultMessage:"A4"});case"Legal":return i.createElement(O.b,{id:"exportModal.pageFormatButton.legal.label",defaultMessage:"Legal"});case"Tabloid":return i.createElement(O.b,{id:"exportModal.pageFormatButton.tabloid.label",defaultMessage:"Tabloid"})}}getBlockExportTypeMenuListItem(e,t,n){const r=s.a.state,a=r.open&&"pdf"===e&&"space"===r.root.table&&!E.a(this.environment);return{key:e,action:()=>{if(t.close(),a)return w.a(this.environment,{from:"export_modal",for:"enterprise"}),void this.handleUpgrade();this.handleSelectExportType(e,n)},render:n=>{let{onClick:r,key:s}=n,o=B(n,["onClick","key"]);return i.createElement(C.a,{key:s,requireUpgradeToTier:a&&"enterprise",analyticsName:"export_modal",onClick:r,onUpgradeClick:()=>{t.close(),this.handleUpgrade()},render:(t,n)=>i.createElement(h.a,Object.assign({},Object(k.a)(o,t),{title:this.getBlockExportTypeTitle(e),right:n})),renderUpgradeTooltip:()=>i.createElement(T.a,{imageURL:D.a.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:i.createElement(O.b,{defaultMessage:"Upgrade to export the workspace as PDFs",id:"exportModal.workspacePdfUpgradeTooltip.title"}),caption:i.createElement(O.b,{defaultMessage:"Creates a zip file containing all pages in the workspace as PDF files.",id:"exportModal.workspacePdfUpgradeTooltip.caption"})}),tooltipPlacement:P.a.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2}})}}}getPaperFormatMenuListItem(e,t){return{key:e,action:()=>{t.close(),this.handleSelectPaperFormat(e)},render:t=>i.createElement(h.a,Object.assign({},t,{title:this.getPDFFormatTitle(e)}))}}getModalWrapStyle(){return{width:320,padding:24,fontSize:14}}getOfflineStyle(){return j({},this.getModalWrapStyle(),{color:this.theme.mediumTextColor})}}t.default=F},1142:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(3),a=n(835),s=n(742),o=n(22),l=n(342),c=n(20),d=n(217),u=n(834),p=n(257),m=n(1);class h extends i.a{constructor(){super(...arguments),this.handleModalDismiss=()=>{a.a.state.open&&a.a.state.onDecline&&a.a.state.onDecline(),a.a.setState({open:!1})},this.handleConnectClick=()=>{a.a.state.open&&a.a.state.onConfirm(),a.a.setState({open:!1})},this.handleConnectedAppsClick=()=>{this.handleModalDismiss(),u.a({currentTab:"connected_apps"})}}renderComponent(){const{device:e}=this.environment,t=a.a.state;return r.createElement(s.a,{open:t.open,innerStyle:h.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>r.createElement(r.Fragment,null,r.createElement("div",{style:h.modalHeaderWrapStyle},r.createElement("img",{src:c.a.images.googleDriveLogoPng,style:{width:50,display:"inline-block"}}),r.createElement("div",{style:this.getModalMessageStyle()},r.createElement(m.b,{defaultMessage:"Notion cannot access the Google Drive file you are trying to embed.",id:"googleAuthPromptModal.noAccessFile.errorMessage"})),e.isReactNative?r.createElement("div",{style:this.getModalMessageStyle()},r.createElement(m.b,{defaultMessage:"Please use Notion on desktop to connect a new account.",id:"googleAuthPromptModal.mobileUseDesktopPrompt.errorMessage"})):r.createElement(l.a,{isLarge:!0,onClick:this.handleConnectClick},r.createElement(m.b,{defaultMessage:"Connect to Google",id:"googleAuthPromptModal.connectToGoogleButton.label"})),!e.isMobile&&this.renderConnectedAccountsLink())),onDismiss:this.handleModalDismiss})}renderConnectedAccountsLink(){return r.createElement("div",{style:{display:"block",marginTop:d.a.vertical.tiny}},r.createElement(p.a,{underlined:!0,onClick:this.handleConnectedAppsClick},r.createElement(m.b,{defaultMessage:"See my connected accounts",id:"googleAuthPromptModal.seeConnectedAccountsButton.label"})))}getModalMessageStyle(){return{fontSize:16,lineHeight:1.5,fontWeight:o.a.fontWeight.medium,marginTop:15,marginBottom:20,color:this.theme.mediumTextColor}}}h.wrapStyle={padding:"24px 36px 24px",minWidth:300,maxWidth:400},h.modalHeaderWrapStyle={textAlign:"center",marginTop:8,marginBottom:18,justifyContent:"space-between"},t.default=h},1143:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(40),a=n(19),s=n(22),o=n(296),l=n(800),c=n(200),d=n(59),u=n(3),p=n(742),m=n(153),h=n(342),g=n(483),b=n(8),f=n(83),y=n(1),S=n(66);function v(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?v(Object(n),!0).forEach((function(t){M(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function M(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class w extends u.a{constructor(){super(...arguments),this.storeTypes={promoCodeStore:c.a,promoError:d.a.of(void 0)},this.handleModalDismiss=()=>{l.a.setState({open:!1})},this.handleChangeEmail=()=>{this.handleModalDismiss(),o.a.setState(E({},o.a.state,{open:!0,currentTab:"profile"}))},this.handleInputChange=e=>{this.stores.promoCodeStore.setState(E({},this.stores.promoCodeStore.state,{inputValue:e.target.value.toUpperCase()})),this.stores.promoError.set(void 0)},this.handleSubmitPromoCode=async()=>{const e=this.stores.promoCodeStore.state.inputValue;if(e){const t=await i.P(this.environment,{code:e});"failed"!==t.type&&t.data.promo?l.a.state.open&&(await l.a.state.handlePromoCode(this.stores.promoCodeStore.state.inputValue),this.handleModalDismiss()):this.stores.promoError.set(this.props.intl.formatMessage({defaultMessage:"Promo code {code} does not exist",id:"studentNotEligibleModal.numberedList.item2.promocode.errorMessage"},{code:e}))}}}renderComponent(){const{open:e}=l.a.state;return r.createElement(p.a,{open:e,innerStyle:w.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>this.renderModalContents(),onDismiss:this.handleModalDismiss})}renderModalContents(){return r.createElement("div",{style:{fontSize:14}},r.createElement("div",null,r.createElement(y.b,{defaultMessage:"<p>Unfortunately you are not eligible for a free Personal Pro plan if you use this email address.</p><p>K-12 students, K-12 educators, and personal email addresses such as Gmail and Outlook are not eligible to receive the <pricinglink>Personal Pro Plan</pricinglink> for free, but anyone is welcome to use the <pricinglink>Personal Plan</pricinglink> for free with unlimited storage.</p>",id:"studentNotEligibleModal.header",values:{br:r.createElement("br",null),p:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("p",{style:{marginTop:0,marginBottom:8}},1===t.length?t[0]:r.Children.toArray(t))},pricinglink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(g.a,{href:S.O},t)}}})),this.renderSchoolEmailCodePrompt(),this.renderPromoCode(),this.renderContactUs())}renderSchoolEmailCodePrompt(){const e=Object(f.g)(this.environment);return r.createElement("div",{style:{display:"flex",marginTop:16}},r.createElement("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},r.createElement(y.b,{defaultMessage:"1.",id:"studentNotEligibleModal.numberedList.firstItem"})),r.createElement("div",{style:{flexGrow:1}},r.createElement("div",{style:{color:this.theme.mediumTextColor}},r.createElement(y.b,{defaultMessage:"Your current email is:",id:"studentNotEligibleModal.numberedList.changeEmailItem.message"})),r.createElement("div",{style:{fontWeight:s.a.fontWeight.medium,marginTop:0}},e&&e.email),r.createElement("div",{style:{color:this.theme.mediumTextColor,marginTop:4}},r.createElement(y.b,{defaultMessage:"Thousands of university, college, and post-secondary school domains are already eligible, not just .edu emails!",id:"studentNotEligibleModal.numberedList.changeEmailItem.message2"})),r.createElement(h.a,{style:{marginTop:12},onClick:this.handleChangeEmail,isLarge:!0},r.createElement(y.b,{defaultMessage:"Change email",id:"studentNotEligibleModal.numberedList.changeEmailItem.button.label"}))))}renderPromoCode(){const e=this.stores.promoError.get(),t=this.props.intl.formatMessage({defaultMessage:"Enter student promo code…",id:"studentNotEligibleModal.numberedList.item2.promocodePlaceholder"});return r.createElement("div",{style:{display:"flex",marginTop:16}},r.createElement("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},r.createElement(y.b,{defaultMessage:"2.",id:"studentNotEligibleModal.numberedList.secondItem"})),r.createElement("div",{style:{flexGrow:1}},r.createElement("div",{style:{color:this.theme.mediumTextColor}},r.createElement(y.b,{defaultMessage:"Have a student promo code?",id:"studentNotEligibleModal.numberedList.promoCodeItem.message"})),r.createElement("div",{style:{display:"flex",marginTop:12}},r.createElement(m.b,{style:{marginRight:8,height:32},value:this.stores.promoCodeStore.state.inputValue,onChange:this.handleInputChange,onSubmit:this.handleSubmitPromoCode,placeholder:t}),r.createElement(h.a,{onClick:this.handleSubmitPromoCode,disabled:!this.stores.promoCodeStore.state.inputValue,isLarge:!0},r.createElement(y.b,{defaultMessage:"Submit",id:"studentNotEligibleModal.numberedList.promoCodeItem.submitButton"}))),r.createElement("div",{style:{color:a.f.red,fontSize:12,marginTop:4,marginLeft:8,height:20}},e)))}renderContactUs(){return r.createElement("div",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:14}},b.a.help({width:14,marginTop:1,marginRight:6,fill:this.theme.lightIconColor})," ",r.createElement("div",null,r.createElement(y.b,{defaultMessage:"Have questions about this? <inlinelink>More info & FAQs</inlinelink>.",id:"studentNotEligibleModal.contactUsSection.message",values:{inlinelink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(g.a,{href:"https://www.notion.so/Notion-for-students-teachers-adc631df15ee4ab9a7a33dd50f4c16fe",external:!0},t)}}})))}}w.wrapStyle={padding:"24px 36px 24px",minWidth:300,maxWidth:400},t.default=Object(y.h)(w)},1144:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(3),a=n(742),s=n(762),o=n(1),l=n(1401),c=n(342),d=n(295),u=n(81),p=n(17);function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class g extends i.a{constructor(){super(...arguments),this.storeTypes={},this.renderModal=()=>r.createElement("div",{style:this.getModalStyle()},r.createElement(l.a,{planInfo:{subscriptionTier:"team_free"}}),r.createElement("div",{style:this.getButtonContainerStyle()},r.createElement(d.a,{isLarge:!0,style:{marginLeft:"auto",marginRight:12},onClick:this.handleModalClose},r.createElement(o.b,{id:"spacePermissionSettingsTrialModal.cancel.label",defaultMessage:"Cancel"})),r.createElement(c.a,{onClick:this.handleTrialAccept,isLarge:!0},r.createElement(o.b,{id:"spacePermissionSettingsTrialModal.tryItFree.label",defaultMessage:"Try it free"})))),this.handleTrialAccept=async()=>{const{currentSpaceStore:e}=p.a.state;e&&(await u.a({environment:this.environment,spaceStore:e,planType:"team"}),this.handleModalClose())},this.handleModalClose=()=>{s.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},s.a.state,{open:!1}))}}renderComponent(){return r.createElement(a.a,{open:s.a.state.open,render:this.renderModal,onDismiss:this.handleModalClose})}getButtonContainerStyle(){return{display:"flex",marginTop:40}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:3,width:349,padding:24}}}t.default=g},1145:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(3),a=n(565),s=n(421),o=n(21),l=n(55),c=n(24),d=n(83),u=n(53),p=n(88),m=n(49),h=n(45),g=n(251),b=n(17),f=n(91),y=n(1),S=n(120);class v extends i.a{constructor(){super(...arguments),this.renderPopup=()=>{const{device:e}=this.environment,t=a.a.state;if(!t.open)return;const{currentUserRootStore:n}=b.a.state;if(!n)return;const i=d.j(n),m=[];for(const a of i){const n=a.getSpaceStore();if(n){const i=Object(S.getSpaceName)(this.environment,n),o=Object(S.getSpaceIcon)(this.environment,n);m.push({key:a.id,action:async()=>{await s.c({environment:this.environment,store:t.store,spaceStore:n,spaceViewStore:a,isPrivate:!0})},render:t=>r.createElement(u.a,Object.assign({title:i,icon:r.createElement(p.a,{icon:o,isEmptyPage:!1,title:i,size:e.isMobile?24:20,disabled:!0})},t))})}}const h=[{key:"spaces",render:t=>r.createElement(c.a,Object.assign({title:e.isMobile?void 0:r.createElement(y.b,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.chooseWorkspace.menuItem.title"}),isTitleUppercase:!0},t)),items:m},{key:"logout",render:e=>r.createElement(c.a,Object.assign({},e,{topBorder:!0})),items:[{key:"logout",action:()=>g.k(this.environment),render:e=>{const{currentUserStore:t}=b.a.state;let n="";if(t){const e=t.getValue();e&&(n=e.email)}return r.createElement(u.a,Object.assign({caption:r.createElement(y.b,{defaultMessage:"Log out ({email})",id:"duplicatePagePopup.buttonMenuItem.logoutButton.label",values:{email:n}})},e))}}]}];let v;return v=e.isMobile?{menuType:o.b.MenuType.Modal,title:r.createElement(y.b,{defaultMessage:"Choose a workspace",id:"duplicatePagePopup.choooseWorkspaceMobileMenu.title"}),right:r.createElement(f.CancelMenuText,null),onClickRight:s.a}:{menuType:o.b.MenuType.Popup},r.createElement(o.b,Object.assign({},v),r.createElement(l.a,{type:l.a.Type.Vertical,sections:h,initialFocus:1}))}}renderComponent(){const{device:e}=this.environment;return r.createElement(h.c,{popupType:e.isMobile?m.a.PopupType.SlideUp:m.a.PopupType.Popup,open:a.a.state.open,render:this.renderPopup,originGap:8,onDismiss:s.a,originRect:a.a.state.originRect,enableRounding:!0})}}t.default=v},1148:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(2),a=n(27),s=n(40),o=n(111),l=n(54),c=n(251),d=n(17),u=n(14),p=n(149),m=n(1),h=n(5);const g=Object(m.g)({deletingAccount:{id:"accountActions.deletingAccount.loadingMessage",defaultMessage:"Deleting your account…"},noUserError:{id:"accountActions.deletingAccount.noUserToDeleteMessage",defaultMessage:"No account to delete."}}),b=function(e){const{userStore:t,data:n,transaction:r}=e,i={};n.givenName&&(i.given_name=n.givenName),n.familyName&&(i.family_name=n.familyName),i.profile_photo=n.profilePhoto,a.d({store:t,data:i,transaction:r})};var f=n(117),y=n(81),S=n(16),v=n(13);class E extends S.a{getInitialState(){return{uploadingProfilePhoto:!1,givenName:"",familyName:"",startDayOfWeek:Object(v.H)()}}getValueForUser(e,t){const n=e.getValue();if(n){const{given_name:e,family_name:r,profile_photo:i}=n,a=t.getSettings();return{uploadingProfilePhoto:!1,givenName:e||"",familyName:r||"",profilePhoto:i,startDayOfWeek:void 0===a.start_day_of_week?Object(v.H)():a.start_day_of_week}}}}var M=E;class w extends S.a{getInitialState(){return{emailDomains:[],name:"",domain:""}}getValueForSpace(e){const t=e.getValue();if(t){const{name:e,domain:n,email_domains:r}=t;return{name:e||"",domain:n||"",emailDomains:r||[]}}}}var C=w;class O extends S.a{getInitialState(){return{disablePublicAccess:!1,disableGuests:!1,disableMoveToSpace:!1,disableExport:!1,disableSpacePageEdits:!1,disablePublicAccessRequests:!1}}getValueForSpace(e){const t=e.getValue();if(t){const{disable_public_access:e,disable_guests:n,disable_move_to_space:r,disable_export:i,disable_space_page_edits:a,disable_public_access_requests:s}=t;return{disablePublicAccess:Boolean(e),disableGuests:Boolean(n),disableMoveToSpace:Boolean(r),disableExport:Boolean(i),disableSpacePageEdits:Boolean(a),disablePublicAccessRequests:Boolean(s)}}}}var k=O;function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}async function D(e){const{environment:t,spaceId:n,store:r}=e,i=await s.S(t,{spaceId:n});if("failed"===i.type)l.d(i);else if(i.data&&i.data.samlConfig){const e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){T(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},i.data.samlConfig,{useMetadataUrl:Boolean(i.data.samlConfig.idpMetadataUrl)});return r.setState(e),i.data}return r.reset(),{}}class I extends S.a{getInitialState(){return{status:"unconfigured",emailDomains:[],spaceIds:[],createAccount:!1,useMetadataUrl:!1}}async getValueForSpace(e,t){const n=new I;return await D({environment:e,spaceId:t.id,store:n}),Promise.resolve(n.state)}}var j=I,x=n(296),B=n(3),A=n(586),F=n(742),R=n(1395),L=n(485),U=n(33),_=n(230),W=n(153),q=n(99),N=n(1195),z=n(743),V=n(748),H=n(11),G=n(59),Y=n(22),Q=n(249),K=n(195),Z=n(80),X=n(19),$=n(342),J=n(295);n(135);function ee(){return(navigator.languages?navigator.languages.map(e=>e.toLowerCase()):navigator.language?[navigator.language.toLowerCase()]:navigator.userLanguage?[navigator.userLanguage.toLowerCase()]:[]).map(e=>e.split("-")[0])}const te=["ar","az","he","fa","ur"];function ne(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function re(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ne(Object(n),!0).forEach((function(t){ie(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ne(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ie(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ae extends B.a{renderComponent(){return this.renderTranslatedText()}renderTranslatedText(){const{translations:e}=this.props,t=ee();for(const n of t){const t=e[n];if(t)return r.createElement("div",{style:this.getTextStyle(n)},t)}}getTextStyle(e){return te.includes(e)?re({direction:"rtl"},this.props.style):re({},this.props.style)}}var se=ae,oe=n(1200),le=n(498),ce=n(84),de=n(83),ue=n(1659),pe=n(255),me=n(1396),he=n(106),ge=n(8),be=n(620),fe=n(469),ye=n(257),Se=n(744);class ve extends S.a{getInitialState(){return{open:!1,authorized:!1,authorizationType:void 0}}}var Ee=ve,Me=n(483),we=n(223);function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Pe extends B.a{constructor(){super(...arguments),this.storeTypes={store:Ee},this.renderModalContent=()=>{const{store:e}=this.stores,{state:t}=e;return r.createElement("div",{style:Oe({},this.styles.modal,{},this.getColors().modal)},r.createElement(be.a,{fetch:this.getAuthorizationType,loading:e=>e&&r.createElement("div",{style:this.styles.loadingSpinner},r.createElement(q.a,null)),render:()=>r.createElement(r.Fragment,null,"Password"===t.authorizationType?this.renderVerifyPassword(t):"TemporaryPasscode"===t.authorizationType?this.renderVerifyCurrentEmail(t):void 0,t.authorized&&this.renderSetNewEmail(t))}))},this.renderSetNewEmail=e=>{const{store:t}=this.stores;if(t.state.authorized)return r.createElement(r.Fragment,null,r.createElement("p",{style:this.styles.paragraph},r.createElement(m.b,{id:"profileSettings.changeEmailModal.newEmailInstructions",defaultMessage:"Please enter a new email and we will send you a verification code."})),r.createElement("div",null,this.renderNewEmailInput()),t.state.newEmailPasscodeSent?this.renderNewEmailPasscodeInput(e):this.renderSendNewEmailPasscodeButton(e),this.renderEducationPlanDowngradeWarning())},this.handleSendCurrentEmailVerification=async()=>{const{userValue:e}=this.props,{store:t}=this.stores;if(!e)return;const n=await s.Rb(this.environment,{email:e.email,disableLoginLink:!0,isSignup:!1});"success"===n.type?t.setState(Oe({},t.state,{currentEmailPasscodeSent:!0,currentEmailPasscode:"",error:void 0})):t.setState(Oe({},t.state,{currentEmailPasscodeSent:!0,error:Object(we.b)(this.props.intl,n)}))},this.handleChangeCurrentEmailPasscode=e=>{const{store:t}=this.stores;t.setState(Oe({},t.state,{currentEmailPasscode:e.currentTarget.value,error:void 0}))},this.handleChangePassword=e=>{const{store:t}=this.stores;t.setState({open:!0,authorized:!1,authorizationType:"Password",password:e.currentTarget.value,error:void 0})},this.handleClearPassword=()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:"Password",password:""})},this.handleSubmitAuthorization=async()=>{const{store:e}=this.stores;if(!e.state.authorized)if("Password"===e.state.authorizationType){const t=this.getUserCurrentEmail();if(!t)return;const n=await s.xb(this.environment,{email:t,password:e.state.password});if("failed"===n.type)return void e.setState(Oe({},e.state,{error:Object(we.b)(this.props.intl,n)}));e.setState(Oe({},e.state,{authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1}))}else"TemporaryPasscode"===e.state.authorizationType&&e.setState(Oe({},e.state,{authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1}))},this.handleChangeNewEmail=e=>{const{store:t}=this.stores;t.setState(Oe({},t.state,{newEmail:e.currentTarget.value,error:void 0}))},this.handleClearNewEmail=()=>{const{store:e}=this.stores;e.setState(Oe({},e.state,{newEmail:"",newEmailPasscodeSent:!1,error:void 0}))},this.handleSendNewEmailVerification=async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t=await s.Qb(this.environment,{email:e.state.newEmail});"success"===t.type?e.setState(Oe({},e.state,{newEmailPasscodeSent:!0,newEmailPasscode:"",error:void 0})):e.setState(Oe({},e.state,{error:Object(we.b)(this.props.intl,t)}))},this.handleChangeNewEmailPasscode=e=>{const{store:t}=this.stores;t.setState(Oe({},t.state,{newEmailPasscode:e.currentTarget.value,error:void 0}))},this.handleSubmit=async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t="Password"===e.state.authorizationType?{type:"Password",password:e.state.password,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode}:{type:"CurrentEmail",currentEmailPasscode:e.state.currentEmailPasscode,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode},n=await s.k(this.environment,t);"success"===n.type?await this.closeModal():e.setState(Oe({},e.state,{error:Object(we.b)(this.props.intl,n)}))},this.handleSendUsMessageClick=()=>{Se.a({environment:this.environment,from:"change_email_student"})},this.openModal=()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:void 0})},this.closeModal=async()=>{const{store:e}=this.stores,{hasEducationPlan:t}=this.props;e.reset(),t&&await y.f(this.environment)},this.getAuthorizationType=async()=>{const{store:e}=this.stores,{intl:t}=this.props,n=this.getUserCurrentEmail();if(!n)return;const r=await fe.b({environment:this.environment,userEmail:n});r.error?e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:t.formatMessage({id:"profileSettings.changeEmailModal.errorFetchingAccountData",defaultMessage:"Could not fetch account information for {currentEmail}."},{currentEmail:n})}):r.value.hasPassword?e.setState({open:!0,authorized:!1,authorizationType:"Password",password:""}):e.setState({open:!0,authorized:!1,authorizationType:"TemporaryPasscode",currentEmailPasscodeSent:!1,currentEmailPasscode:""})},this.styles={modal:{width:460,padding:32,borderRadius:3,fontSize:14},loadingSpinner:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},paragraph:{marginTop:12,marginBottom:14},error:{color:X.f.red,fontSize:12,marginTop:4,marginLeft:8},bold:{fontWeight:Y.a.fontWeight.bold},input:{padding:"4px 8px"},button:{marginTop:14},educationPlanWarning:{display:"flex",marginTop:14,paddingTop:14}}}renderComponent(){const{userValue:e}=this.props,{store:t}=this.stores;return r.createElement(r.Fragment,null,r.createElement(V.a,null,r.createElement(m.b,{id:"profileSettings.personalInfoSection.emailSetting.label",defaultMessage:"Email"})),r.createElement("div",null,r.createElement("span",{style:{marginRight:12}},e&&e.email),r.createElement(ye.a,{onClick:this.openModal},r.createElement(m.b,{id:"profileSettings.personalInfoSection.emailSetting.changeEmailButton.label",defaultMessage:"Change email"}))),r.createElement(F.a,{open:t.state.open,onDismiss:this.closeModal,render:this.renderModalContent}))}renderVerifyPassword(e){const{userValue:t}=this.props;if(t)return r.createElement(r.Fragment,null,r.createElement("p",{style:{margin:0}},this.renderCurrentEmail()),r.createElement("p",{style:this.styles.paragraph},r.createElement(m.b,{id:"profileSettings.changeEmailModal.enterPasswordInstructions",defaultMessage:"Please enter your password."})),r.createElement(W.b,{style:{display:"none"},type:"text",value:t.email,autoComplete:"username",disabled:!0}),r.createElement(W.b,{type:"password",disabled:e.authorized,value:e.password,onChange:this.handleChangePassword,showClearButton:!0,onClearButtonClick:this.handleClearPassword,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.passwordInput.label",defaultMessage:"Password"}),style:this.styles.input,focusInitial:!0,autoComplete:"current-password"}),!e.authorized&&e.error&&r.createElement("div",{style:this.styles.error},e.error),!e.authorized&&r.createElement($.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},r.createElement(m.b,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderVerifyCurrentEmail(e){return r.createElement(r.Fragment,null,r.createElement("p",{style:Oe({},this.styles.paragraph,{marginTop:0})},this.renderCurrentEmail()," ",e.currentEmailPasscodeSent?r.createElement(m.b,{id:"profileSettings.changeEmailModal.sentVerificationCodeToCurrentEmail",defaultMessage:"We've sent a temporary verification code to this email."}):r.createElement(m.b,{id:"profileSettings.changeEmailModal.sendVerificationCodeToCurrentEmail",defaultMessage:"We'll send a temporary verification code to this email."})),e.currentEmailPasscodeSent?this.renderCurrentEmailPasscodeInput(e):this.renderSendCurrentEmailPasscodeButton())}renderSendCurrentEmailPasscodeButton(){return r.createElement($.a,{isLarge:!0,onClick:this.handleSendCurrentEmailVerification},r.createElement(m.b,{id:"profileSettings.changeEmailModal.sendCurrentEmailVerificationCode.label",defaultMessage:"Send verification code",description:"Sends a temporary verification passcode to the user's current email."}))}renderCurrentEmailPasscodeInput(e){return r.createElement(r.Fragment,null,r.createElement(W.b,{value:e.currentEmailPasscode,onChange:this.handleChangeCurrentEmailPasscode,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterCurrentEmailVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),!e.authorized&&r.createElement($.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},r.createElement(m.b,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderNewEmailInput(){const{store:e}=this.stores;if(e.state.authorized)return r.createElement(W.b,{value:e.state.newEmail,onChange:this.handleChangeNewEmail,onSubmit:this.handleSendNewEmailVerification,showClearButton:!0,onClearButtonClick:this.handleClearNewEmail,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.newEmailInput.placeholder",defaultMessage:"Enter new email"}),style:this.styles.input,focusInitial:!0})}renderSendNewEmailPasscodeButton(e){return r.createElement(r.Fragment,null,e.error&&r.createElement("div",{style:this.styles.error},e.error),r.createElement($.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSendNewEmailVerification},r.createElement(m.b,{id:"profileSettings.changeEmailModal.sendVerificationCodeButton.label",defaultMessage:"Send verification code"})))}renderNewEmailPasscodeInput(e){return r.createElement(r.Fragment,null,r.createElement("p",{style:this.styles.paragraph},r.createElement(m.b,{id:"profileSettings.changeEmailModal.verificationCodeSentMessage",defaultMessage:"We just sent you a temporary verification code to {newEmail}.",values:{newEmail:r.createElement("span",{style:this.styles.bold},e.newEmail)}})),r.createElement(W.b,{value:e.newEmailPasscode,onChange:this.handleChangeNewEmailPasscode,onSubmit:this.handleSubmit,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),e.error&&r.createElement("div",{style:this.styles.error},e.error),r.createElement($.a,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmit},r.createElement(m.b,{id:"profileSettings.changeEmailModal.changeEmailButton.label",defaultMessage:"Change email"})))}renderEducationPlanDowngradeWarning(){var e=this;const{hasEducationPlan:t}=this.props;if(t)return r.createElement("div",{style:Oe({},this.styles.educationPlanWarning,{},this.getColors().educationPlanWarning)},ge.a.help({width:14,marginTop:4,marginRight:6,fill:this.theme.lightIconColor})," ",r.createElement("div",null,r.createElement(m.b,{defaultMessage:"Changing your email may downgrade your workspace on a Free Education Plan to the basic Free Plan. You won't lose any data, but you'll need to upgrade to re-access paid features. Have questions about this? <sendmessagelink>Send us a message</sendmessagelink>.",id:"emailChangeSettings.downgradeEducationPlan.warning.message",values:{sendmessagelink:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:e.handleSendUsMessageClick},n)}}})))}renderCurrentEmail(){const{userValue:e}=this.props;if(e)return r.createElement(m.b,{id:"profileSettings.changeEmailModal.currentEmail",defaultMessage:"Your current email is {currentEmail}.",values:{currentEmail:r.createElement("span",{style:this.styles.bold},e&&e.email)}})}getUserCurrentEmail(){const{store:e}=this.stores,{userValue:t,intl:n}=this.props;if(t)return t.email;e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:n.formatMessage({id:"profileSettings.changeEmailModal.errorNoUserValue",defaultMessage:"User value is undefined."})})}getColors(){return{modal:{background:this.theme.contentBackground},educationPlanWarning:{color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}}}var Te=Object(m.h)(Pe),De=n(108),Ie=n(136),je=n(120);class xe extends S.a{getInitialState(){return{open:!1}}}var Be=new xe;function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){Re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Le extends B.a{constructor(){super(...arguments),this.handleLogOutFromActiveSessions=async()=>{await s.Bb(this.environment,{}),this.openConfirmationModal()}}renderComponent(){return r.createElement(r.Fragment,null,r.createElement("div",{style:this.getSettingsOptionStyle()},r.createElement(z.a,{smallMarginBottom:!0},r.createElement(m.b,{id:"manageActiveSessions.title",defaultMessage:"Log out of all devices"})),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.createElement(m.b,{id:"manageActiveSessions.logOutActiveSessions.label",defaultMessage:"You will be logged out of all other active sessions besides this one and will have to log back in."})),r.createElement(J.a,{isLarge:!0,isRed:!0,onClick:this.handleLogOutFromActiveSessions,style:{marginTop:12}},r.createElement(m.b,{id:"manageActiveSessions.logOutActiveSessions.button",defaultMessage:"Log out"}))),this.renderManageActiveSessionsModal())}renderManageActiveSessionsModal(){const{device:e}=this.environment,{open:t}=Be.state,n=this.getUserEmailAddress();return r.createElement(F.a,{open:t,onDismiss:this.closeConfirmationModal,innerStyle:{width:e.isPhone?"90%":350,padding:24,display:"flex",flexDirection:"column"},render:()=>r.createElement(r.Fragment,null,r.createElement("div",{style:{marginBottom:24}},n?r.createElement(m.b,{id:"manageActiveSessions.confirmationModal.withEmail",defaultMessage:"You have been logged out from other active sessions for {email}.",values:{email:n}}):r.createElement(m.b,{id:"manageActiveSessions.confirmationModal.withoutEmail",defaultMessage:"You have been logged out from other active sessions for your account."})),r.createElement($.a,{onClick:this.closeConfirmationModal},r.createElement(m.b,{id:"manageActiveSessions.confirmationModal.close",defaultMessage:"Close"})))})}openConfirmationModal(){Be.setState(Fe({},Be.state,{open:!0}))}closeConfirmationModal(){Be.setState(Fe({},Be.state,{open:!1}))}getUserEmailAddress(){let e=void 0;const{currentUserStore:t}=d.a.state;if(t){const n=t.getValue();e=n&&n.email}return e}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}var Ue=Le,_e=n(1478);function We(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function qe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?We(Object(n),!0).forEach((function(t){Ne(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):We(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ze extends B.a{constructor(){super(...arguments),this.storeTypes={spaceProfileSettingsStore:M,passwordRequestStore:pe.a,isEducationStore:G.a.of(!1)},this.handleUploadProfilePhoto=()=>{Q.c({environment:this.environment,onStart:this.handleUploadStart,bucket:"public",onError:this.handleUploadError,onComplete:this.handleUploadComplete,accept:"image/*"})},this.handleDeleteProfilePhoto=()=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{profilePhoto:void 0}))},this.handleUpdateClick=()=>{const{givenName:e,familyName:t,profilePhoto:n,startDayOfWeek:i}=this.stores.spaceProfileSettingsStore.state;e&&t?(H.d(this.environment,r=>{const{currentUserStore:a,currentUserSettingsStore:s}=d.a.state;if(a&&b({userStore:a,data:{givenName:e,familyName:t,profilePhoto:n},transaction:r}),s){s.getSettings().start_day_of_week!==i&&L.e({userSettingsStore:s,data:{start_day_of_week:i},transaction:r})}}),x.a.setState(qe({},x.a.state,{open:!1}))):l.e(r.createElement(m.b,{id:"profileSettings.personalInfoSection.firstOrLastNameMissing.message",defaultMessage:"Please fill in both first name and last name."}))},this.handleStartOfWeekToggle=()=>{const{state:e}=this.stores.spaceProfileSettingsStore,{startDayOfWeek:t}=e;this.stores.spaceProfileSettingsStore.setState(qe({},e,{startDayOfWeek:t?0:1}))},this.handleCancelClick=()=>{x.a.setState(qe({},x.a.state,{open:!1}))},this.handleGivenNameChange=e=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{givenName:e.target.value}))},this.handleFamilyNameChange=e=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{familyName:e.target.value}))},this.handleUploadStart=()=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{uploadingProfilePhoto:!0}))},this.handleUploadError=()=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{uploadingProfilePhoto:!1})),l.e(r.createElement(m.b,{id:"profileSettings.profilePhotoSection.uploadProfilePhotoError.message",defaultMessage:"Upload failed."}))},this.handleUploadComplete=e=>{this.stores.spaceProfileSettingsStore.setState(qe({},this.stores.spaceProfileSettingsStore.state,{profilePhoto:e[0],uploadingProfilePhoto:!1}))},this.handleDeleteAccountClick=async()=>{const{currentUserStore:e,currentUserRootStore:t}=d.a.state;if(!e||!t)return;const n=e.getValue();if(!n)return;const a=i.compact(t.getSpaceViewStores().map(e=>e.getSpaceStore())).filter(e=>!Object(le.e)(e.getValue(),e.getRole())),b=i.compact(a.map(e=>Object(je.getSpaceName)(this.environment,e)));await R.b({width:420,message:r.createElement("div",null,r.createElement("div",null,r.createElement(m.b,{id:"profileSettings.deleteAccountConfirmationDialog.warning",defaultMessage:"This action cannot be undone. This will permanently delete your entire account. All private workspaces will be deleted, and you will be removed from all shared workspaces."}),b.length>0&&r.createElement("ul",{style:{padding:0}},b.map(e=>r.createElement("li",{style:{marginTop:6,color:X.f.red,fontWeight:Y.a.fontWeight.medium,listStyle:"none"}},e)))," ",r.createElement(m.b,{id:"profileSettings.deleteAccountConfirmationDialog.prompt",defaultMessage:"Please type in your email to confirm."})),r.createElement(se,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente su cuenta completa. Se eliminarán todas las áreas de trabajo privadas y se eliminará de todas las áreas de trabajo compartidas. Por favor, escriba su correo electrónico para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит всю вашу учетную запись. Все частные рабочие области будут удалены, и вы будете удалены из всех общих рабочих областей. Пожалуйста, введите ваш адрес электронной почты для подтверждения.",zh:"此操作无法撤消。 这将永久删除您的整个帐户。 将删除所有私有工作空间，您将从所有共享工作空间中删除。 请输入您的电子邮箱进行确认。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird Ihr gesamtes Konto dauerhaft gelöscht. Alle privaten Arbeitsbereiche werden gelöscht und Sie werden aus allen freigegebenen Arbeitsbereichen entfernt. Bitte geben Sie Ihre E-Mail-Adresse zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement votre compte en entier. Tous les espaces de travail privés seront supprimés et vous serez supprimé de tous les espaces de travail partagés. Veuillez taper votre email pour confirmer.",ja:"この操作を元に戻すことはできません。 これによりアカウント全体が完全に削除されます。 すべてのプライベートワークスペースが削除され、あなたはすべての共有ワークスペースから削除されます。 確認のためにメールアドレスを入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'intero account. Tutti gli spazi di lavoro privati verranno eliminati e verranno rimossi da tutti gli spazi di lavoro condivisi. Inserisci la tua email per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente sua conta inteira. Todos os espaços de trabalho privados serão excluídos e você será removido de todos os espaços de trabalho compartilhados. Por favor, digite o seu email para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt uw gehele account permanent verwijderd. Alle privéwerkruimten worden verwijderd en u wordt verwijderd uit alle gedeelde werkruimten. Voer je e-mailadres in om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie całego konta. Wszystkie prywatne obszary robocze zostaną usunięte, a użytkownik zostanie usunięty ze wszystkich współużytkowanych obszarów roboczych. Wpisz swój e-mail, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort hela ditt konto permanent. Alla privata arbetsytor kommer att raderas, och du kommer att tas bort från alla delade arbetsytor. Vänligen skriv in din email för att bekräfta.",uk:"Цю дію не можна скасувати. Таким чином буде видалено весь обліковий запис назавжди. Всі приватні робочі області будуть видалені, і ви будете видалені з усіх спільних робочих областей. Будь ласка, введіть електронний лист для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette hele kontoen din. Alle private arbeidsområder blir slettet, og du vil bli fjernet fra alle delte arbeidsområder. Vennligst skriv inn din epost for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu işlem hesabınızın tamamını kalıcı olarak siler. Tüm özel çalışma alanları silinecek ve paylaşılan tüm çalışma alanlarından kaldırılacaksınız. Lütfen onaylamak için e-postanızı yazın.",cs:"Tuto akci nelze vrátit zpět. Tím bude trvale smazán celý váš účet. Všechny soukromé pracovní prostory budou smazány a budete ze všech sdílených pracovních prostor odstraněni. Pro potvrzení zadejte svůj e-mail.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn toàn bộ tài khoản của bạn. Tất cả các không gian làm việc riêng tư sẽ bị xóa và bạn sẽ bị xóa khỏi tất cả các không gian làm việc chung. Vui lòng nhập email của bạn để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette hele din konto. Alle private arbejdsområder slettes, og du vil blive fjernet fra alle delte arbejdsområder. Indtast venligst din email for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a teljes fiókot. Minden privát munkaterület törlődik, és eltávolításra kerül minden megosztott munkaterületről. Kérjük, írja be e-mail címét, hogy megerősítse.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي الإجراء إلى حذف حسابك بالكامل. سيتم أيضا حذف جميع مساحات العمل الخاصة ، وستتم إزالتك من جميع مساحات العمل المشتركة. يرجى كتابة البريد الإلكتروني الخاص بك للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบบัญชีทั้งหมดของคุณอย่างถาวร พื้นที่ทำงานส่วนตัวทั้งหมดจะถูกลบและคุณจะถูกลบออกจากพื้นที่ทำงานที่ใช้ร่วมกันทั้งหมด กรุณาพิมพ์อีเมลของคุณเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את כל החשבון שלך. כל סביבות העבודה הפרטיות יימחקו, ותוסר מכל סביבות העבודה המשותפות. הקלד את האימייל שלך כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa koko tilin pysyvästi. Kaikki yksityiset työtilat poistetaan ja poistetaan kaikista jaetuista työtiloista. Vahvistaaksesi kirjoita sähköpostiosoitteesi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus seluruh akun Anda. Semua ruang kerja pribadi akan dihapus, dan Anda akan dihapus dari semua ruang kerja bersama. Ketikkan email Anda untuk mengonfirmasi."}})),acceptLabel:0===b.length?r.createElement(m.b,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountButton.label",defaultMessage:"Permanently delete account"}):r.createElement(m.b,{id:"profileSettings.deleteAccountConfirmationDialog.deleteAccountAndWorkspacesButton.label",defaultMessage:"{numberOfWorkspaces, plural, one {Permanently delete account and 1 workspace} other {Permanently delete account and {numberOfWorkspaces} workspaces}}",values:{numberOfWorkspaces:b.length}}),requiredInputValue:n.email})&&(x.a.reset(),async function(e){o.b({message:g.deletingAccount});const t=e.currentUser.id,{currentUserRootStore:n,currentUserStore:r}=d.a.state;if(!n||!r||!t)return o.a(),void l.e(h.a.formatMessage(g.noUserError));u.ob(e),await s.r(e,{}),await p.a.clearForUser(t),c.l({environment:e,userId:t}),o.a()}(this.environment))}}willMount(e){super.willMount(e);const{spaceProfileSettingsStore:t,isEducationStore:n}=this.stores,{currentUserStore:r,currentUserSettingsStore:i,currentUserRootStore:a}=d.a.state;if(r&&i){const e=t.getValueForUser(r,i);e&&t.setState(e)}if(a){const e=(Object(he.b)({environment:this.environment,userRootStore:a})||[]).some(e=>e===U.a.pricing.student.productId);n.set(e)}}renderComponent(){return Z.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,style:{textAlign:"center"}},r.createElement(m.b,{defaultMessage:"Please go online to manage your profile.",id:"profileSettings.offline.message"})))}renderSettings(){const{currentUserStore:e}=d.a.state;if(!e)return;e.getValue();const{profilePhoto:t,uploadingProfilePhoto:n,givenName:i,familyName:a,startDayOfWeek:s}=this.stores.spaceProfileSettingsStore.state,{passwordRequestStore:o}=this.stores,l="on"===De.a.getGroup(this.environment,"lion-tamer"),c="on"===De.a.getGroup(this.environment,"user-data-consent");return o.state.loading?r.createElement(q.a,{style:{margin:"50% auto"}}):r.createElement(N.a,{controlRow:this.renderControlRow()},this.renderSpaceProfileHeader(),r.createElement("div",{style:{marginBottom:24}},r.createElement(oe.a,{title:r.createElement(r.Fragment,null,r.createElement(m.b,{id:"profileSettings.helpButton.caption",defaultMessage:"Changes to account settings will apply to all of your workspaces."})," ",r.createElement(m.b,{id:"profileSettings.helpButton.learnMoreLink",defaultMessage:"<s>Learn more.</s>",values:{s:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("span",{style:{textDecoration:"underline"}},t)}}})),href:Object(Ie.a)("guides.profileSettings"),analyticsFrom:"profile_settings"})),r.createElement(z.a,null,r.createElement(m.b,{id:"profileSettings.profilePhotoSection.title",defaultMessage:"Photo"})),t&&r.createElement(K.a,{url:t,isAuthenticated:!1,stripGoogleIconQuery:!0,width:90,render:(e,t)=>r.createElement("div",{style:{width:90,height:90}},r.createElement(_.a,{src:t,style:{width:90,height:90,objectFit:"cover",borderRadius:"100%"}}))}),r.createElement(J.a,{isLarge:!0,onClick:this.handleUploadProfilePhoto,style:{marginTop:8,marginBottom:4}},r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement(m.b,{id:"profileSettings.profilePhotoSection.uploadPhotoButton.label",defaultMessage:"Upload photo"}),n&&r.createElement(q.a,{style:{marginLeft:4}}))),t&&"on"===De.a.getGroup(this.environment,"remove-profile-photo-string")&&r.createElement(J.a,{onClick:this.handleDeleteProfilePhoto,style:{marginTop:4,marginLeft:12,marginBottom:2}},r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement(m.b,{id:"profileSettings.profilePhotoSection.removePhotoButton.label",defaultMessage:"Remove"}))),N.a.renderDivider(),r.createElement(z.a,null,r.createElement(m.b,{id:"profileSettings.personalInfoSection.title",defaultMessage:"Personal info"})),r.createElement(Te,{userValue:Object(de.g)(this.environment),hasEducationPlan:this.stores.isEducationStore.get()}),r.createElement(V.a,{hasMarginTop:!0},r.createElement(m.b,{id:"profileSettings.personalInfoSection.firstNameInput.label",defaultMessage:"First name",description:"User's first name, also known as forename or given name."})),r.createElement(W.b,{value:i,onChange:this.handleGivenNameChange}),r.createElement(V.a,{hasMarginTop:!0}," ",r.createElement(m.b,{id:"profileSettings.personalInfoSection.lastNameInput.label",defaultMessage:"Last name",description:"User's last name, also known as family name or surname"})),r.createElement(W.b,{value:a,onChange:this.handleFamilyNameChange}),N.a.renderDivider(),r.createElement(ue.a,{isEducationPlan:this.props.isEducationPlan,requestStore:o}),c&&N.a.renderDivider(),c&&r.createElement(_e.a,null),N.a.renderDivider(),r.createElement(Ue,null),!l&&N.a.renderDivider(),!l&&r.createElement(me.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:s}),N.a.renderDivider(),r.createElement(z.a,null,r.createElement(m.b,{id:"profileSettings.dangerousSettings.title",defaultMessage:"Danger zone",description:"Title for the user settings that we consider 'dangerous', like deleting an account."})),r.createElement(J.a,{isLarge:!0,isRed:!0,onClick:this.handleDeleteAccountClick},r.createElement(m.b,{id:"profileSettings.dangerousSettings.deleteAccountButton.label",defaultMessage:"Delete my account"})))}renderControlRow(){return r.createElement("div",{style:{display:"flex"}},r.createElement($.a,{isLarge:!0,onClick:this.handleUpdateClick},r.createElement(m.b,{id:"profileSettings.updateButton.label",defaultMessage:"Update"})),r.createElement(J.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.createElement(m.b,{id:"profileSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderSpaceProfileHeader(){return r.createElement(z.a,{large:!0,divider:"full"},r.createElement(m.b,{id:"profileSettings.title",defaultMessage:"Account"}))}}var Ve=Object(m.h)(ze);function He(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ge(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ye extends B.a{renderComponent(){return r.createElement("div",{style:this.getStyle(),onMouseDown:this.props.onMouseDown,onClick:this.props.onClick,onDoubleClick:this.props.onDoubleClick,onContextMenu:this.props.onContextMenu},r.createElement("div",{style:this.getSidebarStyle()},this.props.sidebar),r.createElement("div",{style:this.getChildrenStyle()},this.props.children))}getStyle(){return{display:"flex",height:"100%",flexDirection:this.props.isReversed?"row-reverse":"row"}}getSidebarStyle(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?He(Object(n),!0).forEach((function(t){Ge(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):He(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({width:160,height:"100%",background:this.theme.sidebarBackground,flexGrow:0,flexShrink:0},this.props.sidebarStyle)}getChildrenStyle(){return{flexGrow:1,position:"relative",zIndex:1,height:"100%"}}}var Qe=Ye,Ke=n(88),Ze=n(92);function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(n),!0).forEach((function(t){Je(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class et extends B.a{constructor(){super(...arguments),this.handleKeyDown=e=>{"Backspace"===e.key&&0===this.props.value.length&&this.props.onRemoveLastToken()}}renderComponent(){const{device:e}=this.environment;return r.createElement("div",{onClick:this.props.onClick,style:e.isMobile?this.getMobileWrapStyle():this.getDesktopWrapStyle()},this.props.tokens,this.renderInput())}renderInput(){const{device:e}=this.environment,t=0===this.props.tokens.length;return r.createElement(W.b,Object.assign({format:W.b.Format.Transparent},Object(Ze.a)({onKeyDown:this.handleKeyDown},{onChange:this.props.onChange}),{value:this.props.value,onSubmit:this.props.onSubmit,onBlur:this.props.onBlur,focus:this.props.focus,style:$e({},et.inputStyle,{margin:e.isMobile?"0 8px 8px 0":"0 6px 6px 0"}),readOnly:this.props.readOnly,inputStyle:{height:18},size:1,type:this.props.type,placeholder:t?this.props.placeholder:"",autoComplete:"off",autoCorrect:"off",autoCapitalize:"off",spellCheck:!1}))}getDesktopWrapStyle(){return $e({display:"flex",flexWrap:"wrap",alignItems:"flex-start",minHeight:32,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,borderRadius:3,fontSize:14,cursor:"text",overflow:"hidden",padding:"7px 9px 0px"},this.props.style)}getMobileWrapStyle(){return $e({},this.getDesktopWrapStyle(),{fontSize:14,padding:"7px 10px 0"})}}et.inputStyle={flexGrow:1,flexShrink:1,flexBasis:60,minWidth:60,width:"auto",lineHeight:"20px"};var tt=et,nt=n(147),rt=n(39),it=n(250),at=n(45),st=n(21),ot=n(55),lt=n(53),ct=n(24),dt=n(125),ut=(n(690),n(772)),pt=n(750),mt=n(192),ht=n(271),gt=n(37),bt=n(504);function ft(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ft(Object(n),!0).forEach((function(t){St(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ft(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vt(){return r.createElement(m.b,{id:"spaceBasicSettings.workspaceNameSection.nameInput.caption",defaultMessage:"You can use your name or the name of your team. Keep it simple.",description:"The caption below the text input where a user edits the name of their workspace"})}const Et=Object(m.g)({nameInputPlaceholder:{id:"spaceBasicSettings.nameInput.placeholder",defaultMessage:"e.g. company name"},workspaceDomainInputPlaceholder:{id:"spaceBasicSettings.domainSection.workspaceDomainInput.placeholder",defaultMessage:"URL"},allowedEmailDomainsInputPlaceholder:{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.placeholder",defaultMessage:"Type an email domain…"},copyDomainTooltip:{id:"spaceBasicSettings.workspaceDomain.tooltip",defaultMessage:"Click to copy link"}});class Mt extends B.a{constructor(){super(...arguments),this.storeTypes={spaceBasicSettingsStore:C,tokenQuery:G.a.of("")},this.handleSpaceNameChange=e=>{this.stores.spaceBasicSettingsStore.setState(yt({},this.stores.spaceBasicSettingsStore.state,{name:e.target.value}))},this.handleSpaceUrlChange=e=>{this.stores.spaceBasicSettingsStore.setState(yt({},this.stores.spaceBasicSettingsStore.state,{domain:f.z(e.target.value)})),this.forceUpdate()},this.handleConfirm=async()=>{const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores,{name:n,domain:r,emailDomains:i}=t.state,a=t.getValueForSpace(e);a&&!Object(bt.a)(a.emailDomains,i)&&u.j(this.environment,{domains:i,confirmed:!0}),await f.y({environment:this.environment,spaceStore:e,name:n,domain:r||void 0,emailDomains:i}),x.a.setState(yt({},x.a.state,{open:!1}))},this.handleCancelClick=()=>{x.a.setState(yt({},x.a.state,{open:!1}))},this.handleExportClick=()=>{const{currentSpaceStore:e}=d.a.state;e&&ut.h({environment:this.environment,root:{table:"space",id:e.id}})},this.handleExportMembersClick=()=>{const{currentSpaceStore:e}=d.a.state,{data:t}=dt.a.state;e&&t&&"subscribed_admin"===t.type&&ut.e({spaceStore:e,subscriptionData:t,intl:this.props.intl})},this.handleLeaveClick=()=>{const{spaceStore:e}=this.props,{currentUserSettingsStore:t}=d.a.state;t&&l.c({message:r.createElement(m.b,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.prompt",defaultMessage:"Are you sure you want to leave this workspace?"}),showCancel:!0,keepFocus:!0,items:[{label:r.createElement(m.b,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.leaveButton.label",defaultMessage:"Leave"}),color:"red",onAccept:async()=>{await f.l({environment:this.environment,spaceId:e.id,userSettingsStore:t})&&(u.Yb(this.environment),x.a.setState(yt({},x.a.state,{open:!1})))}}]})},this.handleDeleteClick=async()=>{const{currentUserSettingsStore:e}=d.a.state;if(!e)return;const{spaceStore:t,intl:n}=this.props,i=Object(je.getSpaceName)(this.environment,t)||n.formatMessage({defaultMessage:"Untitled workspace",id:"spaceBasicSettings.deleteWorkspace.untitledWorkspace.placeholder"});await R.b({message:r.createElement("div",null,r.createElement("div",null,r.createElement(m.b,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.prompt",defaultMessage:"This action cannot be undone. This will permanently delete the workspace, including all pages and files. Please type the name of the workspace to confirm."})),r.createElement(se,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente el espacio de trabajo, incluidas todas las páginas y archivos. Por favor escriba el nombre del espacio de trabajo para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит рабочее пространство, включая все страницы и файлы. Пожалуйста, введите название рабочей области для подтверждения.",zh:"此操作无法撤消。 这将永久删除工作区，包括所有页面和文件。 请输入要确认的工作空间的名称。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird der Arbeitsbereich einschließlich aller Seiten und Dateien dauerhaft gelöscht. Bitte geben Sie den Namen des Arbeitsbereichs zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement l'espace de travail, y compris toutes les pages et tous les fichiers. Veuillez saisir le nom de l'espace de travail pour confirmer.",ja:"この操作を元に戻すことはできません。 これにより、すべてのページとファイルを含むワークスペースが完全に削除されます。 確認するワークスペースの名前を入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'area di lavoro, incluse tutte le pagine e i file. Digita il nome dell'area di lavoro per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente o espaço de trabalho, incluindo todas as páginas e arquivos. Por favor, digite o nome do espaço de trabalho para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt de werkruimte permanent verwijderd, inclusief alle pagina's en bestanden. Typ de naam van de werkruimte om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie obszaru roboczego, w tym wszystkich stron i plików. Wpisz nazwę obszaru roboczego, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort arbetsytan permanent, inklusive alla sidor och filer. Vänligen skriv in arbetsplatsens namn för att bekräfta.",uk:"Цю дію не можна скасувати. Це дозволить остаточно видалити робочу область, включаючи всі сторінки та файли. Введіть назву робочої області для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette arbeidsområdet, inkludert alle sider og filer. Vennligst skriv navnet på arbeidsområdet for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu, tüm sayfaları ve dosyaları içeren çalışma alanını kalıcı olarak siler. Lütfen onaylamak için çalışma alanının adını yazın.",cs:"Tuto akci nelze vrátit zpět. Tím se trvale odstraní pracovní prostor včetně všech stránek a souborů. Zadejte prosím název pracovního prostoru, který chcete potvrdit.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn không gian làm việc, bao gồm tất cả các trang và tệp. Vui lòng nhập tên của không gian làm việc để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette arbejdsområdet, inklusive alle sider og filer. Indtast navnet på arbejdsområdet for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a munkaterületet, beleértve az összes oldalt és fájlt. Kérjük, írja be a munkaterület nevét a megerősítéshez.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي ذلك إلى حذف مساحة العمل كليا ، بما يشمل جميع الصفحات والملفات. يرجى كتابة اسم مساحة العمل للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบพื้นที่ทำงานอย่างถาวรรวมถึงหน้าและไฟล์ทั้งหมด โปรดพิมพ์ชื่อของพื้นที่ทำงานเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את סביבת העבודה, כולל כל הדפים והקבצים. הקלד את שם מרחב העבודה כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa työtilan pysyvästi, mukaan lukien kaikki sivut ja tiedostot. Vahvista kirjoittamalla työtilan nimi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus ruang kerja, termasuk semua halaman dan file. Silakan ketik nama ruang kerja untuk mengonfirmasi."}})),acceptLabel:r.createElement(m.b,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.deleteWorkspaceButton.label",defaultMessage:"Permanently delete workspace"}),requiredInputValue:i})&&(f.h({environment:this.environment,spaceId:t.id,userSettingsStore:e}),u.mb(this.environment),x.a.setState(yt({},x.a.state,{open:!1})))},this.handleRecordIconChange=e=>{const{spaceStore:t}=this.props;H.d(this.environment,n=>{a.c({store:t.getIconStore(),value:e,transaction:n})})}}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{spaceBasicSettingsStore:n}=this.stores,r=n.getValueForSpace(t);r&&n.setState(r)}renderComponent(){return Z.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,style:{textAlign:"center"}},r.createElement(m.b,{id:"spaceBasicSettings.offlineMessage",defaultMessage:"Please go online to manage settings."})))}renderSettings(){const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores,{name:n,domain:i}=t.state,{data:a}=dt.a.state;if(!a)return;const s=e.canAdmin(),o=!e.canRead(),l=Object(je.getSpacePermissionItems)(e),c=he.I(this.environment),d=e.getValue(),u=s&&d&&!d.disable_export,p=s,g="subscribed_admin"===a.type&&a.productId===U.a.pricing.enterprise.productId;return r.createElement(N.a,{controlRow:s&&this.renderControlRow()},this.renderSpaceBasicHeader(),o&&r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},r.createElement(m.b,{id:"spaceBasicSettings.guestLimitedAccessMessage",defaultMessage:"You are currently a guest in this workspace. Ask an admin to add you as a member in order to see other pages and workspace settings."})),o&&N.a.renderDivider(),s&&r.createElement(r.Fragment,null,r.createElement(z.a,null,r.createElement(m.b,{id:"spaceBasicSettings.workspaceNameSection.title",defaultMessage:"Name"})),r.createElement(W.b,{value:n,placeholder:h.a.formatMessage(Et.nameInputPlaceholder),readOnly:!s,onChange:this.handleSpaceNameChange}),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},r.createElement(vt,null)),N.a.renderDivider()),s&&r.createElement(r.Fragment,null,r.createElement(z.a,null,r.createElement(m.b,{id:"spaceBasicSettings.workspaceIconSection.title",defaultMessage:"Icon"})),r.createElement("div",{style:{width:72,height:72,border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center"}},s?r.createElement(Ke.a,{bucket:"public",disabled:!1,icon:Object(je.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:n,size:64,onChange:this.handleRecordIconChange}):r.createElement(Ke.a,{disabled:!0,icon:Object(je.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:n,size:64})),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:8}},r.createElement(m.b,{id:"spaceBasicSettings.workspaceIconSection.caption",defaultMessage:"Upload an image or pick an emoji. It will show up in your sidebar and notifications."})),N.a.renderDivider()),s&&r.createElement("div",null,r.createElement(z.a,null,r.createElement(m.b,{id:"spaceBasicSettings.domainSection.title",defaultMessage:"Domain"})),r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement("div",null,window.location.host,"/"),r.createElement("div",{style:{marginLeft:6,width:"100%"}},r.createElement(W.b,{value:i,placeholder:h.a.formatMessage(Et.workspaceDomainInputPlaceholder),readOnly:!s,onChange:this.handleSpaceUrlChange}))),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},Mt.renderDomainCaption(this.environment,i,!0,this.theme)),N.a.renderDivider()),s&&c&&r.createElement(r.Fragment,null,r.createElement(z.a,null,r.createElement(m.b,{id:"spaceBasicSettings.allowedEmailDomainsSection.title",defaultMessage:"Allowed email domains"})),this.renderAllowedEmailDomains(),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},Mt.renderAllowEmailDomainsCaption()),N.a.renderDivider()),u&&r.createElement(r.Fragment,null,r.createElement(z.a,null,r.createElement(m.b,{id:"spaceBasicSettings.exportContentSection.title",defaultMessage:"Export content"})),r.createElement("div",{style:{display:"flex"}},r.createElement(J.a,{isLarge:!0,onClick:this.handleExportClick},r.createElement(m.b,{id:"spaceBasicSettings.exportContentSection.exportButton.label",defaultMessage:"Export all workspace content"}))),r.createElement("div",{style:{height:12}}),r.createElement(oe.a,{title:r.createElement(m.b,{id:"spaceBasicSettings.exportContentSection.helpButton.caption",defaultMessage:"Learn about exporting workspaces."}),href:Object(Ie.a)("guides.exportWorkspace"),analyticsFrom:"space_settings"}),N.a.renderDivider()),p&&r.createElement(r.Fragment,null,r.createElement(z.a,{style:{display:"flex",alignItems:"center"}},r.createElement("span",{style:{marginRight:8}},r.createElement(m.b,{id:"spaceBasicSettings.exportMembersSection.title",defaultMessage:"Export members"})),!g&&r.createElement(pt.a,{subscriptionTier:"enterprise",analyticsName:"space_export_members",desktopStyle:{marginTop:-1}})),r.createElement("div",{style:{display:"flex"}},r.createElement(J.a,{isLarge:!0,disabled:!g,onClick:this.handleExportMembersClick,disabledFeedback:!0},r.createElement(m.b,{id:"spaceBasicSettings.exportMembersSection.exportAsCSVButton.label",defaultMessage:"Export members as CSV"}))),r.createElement("div",{style:{height:12}}),r.createElement(oe.a,{title:r.createElement(m.b,{id:"spaceBasicSettings.exportMembersSection.helpButton.caption",defaultMessage:"Learn about exporting members."}),href:Object(Ie.a)("guides.exportMembers"),analyticsFrom:"space_settings"}),N.a.renderDivider()),r.createElement(z.a,null,r.createElement(m.b,{id:"spaceBasicSettings.dangerousSettingsSection.title",defaultMessage:"Danger zone"})),r.createElement("div",{style:{display:"flex"}},(l.length>1||o)&&r.createElement(J.a,{isLarge:!0,onClick:this.handleLeaveClick,style:{marginRight:s?12:void 0}},r.createElement(m.b,{id:"spaceBasicSettings.dangerousSettingsSection.leaveWorkspaceButton.label",defaultMessage:"Leave workspace"})),s&&r.createElement(J.a,{isLarge:!0,isRed:!0,onClick:this.handleDeleteClick},r.createElement(m.b,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceButton.label",defaultMessage:"Delete entire workspace"}))),s&&r.createElement(r.Fragment,null,r.createElement("div",{style:{height:12}}),r.createElement(oe.a,{title:r.createElement(m.b,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceHelpButton.caption",defaultMessage:"Learn about deleting workspaces."}),href:Object(Ie.a)("guides.deleteWorkspace"),analyticsFrom:"space_settings"})))}renderSpaceBasicHeader(){return r.createElement(z.a,{large:!0,divider:"full"},r.createElement(m.b,{id:"spaceBasicSettings.title",defaultMessage:"Workspace settings"}))}renderControlRow(){return r.createElement("div",{style:{display:"flex"}},r.createElement($.a,{isLarge:!0,onClick:this.handleConfirm},r.createElement(m.b,{id:"spaceBasicSettings.updateButton.label",defaultMessage:"Update"})),r.createElement(J.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.createElement(m.b,{id:"spaceBasicSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderAllowedEmailDomains(){const{device:e}=this.environment,{spaceStore:t}=this.props,{spaceBasicSettingsStore:n}=this.stores,{emailDomains:i}=n.state,a=t.canAdmin();return r.createElement(at.c,{popupType:e.isMobile?at.c.PopupType.SlideUp:at.c.PopupType.Popup,sameWidthAsOrigin:!0,open:this.stores.tokenQuery.get().length>0,origin:r.createElement(tt,{placeholder:h.a.formatMessage(Et.allowedEmailDomainsInputPlaceholder),value:this.stores.tokenQuery.get(),onChange:e=>this.stores.tokenQuery.set(e.target.value),readOnly:!a,onRemoveLastToken:()=>{const e=i.slice(0,i.length-1);n.setState(yt({},n.state,{emailDomains:e}))},tokens:i.map(e=>r.createElement(nt.b,{showRemoveButton:!0,isSingle:!1,format:nt.b.Format.Medium,key:e,onClickRemove:()=>{const t=i.filter(t=>t!==e);n.setState(yt({},n.state,{emailDomains:t}))},value:e}))}),render:()=>{const t=this.stores.tokenQuery.get().trim(),{data:a}=dt.a.state,{spaceStore:s}=this.props,o=r.createElement(m.b,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholder",defaultMessage:"Type an email domain…"}),l=r.createElement(m.b,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholderNoResults",defaultMessage:"Type an email domain of a member of this workspace…"}),c=a?he.s(a).map(e=>{if(("unsubscribed_admin"===a.type||"unsubscribed_member"===a.type||"subscribed_admin"===a.type)&&a.joinedMemberIds.includes(e.userId)){const t=mt.a.createChildStore(s,{table:gt.a,id:e.userId}).getEmail();return t&&t.split("@")[1]}}).filter((e,t,n)=>Boolean(e&&t===n.indexOf(e)&&!i.includes(e))):[],d=Object(ht.b)(t,c,e=>e).map((e,t)=>({key:t,render:t=>r.createElement(lt.a,Object.assign({},t,{title:e})),action:()=>{const t=[...i,e];n.setState(yt({},n.state,{emailDomains:t})),this.stores.tokenQuery.set("")}}));let u;return u=e.isMobile?{menuType:st.b.MenuType.ActionSheet}:{menuType:st.b.MenuType.Popup,width:"100%"},r.createElement(st.b,Object.assign({},u),r.createElement(ot.a,{type:ot.a.Type.Vertical,initialFocus:d.length>0?0:void 0,sections:[{key:0,render:e=>r.createElement(ct.a,Object.assign({},e,{disableDesktopPadding:!0,title:d.length>0?o:l})),items:d}]}))},onDismiss:()=>{this.stores.tokenQuery.set("")}})}}Mt.renderDomainCaption=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=arguments.length>3?arguments[3]:void 0;const a="".concat(window.location.host,"/").concat(t);let s;if(t&&(s=n?r.createElement(rt.a,{delayThreshold:0,renderTooltip:()=>h.a.formatMessage(Et.copyDomainTooltip),render:t=>r.createElement(Me.a,Object.assign({onClick:()=>{it.c({environment:e,stringValue:a})}},t),a)}):r.createElement("span",{style:{color:i.regularTextColor}},a)),!he.O(e,"personal")&&!he.O(e,"student"))return r.createElement("div",null,r.createElement(m.b,{id:"spaceBasicSettings.domainSection.workspaceDomainInput.caption",defaultMessage:"Share the link {linkText} to add anyone with an allowed email domain to your workspace.",values:{linkText:s}}))},Mt.renderAllowEmailDomainsCaption=()=>r.createElement(m.b,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.caption",defaultMessage:"Anyone with email addresses at these domains can automatically join your workspace."});var wt=Object(m.h)(Mt),Ct=n(1655),Ot=n(1480),kt=n(747),Pt=n(221),Tt=n(589),Dt=n(170);class It extends S.a{getInitialState(){return{churnSurveyModalOpen:!1}}}var jt=It,xt=n(113),Bt=n(558),At=n(373),Ft=n(184);function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Lt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Ut={"en-US":{enterpriseContact:"https://notionup.typeform.com/to/FbZ6Tk",enterpriseTrial:"https://notionup.typeform.com/to/OHk8LR",startupFounder:"https://notionup.typeform.com/to/HgYsu8",startupPartner:"https://notionup.typeform.com/to/XEqmGB",nonprofit:"https://notionup.typeform.com/to/nlhrVv",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"},"ko-KR":{enterpriseContact:"https://notionup.typeform.com/to/K5knuI18",enterpriseTrial:"https://notionup.typeform.com/to/XkdAkTfV",startupFounder:"https://notionup.typeform.com/to/DYAiiu7x",startupPartner:"https://notionup.typeform.com/to/GfPkKEJZ",nonprofit:"https://notionup.typeform.com/to/cSKAL2LL",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"}};async function _t(e){const t=Ut[Ft.a][e.typeform];let n={};e.params&&(n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){Lt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n,{},e.params));const r=t+("?"+Object.keys(n).map(e=>e+"="+n[e]).join("&"));u.Wc(e.environment,{from:e.frontContext,name:e.typeform}),await Object(At.b)("https://embed.typeform.com/embed.js"),window.typeformEmbed.makePopup(r,{hideHeaders:!0,hideFooter:!1}).open()}var Wt=n(66);const qt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("p",{style:{marginTop:8,marginBottom:8}},1===t.length?t[0]:r.Children.toArray(t))},Nt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("ul",{style:{marginTop:8,marginBottom:8,paddingLeft:"1em"}},t)},zt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("ol",{style:{marginTop:8,marginBottom:8,paddingLeft:"1.125em"}},t)},Vt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("li",null,1===t.length?t[0]:r.Children.toArray(t))},Ht=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{external:!0,href:Object(Ie.a)("guides.guides")},t)},Gt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{href:Wt.O},t)},Yt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{href:Wt.db},t)},Qt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{href:Wt.o},t)},Kt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("b",null,t)},Zt=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("em",null,t)};function Xt(){return[{question:r.createElement(m.b,{id:"faq.whyFreeForStudents.question",defaultMessage:"Why is Notion free for students and educators?"}),answer:r.createElement(m.b,{id:"faq.whyFreeForStudents.answer",defaultMessage:"<p>Notion is the perfect tool for school. And it couldn’t be more core to our mission to support the next generation of thinkers, dreamers, and leaders.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.alreadyPayingForPersonalAccessToFreeEducation.question",defaultMessage:"I’m already paying for a Personal Pro Plan. Can I still get free access?"}),answer:r.createElement(m.b,{id:"faq.alreadyPayingForPersonalAccessToFreeEducation.answer",defaultMessage:"<p>Yes! Detailed upgrade instructions are available in the <helpcenterlink>help center</helpcenterlink>.</p>",values:{p:qt,helpcenterlink:Ht}})},{question:r.createElement(m.b,{id:"faq.eligibleForEducation.question",defaultMessage:"Am I eligible for free Personal Pro Plan access?"}),answer:r.createElement(m.b,{id:"faq.eligibleForEducation.answer",defaultMessage:"<p>You’re eligible if:</p><ol><li>You’re a student or educator at an accredited college or university.</li><li>You have a school email address. We don’t accept student IDs or other documentation to verify at this time.</li></ol><p>You’re not eligible if:</p><ol><li>You’re a K-12 student or K-12 educator. But you can still use our Personal Plan with unlimited storage for free! Learn more on our <pricinglink>pricing page</pricinglink>.</li><li>Your Notion account is associated with a personal email address, such as a gmail.com or outlook.com email address.</li></ol>",values:{p:qt,ol:zt,li:Vt,pricinglink:Gt}})},{question:r.createElement(m.b,{id:"faq.educationPlanGraduation.question",defaultMessage:"What happens when I graduate?"}),answer:r.createElement(m.b,{id:"faq.educationplanGraduation.answer",defaultMessage:"<p>You can continue using your free student account as long as it’s associated with a university email address. You’ll have the opportunity to change your email address and switch to a paid plan upon graduation. We hope you’ll stick with us 🤞</p>",values:{p:qt}})}]}function $t(e){_t({environment:e,typeform:"startupFounder",frontContext:"startups",params:{source:"startups"}})}function Jt(e){_t({environment:e,typeform:"startupPartner",frontContext:"startups",params:{source:"startups"}})}function en(e,t,n){_t({environment:e,typeform:"enterpriseContact",frontContext:t,params:{source:n}})}const tn={students:Xt,educators:function(){return Xt().slice(0,3)},general:function(e){return[{question:r.createElement(m.b,{id:"faq.freeVsPersonalAndTeam.question",defaultMessage:"How is the free Personal Plan different from the Personal Pro and Team Plans?"}),answer:r.createElement(m.b,{id:"faq.freeVsPersonalAndTeam.answer",defaultMessage:'<p>The biggest difference is how you can collaborate with others.</p><p>The free Personal Plan is designed for individual use, but allows up to 5 unique guests. These are friends, family members, and others you can invite to collaborate with you privately on any page. You can also share a page publicly and turn on commenting or editing access. In the Share menu at the top right, turn on "Share to web" then "Allow editing." Any Notion user with the link will be able to edit your page.</p><p>With the Personal Pro Plan, you can invite unlimited guests for private collaboration. For example, if you run your own business, you can invite all your clients to provide feedback on your work. </p><p>With the Team Plan, you can add members to your workspace so you all share and work on the same content. It also comes with more permission and admin controls so you and your teammates can work together securely. See the plan comparison chart for more details.</p>',values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.overGuestLimitInFreePlan.question",defaultMessage:"What happens when I go over the guest limit on my Personal Plan?"}),answer:r.createElement(m.b,{id:"faq.overGuestLimitInFreePlan.answer",defaultMessage:"<p>Upgrade to the Personal Pro Plan for unlimited guests, or the Team Plan if you collaborate with the same group of people automatically. You can also review and remove inactive guests in Settings & Members.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.teamTrial.question",defaultMessage:"How do I try out the Team Plan for free?"}),answer:r.createElement(m.b,{id:"faq.teamTrial.answer",defaultMessage:"<p>When asked how you would like to set up Notion during sign up, select Team, and you’ll be automatically enrolled in a Team Plan trial. You’ll get access to most features of a paid Team Plan, with a 1,000 block storage limit. If your team wants to add more than that, upgrade to the full Team Plan. Details above.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.overStorageLimitInFreePlan.question",defaultMessage:"What happens when I go over the block storage limit on my Team trial?"}),answer:r.createElement(m.b,{id:"faq.overStorageLimitInFreePlan.answer",defaultMessage:"<p>You can still read, edit, and organize existing content blocks as usual, but you won’t be able to add new content blocks.</p><p>However, you can delete existing content blocks to free up your storage.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.useNotionForFree.question",defaultMessage:"Can I use Notion for free?"}),answer:r.createElement(m.b,{id:"faq.useNotionForFree.answer",defaultMessage:"<p>Absolutely! Notion is free to use indefinitely.</p><p>The Personal Plan is completely free for individual use. The Team Plan has a free trial with a 1,000 block limit, more than enough to try out Notion with your team before upgrading.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.whatIsABlock.question",defaultMessage:"What is a block?"}),answer:r.createElement(m.b,{id:"faq.whatIsABlock.answer",defaultMessage:"<p>A block is any single piece of content you add to your page, like a paragraph of text, a to-do item, an image, a code block, an embedded file, etc. Think of your page as being made up of these building blocks.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.deleteBlocks.question",defaultMessage:"Can I delete blocks to free up my storage?"}),answer:r.createElement(m.b,{id:"faq.deleteBlocks.answer",defaultMessage:"<p>Of course! It works just like the storage limit on your phone or computer. If you delete something, you will free up space for more.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.studentDiscount.question",defaultMessage:"Do you offer student discounts?"}),answer:r.createElement(m.b,{id:"faq.studentDiscount.answer",defaultMessage:"<p>The Personal Pro Plan is free for students and educators. This lets you collaborate with unlimited guests and gives you version history. Simply sign up with your school email address and you’ll immediately gain access to these features.</p><p>If you’re already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free. If you're already on our free Education Plan, you've been automatically upgraded to the Personal Pro Plan.</p><p><helpcenterlink>Visit the help center to learn more</helpcenterlink></p>",values:{p:qt,helpcenterlink:Ht}})},{question:r.createElement(m.b,{id:"faq.howToEarnCredit.question",defaultMessage:"How do I earn credit?"}),answer:r.createElement(m.b,{id:"faq.howToEarnCredit.answer",defaultMessage:"<p>You can earn credit by using Notion across your devices and trying out new features. Go to the Earn Credit tab in Settings & Members to learn more.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.howToApplyCredit.question",defaultMessage:"How do I apply credit to my workspace?"}),answer:r.createElement(m.b,{id:"faq.howToApplyCredit.answer",defaultMessage:"<p>To apply credit, you must first upgrade to a paid plan. As part of this process, you can choose to apply some or all of your account credit to the plan.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.whyBillingInformation.question",defaultMessage:"Why do you need my billing information if I have enough credit to pay for Notion?"}),answer:r.createElement(m.b,{id:"faq.whyBillingInformation.answer",defaultMessage:"<p>We still require your billing information, even if you applied enough credit to make your first bill $0, because you may run out of credit in the future and we need to be able to charge your account.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.runOutOfCredit.question",defaultMessage:"What happens if I run out of credit?"}),answer:r.createElement(m.b,{id:"faq.runOutOfCredit.answer",defaultMessage:"<p>If you run out of credit, your account will be charged via your selected payment method.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.maximumEarnedCredit.question",defaultMessage:"Is there a maximum amount of credit I can earn?"}),answer:r.createElement(m.b,{id:"faq.maximumEarnedCredit.answer",defaultMessage:"<p>Yes, you can earn up to {maximumAmountInDollars} in credit.</p>",values:{p:qt,maximumAmountInDollars:Object(xt.b)({amount:Bt.f,currency:"dollar",intl:h.a.getIntl()})}})},{question:r.createElement(m.b,{id:"faq.advancedPermissions.question",defaultMessage:"What advanced permissions does the paid Team & Enterprise Plans offer?"}),answer:r.createElement(m.b,{id:"faq.advancedPermissions.answer",defaultMessage:'<p>If you are on a free Team trial, you can set the access level on each page to "Full access," "Can view," or "Can comment." That dictates how other users can interact with that page. "Full access" means someone can edit, comment, and share the page with others.</p><p>On paid Team and Enterprise Plans, you have the ability to grant "Can edit" access to other users. This gives someone the ability to edit and comment on that page, but not share it with others. This is especially useful if you do not want your content leaking outside your team.</p><p><contactsales>Contact sales to learn more</contactsales></p>',values:{p:qt,contactsales:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:()=>en(e,"faq","Advanced permissions")},n)}}})},{question:r.createElement(m.b,{id:"faq.teamAdminTools.question",defaultMessage:"What admin tools come with the Team Plan? "}),answer:r.createElement(m.b,{id:"faq.teamAdminTools.answer",defaultMessage:"<p>On a free Team trial, every member in your workspace is an admin. This means all of you can adjust team settings and invite other people into the workspace.</p><p>If you want only a few people to have admin abilities, we recommend upgrading to the full Team Plan. It comes with tools that allow you to make only select people admins while everyone else is a member. Members can't edit billing information or security options, and can't share your content outside the workspace.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.personalPricing.question",defaultMessage:"How is pricing calculated for the Personal Pro Plan?"}),answer:r.createElement(m.b,{id:"faq.personalPricing.answer",defaultMessage:"<p>If you upgrade your workspace to Personal Pro, you will be charged a flat fee ($5 monthly or $48 yearly).</p><p>Guests are free of charge, but they can only be added to one page at a time.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.teamPricing.question",defaultMessage:"How is pricing calculated for the Team Plan?"}),answer:r.createElement(m.b,{id:"faq.teamPricing.answer",defaultMessage:'<p>If you upgrade your workspace to the Team Plan, you will be charged a fee per member ($10 monthly or $96 yearly). For example, if you pay per month and have 5 members, you will be charged $50 each month.</p><p>Guests are free of charge – but they can only access individual pages they are invited to. In other words, guests won’t be able to see all the team pages under the "Workspace" section in the left sidebar.</p>',values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.monthlyAndYearlyBilling.question",defaultMessage:"Do you have monthly and yearly billing options?"}),answer:r.createElement(m.b,{id:"faq.monthlyAndYearlyBilling.answer",defaultMessage:"<p>Yes! We offer both monthly and yearly billing options. The yearly billing option is always cheaper (an estimated 20% discount). For example, the Team Plan is $10 per member per month when you choose the monthly option, but $8 per member per month if you choose to pay yearly.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.addingAndRemovingMembers.question",defaultMessage:"How does adding and removing members work?"}),answer:r.createElement(m.b,{id:"faq.addingAndRemovingMembers.answer",defaultMessage:"<p>Whether you're on a monthly or yearly billing schedule, your account may be charged on a monthly basis if you make these types of changes. If you added members, your account will be charged a prorated amount based on the percentage of the billing cycle left at the time each member was added. If you removed members, your account will be credited in the same way.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.changePlans.question",defaultMessage:"What happens when I change plans?"}),answer:r.createElement(m.b,{id:"faq.changePlans.answer",defaultMessage:"<p>Upgrading or downgrading your plan works similarly to adding and removing members. Your account will be charged or credited based on the percentage of the billing cycle left at the time the plan was changed.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.cancelPlan.question",defaultMessage:"What happens if I cancel my paid plan?"}),answer:r.createElement(m.b,{id:"faq.cancelPlan.answer",defaultMessage:"<p>When you cancel your plan, you will remain on the plan until the end of your billing cycle, at which time the plan will be canceled.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.paymentFailure.question",defaultMessage:"What happens if my payment fails? Like if my credit card expires?"}),answer:r.createElement(m.b,{id:"faq.paymentFailure.answer",defaultMessage:"<p>Your account email will be notified after each failed payment. Payments may be retried up to 4 times within the next month. After this, if the payment did not succeed, you will be downgraded to the free plan.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.changePaymentMethod.question",defaultMessage:"Can I change my payment method?"}),answer:r.createElement(m.b,{id:"faq.changePaymentMethod.answer",defaultMessage:"<p>You can change your payment method at any time in your billing settings.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.refund.question",defaultMessage:"Do you offer refunds?"}),answer:r.createElement(m.b,{id:"faq.refund.answer",defaultMessage:"<p>In most cases, we don't offer refunds. Instead, we'll credit your account a prorated amount if you remove members from your workspace or downgrade. The next time your account is charged, any remaining balance will be used before creating a new charge.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.serviceLevelAgreement.question",defaultMessage:"Do you have a Service-Level Agreement (SLA)?"}),answer:r.createElement(m.b,{id:"faq.serviceLevelAgreement.answer",defaultMessage:"<p>We do not offer a standard SLA. For teams with greater than 100 members, we can offer a custom SLA.</p><p><contactsales>Contact sales to learn more</contactsales></p>",values:{p:qt,contactsales:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:()=>en(e,"faq","SLA")},n)}}})},{question:r.createElement(m.b,{id:"faq.importStorageLimit.question",defaultMessage:"How does importing content from another app affect my block storage limit if I'm on the Team Plan trial?"}),answer:r.createElement(m.b,{id:"faq.importStorageLimit.answer",defaultMessage:"<p>Content created via import doesn’t count toward your workspace’s storage limit. We want to make sure you get started with Notion as smoothly as possible.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.paymentProcessor.question",defaultMessage:"How is my payment being processed?"}),answer:r.createElement(m.b,{id:"faq.paymentProcessor.answer",defaultMessage:"<p>We use Stripe to process your payment. It’s the same payment provider used by products such as Twitter, Pinterest, and Lyft. We do not handle your credit card information directly.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.multipleTeams.question",defaultMessage:"Can I belong to multiple teams on Notion? "}),answer:r.createElement(m.b,{id:"faq.multipleTeams.answer",defaultMessage:"<p>Yes! You can use the same email address to create and join multiple teams. However, each one of these workspaces is on its own plan and needs to be upgraded individually.</p>",values:{p:qt}})}]},startups:function(e){return[{question:r.createElement(m.b,{id:"faq.startupDiscountEligibility.question",defaultMessage:"Who is eligible?"}),answer:r.createElement(m.b,{id:"faq.startupDiscountEligibility.answer",defaultMessage:"<p>You qualify for the discount if you meet two criteria:</p><p>1) You’re starting a workspace on Notion’s Team Plan for a startup.</p><p>2) You’re working with one of our partnering incubators or accelerators (see <formlink>our form</formlink> for the full list).</p><p>We plan to expand eligibility in the future…please stay tuned.</p>",values:{p:qt,formlink:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:()=>$t(e)},n)}}})},{question:r.createElement(m.b,{id:"faq.whyStartupDiscount.question",defaultMessage:"Why is Notion offering a discount for startups?"}),answer:r.createElement(m.b,{id:"faq.whyStartupDiscount.answer",defaultMessage:"<p>We've seen thousands of startups use Notion to get going on the right foot — as a wiki, for project management, document sharing, notes, and more. We want to help more companies lay a strong foundation that can grow with them from the beginning.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.howToApplyForStartupCredit.question",defaultMessage:"How do I apply to receive the $1,000 credit?"}),answer:r.createElement(m.b,{id:"faq.howToApplyForStartupCredit.answer",defaultMessage:"<p>Easy! Fill out <formlink>this form</formlink>.</p>",values:{p:qt,formlink:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:()=>$t(e)},n)}}})},{question:r.createElement(m.b,{id:"faq.startupCreditWorth.question",defaultMessage:"What is $1,000 in Notion credit worth?"}),answer:r.createElement(m.b,{id:"faq.startupCreditWorth.answer",defaultMessage:"<p>Notion’s <pricinglink>Team Plan</pricinglink> normally costs $10 per member per month paid monthly. So, for a team of 10, $1,000 in credit represents 10 months of free Notion. For a team of 5, it’s 20 months of free Notion, and so on.</p>",values:{p:qt,pricinglink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{href:Wt.O},t)}}})},{question:r.createElement(m.b,{id:"faq.whereStartupCredit.question",defaultMessage:"How can I see the credit in my account?"}),answer:r.createElement(m.b,{id:"faq.whereStartupCredit.answer",defaultMessage:"<p>Inside Notion, go to Settings & Members, and click Billing. You’ll see your current credit, including the $1,000 credit under Workspace Balance. It should appear there after you upgrade to the Team Plan.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.suggestStartupPartner.question",defaultMessage:"How do I suggest a partner that Notion should work with?"}),answer:r.createElement(m.b,{id:"faq.suggestStartupPartner.answer",defaultMessage:"<p>Don’t see your investors on our list? There are a few things you can do:</p><p>1) Send them a note encouraging them to join the program.</p><p>2) Tweet at them and @NotionHQ with the hashtag #NotionForStartups and we’ll pick up the conversation!</p><p>3) <applicationlink>Apply for credit</applicationlink> and make your suggestion on our form.</p>",values:{p:qt,applicationlink:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:()=>$t(e)},n)}}})},{question:r.createElement(m.b,{id:"faq.portfolioCompaniesStartupDiscount.question",defaultMessage:"I want this discount to be available to my portfolio companies. How can I become a partner?"}),answer:r.createElement(m.b,{id:"faq.portfolioCompaniesStartupDiscount.answer",defaultMessage:"<p>We want to hear from you! Fill out <partnerform>this quick form</partnerform>, and we’ll get back to you with more information. We’re especially interested in finding partners outside of major tech hubs.</p>",values:{p:qt,partnerform:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:()=>Jt(e)},n)}}})}]},personal:function(){return[{question:r.createElement(m.b,{id:"faq.alreadyHadFreeAccount.question",defaultMessage:"I already had a free Notion account. What changed?"}),answer:r.createElement(m.b,{id:"faq.alreadyHadFreeAccount.answer",defaultMessage:"<p>Our old Free Plan had a limit of 1,000 blocks of content. Now, you’re on our new free Personal Plan and can add as much content as you want!</p><p>We made a couple other changes, too:</p><ul><li>We made it simpler to share pages with collaborators. Instead of adding them as guests or members, just send them a link.</li><li>You can now invite up to five guests to collaborate privately with you on pages in your workspace. To invite more guests, you'll need to upgrade to our Personal Pro Plan.</li></ul><p>Learn more about all our plans at <pricinglink>notion.so/pricing</pricinglink>.</p>",values:{p:qt,ul:Nt,li:Vt,pricinglink:Gt}})},{question:r.createElement(m.b,{id:"faq.alreadyPayingForPersonal.question",defaultMessage:"What if I'm already paying for the old Personal Plan?"}),answer:r.createElement(m.b,{id:"faq.alreadyPayingForPersonal.answer",defaultMessage:"<p>You've been automatically upgraded to our new Personal Pro Plan at no extra cost! In addition to all the features of the free Personal Plan, Personal Pro includes:</p><ul><li>No limit on file uploads (5MB is the limit for free)</li><li>Unlimited guest collaborators (5 guests is the limit for free)</li><li>Version history up to 30 days</li><li>Priority customer support</li></ul><p>You can switch back to the free Personal Plan at any time.</p>",values:{p:qt,ul:Nt,li:Vt}})},{question:r.createElement(m.b,{id:"faq.whatHappensToFreeGuests.question",defaultMessage:"What happens to all the guests I added on the old Free Plan?"}),answer:r.createElement(m.b,{id:"faq.whatHappensToFreeGuests.answer",defaultMessage:"<p>You can still add up to 5 guests to collaborate on any page in your workspace. If you've already added more than 5 guests, they will still be there. But to add more over the 5-guest limit, you’ll need to upgrade to the Personal Pro Plan.</p><p>That said, our new public editing feature makes it possible to allow any other Notion users with the page's link to add edits or comments.</p>",values:{p:qt}})},{question:r.createElement(m.b,{id:"faq.previouslyHadMultipleMembers.question",defaultMessage:"What if I had multiple members in my free workspace?"}),answer:r.createElement(m.b,{id:"faq.previouslyHadMultipleMembers.answer",defaultMessage:"<p>No worries, you don’t have to remove anyone! Nothing is different for you until you hit 1,000 blocks of content. At that point, if you want to add more, you can:</p><ul><li>Upgrade to our Team Plan.</li><li>Start a new workspace for just yourself and use it for free, indefinitely.</li><li>Remove members, and enjoy no content limits on your own.</li></ul><p>Note: Make sure members in your workspace have their private pages backed up before you remove them!</p>",values:{p:qt,ul:Nt,li:Vt}})},{question:r.createElement(m.b,{id:"faq.howCanTeamTryForFree.question",defaultMessage:"How can my team try out Notion for free?"}),answer:r.createElement(m.b,{id:"faq.howCanTeamTryForFree.answer",defaultMessage:"<p>We want to make it easy for you to take Notion for a spin with multiple members before you start paying. Here’s how to do that:</p><ul><li>Create a new Notion workspace, and select Team as the type when asked.</li><li>You’ll be enrolled in a Team Plan free trial that gives you access to Team Plan features with a 1,000-block content limit. When you hit that limit, you can upgrade.</li></ul>",values:{p:qt,ul:Nt,li:Vt}})},{question:r.createElement(m.b,{id:"faq.freePlanForEducation.question",defaultMessage:"What about free plans for students and educators?"}),answer:r.createElement(m.b,{id:"faq.freePlanForEducation.answer",defaultMessage:"<p>Students and educators are eligible to get our new Personal Pro Plan for free (normally $5/month)! And those already on our Free Education plan have been upgraded automatically. In addition to all free features, this includes:</p><ul><li>Adding unlimited guest collaborators to any page</li><li>No limit on file uploads (5MB is the limit for free)</li><li>Version history up to 30 days</li><li>Priority customer support</li><li>Learn more at <studentslink>notion.so/students</studentslink> or <educatorslink>notion.so/educators</educatorslink></li></ul>",values:{p:qt,ul:Nt,li:Vt,studentslink:Yt,educatorslink:Qt}})}]},careers:function(e){return[{question:r.createElement(m.b,{defaultMessage:"When is Notion’s team planning to be back in office?",id:"faq.officeReturn.question"}),answer:r.createElement(m.b,{id:"faq.officeReturn.answer",defaultMessage:"<p>We’ll continue to work from home until Summer 2021. Our highest priority is the health and safety of our employees and their families. Given there are no clear guidelines on when we’ll get to a post-COVID-19 world, we want to lean in on making sure our employees feel safe. We will continue to monitor the key public health indicators which will help us guide our decision to reopen the office at a later date.</p>",values:{p:qt}})},{question:r.createElement(m.b,{defaultMessage:"If I don’t see a role listed in a city I am currently located in and I am not open to relocation, can I work remotely?",id:"faq.remotePositions.question"}),answer:r.createElement(m.b,{id:"faq.remotePositions.answer",defaultMessage:"<p>At this time, we are not hiring for remote positions. We have small teams so working in one place helps us go faster and solve complex problems together.</p>",values:{p:qt}})},{question:r.createElement(m.b,{defaultMessage:"Are you hiring remote contractors?",id:"faq.remoteContractors.question"}),answer:r.createElement(m.b,{id:"faq.remoteContractors.answer",defaultMessage:"<p>We are not hiring remote contractors at this time.</p>",values:{p:qt}})},{question:r.createElement(m.b,{defaultMessage:"Do you cover relocation costs?",id:"faq.relocationCosts.question"}),answer:r.createElement(m.b,{id:"faq.relocationCosts.answer",defaultMessage:"<p>If you’re based elsewhere in the U.S. (or internationally and you are authorized to work in the U.S.), we’ll help cover some of your relocation expenses to whichever city your new role is based.</p>",values:{p:qt}})}]},confluence:function(e){return[{question:r.createElement(m.b,{defaultMessage:"How can I import my Confluence workspace into Notion?",id:"faq.confluenceImport.question"}),answer:r.createElement(m.b,{id:"faq.confluenceImport.answer",defaultMessage:"<p>You can copy your entire Confluence workspace into Notion in just a few clicks! Just follow the instructions in our <guidelink>Import Guide</guidelink>.</p>",values:{p:qt,guidelink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{href:"https://www.notion.so/notion/Import-data-into-Notion-18c37b470e8941789548b68049af750b"},t)}}})},{question:r.createElement(m.b,{defaultMessage:"Does imported content count towards the storage limit for Team Plan trials?",id:"faq.confluenceStorageLimit.question"}),answer:r.createElement(m.b,{id:"faq.confluenceStorageLimit.answer",defaultMessage:"<p>No, imported blocks will not count towards the limit. However, any blocks subsequently created inside imported pages <italic>will</italic> count towards the limit as usual.</p>",values:{italic:Zt,p:qt}})},{question:r.createElement(m.b,{defaultMessage:"Is there a maximum import size?",id:"faq.confluenceImportSizeLimit.question"}),answer:r.createElement(m.b,{id:"faq.confluenceImportSizeLimit.answer",defaultMessage:"<p>Confluence imports are limited to 2.5GB each. If you run into the limit, you can try using the <bold>Custom Export</bold> option in Confluence to select pages for export, omitting attachment-heavy pages.</p>",values:{bold:Kt,p:qt}})}]}};class nn extends B.a{constructor(){super(...arguments),this.renderFaqItem=(e,t)=>r.createElement(r.Fragment,{key:t},r.createElement("div",{style:nn.questionStyle},e.question),r.createElement("div",{style:this.getAnswerStyle()},e.answer)),this.handleHelpButtonClick=()=>{Se.a({environment:this.environment,from:"pricing"})}}renderComponent(){return r.createElement("div",{style:{maxWidth:600}},this.getFaqList().map((e,t)=>this.renderFaqItem(e,t)),r.createElement("div",{style:{color:this.props.isSettings?this.theme.mediumTextColor:X.f.frontTextMedium}},this.props.cta?"intercom"===this.props.cta?this.renderIntercomCTA():this.renderGuidesCTA():null))}renderIntercomCTA(){var e=this;return r.createElement(m.b,{id:"faqList.moreQuestionsTextIntercom",defaultMessage:"Still have more questions? <messagelink>Send us a message</messagelink>",values:{messagelink:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:e.handleHelpButtonClick},n)}}})}renderGuidesCTA(){return r.createElement(m.b,{id:"faqList.moreQuestionsTextHelpCenter",defaultMessage:"Still have more questions? Learn more in our <messagelink>help center</messagelink>.",values:{messagelink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{href:Object(Ie.a)("guides.guides")},t)}}})}getFaqList(){return tn[this.props.type](this.environment)}getAnswerStyle(){return{color:this.props.isSettings?this.theme.mediumTextColor:X.f.frontTextMedium,marginBottom:"1.5rem",lineHeight:1.5}}}nn.questionStyle={fontWeight:Y.a.fontWeight.semibold,marginBottom:4};var rn=nn,an=n(759),sn=n(232),on=n(1322),ln=n(749),cn=n(797),dn=n(42);var un={fontSize:{ui:{s:14,m:15},body:{s:15,m:17,l:20},title:{s:22,m:30,l:38,xl:50,xxl:74}},fontFamily:{sans:'inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',handwriting:'permanent-marker, -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, "Apple Color Emoji", Arial, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol"',mono:"iawriter-mono, Nitti, Menlo, Courier, monospace"},fontWeight:{regular:400,medium:500,bold:700},styles:{paragraph:{fontSize:17,lineHeight:1.5},smallCaps:{textTransform:"uppercase",fontSize:11,letterSpacing:.5,fontWeight:500}}};function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach((function(t){hn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class gn extends B.a{constructor(){super(...arguments),this.storeTypes={loginStore:ln.a,loginPermissionsStore:on.a},this.handleLoginClick=async()=>{const{email:e}=this.stores.loginStore.state;this.props.analyticsName&&u.U(this.environment,{from:this.props.analyticsName});const t=await s.l(this.environment,{email:e});if("failed"===t.type)return;const n=t.data;n.samlRedirect?c.n(this.environment,n.samlRedirect.redirectUrl):n.isGoogleAppsEmail?c.p({environment:this.environment,store:this.stores.loginStore,email:e,permissionsStore:this.stores.loginPermissionsStore}):n.hasPassword?(dn.f({environment:this.environment,url:Wt.C}),n.mustReverify?(await c.r({environment:this.environment,store:sn.a,reverify:!0}),this.stores.loginStore.reset()):sn.a.setState({loginType:"password",email:e,password:"",emailInputFocused:!1,alert:void 0})):(dn.f({environment:this.environment,url:Wt.X}),sn.a.setState({loginType:"email",email:e,password:"",emailInputFocused:!1}),await c.r({environment:this.environment,store:sn.a}),this.stores.loginStore.reset())},this.handleInputChange=e=>{""===e.target.value&&this.stores.loginStore.reset(),this.stores.loginStore.setState(mn({},this.stores.loginStore.state,{email:e.target.value}))},this.handleInputFocus=e=>{this.stores.loginStore.setState(mn({},this.stores.loginStore.state,{emailInputFocused:!0}))},this.handleInputBlur=e=>{this.stores.loginStore.setState(mn({},this.stores.loginStore.state,{emailInputFocused:!1}))}}renderComponent(){const e=this.renderPlaceholderText();return r.createElement("div",{style:this.getWrapStyle()},r.createElement(W.b,{style:gn.inputStyle,value:this.stores.loginStore.state.email,type:"email",format:W.b.Format.Large,autoFocus:!1,autoComplete:"off",placeholder:e,onSubmit:this.handleLoginClick,showClearButton:!0,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur,onChange:this.handleInputChange}),r.createElement(an.a,{variant:this.props.buttonVariant?this.props.buttonVariant:"primary",style:{textAlign:"center",width:this.props.buttonWidth?this.props.buttonWidth:"auto"},onClick:this.handleLoginClick},this.props.buttonTitle||r.createElement(m.b,{id:"frontSignupComponent.submitButton.label",defaultMessage:"Sign up"})))}renderPlaceholderText(){const{persona:e,intl:t}=this.props,n=t.formatMessage({id:"frontSignupComponent.emailInput.genericEmailPlaceholder",defaultMessage:"Enter your email…"});switch(e){case"personal":return n;case"education":return t.formatMessage({id:"frontSignupComponent.emailInput.educationEmailPlaceholder",defaultMessage:"Enter your school email…"});case"team":return t.formatMessage({id:"frontSignupComponent.emailInput.teamEmailPlaceholder",defaultMessage:"Enter your work email…"});default:return n}}getWrapStyle(){return{width:"100%",maxWidth:this.props.maxWidth?this.props.maxWidth:320,display:"flex",alignItems:"center"}}}gn.inputStyle={fontSize:un.fontSize.ui.m,height:36,flex:1,background:X.f.white,boxShadow:cn.a.frontInputShadow,marginRight:8};var bn=Object(m.h)(gn),fn=n(20),yn=n(719);class Sn extends S.a{getInitialState(){return{termType:"yearly"}}}var vn=new Sn,En=n(256);function Mn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Cn extends B.a{renderComponent(){const e="yearly"===vn.state.termType?"monthly":"yearly";return r.createElement("div",{style:this.getTermToggleStyle(this.theme),onClick:()=>{u.Jb(this.environment,{from:"pricing_grid_top",toggle_to:e}),vn.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mn(Object(n),!0).forEach((function(t){wn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},vn.state,{termType:e}))}},r.createElement("div",{style:{marginRight:8}},this.props.isSettings?r.createElement(m.b,{id:"pricingGrid.pricingTermToggle.payAnnually.label",defaultMessage:"Pay annually"}):r.createElement(m.b,{id:"frontPricingPage.pricingTermToggle.payAnnually.label",defaultMessage:"Pay annually"})),r.createElement(En.a,{on:"monthly"===vn.state.termType}),r.createElement("div",{style:{marginLeft:8}},this.props.isSettings?r.createElement(m.b,{id:"pricingGrid.pricingTermToggle.payMonthly.label",defaultMessage:"Monthly"}):r.createElement(m.b,{id:"frontPricingPage.pricingTermToggle.payMonthly.label",defaultMessage:"Pay monthly"})))}getTermToggleStyle(e){return{cursor:"pointer",fontSize:14,color:e.mediumTextColor,display:"flex",alignItems:"center",marginBottom:8}}}var On=Cn;var kn=function(e){return!!e.device.isMobile||e.WindowSizeStore.state.width<960};const Pn={s:620,m:940,l:1260};B.a;var Tn=n(30),Dn=n(1323),In=n(89);function jn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jn(Object(n),!0).forEach((function(t){Bn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const An=["free","personal","team","enterprise"];class Fn extends B.a{willMount(e){e.data&&he.A(e.data)&&vn.setState({termType:"year"===e.data.interval?"yearly":"monthly"})}renderComponent(){return r.createElement("div",null,r.createElement("table",{style:this.getTableStyle(this.props.isSettings)},this.props.isSettings&&this.renderHeader(),r.createElement("tbody",null,yn.e.map((e,t)=>this.renderSection(e,t))),!this.props.isSettings&&this.renderFooter()))}renderCheck(){return ge.a.thinCheck({display:"inline",height:this.props.isSettings?12:14,width:this.props.isSettings?12:14,color:this.theme.regularTextColor})}upgradeLink(e,t){const{planState:n}=this.props;if(n)return r.createElement(Me.a,{onClick:n.plans[e].onClick,style:{fontSize:12,fontWeight:500,textDecoration:"none",color:this.theme.mediumTextColor,lineHeight:1.2}},t||r.createElement(m.b,{id:"pricingGrid.planAttribute.button.upgrade",defaultMessage:"Upgrade"}))}renderPlanContent(e){const{label:t,upgradeCta:n,upgradeCTALabel:i}=e;return t&&n?r.createElement(r.Fragment,null,t,r.createElement("br",null),this.upgradeLink(n,i)):t||(n?r.createElement(r.Fragment,null,r.createElement(m.b,{id:"pricingGrid.planAttribute.notInTrial",defaultMessage:"Not in trial"}),r.createElement("br",null),this.upgradeLink(n,i)):this.renderCheck())}renderPlan(e,t,n){return r.createElement("td",{style:xn({},this.getRowStyle(this.theme),{},this.getValueStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e))},n.hasFeature&&r.createElement(rt.a,{delayThreshold:0,placement:rt.a.Placement.Right,renderTooltip:()=>Object(yn.f)(t),textWrap:!0,render:e=>r.createElement("div",Object.assign({style:{cursor:"help",lineHeight:1.3,padding:"6px 0"}},e),this.renderPlanContent(n))}))}renderItem(e,t){const n=this.props.isSettings?"auto":300,i=this.props.planState&&this.props.planState.isTeamTrial;return r.createElement("tr",{key:"table-row-".concat(t)},r.createElement("td",{style:xn({},this.getRowStyle(this.theme),{},this.getRowLabelStyle(this.theme),{width:n,maxWidth:n,minWidth:n})},r.createElement(rt.a,{delayThreshold:0,placement:rt.a.Placement.Right,renderTooltip:()=>Object(yn.f)(e.tooltip),textWrap:!0,render:t=>r.createElement("span",Object.assign({},t,{style:this.getTooltipInnerStyle(this.theme)}),e.label,e.isComingSoon&&this.renderComingSoonBadge())})),An.map(t=>{const n="team"===t&&i?"teamTrial":t;return this.renderPlan(t,e.tooltip,e.plans[n])}))}renderEmptyTableCell(e,t){return r.createElement("td",{style:xn({},this.getSectionStyle(this.theme,t),{},this.getValueStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e),{color:X.f.lightTextColor,fontWeight:400})},!this.props.isSettings&&this.getPlanName(e))}renderEmptyTableCells(e){return r.createElement(r.Fragment,null,An.map(t=>this.renderEmptyTableCell(t,e)))}renderSection(e,t){const n=this.props.isSettings?"auto":300;return r.createElement(r.Fragment,{key:"table-section-".concat(t)},r.createElement("tr",null,r.createElement("td",{style:xn({},this.getSectionStyle(this.theme,t),{width:n,maxWidth:n,minWidth:n})},e.label),this.renderEmptyTableCells(t)),e.items.map((e,t)=>this.renderItem(e,t)))}renderButton(e,t){const n=t.plans[e],i="notion-pricing-grid-upgrade-".concat(e);let a;switch(n.buttonType){case"current":a=r.createElement(m.b,{id:"pricingGrid.currentPlanButton.label",defaultMessage:"Current"});break;case"upgrade":a=r.createElement(m.b,{id:"pricingGrid.upgradePlanButton.label",defaultMessage:"Upgrade"});break;case"downgrade":a=r.createElement(m.b,{id:"pricingGrid.downgradePlanButton.label",defaultMessage:"Downgrade"});break;case"will-downgrade":a=r.createElement(m.b,{id:"pricingGrid.willDowngradePlanButton.label",defaultMessage:"Future plan"});break;case"resubscribe":a=r.createElement(m.b,{id:"pricingGrid.resubscribePlanButton.label",defaultMessage:"Resubscribe"});break;default:Tn.e(n.buttonType)}return"current"===n.buttonType?this.renderDisabledButtonWithTooltip({tooltip:r.createElement(m.b,{id:"pricingGrid.currentPlan.tooltip",defaultMessage:"This is your current active plan"}),label:r.createElement(m.b,{id:"pricingGrid.currentPlan.largeScreenLabel",defaultMessage:"Current plan"}),buttonClassName:i,wrapTooltip:!1}):t.canSwitchPlans?("personal"===e||"free"===e)&&t.memberCount>1?this.renderDisabledButtonWithTooltip({tooltip:r.createElement(m.b,{id:"pricingGrid.switchToPersonalPlanButton.tooltip",defaultMessage:"The Personal and Personal Pro Plans are only available for 1-person use. If you'd like to use these plans, please remove the other members in this workspace."}),label:a,buttonClassName:i,wrapTooltip:!0}):"will-downgrade"===n.buttonType?this.renderDisabledButtonWithTooltip({tooltip:r.createElement(m.b,{id:"pricingGrid.willDowngradePlan.tooltip",defaultMessage:"This is the plan after your current plan expires"}),label:r.createElement(m.b,{id:"pricingGrid.willDowngradePlan.largeScreenLabel",defaultMessage:"Future plan"}),buttonClassName:i,wrapTooltip:!1}):"downgrade"===n.buttonType?r.createElement(J.a,{isLarge:!0,style:{width:"100%"},onClick:()=>{u.kd(this.environment,{plan:e,from:"pricing_grid_top",button_text:n.buttonType}),n.onClick()},className:i},a):r.createElement($.a,{isLarge:!0,style:{width:"100%"},onClick:()=>{u.kd(this.environment,{plan:e,from:"pricing_grid_top",button_text:n.buttonType}),n.onClick()},className:i},a):this.renderDisabledButtonWithTooltip({tooltip:r.createElement(m.b,{id:"pricingGrid.switchPlanAsMember.tooltip",defaultMessage:"You need to be an administrator of this workspace to switch plans."}),label:a,buttonClassName:i,wrapTooltip:!0})}renderDisabledButtonWithTooltip(e){const{tooltip:t,label:n,buttonClassName:i,wrapTooltip:a}=e;return r.createElement(rt.a,{style:{width:a?320:"auto"},textWrap:a,renderTooltip:()=>t,render:e=>r.createElement(J.a,Object.assign({style:{width:"100%",opacity:.5},isLarge:!0,disabled:!0},e,{className:i}),n)})}renderSalesContactLink(){return r.createElement(Me.a,{onClick:()=>{const{currentUserStore:e}=d.a.state,t=e&&e.getValue();u.V(this.environment),Dn.a.setState({open:!0,email:t&&t.email,name:t&&Object(In.d)(this.props.intl,t)})}},r.createElement("div",{style:this.getUpgradeButtonBelowLinkStyle()},r.createElement(m.b,{id:"pricingGrid.contactSalesLink",defaultMessage:"Contact sales"})))}renderTeamTrialIndicator(){return r.createElement(rt.a,{delayThreshold:0,placement:rt.a.Placement.Bottom,renderTooltip:()=>r.createElement(m.b,{id:"pricingGrid.inTeamTrial.tooltip",defaultMessage:"Your current Team trial has a 1,000 block limit. Upgrade to go unlimited."}),textWrap:!0,style:{width:280},render:e=>r.createElement("div",Object.assign({style:xn({},this.getUpgradeButtonBelowLinkStyle(),{fontWeight:500,display:"flex",flexDirection:"row",cursor:"help"})},e),r.createElement("div",{style:{paddingRight:4,paddingTop:2}},this.renderCheck()),r.createElement("div",null,r.createElement(m.b,{id:"pricingGrid.inTeamTrial",defaultMessage:"In free trial"})))})}renderTeamTrialButton(e){if(e.isActive&&"resubscribe"===e.buttonType)return;const t="current"===e.buttonType?r.createElement(m.b,{id:"pricingGrid.cancelPlanLink",defaultMessage:"Cancel plan"}):r.createElement(m.b,{id:"pricingGrid.teamTrialLink",defaultMessage:"Try for free"});return r.createElement(Me.a,{onClick:e.onClickTeamFree},r.createElement("div",{style:this.getUpgradeButtonBelowLinkStyle()},t))}getPlanName(e){const{intl:t}=this.props;switch(e){case"free":return t.formatMessage({id:"pricingGrid.personalFreePlanColumn.header",defaultMessage:"Personal"});case"personal":return t.formatMessage({id:"pricingGrid.personalProPlanColumn.header",defaultMessage:"Personal Pro"});case"team":return t.formatMessage({id:"pricingGrid.teamPlanColumn.header",defaultMessage:"Team"});case"enterprise":return t.formatMessage({id:"pricingGrid.enterprisePlanColumn.header",defaultMessage:"Enterprise"});default:return Tn.e(e),""}}renderHeaderTitle(e){const t=this.getPlanName(e.plan);return r.createElement("td",{style:xn({},this.getHeaderStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e.plan)),{},this.getBorderStyle(e.plan))},!this.props.isSettings&&r.createElement("img",{style:{height:80,marginBottom:-5},src:e.image,alt:t}),r.createElement("div",{style:this.getHeaderTitleStyle()},t),void 0!==e.price&&r.createElement("div",{style:{display:kn(this.environment)?"block":"flex"}},r.createElement("div",{style:this.getHeaderPriceStyle()},e.price),void 0!==e.terms&&r.createElement("div",{style:this.getHeaderTermsStyle(this.theme)},Object(yn.c)(this.props.intl,e.terms))),!this.props.isSettings&&"enterprise"===e.plan&&r.createElement("div",{style:{height:30}},this.renderSalesContactLink()))}renderHeaderLabels(){const e=this.isPlanActive("team")||this.isPlanActive("enterprise");return r.createElement("tr",null,r.createElement("td",{style:{width:"28%"}}),r.createElement("td",{style:xn({},this.getHeaderLabelStyle(!e),{},this.getBorderStyle("free"),{borderLeft:this.props.isSettings?"1px solid ".concat(this.theme.lightDividerColor):void 0}),colSpan:2},r.createElement(m.b,{id:"pricingGrid.personalPlans.label",defaultMessage:"For individuals"})),r.createElement("td",{style:xn({},this.getHeaderLabelStyle(e),{},this.getBorderStyle("enterprise")),colSpan:2},r.createElement(m.b,{id:"pricingGrid.teamPlans.label",defaultMessage:"For teams & businesses"})))}renderHeaderTitles(){const e=vn.state.termType,t=Object(yn.d)(U.a,this.props.intl);return r.createElement("tr",null,r.createElement("td",null),this.renderHeaderTitle({plan:"free",price:t.price[e].personal,image:fn.a.front.pricing.pricingFreeV2Png}),this.renderHeaderTitle({plan:"personal",price:t.price[e].pro,image:fn.a.front.pricing.pricingPersonalV2Png,terms:t.terms.pro}),this.renderHeaderTitle({plan:"team",price:t.price[e].team,image:fn.a.front.pricing.pricingTeamV2Png,terms:t.terms.team}),this.props.isSettings?this.renderHeaderTitle({plan:"enterprise",price:t.price[e].enterprise,image:fn.a.front.pricing.pricingEnterpriseV2Png,terms:t.terms.enterprise}):this.renderHeaderTitle({plan:"enterprise",image:fn.a.front.pricing.pricingEnterpriseV2Png}))}renderHeaderAction(e){const{planState:t}=this.props;if(t)return r.createElement("td",{style:xn({},this.getHeaderStyle(),{},this.getActiveStyle(this.theme,this.isPlanActive(e)),{},this.getBorderStyle(e))},this.renderButton(e,t),this.renderHeaderSubAction(e))}renderHeaderSubAction(e){if("enterprise"===e)return r.createElement("div",{style:{marginTop:7}},this.renderSalesContactLink());if("team"===e){const{planState:t}=this.props;if(!t||!t.canSwitchPlans||t.plans.personal.isActive)return;return r.createElement("div",{style:{marginTop:7}},t.isTeamTrial?this.renderTeamTrialIndicator():this.renderTeamTrialButton(t.plans[e]))}}renderHeaderActions(){if(this.props.isSettings&&this.props.planState)return r.createElement("tr",null,r.createElement("td",{style:{width:"28%",verticalAlign:"top",paddingTop:16}},r.createElement(On,{isSettings:this.props.isSettings})),An.map(e=>this.renderHeaderAction(e)))}renderHeader(){return r.createElement("thead",null,this.renderHeaderLabels(),this.renderHeaderTitles(),this.renderHeaderActions())}renderStandardCTA(){return r.createElement(bn,{buttonTitle:r.createElement(m.b,{id:"pricingGrid.signupComponent.submitButton.label",defaultMessage:"Try it free"}),analyticsName:"pricing_grid_bottom",buttonWidth:100,persona:"personal"})}renderEnterpriseCTA(){return r.createElement(an.a,{variant:"secondary",isFullWidth:!0,onClick:()=>{_t({environment:this.environment,typeform:"enterpriseTrial",frontContext:"pricing_grid_bottom",params:{source:"pricing_grid_bottom"}})}},r.createElement(m.b,{defaultMessage:"Try Enterprise",id:"pricingGrid.enterpriseCallToAction.message"}))}renderCTAs(){return r.createElement(r.Fragment,null,r.createElement("td",{colSpan:3,style:xn({},this.getCTACellStyle())},r.createElement("div",{style:{display:"flex",justifyContent:"flex-start",width:"100%"}},this.renderStandardCTA())),r.createElement("td",{style:xn({},this.getCTACellStyle())},this.renderEnterpriseCTA()))}renderFooter(){return r.createElement("tfoot",null,r.createElement("tr",null,r.createElement("td",{style:{verticalAlign:"middle",fontWeight:500}},r.createElement(m.b,{defaultMessage:"Sign up for free.{br}Add your team later.",id:"pricingGrid.footerSignupCallToAction.message",values:{br:r.createElement("br",null)}})),this.renderCTAs()))}renderComingSoonBadge(){return r.createElement("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap"}},r.createElement(m.b,{id:"pricingGrid.comingSoonBadge",defaultMessage:"Coming soon"}))}isPlanActive(e){return!(!this.props.planState||!this.props.planState.plans[e].isActive)}getTableStyle(e){return{fontSize:e?14:16,width:e?"100%":Pn.m,tableLayout:"fixed",borderCollapse:"initial"}}getSectionStyle(e,t){const n={borderBottom:"1px solid ".concat(e.regularDividerColor),paddingBottom:7,paddingRight:15,fontWeight:500,verticalAlign:"bottom"};return xn({},n,0===t?{paddingTop:this.props.isSettings?0:54}:{paddingTop:this.props.isSettings?20:42})}getUpgradeButtonBelowLinkStyle(){return{fontSize:this.props.isSettings?12:14}}getRowStyle(e){return{borderBottom:"1px solid ".concat(e.regularDividerColor)}}getRowLabelStyle(e){const t=(this.props.isSettings,5);return{color:e.mediumTextColor,paddingRight:10,paddingTop:t,paddingBottom:t+1,verticalAlign:"top"}}getCTACellStyle(){return{padding:"20px 15px"}}getValueStyle(){const e=this.props.isSettings?10:15;return{paddingLeft:e,paddingRight:e,textAlign:"left",overflow:"hidden",verticalAlign:"top"}}getActiveStyle(e,t){return{background:t?e.sidebarBackground:X.f.transparent}}getBorderStyle(e){return{borderLeft:this.props.isSettings?"1px solid ".concat(this.theme.lightDividerColor):void 0,borderRight:this.props.isSettings&&["enterprise"].includes(e)?"1px solid ".concat(this.theme.lightDividerColor):void 0}}getHeaderLabelStyle(e){const t=this.props.isSettings?10:15;return{paddingLeft:t,paddingRight:t,verticalAlign:"top",width:"36%",paddingTop:this.props.isSettings?10:0,fontWeight:700,fontSize:12,paddingBottom:10,borderBottom:e?"2px solid ".concat(this.theme.regularTextColor):"1px solid ".concat(this.theme.lightDividerColor),borderTop:"1px solid ".concat(this.theme.lightDividerColor)}}getHeaderStyle(){const e=this.props.isSettings?10:15;return{paddingLeft:e,paddingRight:e,verticalAlign:"top",width:"18%",paddingTop:this.props.isSettings?10:0}}getHeaderTitleStyle(){return{fontSize:this.props.isSettings?16:25,fontWeight:this.props.isSettings&&kn(this.environment)?500:700,lineHeight:1.3,marginBottom:2}}getHeaderPriceStyle(){return{fontSize:this.props.isSettings?20:25,marginRight:7}}getTooltipInnerStyle(e){return{cursor:"help",width:"100%",display:"inline-block"}}getHeaderTermsStyle(e){return{fontSize:this.props.isSettings?10:12,lineHeight:1,color:e.mediumTextColor,width:70,paddingTop:this.props.isSettings?kn(this.environment)?0:3:5}}}var Rn=Object(m.h)(Fn);const Ln=["not_using_enough","too_difficult","trial_over","too_expensive","security_compliance_requirements","company_shutting_down","upgraded_by_mistake","using_alternative","missing_features","other"],Un=["google_drive_docs","asana","trello","microsoft_office","atlassian_confluence","atlassian_jira","airtable","coda","dropbox_paper","quip","evernote","other"];class _n extends S.a{getInitialState(){return{reasons:[],reasonMissingFeatures:"",reasonOther:"",alternatives:[],alternativeOther:"",otherFeedback:""}}}var Wn=_n,qn=n(312),Nn=n(70);function zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zn(Object(n),!0).forEach((function(t){Hn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Gn=Object(m.g)({missingFeaturesPlaceholder:{id:"churnSurveyMenu.reasons.missingFeaturesPlaceholder",defaultMessage:"Let us know which features are missing..."},reasonOtherPlaceholder:{id:"churnSurveyMenu.reasons.reasonOtherPlaceholder",defaultMessage:"Tell us more..."},alternativeOtherPlaceholder:{id:"churnSurveyMenu.alternatives.alternativeOtherPlaceholder",defaultMessage:"Tell us more..."},otherFeedbackPlaceholder:{id:"churnSurveyMenu.other.otherFeedbackPlaceholder",defaultMessage:"Our team will review your feedback to make Notion better."}});class Yn extends B.a{constructor(){super(...arguments),this.shuffledReasons=[...i.shuffle(i.without(Ln,"other")),"other"],this.shuffledAlternatives=[...i.shuffle(i.without(Un,"other")),"other"],this.storeTypes={store:Wn},this.handleAccept=()=>{Object(u.v)(this.environment,this.stores.store.state),this.props.onAccept()}}renderComponent(){var e=this;const{churnType:t,onClose:n,periodEnd:a}=this.props,{store:s}=this.stores,{reasons:o,reasonMissingFeatures:l,reasonOther:c,alternatives:d,alternativeOther:u,otherFeedback:p}=s.state,g=Object(Nn.a)(a).format("LL");return r.createElement("div",{style:{fontSize:14}},r.createElement("div",{style:{display:"flex",fontSize:14,padding:24,paddingBottom:20,borderBottom:"1px solid ".concat(this.theme.lightDividerColor)}},r.createElement("div",null,r.createElement("h3",{style:Yn.headerStyle},"personal"===t?r.createElement(m.b,{id:"churnSurveyMenu.header.personal.title",defaultMessage:"Downgrade to Personal"}):r.createElement(m.b,{id:"churnSurveyMenu.header.team.title",defaultMessage:"Downgrade to Team Trial"})),r.createElement("p",{style:{lineHeight:1.4,margin:"8px 0 12px"}},r.createElement(m.b,{id:"churnSurveyMenu.header.description",defaultMessage:"Notion is constantly improving. Before you downgrade, we’d love your input to help us make Notion better for everyone. Thank you for your feedback."})),r.createElement(J.a,{onClick:n},r.createElement(m.b,{id:"churnSurveyMenu.goBackButton.title",defaultMessage:"Back to Plans"}))),r.createElement("div",{style:{alignSelf:"center",padding:"0px 8px"}},r.createElement("img",{src:fn.a.images.downgradeFeedbackPng,style:{filter:this.theme.illustrationFilter},width:160}))),r.createElement("div",{style:{padding:"8px 12px",margin:"20px 24px 12px 24px",background:this.theme.sidebarBackground,borderRadius:3}},r.createElement(m.b,{id:"churnSurveyMenu.header.covidMessage",defaultMessage:"💛 If you are impacted by COVID-19, <contactuslink>contact us</contactuslink> for assistance.",values:{contactuslink:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:()=>{Object(Se.a)({environment:e.environment,from:"churn_survey"})}},n)}}})),r.createElement("div",{style:Yn.surveySectionStyle},r.createElement("h4",{style:Yn.subheaderStyle},r.createElement(m.b,{id:"churnSurveyMenu.reasons.title",defaultMessage:"1. What are your reasons for downgrading?"})),r.createElement("div",{style:this.getDescriptionStyle()},r.createElement(m.b,{id:"churnSurveyMenu.reasons.description",defaultMessage:"Please select one or more"})),this.shuffledReasons.map(e=>{const t=o.includes(e);return r.createElement(r.Fragment,null,r.createElement("div",{key:e,style:Yn.optionRowStyle,onClick:()=>{s.setState(Vn({},s.state,{reasons:t?i.without(o,e):[...o,e]}))}},r.createElement(qn.a,{checked:t,size:14}),r.createElement("span",{style:{marginLeft:4}},this.renderMessageForReason(e))),"missing_features"===e&&t&&r.createElement(W.b,{style:Yn.inlineInputStyle,autoFocus:!0,value:l,placeholder:h.a.formatMessage(Gn.missingFeaturesPlaceholder),onChange:e=>{s.setState(Vn({},s.state,{reasonMissingFeatures:e.target.value}))}}),"other"===e&&t&&r.createElement(W.b,{style:Yn.inlineInputStyle,autoFocus:!0,value:c,placeholder:h.a.formatMessage(Gn.reasonOtherPlaceholder),onChange:e=>{s.setState(Vn({},s.state,{reasonOther:e.target.value}))}}))})),r.createElement("div",{style:Yn.surveySectionStyle},r.createElement("h4",{style:Yn.subheaderStyle},r.createElement(m.b,{id:"churnSurveyMenu.alternatives.title",defaultMessage:"2. What tools are you using instead?"})),r.createElement("div",{style:this.getDescriptionStyle()},r.createElement(m.b,{id:"churnSurveyMenu.alternatives.description",defaultMessage:"Please select one or more"})),this.shuffledAlternatives.map(e=>{const t=d.includes(e);return r.createElement(r.Fragment,null,r.createElement("div",{key:e,style:Yn.optionRowStyle,onClick:()=>{s.setState(Vn({},s.state,{alternatives:t?i.without(d,e):[...d,e]}))}},r.createElement(qn.a,{checked:t,size:14}),r.createElement("span",{style:{marginLeft:4}},this.renderMessageForAlternative(e))),"other"===e&&t&&r.createElement(W.b,{style:Yn.inlineInputStyle,autoFocus:!0,value:u,placeholder:h.a.formatMessage(Gn.alternativeOtherPlaceholder),onChange:e=>{s.setState(Vn({},s.state,{alternativeOther:e.target.value}))}}))})),r.createElement("div",{style:Yn.surveySectionStyle},r.createElement("h4",{style:Yn.subheaderStyle},r.createElement(m.b,{id:"churnSurveyMenu.otherFeedback.title",defaultMessage:"3. Any other feedback for us?"})),r.createElement(W.b,{textarea:!0,style:{marginTop:4},value:p,placeholder:h.a.formatMessage(Gn.otherFeedbackPlaceholder),onChange:e=>{s.setState(Vn({},s.state,{otherFeedback:e.target.value}))}})),r.createElement("div",{style:{padding:"20px 24px",marginTop:20,borderTop:"1px solid ".concat(this.theme.lightDividerColor)}},r.createElement("h4",{style:Yn.subheaderStyle},r.createElement(m.b,{id:"churnSurveyMenu.continueDowngrade.title",defaultMessage:"Continue downgrade?"})),r.createElement("p",{style:{margin:"4px 0 20px",lineHeight:1.4}},"personal"===t?r.createElement(m.b,{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.personal",defaultMessage:"Your current plan will expire on {periodEnd}. All features of your paid plan will be available until then. You can resubscribe or switch to another paid plan anytime.{br}After that, this workspace will be downgraded to the free Personal plan, with these restrictions: <li>Single-person use</li><li>Guest limit of 5 per workspace</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No member shared workspace</li>",values:{periodEnd:r.createElement("span",{style:{fontWeight:600}},g),br:r.createElement("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("ul",{style:Yn.restrictionListItemStyle},r.createElement("li",null,t))}}}):r.createElement(m.b,{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.team",defaultMessage:"Your current plan will expire on {periodEnd}. All features of your paid plan will be available until then. You can resubscribe or switch to another paid plan anytime.{br}After that, this workspace will be downgraded to a free trial of the Team Plan, with these restrictions: <li>1,000 block limit</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No bulk exports</li><li>No advanced permissions</li><li>No permission groups</li>",values:{periodEnd:r.createElement("span",{style:{fontWeight:600}},g),br:r.createElement("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("ul",{style:Yn.restrictionListItemStyle},r.createElement("li",null,t))}}})),r.createElement("div",{style:{display:"flex"}},r.createElement(J.a,{isRed:!0,onClick:this.handleAccept},r.createElement(m.b,{id:"churnSurveyMenu.downgradeButton.title",defaultMessage:"Downgrade"})),r.createElement(J.a,{onClick:n,style:{marginLeft:12}},r.createElement(m.b,{id:"churnSurveyMenu.cancelButton.title",defaultMessage:"Cancel"})))))}renderMessageForReason(e){if("not_using_enough"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.notUsingEnough",defaultMessage:"Not using it enough"});if("too_difficult"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.toDifficult",defaultMessage:"Too difficult to use"});if("trial_over"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.trialOver",defaultMessage:"Trial is over"});if("too_expensive"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.tooExpensive",defaultMessage:"Too expensive"});if("security_compliance_requirements"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.securityComplianceRequirements",defaultMessage:"Security or compliance requirements"});if("company_shutting_down"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.companyShuttingDown",defaultMessage:"Company is shutting down or making cuts"});if("upgraded_by_mistake"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.upgradedByMistake",defaultMessage:"Upgraded by mistake"});if("using_alternative"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.usingAlternative",defaultMessage:"Using an alternative"});if("missing_features"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.missingFeatures",defaultMessage:"Missing features"});if("other"===e)return r.createElement(m.b,{id:"churnSurveyMenu.reasons.other",defaultMessage:"Other"});throw Object(Tn.e)(e)}renderMessageForAlternative(e){if("google_drive_docs"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.googleDriveDocs",defaultMessage:"Google Drive / Docs"});if("asana"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.asana",defaultMessage:"Asana"});if("trello"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.trello",defaultMessage:"Trello"});if("microsoft_office"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.microsoftOffice",defaultMessage:"Microsoft 365 / Office"});if("atlassian_confluence"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.atlassianConfluence",defaultMessage:"Confluence"});if("atlassian_jira"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.atlassianJira",defaultMessage:"Jira"});if("airtable"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.airtable",defaultMessage:"Airtable"});if("coda"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.coda",defaultMessage:"Coda"});if("dropbox_paper"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.dropboxPaper",defaultMessage:"Dropbox Paper"});if("quip"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.quip",defaultMessage:"Quip"});if("evernote"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.evernote",defaultMessage:"Evernote"});if("other"===e)return r.createElement(m.b,{id:"churnSurveyMenu.alternatives.other",defaultMessage:"Other"});throw Object(Tn.e)(e)}getDescriptionStyle(){return{margin:0,color:this.theme.mediumTextColor,marginBottom:8}}}Yn.optionRowStyle={display:"flex",alignItems:"center",cursor:"pointer",marginBottom:4},Yn.restrictionListItemStyle={paddingLeft:20,margin:"6px 0"},Yn.surveySectionStyle={padding:"8px 24px"},Yn.headerStyle={margin:0,marginBottom:8},Yn.subheaderStyle={margin:0,marginTop:8,fontSize:16,fontWeight:600},Yn.inlineInputStyle={marginBottom:12,marginLeft:18,width:"calc(100% - 18px)"};var Qn=Yn,Kn=n(1481);function Zn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zn(Object(n),!0).forEach((function(t){$n(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Jn extends B.a{constructor(){super(...arguments),this.storeTypes={store:jt},this.renderChurnSurveyModal=()=>{const e=this.stores.store.state,{data:t}=this.props,n=he.i(this.environment);if(e.churnSurveyModalOpen&&n&&"subscribed_admin"===t.type)return r.createElement(Qn,{churnType:e.churnType,periodEnd:t.periodEnd,onAccept:this.handleChurnSurveyModalAccept,onClose:this.handleChurnSurveyModalClose})},this.handleFreeClick=async()=>{const{data:e}=this.props;if(e&&"subscribed_admin"===e.type){const e=await new Promise(e=>{const{store:t}=this.stores;t.setState({churnType:"personal",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})});if(!e)return;e&&await y.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"personal"})}else if(e&&("unsubscribed_admin"===e.type||"unsubscribed_member"===e.type)){await new Promise((e,t)=>{l.c({showCancel:!0,keepFocus:!1,message:r.createElement("div",null,r.createElement("h4",{style:{margin:"8px 0 0"}},r.createElement(m.b,{id:"subscriptSettings.freePersonal.downgradeTitle",defaultMessage:"Downgrade to the Personal Plan?"})),r.createElement("p",{style:{margin:"8px 0"}},r.createElement(m.b,{id:"subscriptionSettings.freePersonal.downgradeMessage",defaultMessage:"The Personal Plan is free for 1-person use. You'll lose the ability to add members, and guests will be limited to 5 per workspace."}))),items:[{label:r.createElement(m.b,{id:"subscriptionSettings.freePersonal.downgradeConfirmationButton",defaultMessage:"Downgrade to Personal Plan"}),color:"red",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})})&&await y.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"personal"})}},this.handlePersonalClick=async()=>{const{spaceStore:e,data:t}=this.props;if("subscribed_admin"===t.type&&he.G(t)){const n=Tt.c.personal[t.interval];await y.i({environment:this.environment,spaceStore:e,plan:n,billing:t.billing})}else y.e(this.environment,{subscriptionTier:"personal",from:"pricing_grid"})},this.handleEducationPlanClick=async()=>{const{spaceStore:e}=this.props;y.j({environment:this.environment,spaceStore:e})},this.handleTeamClick=async()=>{const{spaceStore:e,data:t}=this.props;let n;if("subscribed_admin"===t.type&&void 0===t.canceledAt&&he.l(t)!==U.a.pricing.enterprise.productId&&(n=this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmMessage",defaultMessage:"You will be charged a prorated amount based on your current billing interval and account balance."})),n){const e="unsubscribed_admin"===t.type||"unsubscribed_member"===t.type||"subscribed_admin"===t.type&&t.canceledAt||he.l(t)!==U.a.pricing.enterprise.productId;if(!(await l.a({message:n,acceptLabel:this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmButtonLabel",defaultMessage:"{upgrading, select, true {Upgrade to Team Plan} other {Downgrade to Team Plan}}"},{upgrading:e})})))return}if("subscribed_admin"===t.type&&he.G(t)){const n=Tt.c.team[t.interval];await y.i({environment:this.environment,spaceStore:e,plan:n,billing:t.billing})}else y.e(this.environment,{subscriptionTier:"team",from:"pricing_grid"})},this.handleTeamFreeClick=async()=>{const{data:e}=this.props;if(e&&"subscribed_admin"===e.type){const e=await new Promise(e=>{const{store:t}=this.stores;t.setState({churnType:"team",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})});if(u.F(this.environment,{confirmed:e}),!e)return;e&&await y.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team"})}else if(e&&("unsubscribed_admin"===e.type||"unsubscribed_member"===e.type)){const e=await new Promise((e,t)=>{l.c({showCancel:!0,keepFocus:!1,message:r.createElement("div",null,r.createElement("h4",{style:{margin:"8px 0 0"}},r.createElement(m.b,{id:"subscriptionSettings.freeTeam.upgradeTitle",defaultMessage:"Try the Team Plan for free"})),r.createElement("p",{style:{margin:"8px 0"}},r.createElement(m.b,{id:"subscriptionSettings.freeTeam.upgradeMessage",defaultMessage:"You'll get access to most features of a paid Team Plan, with a 1,000 block storage limit. Upgrade to go unlimited anytime."}))),items:[{label:r.createElement(m.b,{id:"subscriptionSettings.startTeamTrialDialog.confirmationbutton",defaultMessage:"Start Team trial"}),color:"blue",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})});if(u.G(this.environment,{confirmed:Boolean(e)}),!e)return;e&&await y.a({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team"})}},this.handleEnterpriseClick=async()=>{const{spaceStore:e,data:t}=this.props;if("subscribed_admin"===t.type&&void 0===t.canceledAt){const e=r.createElement(m.b,{id:"subscriptionSettings.upgradeToEnterpriseDialog.message",defaultMessage:"You will be charged a prorated amount based on your current billing interval and account balance."});if(!(await l.a({message:e,acceptLabel:r.createElement(m.b,{id:"subscriptionSettings.upgradeToEnterpriseDialog.confirmationbutton",defaultMessage:"Upgrade to Enterprise Plan"})})))return}if("subscribed_admin"===t.type&&he.G(t)){const n=Tt.c.enterprise[t.interval];await y.i({environment:this.environment,spaceStore:e,plan:n,billing:t.billing})}else y.e(this.environment,{subscriptionTier:"enterprise",from:"pricing_grid"})},this.handleChurnSurveyModalAccept=()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onAccept(),e.reset()},this.handleChurnSurveyModalClose=()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onClose(),e.reset()}}willMount(){y.f(this.environment)}renderComponent(){return Z.a.state.online?this.renderPlans():r.createElement(Kn.a,null)}renderPlans(){const{churnSurveyModalOpen:e}=this.stores.store.state;return r.createElement("div",{style:Jn.wrapStyle},r.createElement(Dt.b,{style:Jn.scrollerStyle,type:Dt.a.Y},this.renderSubscriptionInfo(),this.renderPricingGrid(),this.renderPriceDisclaimer(),this.allowEducationUpgrade()&&this.renderStudentUpgrade(),this.renderFAQ(),r.createElement(F.a,{innerStyle:{width:600,height:"80vh",overflow:"scroll"},open:e,render:this.renderChurnSurveyModal,onDismiss:this.handleChurnSurveyModalClose})))}renderPriceDisclaimer(){const{intl:e}=this.props;return r.createElement("div",{style:Jn.priceDisclaimerStyle},r.createElement(m.b,{id:"spaceSubscriptionPlans.priceDisclaimer",defaultMessage:"Prices shown are for annual billing. When billed month-to-month, the <b>Personal Pro Plan</b> is {personalMonthlyPrice} per month, the <b>Team Plan</b> is {teamMonthlyPrice} per member per month, and the <b>Enterprise Plan</b> is {enterpriseMonthlyPrice} per member per month.",values:{b:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("b",null,t)},personalMonthlyPrice:Object(xt.b)({amount:U.a.pricing.personal.monthlyPrice,currency:"dollar",intl:e}),teamMonthlyPrice:Object(xt.b)({amount:U.a.pricing.team.monthlyPricePerMember,currency:"dollar",intl:e}),enterpriseMonthlyPrice:Object(xt.b)({amount:U.a.pricing.enterprise.monthlyPricePerMember,currency:"dollar",intl:e})}}))}renderSubscriptionInfo(){const{spaceStore:e}=this.props,{data:t}=this.props;if("subscribed_admin"===t.type)return r.createElement("div",{style:this.subscriptionInfoStyle()},he.F(this.environment,e,t));if("unsubscribed_admin"===t.type||"unsubscribed_member"===t.type){e.getPlanType();return r.createElement("div",{style:Xn({},this.subscriptionInfoStyle(),{display:"flex",alignItems:"center",justifyContent:"space-between"})},r.createElement("div",null,he.F(this.environment,e,t)))}}renderPricingGrid(){const e=this.getPlanState();return r.createElement(Rn,{isSettings:!0,planState:e,data:this.props.data})}renderStudentUpgrade(){return r.createElement("div",{style:Jn.subsectionStyle},r.createElement("div",{style:Jn.subsectionTitleStyle},r.createElement(m.b,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.title",defaultMessage:"Students & educators"})),r.createElement("div",{style:{color:this.theme.mediumTextColor,marginBottom:15}},r.createElement(m.b,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.text",defaultMessage:"<p>Personal Pro Plans are free for students and educators! Simply sign up with your school email address and you'll immediately gain access to those features.</p><p>If you're already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free.</p>",values:{p:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("div",{style:{marginBottom:4}},t)}}})),r.createElement($.a,{isLarge:!0,onClick:this.handleEducationPlanClick},r.createElement(m.b,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.getEducationPlanButton.label",defaultMessage:"Get free Education plan"})))}renderFAQ(){return r.createElement("div",{style:Jn.subsectionStyle},r.createElement("div",{style:Jn.subsectionTitleStyle},r.createElement(m.b,{id:"spaceSubscriptionPlans.faqSection.title",defaultMessage:"FAQ"})),r.createElement(rn,{cta:"intercom",type:"general",isSettings:!0}))}getMemberCount(){return he.t(this.props.data)}canSwitchPlans(){return this.props.spaceStore.canAdmin()}calculateButtonState(e){const{data:t}=this.props,n=Boolean(t&&"subscribed_admin"===t.type&&t.canceledAt);if("personal_free"===e)return{free:"current",personal:"upgrade",team:"upgrade",enterprise:"upgrade"};if("personal"===e||"student"===e)return{free:n?"current":"downgrade",personal:n?"resubscribe":"current",team:"upgrade",enterprise:"upgrade"};if("team_free"===e||"free"===e)return{free:"downgrade",personal:"upgrade",team:"upgrade",enterprise:"upgrade"};if("team"===e)return{free:"downgrade",personal:"downgrade",team:n?"resubscribe":"current",enterprise:"upgrade"};if("enterprise"===e)return{free:"downgrade",personal:"downgrade",team:"downgrade",enterprise:n?"resubscribe":"current"};throw Object(Tn.e)(e)}isButtonStateActive(e){return["current","resubscribe"].includes(e)}getPlanState(){const e=he.i(this.environment);if(!e)return;const t="team_free"===e||"free"===e,n=this.calculateButtonState(e);return{plans:{free:{buttonType:n.free,isActive:this.isButtonStateActive(n.free),onClick:this.handleFreeClick},personal:{buttonType:n.personal,isActive:this.isButtonStateActive(n.personal),onClick:this.handlePersonalClick},team:{buttonType:n.team,isActive:this.isButtonStateActive(n.team)||t,onClick:this.handleTeamClick,onClickTeamFree:this.handleTeamFreeClick},enterprise:{buttonType:n.enterprise,isActive:this.isButtonStateActive(n.enterprise),onClick:this.handleEnterpriseClick}},isTeamTrial:t,canSwitchPlans:this.canSwitchPlans(),memberCount:this.getMemberCount()}}allowEducationUpgrade(){const{data:e}=this.props,t=this.getPlanState();return t&&t.canSwitchPlans&&!he.w(e)&&1===t.memberCount&&(t.plans.free.isActive||t.plans.personal.isActive)}subscriptionInfoStyle(){return{textAlign:"left",marginBottom:24,fontSize:14,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:16}}}Jn.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Jn.scrollerStyle={transform:"translateZ(0px)",flexGrow:1,padding:30},Jn.subscriptionInfoCtaButtonStyle={marginLeft:16,paddingLeft:10},Jn.priceDisclaimerStyle={fontSize:14,marginTop:20,marginBottom:40},Jn.subsectionStyle={fontSize:14,marginTop:40},Jn.subsectionTitleStyle={fontSize:20,fontWeight:Y.a.fontWeight.bold,marginBottom:12};var er=Object(m.h)(Jn),tr=n(562);class nr extends S.a{getInitialState(){return{paymentMethodModalOpen:!1,billingIntervalModalOpen:!1,billingEmailModalOpen:!1,vatIdModalOpen:!1,addressModalOpen:!1,applyCreditModalOpen:!1,billingEventsLimit:20}}}var rr=nr,ir=n(1656);const ar={workspaceBalance:r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.workspaceSubscriptionBalance.title",defaultMessage:"Workspace balance"})};var sr=n(181),or=n(77),lr=n(114);function cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function dr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ur extends B.a{constructor(){super(...arguments),this.storeTypes={store:rr,billingHistoryRequestStore:pe.a},this.performGetBillingHistoryRequest=async e=>{const{spaceStore:t}=this.props,n=await s.D(this.environment,{spaceId:t.id,limit:e});if("failed"===n.type)throw n.error;return n.data},this.renderBillingHistoryResults=(e,t)=>{this.props.mockBillingHistoryResult&&(t=this.props.mockBillingHistoryResult);const{billingHistoryRequestStore:n}=this.stores;return r.createElement("div",null,t&&0===t.events.length&&r.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:14}},r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.noInvoicesMessage",defaultMessage:"This workspace has no payments yet."})),t&&t.events.length>0&&r.createElement("table",null,r.createElement("tbody",null,t.events.map(this.renderBillingHistoryEvent))),t&&!t.reachedEndOfResults&&r.createElement(or.a,{onClick:this.handleLoadMoreBillingEventsClick,style:{marginLeft:-4,width:"100%"}},r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.loadMoreInvoicesButton.label",defaultMessage:"Load more"})),n.state.loading&&r.createElement(q.a,null))},this.renderBillingHistoryEvent=(e,t)=>{let n;const{intl:i}=this.props;return n="paid"===e.status?e.total<0?r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.credited",defaultMessage:"Credited"}):r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.paid",defaultMessage:"Paid"}):e.attempted?r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.failed",defaultMessage:"Failed"}):r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.due",defaultMessage:"Due",description:"Label for the amount that the user owes on a given invoice"}),r.createElement("tr",{style:{height:28,fontSize:14,whiteSpace:"nowrap"},key:t},r.createElement("td",{style:{width:"100%",paddingRight:18,color:this.theme.mediumTextColor}},Object(Nn.a)(e.timestamp).format("LL")),r.createElement("td",{style:{paddingRight:18}},n),r.createElement("td",{style:{paddingRight:18,textAlign:"right"}},Object(xt.b)({amount:e.total,currency:"dollar",intl:i})),r.createElement("td",null,r.createElement(lr.a,{inline:!0,href:"/invoice/".concat(e.id),external:!0,innerStyle:this.getViewInvoiceButtonStyle()},r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.viewInvoiceButton",defaultMessage:"View invoice"}))))},this.handleLoadMoreBillingEventsClick=()=>{this.stores.store.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?cr(Object(n),!0).forEach((function(t){dr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):cr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.stores.store.state,{billingEventsLimit:this.stores.store.state.billingEventsLimit+ur.billingEventsLimitIncrement}))}}renderComponent(){const{store:e,billingHistoryRequestStore:t}=this.stores,n={request:e.state.billingEventsLimit,performRequest:this.performGetBillingHistoryRequest,render:this.renderBillingHistoryResults};return r.createElement("div",null,r.createElement(z.a,{large:!0,divider:"full",style:{marginTop:36}},r.createElement(m.b,{id:"spaceSubscriptionBilling.invoicesSection.title",defaultMessage:"Invoices"})),r.createElement(sr.a,Object.assign({},n,{requestStore:t})))}static getModalStyle(e){return{width:480,background:e.popoverBackground,padding:24,borderRadius:3}}getViewInvoiceButtonStyle(){return{color:this.theme.mediumTextColor,padding:"2px 3px",borderRadius:3}}}ur.billingEventsLimitIncrement=20,ur.modalTitleStyle={fontSize:18,marginBottom:16,fontWeight:Y.a.fontWeight.medium};var pr=Object(m.h)(ur);const mr=Object(m.g)({apply_credit:{id:"spaceSubscriptionBilling.applyCreditButton.label",defaultMessage:"Apply credit",description:"Button a user clicks to apply Notion credits towards their Notion bill."},update:{id:"spaceSubscriptionBilling.updateButton.label",defaultMessage:"Update"},add:{id:"spaceSubscriptionBilling.addButton.label",defaultMessage:"Add"}});class hr extends B.a{renderComponent(){const{title:e,caption:t,buttonArgs:n}=this.props,i=r.createElement(m.b,Object.assign({},mr[n.buttonPurpose]));return r.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14}},r.createElement("div",{style:{marginRight:"auto"}},e),r.createElement("div",{style:{color:this.theme.mediumTextColor}},t),r.createElement("div",{style:{minWidth:110,display:"flex",justifyContent:"flex-end"}},n.showButton&&r.createElement(or.a,{isBlue:!0,onClick:n.onClick,style:hr.buttonStyle},i)))}}hr.buttonStyle={marginLeft:18,marginRight:-4,fontWeight:Y.a.fontWeight.medium};var gr=Object(m.h)(hr);function br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?br(Object(n),!0).forEach((function(t){yr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):br(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Sr={offline:r.createElement(m.b,{defaultMessage:"Please go online to manage billing.",id:"spaceSubscriptionBilling.offline.message"})};class vr extends B.a{constructor(){super(...arguments),this.storeTypes={store:rr,billingHistoryRequestStore:pe.a},this.renderPaymentMethodModal=()=>{const{temporaryBillingType:e}=this.stores.store.state,{data:t}=this.props,n=e||t.billing,i=Boolean(t.brand&&t.last4);return r.createElement(Er,{theme:this.theme,title:r.createElement(m.b,{id:"spaceSubscriptionBilling.changePaymentMethod.title",defaultMessage:"Change payment method"}),acceptAction:"update",onAccept:this.handlePaymentMethodAccept,onClose:this.handleModalClose},r.createElement("div",{style:{marginTop:12,marginBottom:16}},i?he.E({currentBillingType:n,hasExistingCreditCard:i,handleUseCardClick:this.handleUseCardClick,handleCardUpdateClick:this.handleCardUpdateClick,handleSendInvoiceClick:this.handleSendInvoiceClick}):he.E({currentBillingType:n,hasExistingCreditCard:i,handleUseCardClick:this.handleUseCardClick,handleSendInvoiceClick:this.handleSendInvoiceClick})))},this.renderBillingIntervalModal=()=>{const{temporaryBillingInterval:e}=this.stores.store.state,{data:t}=this.props,n=e||t.interval,{monthlyPlanAmount:i,yearlyPlanAmount:a}=t,s=1-a/(12*i);return r.createElement(Er,{theme:this.theme,title:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingInterval.title",defaultMessage:"Change billing interval"}),helpButton:r.createElement(oe.a,{title:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingInterval.helpButton.label",defaultMessage:"Learn about how this change will impact what you pay."}),href:Object(Ie.a)("guides.changeBillingInterval"),analyticsFrom:"billing_interval_settings"}),acceptAction:"update",onAccept:this.handleBillingIntervalAccept,onClose:this.handleModalClose},r.createElement("div",{style:{marginTop:12,marginBottom:16}},he.D({environment:this.environment,productId:t.productId,yearlyPlanAmount:a,monthlyPlanAmount:i,yearlySavingsPercent:s,currentBillingInterval:n,handleMonthlyBillingClick:this.handleMonthlyBillingClick,handleYearlyBillingClick:this.handleYearlyBillingClick})))},this.renderApplyCreditModal=()=>{const{data:e,intl:t}=this.props,{availableCredit:n}=e,i=this.getCurrentFormCreditAmount(),a=Math.max(0,(e.nextInvoiceAmount||0)-i);return r.createElement("div",{style:vr.getModalStyle(this.theme)},r.createElement("div",{style:vr.modalTitleStyle},r.createElement(m.b,{id:"spaceSubscriptionBilling.useCreditModal.title",defaultMessage:"Use Notion credit - {creditInDollars} available",values:{creditInDollars:Object(xt.b)({amount:n,currency:"dollar",intl:t})}})),r.createElement("div",{style:{fontSize:14,display:"flex",alignItems:"center",marginBottom:16}},r.createElement("div",{style:{width:"100%",marginRight:20,color:this.theme.mediumTextColor}},r.createElement(m.b,{id:"spaceSubscriptionBilling.useCreditModal.amountOfCreditQuestion",defaultMessage:"How much credit would you like to apply to your next invoice?"})),r.createElement(ir.a,{availableCredit:n,focus:!0,selectAll:!0,onChange:this.handleApplyCreditAmountInputChange}),r.createElement("div",{style:{whiteSpace:"nowrap",marginLeft:8}},"/"," ",Object(xt.b)({amount:n,currency:"dollar",intl:t}))),r.createElement("div",{style:{borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:16}},r.createElement("div",{style:{paddingBottom:18,fontSize:12,color:this.theme.mediumTextColor}},r.createElement(m.b,{id:"spaceSubscriptionBilling.useCreditModal.warning",defaultMessage:"Applying credit to your account <bold>cannot be undone</bold>.",values:{bold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("b",null,t)}}})),r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement("div",{style:{fontSize:36,lineHeight:1}},Object(xt.b)({amount:a,currency:"dollar",intl:t})),r.createElement("div",{style:{marginLeft:8,fontSize:12,color:this.theme.mediumTextColor,alignSelf:"flex-end"}},r.createElement(m.b,{id:"spaceSubscriptionBilling.useCreditModal.nextInvoiceAmount",defaultMessage:"next invoice total",description:"Text that appears next to the amount, in dollars, that the user's next invoice will be after applying their Notion credits to their bill."})),r.createElement(J.a,{isLarge:!0,style:{marginLeft:"auto"},onClick:this.handleModalClose},r.createElement(m.b,{id:"spaceSubscriptionBilling.useCreditModal.cancelButton.label",defaultMessage:"Cancel"})),r.createElement($.a,{isLarge:!0,style:{marginLeft:12},disabled:i<=0,onClick:this.handleApplyCreditAccept},r.createElement(m.b,{id:"spaceSubscriptionBilling.useCreditModal.applyCreditButton.label",defaultMessage:"Apply credit"})))))},this.renderSingleTextFieldModal=(e,t,n,i,a)=>r.createElement(Er,{theme:this.theme,title:t,acceptAction:a,onAccept:i,onClose:this.handleModalClose},r.createElement(W.b,{focus:!0,selectAll:!0,value:e,onChange:n,onSubmit:i,style:vr.modalInputStyle})),this.renderBillingEmailModal=()=>{const{data:e}=this.props,{temporaryBillingEmail:t}=this.stores.store.state,n=void 0!==t?t:e.billingEmail||"",i=e.billingEmail?"update":"add";return this.renderSingleTextFieldModal(n,r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingEmailModal.title",defaultMessage:"Change billing email"}),this.handleBillingEmailChange,this.handleBillingEmailAccept,i)},this.renderVatIdModal=()=>{const{data:e}=this.props,{temporaryVatId:t}=this.stores.store.state,n=void 0!==t?t:e.vatId||"",i=e.vatId?"update":"add";return this.renderSingleTextFieldModal(n,r.createElement(m.b,{id:"spaceSubscriptionBilling.changeVATIDModal.title",defaultMessage:"Change VAT ID"}),this.handleVatIdChange,this.handleVatIdAccept,i)},this.updateTemporaryAddress=e=>{const{temporaryAddress:t}=this.stores.store.state;this.stores.store.setState(fr({},this.stores.store.state,{temporaryAddress:fr({},this.props.data.address,{},t,{},e)}))},this.renderAddressModal=()=>{const{data:e}=this.props,{temporaryAddress:t}=this.stores.store.state,n=[{key:"name",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.nameInput.label",defaultMessage:"Name"})},{key:"businessName",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.businessNameInput.label",defaultMessage:"Business name"})},{key:"addressLine1",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.addressLine1Input.label",defaultMessage:"Address line 1"})},{key:"addressLine2",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.addressLine2Input.label",defaultMessage:"Address line 2"})},{key:"city",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.cityInput.label",defaultMessage:"City"})},{key:"state",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.stateInput.label",defaultMessage:"State / Province"})},{key:"country",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.countryInput.label",defaultMessage:"Country"})},{key:"zipCode",label:r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.ZIPInput.label",defaultMessage:"ZIP / Postal code"})}].map(n=>r.createElement(r.Fragment,{key:n.key},r.createElement("div",{style:vr.addressModalTitleStyle},n.label),r.createElement(W.b,{style:vr.modalInputStyle,value:t?t[n.key]:e.address[n.key]||"",onChange:e=>this.updateTemporaryAddress({[n.key]:e.target.value})})));return r.createElement("div",{style:{display:"flex",flexDirection:"column",maxHeight:"75vh"}},r.createElement(Dt.b,{style:vr.getModalStyle(this.theme),type:Dt.b.OverflowType.Y},r.createElement("div",{style:vr.modalTitleStyle},r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.title",defaultMessage:"Change billing address"})),n),r.createElement("div",{style:{display:"flex",justifyContent:"flex-end",padding:"16px 24px",background:this.theme.contentBackground}},r.createElement(J.a,{isLarge:!0,onClick:this.handleModalClose},r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.cancelButton.label",defaultMessage:"Cancel"})),r.createElement($.a,{style:{marginLeft:12},isLarge:!0,disabled:void 0===this.getUpdatedAddress(),onClick:this.handleAddressAccept},r.createElement(m.b,{id:"spaceSubscriptionBilling.changeBillingAddressModal.updateButton.label",defaultMessage:"Update"}))))},this.handleChangePlanClick=()=>{x.a.setState({open:!0,currentTab:"plans"})},this.handlePaymentMethodChangeClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{paymentMethodModalOpen:!0}))},this.handleBillingIntervalChangeClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{billingIntervalModalOpen:!0}))},this.handleBillingEmailChangeClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{billingEmailModalOpen:!0}))},this.handleAddressChangeClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{addressModalOpen:!0}))},this.handleVatIdChangeClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{vatIdModalOpen:!0}))},this.handleModalClose=()=>{this.stores.store.reset()},this.handleBillingEmailChange=e=>{this.stores.store.setState(fr({},this.stores.store.state,{temporaryBillingEmail:e.target.value}))},this.handleBillingEmailAccept=async()=>{const{spaceStore:e,data:t}=this.props,{temporaryBillingEmail:n}=this.stores.store.state;n!==t.billingEmail&&await y.i({environment:this.environment,spaceStore:e,billingEmail:n}),this.handleModalClose()},this.handleVatIdChange=e=>{this.stores.store.setState(fr({},this.stores.store.state,{temporaryVatId:e.target.value}))},this.handleVatIdAccept=async()=>{const{spaceStore:e,data:t}=this.props,{temporaryVatId:n}=this.stores.store.state;n!==t.vatId&&await y.i({environment:this.environment,spaceStore:e,vatId:n}),this.handleModalClose()},this.handleAddressAccept=async()=>{const{spaceStore:e}=this.props,t=this.getUpdatedAddress();if(t)try{await y.g({environment:this.environment,spaceStore:e,address:t}),this.handleModalClose()}catch(n){}},this.getUpdatedAddress=()=>{const{data:e}=this.props,{temporaryAddress:t}=this.stores.store.state;if(t&&t!==e.address)return t},this.handleMonthlyBillingClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{temporaryBillingInterval:"month"}))},this.handleYearlyBillingClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{temporaryBillingInterval:"year"}))},this.handleBillingIntervalAccept=async()=>{const{spaceStore:e,data:t}=this.props,{temporaryBillingInterval:n}=this.stores.store.state;if(n&&n!==t.interval){const t=this.getPlanForOppositeBillingInterval();t&&await y.i({environment:this.environment,spaceStore:e,plan:t})}this.handleModalClose()},this.handleUseCardClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{temporaryBillingType:"charge_automatically"}))},this.handleSendInvoiceClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{temporaryBillingType:"send_invoice"}))},this.handleCardUpdateClick=async()=>{const{spaceStore:e}=this.props,{data:t}=this.props;if(t.billingEmail){const n=await y.d({name:"Update your Card",panelLabel:"Update",email:t.billingEmail});await y.i({environment:this.environment,spaceStore:e,billing:"charge_automatically",stripeToken:n})}this.handleModalClose()},this.handlePaymentMethodAccept=async()=>{const{spaceStore:e}=this.props,{data:t}=this.props,{temporaryBillingType:n}=this.stores.store.state,r=n||t.billing;if("charge_automatically"!==r||t.brand)r!==t.billing&&await y.i({environment:this.environment,spaceStore:e,billing:n});else{const{currentUserStore:n}=d.a.state,r=n?n.getValue():void 0,i=t.billingEmail||(r?r.email:void 0);if(!i)throw new Error("No billing email found.");const a=await y.d({name:"Update your Card",panelLabel:"Update",email:i});await y.i({environment:this.environment,spaceStore:e,billing:"charge_automatically",stripeToken:a,billingEmail:i})}this.handleModalClose()},this.handleApplyCreditClick=()=>{this.stores.store.setState(fr({},this.stores.store.state,{applyCreditModalOpen:!0}))},this.handleApplyCreditAccept=async()=>{const e=this.getCurrentFormCreditAmount(),{spaceStore:t}=this.props;e>0&&await y.i({environment:this.environment,spaceStore:t,creditAmount:e}),this.handleModalClose(),u.Qd(this.environment,{amount:e})},this.handleApplyCreditAmountInputChange=e=>{this.stores.store.setState(fr({},this.stores.store.state,{temporaryApplyCreditCents:e}))},this.handleRestartSubscriptionClick=async()=>{const{spaceStore:e}=this.props,{data:t}=this.props;await y.i({environment:this.environment,spaceStore:e,plan:t.plan}),this.handleModalClose()}}willMount(){y.f(this.environment)}renderComponent(){return Z.a.state.online?this.renderBilling():vr.renderOfflineMessage()}static renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,style:{textAlign:"center"}},Sr.offline))}renderBilling(){const{data:e}=this.props,{paymentMethodModalOpen:t,billingIntervalModalOpen:n,billingEmailModalOpen:i,addressModalOpen:a,applyCreditModalOpen:s,vatIdModalOpen:o}=this.stores.store.state;return r.createElement("div",{style:vr.wrapStyle},r.createElement(Dt.b,{style:vr.scrollerStyle,type:Dt.a.Y},this.renderHeader(e),this.renderSummary(e),this.renderPaymentMethod(e),this.renderSeparator(),this.renderBillingInterval(e),this.renderSeparator(),this.renderBillingEmail(e),this.renderSeparator(),this.renderAddress(e),this.renderSeparator(),this.renderVatId(e),this.renderSeparator(),this.renderCredit(e),r.createElement(pr,Object.assign({},this.props)),r.createElement(F.a,{open:t,render:this.renderPaymentMethodModal,onDismiss:this.handleModalClose}),r.createElement(F.a,{open:n,render:this.renderBillingIntervalModal,onDismiss:this.handleModalClose}),r.createElement(F.a,{open:s,render:this.renderApplyCreditModal,onDismiss:this.handleModalClose}),r.createElement(F.a,{open:i,render:this.renderBillingEmailModal,onDismiss:this.handleModalClose}),r.createElement(F.a,{open:a,render:this.renderAddressModal,onDismiss:this.handleModalClose}),r.createElement(F.a,{open:o,render:this.renderVatIdModal,onDismiss:this.handleModalClose})))}renderHeader(e){let t=r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.legacyPlanTitle",defaultMessage:"Legacy Plan"});switch(e.productId){case U.a.pricing.personal.productId:t=r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.personalPlanTitle",defaultMessage:"Personal Pro Plan"});break;case U.a.pricing.student.productId:t=r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.personalEducationPlanTitle",defaultMessage:"Personal Pro (Education) Plan"});break;case U.a.pricing.team.productId:t=r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.teamPlanTitle",defaultMessage:"Team Plan"});break;case U.a.pricing.enterprise.productId:t=r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.enterprisePlanTitle",defaultMessage:"Enterprise Plan"})}return r.createElement(z.a,{large:!0,divider:"full"},t)}renderSummary(e){const{spaceStore:t}=this.props,n=he.F(this.environment,t,e),i=he.v(e),a="subscribed_admin"===e.type;return r.createElement("div",{style:vr.summaryStyle},r.createElement("div",{style:vr.summaryMessageStyle},n),i&&r.createElement($.a,{isLarge:!0,onClick:this.handleRestartSubscriptionClick,style:{marginRight:8}},r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.restartSubscriptionButton.label",defaultMessage:"Restart subscription"})),a&&r.createElement(J.a,{isLarge:!0,onClick:this.handleChangePlanClick},r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.changePlanButton.label",defaultMessage:"Change plan"})))}renderSeparator(){return r.createElement("div",{style:{flex:"none",height:1,marginTop:10,marginBottom:10,background:this.theme.regularDividerColor}})}renderPaymentMethod(e){return r.createElement(gr,{title:r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.title",defaultMessage:"Payment method"}),caption:r.createElement(r.Fragment,null,"send_invoice"===e.billing&&r.createElement("div",null,r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.achOrWireTransfer",defaultMessage:"ACH or Wire Transfer"})),"charge_automatically"===e.billing&&(e.last4&&e.brand?r.createElement("div",null,r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.creditCard",defaultMessage:"{creditCardBrand} ending in {lastFourDigits}",values:{creditCardBrand:Object(tr.a)(e.brand),lastFourDigits:e.last4}})):r.createElement("div",null,r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.none",defaultMessage:"None",description:"The payment method setting we display for users who haven't set up a payment method yet"})))),buttonArgs:{showButton:!0,buttonPurpose:"update",onClick:this.handlePaymentMethodChangeClick}})}renderBillingInterval(e){return r.createElement(gr,{title:r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.title",defaultMessage:"Billing interval"}),caption:r.createElement("div",null,"month"===e.interval?r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.monthly",defaultMessage:"Monthly"}):r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.yearly",defaultMessage:"Yearly"})),buttonArgs:{showButton:Boolean(this.getPlanForOppositeBillingInterval()),buttonPurpose:"update",onClick:this.handleBillingIntervalChangeClick}})}renderBillingEmail(e){return r.createElement(gr,{title:r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingEmail.title",defaultMessage:"Billing email"}),caption:r.createElement("div",null,e.billingEmail||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.billingEmail)?"update":"add",onClick:this.handleBillingEmailChangeClick}})}renderVatId(e){return r.createElement(gr,{title:r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.VATID.title",defaultMessage:"VAT ID",description:"Title for the section where users can update their VAT (value added tax) identification number"}),caption:r.createElement("div",null,e.vatId||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.vatId)?"update":"add",onClick:this.handleVatIdChangeClick}})}renderAddress(e){return r.createElement(gr,{title:r.createElement(m.b,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingAddress.title",defaultMessage:"Billing address"}),caption:r.createElement("div",{style:{textAlign:"right",width:"80%",float:"right"}},this.renderAddressString(e.address)||""),buttonArgs:{showButton:!0,buttonPurpose:e.address&&!i.isEmpty(e.address)?"update":"add",onClick:this.handleAddressChangeClick}})}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:n}=this.props;return r.createElement(gr,{title:ar.workspaceBalance,caption:r.createElement("div",null,Object(xt.b)({amount:t,currency:"dollar",intl:n})),buttonArgs:{showButton:!0,buttonPurpose:"apply_credit",onClick:this.handleApplyCreditClick}})}renderAddressString(e){return e?this.props.intl.formatList([e.name,e.businessName,e.addressLine1,e.addressLine2].filter(Boolean),{type:"conjunction",style:"narrow"}):""}getCurrentFormCreditAmount(){const{data:e}=this.props,{store:t}=this.stores,{temporaryApplyCreditCents:n}=t.state;return void 0!==n?n:e.availableCredit}getPlanForOppositeBillingInterval(){const{data:e}=this.props,t=Tt.b.find(t=>t.indexOf(e.plan)>=0);if(t){const n=t.indexOf(e.plan);return t[0===n?1:0]}}static getModalStyle(e){return{width:480,background:e.popoverBackground,padding:24,borderRadius:3}}}function Er(e){const t=r.createElement(m.b,Object.assign({},mr[e.acceptAction]));return r.createElement("div",{style:vr.getModalStyle(e.theme)},r.createElement("div",{style:vr.modalTitleStyle},e.title),e.children,r.createElement("div",{style:{marginBottom:20}},e.helpButton),r.createElement("div",{style:{display:"flex",justifyContent:"flex-end"}},r.createElement(J.a,{isLarge:!0,onClick:e.onClose,style:{marginRight:12}},r.createElement(m.b,{id:"spaceSubscriptionBilling.cancelButton.label",defaultMessage:"Cancel"})),r.createElement($.a,{isLarge:!0,onClick:e.onAccept},t)))}vr.modalTitleStyle={fontSize:18,marginBottom:16,fontWeight:Y.a.fontWeight.medium},vr.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},vr.scrollerStyle={height:"100%",padding:"36px 60px"},vr.summaryStyle={display:"flex",alignItems:"flex-start",fontSize:14,marginBottom:36},vr.summaryMessageStyle={marginRight:"auto",paddingRight:32},vr.addressModalTitleStyle={marginTop:12},vr.modalInputStyle={marginTop:12,marginBottom:20};var Mr=Object(m.h)(vr);class wr extends B.a{constructor(){super(...arguments),this.storeTypes={store:rr,billingHistoryRequestStore:pe.a}}willMount(){y.f(this.environment)}renderComponent(){const{data:e}=this.props;return Z.a.state.online?r.createElement("div",{style:wr.wrapStyle},r.createElement(Dt.b,{style:wr.scrollerStyle,type:Dt.a.Y},r.createElement(z.a,{large:!0,divider:"full"},r.createElement(m.b,Object.assign({},x.d.billingTab))),this.renderCredit(e),this.renderSeparator(),r.createElement(pr,Object.assign({},this.props)))):wr.renderOfflineMessage()}static renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,style:{textAlign:"center"}},Sr.offline))}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:n}=this.props;return r.createElement(gr,{title:ar.workspaceBalance,caption:r.createElement("div",null,Object(xt.b)({amount:t,currency:"dollar",intl:n})),buttonArgs:{showButton:!1,buttonPurpose:"apply_credit",onClick:i.noop}})}renderSeparator(){return r.createElement("div",{style:{flex:"none",marginTop:30}})}}wr.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},wr.scrollerStyle={height:"100%",padding:"36px 60px"};var Cr=Object(m.h)(wr);class Or extends S.a{getInitialState(){return{emailInputValue:"",showAllInviteCredits:!1}}}var kr=Or,Pr=n(486),Tr=n(211);function Dr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ir(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dr(Object(n),!0).forEach((function(t){jr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function jr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class xr extends B.a{constructor(){super(...arguments),this.handleImportActionClick=()=>{Pr.a.setState({open:!0}),u.hb(this.environment,{type:"import_evernote"})},this.handleWebActionClick=()=>{dn.i({environment:this.environment,url:"/product"}),u.hb(this.environment,{type:"web_login"})},this.handleDesktopActionClick=()=>{dn.i({environment:this.environment,url:"/desktop"}),u.hb(this.environment,{type:"desktop_login"})},this.handleMobileActionClick=()=>{dn.i({environment:this.environment,url:"/mobile"}),u.hb(this.environment,{type:"mobile_login"})},this.handleBrowserExtensionActionClick=()=>{dn.i({environment:this.environment,url:"/web-clipper"}),u.hb(this.environment,{type:"browser_extension"})},this.handleMobileShareSheetActionClick=()=>{dn.i({environment:this.environment,url:"/mobile"}),u.hb(this.environment,{type:"mobile_share_sheet"})}}renderComponent(){return r.createElement("div",{style:this.getWrapperStyle()},r.createElement("div",{style:{flex:0}},this.renderLeft()),r.createElement("div",{style:this.getCenterStyle()},r.createElement("div",null,this.renderTitle()),r.createElement(ce.a,{isSmall:!0,style:{marginBottom:2}},this.renderCaption())),r.createElement("div",{style:{flex:0}},this.renderRight()))}renderTitle(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id).getValue();return r.createElement(r.Fragment,null,Object(gt.d)(t)," ",!e.activated&&t&&!t.onboarding_completed&&r.createElement("span",{style:{color:this.theme.mediumTextColor}},r.createElement(m.b,{id:"userCreditSettings.inviteFriendsSection.userHasNotSignedUpNote",defaultMessage:"(has not signed up)",description:"Annotation that appears next to a referred user's name if the user hasn't signed up for Notion yet"})),!e.activated&&t&&t.onboarding_completed&&r.createElement("span",{style:{color:this.theme.mediumTextColor}},r.createElement(m.b,{id:"userCreditSettings.inviteFriendsSection.userHasAlreadySignedUpNote",defaultMessage:"(has already signed up)",description:"Annotation that appears next to a referred user's name if the user has signed up for Notion already"})))}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id).getValue();return r.createElement(r.Fragment,null,Object(gt.d)(t),r.createElement("span",{style:{color:this.theme.mediumTextColor}},r.createElement(m.b,{id:"userCreditSettings.inviteFriendsSection.sourceOfReferralNote",defaultMessage:"(invited you)",description:"Annotation that appears next to the name of the user who invited this user to Notion"})))}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.title",defaultMessage:"Import from Evernote"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.title",defaultMessage:"Log in on the web"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.title",defaultMessage:"Log in on the desktop app"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.title",defaultMessage:"Log in on the mobile app"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.title",defaultMessage:"Use the Web Clipper"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.title",defaultMessage:"Use the iOS or Android system share menu"}):void 0}renderCaption(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id).getValue();return t&&t.email}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id).getValue();return t&&t.email}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.description",defaultMessage:"Import your notes and notebooks"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.description",defaultMessage:"Sign in to Notion from any web browser"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.description",defaultMessage:"Download the desktop app and sign in"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.description",defaultMessage:"Download the mobile app and sign in"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.description",defaultMessage:"Download the Chrome extension and save a link"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.description",defaultMessage:"Use the share menu to save a link into Notion"}):void 0}renderLeft(){const{credit:e}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id);return r.createElement(Tr.a,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id);return r.createElement(Tr.a,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}return"import_evernote"===e.type?ge.a.evernoteLogo(this.getIconStyle()):"web_login"===e.type?ge.a.logInWeb(this.getIconStyle()):"desktop_login"===e.type?ge.a.deviceDesktop(this.getIconStyle()):"mobile_login"===e.type?ge.a.deviceMobile(this.getIconStyle()):"browser_extension"===e.type?ge.a.googleChrome(this.getIconStyle()):"mobile_share_sheet"===e.type?ge.a.deviceMobileShareSheet(this.getIconStyle()):void 0}renderRight(){const{credit:e,intl:t}=this.props;let n;return"import_evernote"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.actionLink",defaultMessage:"Connect"}),onClick:this.handleImportActionClick}:"web_login"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.actionLink",defaultMessage:"Visit"}),onClick:this.handleWebActionClick}:"desktop_login"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.actionLink",defaultMessage:"Download"}),onClick:this.handleDesktopActionClick}:"mobile_login"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileActionClick}:"browser_extension"===e.type?n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.actionLink",defaultMessage:"Install"}),onClick:this.handleBrowserExtensionActionClick}:"mobile_share_sheet"===e.type&&(n={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileShareSheetActionClick}),r.createElement("div",{style:{display:"flex",alignItems:"center"}},n&&!e.activated&&r.createElement(or.a,{isBlue:!0,isSmall:!0,onClick:n.onClick},n.text),r.createElement("div",{style:Ir({minWidth:32,marginLeft:8,marginRight:8,textAlign:"right",fontWeight:Y.a.fontWeight.semibold},!e.activated&&{color:this.theme.lightTextColor})},Object(xt.b)({amount:e.amount,currency:"dollar",intl:this.props.intl})),r.createElement("div",{style:this.getTickStyles(e.activated)},ge.a.check({fill:X.f.white,width:12,height:12,opacity:e.activated?1:0})))}getUserStore(e){const{currentSpaceStore:t}=d.a.state;if(!t)throw new Error("No current space.");return mt.a.createChildStore(t,{table:gt.a,id:e})}getWrapperStyle(){const e="1px solid ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",borderTop:this.props.isFirst?e:void 0,borderBottom:e,paddingTop:8,paddingBottom:8}}getCenterStyle(){return{flex:1,fontSize:14,marginLeft:4}}getIconStyle(){return{width:24,height:24,fill:this.theme.mediumIconColor,marginRight:8}}getTickStyles(e){const t=e?void 0:"inset 0 0 0 2px ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:20,background:e?X.f.blue:void 0,boxShadow:t}}}var Br=Object(m.h)(xr);function Ar(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Rr extends B.a{constructor(){super(...arguments),this.storeTypes={store:kr},this.renderCredit=(e,t)=>r.createElement(Br,{key:e.id,credit:e,isFirst:0===t}),this.handleInviteCreditsToggleShowMoreClick=()=>{const{store:e}=this.stores;e.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ar(Object(n),!0).forEach((function(t){Fr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ar(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e.state,{showAllInviteCredits:!e.state.showAllInviteCredits}))},this.handleApplyCreditClick=()=>{const{data:e}=this.props;x.a.setState({open:!0,currentTab:"subscribed_admin"===e.type?"billing":"plans"}),u.l(this.environment)}}willMount(){y.f(this.environment)}renderComponent(){if(Z.a.state.online){const{credits:e}=this.props.data;return this.renderSettings(e)}return this.renderOfflineMessage()}renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,style:{textAlign:"center"}},r.createElement(m.b,{id:"userCreditSettings.offline.message",defaultMessage:"Please go online to manage your account credit."})))}renderOtherCreditWays(e){const t=this.getActionCredits(e);return t.length>0&&r.createElement(r.Fragment,null,r.createElement(z.a,{large:!0},r.createElement(m.b,{id:"userCreditSettings.otherWaysToEarnCreditSectionAlt.title",defaultMessage:"Ways to earn credit"})),r.createElement("div",null,t.map(this.renderCredit)))}renderReferralSection(e){const{store:t}=this.stores,{showAllInviteCredits:n}=t.state,i=this.getInviteCredits(e),a=n?i:i.slice(0,Rr.showInviteCreditCount);return i.length>0&&r.createElement(r.Fragment,null,r.createElement("div",{style:this.getHeaderContainerStyles()},r.createElement("div",{style:this.getHeaderStyles()},r.createElement(m.b,{id:"userCreditSettings.inviteFriendsSection.title",defaultMessage:"Invite friends and earn credit"}))),r.createElement("div",{style:this.getInviteCreditStyles()},a.map(e=>this.renderCredit(e,1)),i.length>Rr.showInviteCreditCount&&r.createElement(ye.a,{style:{marginTop:8},onClick:this.handleInviteCreditsToggleShowMoreClick},n?r.createElement(m.b,{id:"userCreditSettings.inviteFriendsSection.showLessReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} less",values:{numberOfReferredUsers:i.length-Rr.showInviteCreditCount}}):r.createElement(m.b,{id:"userCreditSettings.inviteFriendsSection.showMoreReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} more",values:{numberOfReferredUsers:i.length-Rr.showInviteCreditCount}}))))}renderTotalCreditEarned(e){const{intl:t}=this.props,n=e.reduce((e,t)=>e+(t.activated?t.amount:0),0);return n>0&&r.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}},r.createElement(oe.a,{title:t.formatMessage({id:"userCreditSettings.helpButton.caption",defaultMessage:"Learn how to earn and apply credits"}),href:Object(Ie.a)("guides.referralsAndCredit"),analyticsFrom:"credit_settings"}),r.createElement("div",{style:{display:"flex",alignItems:"center",paddingRight:28,marginTop:16}},r.createElement("div",{style:{marginLeft:"auto",fontSize:14,color:this.theme.mediumTextColor}},r.createElement(m.b,{id:"userCreditSettings.otherWaysToEarnCreditSection.totalCreditSummaryText",defaultMessage:"Total credit earned"})),r.createElement("div",{style:{minWidth:44,fontWeight:Y.a.fontWeight.semibold,textAlign:"right"}},Object(xt.b)({amount:n,currency:"dollar",intl:t}))))}renderSettings(e){return r.createElement(N.a,null,this.renderCreditBalance(),this.renderReferralSection(e),this.renderOtherCreditWays(e),this.renderTotalCreditEarned(e))}renderCreditBalance(){var e=this;const{data:t,intl:n}=this.props,{availableCredit:i,totalCredit:a}=t,s=dt.a.state.data;if(!s)return;const o=he.z(s),l=Math.floor(i/U.a.pricing.personal.monthlyPrice),c=a>=Bt.f;return r.createElement(r.Fragment,null,r.createElement(z.a,{large:!0,divider:"full"},r.createElement(m.b,{id:"userCreditSettings.creditBalanceSection.title",defaultMessage:"Credit balance"})),r.createElement("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:40,fontSize:14}},r.createElement("div",null,r.createElement(m.b,{id:"userCreditSettings.creditBalanceSection.creditBalanceMessage",defaultMessage:"Your current credit balance is {creditBalance}.",values:{creditBalance:r.createElement("b",{style:{color:this.theme.regularTextColor}},Object(xt.b)({amount:i,currency:"dollar",intl:n}))}})," ",i>0&&!c&&r.createElement(m.b,{id:"userCreditSettings.creditBalanceSection.freeMonthMessage",description:"Message in sidebar letting user know how many months of free Notion they can get with their credits",defaultMessage:"{numberOfMonths, plural, one {That's equivalent to <b>{numberOfMonths} month</b> of the Personal Pro Plan.} other {That's equivalent to <b>{numberOfMonths} months</b> of the Personal Pro Plan.}}",values:{numberOfMonths:l,b:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement("b",{style:{color:e.theme.regularTextColor}},n)}}}),c&&r.createElement(m.b,{id:"userCreditSettings.creditBalanceSection.maximumCreditBalanceExceeded",defaultMessage:"You've exceeded the maximum amount of credit per account, {maximumCreditBalance}. Any additional credit you earn will not increase your balance.",values:{maximumCreditBalance:Object(xt.b)({amount:Bt.f,currency:"dollar",intl:n})}})),i>0&&r.createElement(J.a,{isLarge:!0,onClick:this.handleApplyCreditClick},o?ge.a.settingsBilling(Rr.applyCreditButtonIconStyle):ge.a.settingsUpgrade(Rr.applyCreditButtonIconStyle),o?n.formatMessage({id:"userCreditSettings.creditBalanceSection.applyCreditButton.label",defaultMessage:"Apply your credit"}):n.formatMessage({id:"userCreditSettings.creditBalanceSection.upgradeForFreeButton.label",defaultMessage:"Upgrade for free"}))))}getActionCredits(e){const{id:t}=this.environment.currentUser,{currentUserSettingsStore:n}=d.a.state;if(!t||!n)return[];const r=[],i=n.getValue();if(i&&Bt.e(i)){const n={id:"web_login_default",version:0,amount:Bt.a.web_login,activated:!1,created_timestamp:Date.now(),type:"web_login",user_id:t};r.push(e.find(e=>"web_login"===e.type)||n);const i={id:"desktop_login_default",version:0,amount:Bt.a.desktop_login,activated:!1,created_timestamp:Date.now(),type:"desktop_login",user_id:t};r.push(e.find(e=>"desktop_login"===e.type)||i);const a={id:"mobile_login_default",version:0,amount:Bt.a.mobile_login,activated:!1,created_timestamp:Date.now(),type:"mobile_login",user_id:t};r.push(e.find(e=>"mobile_login"===e.type)||a)}const a={id:"import_evernote_default",version:0,amount:Bt.a.import_evernote,activated:!1,created_timestamp:Date.now(),type:"import_evernote",user_id:t};r.push(e.find(e=>"import_evernote"===e.type)||a);const s={id:"browser_extension_default",version:0,amount:Bt.a.browser_extension,activated:!1,created_timestamp:Date.now(),type:"browser_extension",user_id:t};r.push(e.find(e=>"browser_extension"===e.type)||s);const o={id:"mobile_share_sheet_default",version:0,amount:Bt.a.mobile_share_sheet,activated:!1,created_timestamp:Date.now(),type:"mobile_share_sheet",user_id:t};return r.push(e.find(e=>"mobile_share_sheet"===e.type)||o),r}getInviteCredits(e){const t=e.find(e=>"invited_by_user"===e.type),n=e.filter(e=>"invited_user"===e.type&&!e.activated),r=e.filter(e=>"invited_user"===e.type&&e.activated);return i.compact([t,...i.sortBy(n,e=>-e.created_timestamp),...i.sortBy(r,e=>-e.created_timestamp)])}getHeaderContainerStyles(){return{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:4,marginBottom:12}}getHeaderStyles(){return{fontWeight:Y.a.fontWeight.medium,fontSize:18}}getInviteCreditStyles(){return{marginBottom:44}}}Rr.showInviteCreditCount=3,Rr.applyCreditButtonIconStyle={width:20,height:20,marginRight:6};var Lr=Object(m.h)(Rr);class Ur extends B.a{isMultipleAccounts(e){return Array.isArray(e)}isSingleAccount(e){return"string"==typeof e}isConnected(e){return this.isSingleAccount(e)||this.isMultipleAccounts(e)&&e.length>0}renderComponent(){const{account:e,intl:t}=this.props;return r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14,paddingTop:2,paddingBottom:2}},this.renderIcon(),r.createElement("div",{style:{marginRight:"auto"}},r.createElement("div",null,this.props.appName),r.createElement("div",{style:{fontSize:12,color:this.theme.mediumTextColor}},this.props.caption)),r.createElement("div",{style:Ur.buttonWrapStyle},this.renderConnectButton(this.isConnected(e)?t.formatMessage({id:"connectedAppsSettingsItem.connectAnotherAccountLink",defaultMessage:"Connect another account",description:"Link that enables user to connect another account from a 3rd-party app (like Google Drive) to Notion, assuming they've already connected an account previously"}):t.formatMessage({id:"connectedAppsSettingsItem.connectAccountLink",defaultMessage:"Connect",description:"Link that enables user to connect an account from a 3rd-party app (like Google Drive) to Notion"})))),this.isSingleAccount(e)?this.renderAccount({accountName:e,onDisconnect:this.props.onDisconnect}):this.renderMultipleAccounts(),r.createElement(A.a,{size:12}))}renderIcon(){const{logo:e}=this.props;return r.createElement("img",{style:Ur.imageIconStyle,src:e})}renderConnectButton(e){return r.createElement(or.a,{isBlue:!0,onClick:this.props.onConnect,style:Ur.buttonStyle},e)}renderAccount(e){const{accountName:t,onDisconnect:n,key:i}=e;return r.createElement("div",{key:i,style:{marginLeft:44}},r.createElement(A.a,{size:12}),r.createElement("div",{style:{display:"flex",alignItems:"center",height:32,marginBottom:2,fontSize:14}},r.createElement("div",{style:{marginRight:"auto"}},r.createElement("div",{style:{color:this.theme.mediumTextColor}},t)),r.createElement("div",{style:Ur.buttonWrapStyle},r.createElement(or.a,{isRed:!0,onClick:()=>n(),style:Ur.buttonStyle},r.createElement(m.b,{id:"connectedAppsSettingsItem.disconnectLink",defaultMessage:"Disconnect",description:"If a user has connected an account from a 3rd-party app (like Google Drive) to Notion, they can click this link to disconnect the account."})))))}renderMultipleAccounts(){const e=this.props.account;if(this.isMultipleAccounts(e))return e.map(e=>this.renderAccount({accountName:e.accountName,onDisconnect:()=>{this.props.onDisconnect(e)},key:e.accountId}))}}Ur.iconSize=32,Ur.buttonStyle={marginLeft:14,marginRight:-4},Ur.buttonWrapStyle={minWidth:80,display:"flex",justifyContent:"flex-end"},Ur.imageIconStyle={flexShrink:0,width:Ur.iconSize,height:Ur.iconSize,borderRadius:3,marginRight:12,background:X.f.white};var _r=Object(m.h)(Ur);async function Wr(e){const t=await s.H(e,{});if("failed"===t.type){const e=t.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0}}return t.data}var qr=n(439),Nr=n(1482),zr=n(1483),Vr=n(1484);class Hr extends B.a{constructor(){super(...arguments),this.storeTypes={connectedAppsStatus:pe.a}}renderComponent(){return Z.a.state.online?r.createElement(sr.a,{request:this.environment,performRequest:Wr,requestStore:this.stores.connectedAppsStatus,render:(e,t)=>t?this.renderConnectedAppsSettings(t):r.createElement("div",{style:Hr.loadingWrapStyle},r.createElement(q.a,null))}):this.renderOfflineMessage()}renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,style:{textAlign:"center"}},r.createElement(m.b,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})))}renderSectionTitle(){return r.createElement(z.a,{large:!0,divider:"full"},r.createElement(m.b,{id:"connectedAppsSettings.connectedAppsSection.title",defaultMessage:"Connected apps"}))}renderConnectedAppsSettings(e){const{intl:t}=this.props,n=this.stores.connectedAppsStatus;return r.createElement("div",{style:Hr.wrapStyle},r.createElement(Dt.b,{style:Hr.scrollerStyle,type:Dt.a.Y},this.renderSectionTitle(),r.createElement(_r,{appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files"}),logo:fn.a.images.import.googleDrivePng,account:n.state.result.drive,onConnect:()=>this.handleDriveAuth(),onDisconnect:e=>{this.handleDisconnectDrive(e)}}),r.createElement(_r,{appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks"}),logo:fn.a.images.import.evernotePng,account:n.state.result.evernote,onConnect:()=>Nr.a({environment:this.environment,requestStore:n}),onDisconnect:()=>async function(e,t){await s.u(e,{}),await t.refresh(),u.ud(e,{name:"evernote"})}(this.environment,n)}),r.createElement(_r,{appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards"}),logo:fn.a.images.import.trelloPng,account:n.state.result.trello,onConnect:()=>Vr.a({environment:this.environment,requestStore:n}),onDisconnect:()=>async function(e,t){await s.v(e,{}),await t.refresh(),u.ud(e,{name:"trello"})}(this.environment,n)}),r.createElement(_r,{appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists"}),logo:fn.a.images.import.asanaPng,account:n.state.result.asana,onConnect:()=>zr.a({environment:this.environment,requestStore:n}),onDisconnect:()=>async function(e,t){await s.s(e,{}),await t.refresh(),u.ud(e,{name:"asana"})}(this.environment,n)}),r.createElement("div",{style:{marginTop:8}},r.createElement(oe.a,{title:t.formatMessage({id:"connectedAppsSettings.helpButton.caption",defaultMessage:"Learn more about embedding content in Notion"}),href:Object(Ie.a)("guides.import"),analyticsFrom:"connected_apps_settings"}))))}async handleDriveAuth(){u.ld(this.environment,{name:"google",from:"connected_apps"}),await qr.f(this.environment),this.stores.connectedAppsStatus.refresh()}async handleDisconnectDrive(e){const{intl:t}=this.props;l.c({message:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await s.t(this.environment,{googleUserId:e.accountId}),this.stores.connectedAppsStatus.refresh()}}]})}}Hr.loadingWrapStyle={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"},Hr.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Hr.scrollerStyle={height:"100%",padding:"36px 60px"};var Gr=Object(m.h)(Hr),Yr=n(34),Qr=n(67),Kr=n(41),Zr=n(193),Xr=n(592),$r=n(65),Jr=n(79);class ei extends S.a{getInitialState(){return{botName:"",botType:"space",spaceRole:"none"}}}var ti=ei,ni=n(298),ri=n(97),ii=n(611);async function ai(e){const{environment:t,table:n,id:r,type:i}=e,a=await s.F(t,{table:n,id:r,type:i});return"failed"===a.type?(Object(l.d)(a),{botIds:[]}):{botIds:a.data.botIds}}function si(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class li extends B.a{constructor(){super(...arguments),this.storeTypes={botCreateStore:ti},this.renderModal=()=>r.createElement("div",null,this.renderBotNameSection(),r.createElement($.a,{isLarge:!0,style:{marginTop:24},onClick:this.handleCreateBot},"Create Bot")),this.handleChangeBotName=e=>{const t=this.stores.botCreateStore.state;this.stores.botCreateStore.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?si(Object(n),!0).forEach((function(t){oi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):si(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{botName:e.target.value}))},this.handleCreateBot=()=>{const{botName:e,spaceRole:t}=this.stores.botCreateStore.state,{userStore:n,spaceStore:r}=this.props,i=function(e){const{environment:t,name:n,spaceStore:r,spaceRole:i,userId:s}=e,o=H.c(t),l=Object(a.b)({environment:t,table:Zr.a,value:{name:n,parent_table:$r.a,parent_id:r.id,created_at:Date.now(),created_by_table:gt.a,created_by_id:s,alive:!0,type:"guest"},inMemoryRecordCacheStore:ri.a,transaction:o});return ni.f({environment:t,store:r,permissionItems:[{type:"bot_permission",role:i,bot_id:l.id}],transaction:o}),H.b({environment:t,transaction:o}),l}({environment:this.environment,name:e,userId:n.id,spaceStore:r,spaceRole:t});this.props.onCreateBot(i)}}renderComponent(){return r.createElement(F.a,{open:!0,render:this.renderModal,onDismiss:this.props.onDismiss,innerStyle:{width:400,padding:24},preventHideChildrenWhileOpening:!0})}renderBotNameSection(){const{botName:e}=this.stores.botCreateStore.state;return r.createElement(r.Fragment,null,r.createElement(V.a,{style:{marginBottom:8}},"Bot Name"),r.createElement(W.b,{placeholder:"Hello World",value:e,onChange:this.handleChangeBotName}))}}var ci=Object(m.h)(li),di=n(49),ui=n(419),pi=n(155);class mi extends B.a{constructor(){super(...arguments),this.storeTypes={tokenOptionsButtonPopupStore:Jr.a},this.handleViewApiTokenClick=async()=>{const e=await async function(e){const{environment:t,botId:n}=e,r=await s.E(t,{botId:n});if("failed"!==r.type)return r.data.token;Object(l.d)(r)}({environment:this.environment,botId:this.props.botStore.id});e&&l.c({message:r.createElement("div",{style:{width:"100%"}},r.createElement("header",{style:{marginBottom:8}},Object(pi.a)(this.props.botStore.getValue())),r.createElement(W.b,{type:"text",format:W.a.Default,value:e,disabled:!0,style:{height:32}})),showCancel:!1,keepFocus:!1,items:[{label:r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.viewTokenModal.copyButton.label",defaultMessage:"Copy token"}),color:"blue",onAccept:()=>{it.c({environment:this.environment,stringValue:e})}},{label:r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.viewTokenModal.dismissButton.label",defaultMessage:"Close"}),onAccept:()=>{}}],innerStyle:{width:336}})},this.handleRevokeApiTokenClick=async()=>{const e=this.props.botStore.getValue();e&&await l.a({message:"scim"===e.type?r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.message",defaultMessage:"Revoke SCIM token? All SCIM API requests that use this token will no longer succeed."}):r.createElement(m.b,{id:"botWithTokenSettings.revokeTokenModal.message",defaultMessage:"Revoke API token? All API requests that use this token will no longer succeed."}),acceptLabel:"scim"===e.type?r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.acceptButton.label",defaultMessage:"Revoke SCIM token"}):r.createElement(m.b,{id:"botWithTokenSettings.revokeTokenModal.acceptButton.label",defaultMessage:"Revoke API token"}),cancelLabel:r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.revokeTokenModal.cancelButton.label",defaultMessage:"Cancel"})})&&await async function(e){const{environment:t,botId:n,tokenId:r}=e,i=await s.Mb(t,{botId:n,tokenId:r});if("failed"!==i.type)return!0;Object(l.d)(i)}({environment:this.environment,botId:e.id})&&l.f({message:"scim"===e.type?r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.tokenRevoked.message",defaultMessage:"SCIM token revoked successfully. A new token is available."}):r.createElement(m.b,{id:"botWithTokenSettings.revokeTokenModal.tokenRevoked.message",defaultMessage:"API token revoked successfully. A new token is now available."})})},this.handleDeleteBot=async()=>{await async function(e){const t=e.getValue();return Object(l.a)({message:r.createElement("span",null,r.createElement(m.b,{id:"botActions.deleteBotConfirmationDialog.confirmationMessage",defaultMessage:"Are you sure you want to delete {bot}?",values:{bot:r.createElement(ii.a,{botValue:t,inline:!0})}})),acceptLabel:r.createElement(m.b,{id:"botActions.deleteBotConfirmationDialog.confirmDeleteBotButton.label",defaultMessage:"Yes"})})}(this.props.botStore)&&(await function(e,t){const n=H.c(e);return H.a({transaction:n,store:t,operation:{pointer:t.pointer,path:["alive"],command:"set",args:!1}}),H.b({environment:e,transaction:n}),t}(this.environment,this.props.botStore),this.props.onDelete&&this.props.onDelete(this.props.botStore))}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:st.b.MenuType.ActionSheet}:{menuType:st.b.MenuType.Popup};const n=Boolean(this.props.onDelete);return r.createElement("div",{style:{display:"flex"}},r.createElement(ii.a,{botValue:this.props.botStore.getValue(),avatarSize:24,style:{fontSize:14,flex:1}}),r.createElement(or.a,{onClick:()=>this.handleViewApiTokenClick(),isBlue:!0},r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.viewToken.label",defaultMessage:"View token"})),r.createElement(di.a,{popupType:e.isMobile?di.a.PopupType.SlideUp:di.a.PopupType.Popup,buttonPopupStore:this.stores.tokenOptionsButtonPopupStore,renderOrigin:t=>r.createElement(ui.a,Object.assign({isMobile:e.isMobile},t,{style:{marginLeft:8,marginRight:8}})),render:e=>r.createElement(st.b,Object.assign({},t),r.createElement(ot.a,{type:ot.a.Type.Vertical,sections:[{key:"token options",render:e=>r.createElement(ct.a,Object.assign({},e)),items:[{key:"revoke token",render:e=>r.createElement(lt.a,Object.assign({title:r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.revokeToken.label",defaultMessage:"Revoke token"}),icon:ge.a.showDeletedPages({width:18,fill:"currentColor"})},e)),action:()=>{this.handleRevokeApiTokenClick(),e.close()}},...n?[{key:"delete",action:()=>{this.handleDeleteBot(),e.close()},render:e=>r.createElement(lt.a,Object.assign({title:r.createElement(m.b,{id:"botWithTokenSettings.deleteBot.label",defaultMessage:"Delete bot"}),icon:ge.a.trash({width:18,fill:"currentColor"})},e))}]:[]]}],initialFocus:void 0}))}))}}var hi=mi;function gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function bi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gi(Object(n),!0).forEach((function(t){fi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const yi=r.Fragment;class Si extends B.a{constructor(){super(...arguments),this.storeTypes={requestStore:pe.a,popupStore:Jr.a},this.renderResult=(e,t,n)=>r.createElement(Xr.a,{loaded:n,spinnerSize:16,showSpinnerTimeout:600},e&&r.createElement("div",null,"Something went wrong..."),t&&this.renderBots(t)),this.renderBots=e=>{let{spaceBotIds:t}=e;return r.createElement(yi,null,r.createElement(z.a,{style:{marginTop:"2em"}},r.createElement(m.b,{id:"apiSettingsPage.bots.title",defaultMessage:"Bots",description:"Bots are the way to access the Notion API."})),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{width:"90%",marginBottom:14}},r.createElement(m.b,{id:"apiSettingsPage.bots.description",defaultMessage:"Bots can only access content shared with the current workspace. To give access to private pages, share pages with the bot from the Share menu. <learnmorelink>Learn more</learnmorelink>",values:{learnmorelink:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement(Me.a,{href:Wt.T},t)}},description:"Bots are the way to access the Notion API. Inform users about what bots are and what they can do."})),r.createElement($.a,{isLarge:!0,onClick:this.handleOpenCreateBotModal},r.createElement(m.b,{id:"apiSettingsPage.bots.addBotbutton",defaultMessage:"Add bot",description:"Bots are the way to access the Notion API. Create a new bot."})),this.renderBotTable(t))},this.renderBotCreateModal=()=>{const{spaceStore:e,userStore:t}=this.props;return r.createElement(ci,{spaceStore:e,userStore:t,onCreateBot:this.handleCreateBot,onDismiss:this.handleCloseCreateBotModal})},this.handleDeleteBot=async e=>{const t=this.stores.requestStore.state;t.result&&this.stores.requestStore.setState(bi({},t,{result:{spaceBotIds:t.result.spaceBotIds.filter(t=>t!==e.id),userBotIds:t.result.userBotIds.filter(t=>t!==e.id)}}))},this.handleCreateBot=async e=>{const t=e.getValue();if(t){const e=this.stores.requestStore.state;e.result&&this.stores.requestStore.setState(bi({},e,{result:{spaceBotIds:t.parent_table===$r.a?[...e.result.spaceBotIds,t.id]:e.result.spaceBotIds,userBotIds:t.parent_table===gt.a?[...e.result.userBotIds,t.id]:e.result.userBotIds}}))}this.handleCloseCreateBotModal()},this.handleOpenCreateBotModal=()=>{this.stores.popupStore.setState({open:!0})},this.handleCloseCreateBotModal=()=>{this.stores.popupStore.setState({open:!1})},this.fetchUserAndSpaceBots=async e=>{let{userId:t,spaceId:n}=e;const[r,i]=await Promise.all([ai({environment:this.environment,table:gt.a,id:t,type:"guest"}),ai({environment:this.environment,table:$r.a,id:n,type:"guest"})]);return{userBotIds:r.botIds,spaceBotIds:i.botIds}}}renderComponent(){return r.createElement("div",{style:Si.wrapStyle},r.createElement(Dt.b,{style:Si.scrollerStyle,type:Dt.a.Y},r.createElement(oe.a,{title:"Read the Notion API documentation.",href:Wt.S,analyticsFrom:"api"}),r.createElement(A.a,{size:32,style:{marginBottom:16}}),this.renderRequest(),this.stores.popupStore.state.open&&this.renderBotCreateModal()))}renderRequest(){const{spaceStore:e,userStore:t}=this.props;return r.createElement(sr.a,{requestStore:this.stores.requestStore,request:{spaceId:e.id,userId:t.id},performRequest:this.fetchUserAndSpaceBots,render:this.renderResult})}renderBotTable(e){const{spaceStore:t,intl:n}=this.props,i=e.map(e=>Object(Kr.c)(t,{table:Zr.a,id:e}));if(i.length>0)return r.createElement(yi,null,r.createElement(A.a,{size:16,style:{marginTop:16}}),r.createElement("div",null,i.map(e=>r.createElement(yi,{key:e.id},r.createElement(hi,{botStore:e,onDelete:this.handleDeleteBot}),r.createElement(A.a,{size:16})))))}}Si.wrapStyle={display:"flex",flexDirection:"column",height:"100%"},Si.scrollerStyle={height:"100%",padding:"36px 60px"};var vi=Object(m.h)(Si),Ei=n(361),Mi=n(203);function wi(e,t){return"".concat(function(e){return"".concat(e||"https://www.notion.so").concat(Wt.V)}(t),"/").concat(e)}var Ci=n(758),Oi=n(1479),ki=n(252),Pi=n(161);function Ti(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Di(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ti(Object(n),!0).forEach((function(t){Ii(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ti(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ii(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ji extends B.a{constructor(){super(...arguments),this.storeTypes={botsRequestStore:pe.a,tokenOptionsButtonPopupStore:Jr.a},this.renderScimBotTokens=(e,t,n)=>{if(!n)return r.createElement(q.a,null);if(t&&!e){const{botIds:e}=t,n=e[0]&&Object(Kr.c)(this.props.spaceStore,{table:Zr.a,id:e[0]});return r.createElement(r.Fragment,null,r.createElement(A.a,{size:48,style:{opacity:0}}),r.createElement("div",{style:this.getHeaderStyle()},r.createElement("span",{style:{marginRight:8}},r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.title",defaultMessage:"SCIM configuration"})),"enterprise"!==he.i(this.environment)&&r.createElement(pt.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{marginTop:-1}})),n&&r.createElement(hi,{botStore:n})||"enterprise"===he.i(this.environment)&&this.renderScimContactUs(),this.renderScimHelp())}},this.handleDisablePublicAccessSwitcherClick=async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disablePublicAccess;if(!t){if(!(await l.a({message:r.createElement(m.b,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.message",defaultMessage:"Are you sure? This will remove access for anyone who is not a member or guest of the workspace from all pages in this workspace."}),acceptLabel:r.createElement(m.b,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState(Di({},e.state,{disablePublicAccess:!t}))},this.handleAllowDisableGuestsSwitcherClick=async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disableGuests;if(!t){if(!(await l.a({message:r.createElement(m.b,{id:"securitySAMLSettings.disableGuests.confirmationModal.message",defaultMessage:"Are you sure? All guests in this workspace will be removed."}),acceptLabel:r.createElement(m.b,{id:"securitySAMLSettings.disableGuests.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState(Di({},e.state,{disableGuests:!t}))},this.handleDisableMoveToSwitcherClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Di({},e.state,{disableMoveToSpace:!e.state.disableMoveToSpace}))},this.handleAllowDisableWorkspaceTopLevelSwitcherClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Di({},e.state,{disableSpacePageEdits:!e.state.disableSpacePageEdits}))},this.handleDisableExportClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Di({},e.state,{disableExport:!e.state.disableExport}))},this.handleDisablePublicAccessRequestsClick=()=>{const{securitySettingsStore:e}=this.props;e.setState(Di({},e.state,{disablePublicAccessRequests:!e.state.disablePublicAccessRequests}))},this.handleUpdateClick=async()=>{await Promise.all([this.saveSecuritySettings(),this.saveSamlConfig()]),this.props.securitySettingsStore.state.error?l.d(this.props.securitySettingsStore.state.error):this.closeSettings()},this.handleCancelClick=()=>{this.closeSettings()},this.handleEnableSamlToggle=()=>{if(!this.isSamlEditable())return;const{state:e}=this.props.samlConfigStore,t=!this.isInvalidSamlConfig(e);"unconfigured"===e.status||"disabled"===e.status?t&&this.props.samlConfigStore.setState(Di({},e,{status:"configured"})):this.props.samlConfigStore.setState(Di({},e,{status:t?"disabled":"unconfigured"}))},this.handleIdpMetadataUrlChange=e=>{this.props.samlConfigStore.setState(Di({},this.props.samlConfigStore.state,{idpMetadataUrl:e.target.value}))},this.handleIdpMetadataUrlBlur=e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!0)},this.handleIdpMetadataChange=e=>{this.props.samlConfigStore.setState(Di({},this.props.samlConfigStore.state,{idpMetadata:e.target.value}))},this.handleIdpMetadataBlur=e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!1)},this.handleEnforceSamlToggle=()=>{const{state:e}=this.props.samlConfigStore;if(this.isSamlEditable()&&!this.isInvalidSamlConfig(e)){const t="enforced"===e.status?"configured":"enforced";this.props.samlConfigStore.setState(Di({},e,{status:t}))}},this.handleCreateAccountToggle=()=>{const{state:e}=this.props.samlConfigStore;this.isSamlEditable()&&this.props.samlConfigStore.setState(Di({},e,{createAccount:!e.createAccount}))},this.handleEmailDomainContactUsClick=()=>{Se.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or change an email domain for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})},this.handleWorkspaceContactUsClick=()=>{Se.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or remove a workspace for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})},this.handleUpgradeClick=()=>{Ei.a(this.environment,{from:"space_saml",for:"enterprise"})},this.handleScimTokenContactUsClick=()=>{Se.a({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to generate a SCIM API token for workspace ".concat(this.props.spaceStore.id,".")})},this.setUseMetadataUrl=e=>{this.props.samlConfigStore.setState(Di({},this.props.samlConfigStore.state,{useMetadataUrl:e}))}}renderComponent(){return Z.a.state.online?r.createElement(N.a,{controlRow:this.renderControlRow()},this.renderSecuritySettings(),this.renderSamlSettings(),this.renderScimSettings()):this.renderOfflineMessage()}renderUpsell(){if(!this.isSecuritySubscribed())return r.createElement("div",{style:{border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:3,padding:16,marginTop:Object(Pi.f)(this.environment)?void 0:24,marginBottom:24}},r.createElement(Oi.a,{for:"enterprise",from:"space_saml",icon:ge.a.key,title:r.createElement(m.b,{id:"securitySAMLSettings.upsell.title",defaultMessage:"Upgrade for advanced security, SAML & SCIM"}),caption:r.createElement(m.b,{id:"securitySAMLSettings.upsell.caption",defaultMessage:"Upgrade to the Enterprise Plan for advanced security settings, SAML single sign-on, and automated user and group provisioning."}),learnMoreRoute:"guides.securitySettings"}))}renderSecuritySettings(){const{securitySettingsStore:e}=this.props,t=r.createElement(pt.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{display:"inline-block",marginLeft:8,marginTop:-3}}),n=n=>r.createElement("div",null,r.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisablePublicAccessSwitcherClick:this.handleUpgradeClick},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.preventPublicSharing.label",defaultMessage:"Prevent members from sharing pages publicly"}),!n&&t,r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.preventPublicSharing.caption",defaultMessage:"This will disable the Share to web option in the Share menu on every page in this workspace."}))),r.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.createElement(En.a,{on:e.state.disablePublicAccess,disabled:!n}))),r.createElement(A.a,{size:24,style:{opacity:0}})),i=n=>r.createElement("div",null,r.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleAllowDisableWorkspaceTopLevelSwitcherClick:this.handleUpgradeClick},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.label",defaultMessage:"Prevent members from changing the Workspace section"}),!n&&t,r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"85%"}},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.caption",defaultMessage:"This disables the ability for members to create, move, reorder, and delete top-level Workspace pages."}))),r.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.createElement(En.a,{on:e.state.disableSpacePageEdits,disabled:!n}))),r.createElement(A.a,{size:24,style:{opacity:0}})),a=n=>r.createElement("div",null,r.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleAllowDisableGuestsSwitcherClick:this.handleUpgradeClick},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableGuests.label",defaultMessage:"Disable guests"}),!n&&t,r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableGuests.caption",defaultMessage:"This prevents anyone from inviting people outside the workspace to any page."}))),r.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.createElement(En.a,{on:e.state.disableGuests,disabled:!n}))),r.createElement(A.a,{size:24,style:{opacity:0}})),s=n=>r.createElement("div",null,r.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisableMoveToSwitcherClick:this.handleUpgradeClick},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableMovingPages.label",defaultMessage:"Disable moving or duplicating pages to other workspaces"}),!n&&t,r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableMovingPages.caption",defaultMessage:"This prevents anyone from moving or duplicating pages to other workspaces via the Move To or Duplicate To action."}))),r.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.createElement(En.a,{on:e.state.disableMoveToSpace,disabled:!n}))),r.createElement(A.a,{size:24,style:{opacity:0}})),{state:o}=e,l=n=>r.createElement("div",null,r.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisableExportClick:this.handleUpgradeClick},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableExport.label",defaultMessage:"Disable export"}),!n&&t,r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disableExport.caption",defaultMessage:"This prevents anyone from exporting as Markdown, CSV, or PDF."}))),r.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.createElement(En.a,{on:e.state.disableExport,disabled:!n}))),r.createElement(A.a,{size:24,style:{opacity:0}})),c=n=>{if(Object(Pi.f)(this.environment))return r.createElement("div",null,r.createElement("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisablePublicAccessRequestsClick:this.handleUpgradeClick},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disablePublicAccessRequests.label",defaultMessage:"Disable page access requests from non-members"}),!n&&t,r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.disablePublicAccessRequests.caption",defaultMessage:"This prevents anyone with the link to a page from requesting access. Workspace members can always request access."}))),r.createElement("div",{style:{marginTop:5,opacity:n?void 0:.5}},r.createElement(En.a,{on:e.state.disablePublicAccessRequests,disabled:!n}))),r.createElement(A.a,{size:24,style:{opacity:0}}))};return this.isSecuritySubscribed()?r.createElement(r.Fragment,null,r.createElement(z.a,{large:!0,divider:"full"},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"})),c(!0),n(!0),i(!0),a(!0),s(!0),l(!0),r.createElement("div",{style:{height:36}})):r.createElement(r.Fragment,null,this.renderUpsell(),r.createElement("div",{style:this.getHeaderStyle()},r.createElement("span",{style:{marginRight:8}},r.createElement(m.b,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"}))),c(!0),n(o.disablePublicAccess),i(o.disableSpacePageEdits),a(o.disableGuests),s(o.disableMoveToSpace),l(o.disableExport),r.createElement("div",{style:{height:32}}))}renderSamlSettings(){return r.createElement(sr.a,{request:{environment:this.environment,spaceId:this.props.spaceStore.id,store:this.props.samlConfigStore},performRequest:D,render:(e,t,n)=>n?t&&!e?this.isSamlAvailable()?this.renderSamlConfig():this.renderUpgradeSamlPrompt():void 0:r.createElement(q.a,null)})}renderSamlHelp(){return r.createElement("div",{style:{marginTop:18,marginBottom:24}},r.createElement(oe.a,{title:r.createElement(m.b,{id:"securitySAMLSettings.SAMLSection.helpButton.label",defaultMessage:"Learn about SAML and single sign-on"}),href:Object(Ie.a)("guides.samlSettings"),analyticsFrom:"saml_settings"}))}renderSamlUneditable(e){if(this.isSamlEditable()||!e)return;const t=ki.a.getPublicSpaceData(this.environment,e);return t?r.createElement("div",{style:{marginBottom:24}},r.createElement(ce.a,{isMultiline:!0},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSection.uneditableMessage",defaultMessage:"SAML is being managed by the workspace <bold>{workspaceName}</bold>. Please go there to change any SAML settings.",values:{workspaceName:t.name,bold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("span",{style:{fontWeight:Y.a.fontWeight.semibold}},t)}}}))):void 0}renderUpgradeSamlPrompt(){return r.createElement("div",null,r.createElement(r.Fragment,null,r.createElement("div",{style:this.getHeaderStyle()},r.createElement("span",{style:{marginRight:8}},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),r.createElement(pt.a,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{marginTop:-1}})),this.renderSamlHelp()))}renderEmailDomains(e){var t=this;return r.createElement(r.Fragment,null,r.createElement(z.a,{smallMarginBottom:!0},r.createElement(m.b,{id:"securitySAMLSettings.emailDomainsSection.title",defaultMessage:"Email domains"})),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:Di({},ji.captionStyle,{marginBottom:12,marginTop:2})},r.createElement(m.b,{id:"securitySAMLSettings.emailDomainsSection.emailInput.caption",defaultMessage:"Once you enable SAML, anyone using an email address with the domains below will be able to log in using SAML SSO. <contactlink>Contact support</contactlink> to add or remove a domain.",values:{contactlink:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:t.handleEmailDomainContactUsClick},n)}}})),r.createElement("div",{style:{height:32}},r.createElement(tt,{placeholder:this.props.intl.formatMessage({id:"securitySAMLSettings.emailDomainsSection.emailInput.placeholder",defaultMessage:"No email domains configured"}),value:"",onChange:()=>{},onRemoveLastToken:()=>{},readOnly:!0,tokens:e.map(e=>r.createElement(nt.b,{showRemoveButton:!1,isSingle:!1,format:nt.b.Format.Medium,key:e,value:e}))})),r.createElement(A.a,{size:40}))}renderSpaceNames(e){var t=this;if(!this.isSamlEditable())return;const n=e.map(e=>ki.a.getPublicSpaceData(this.environment,e)).filter(e=>Boolean(e));return n.length<=1?void 0:r.createElement(r.Fragment,null,r.createElement(z.a,{smallMarginBottom:!0},r.createElement(m.b,{id:"securitySAMLSettings.spaceNamesSection.title",defaultMessage:"Workspaces"})),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:Di({},ji.captionStyle,{marginBottom:12,marginTop:2})},r.createElement(m.b,{id:"securitySAMLSettings.spaceNamesSection.spaceNameInput.caption",defaultMessage:"The SAML settings here apply to multiple workspaces. <contactlink>Contact support</contactlink> to add or remove a workspace.",values:{contactlink:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:t.handleWorkspaceContactUsClick},n)}}})),r.createElement("div",{style:{height:32}},r.createElement(tt,{placeholder:"",value:"",onChange:()=>{},onRemoveLastToken:()=>{},readOnly:!0,tokens:n.map(e=>r.createElement(nt.b,{showRemoveButton:!1,isSingle:!1,format:nt.b.Format.Medium,key:e.id,value:e.name}))})),r.createElement(A.a,{size:40}))}renderSingleSignOnUrl(){const e=wi(this.props.spaceStore.id),t=r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.tooltip",defaultMessage:"Copy link"});return r.createElement(r.Fragment,null,r.createElement(z.a,null,r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.title",defaultMessage:"Single sign-on URL"})),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:Di({},ji.captionStyle,{marginTop:2})},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.caption",defaultMessage:"Enter this in your Identity Provider's SAML configuration."})),r.createElement("div",null,r.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginTop:12,marginBottom:6}},r.createElement(W.b,{type:"text",format:W.a.Default,value:e,disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0,width:"calc(100% - 90px)",height:32}}),r.createElement($.a,{onClick:()=>{it.c({environment:this.environment,stringValue:e})},style:{borderTopLeftRadius:0,borderBottomLeftRadius:0,width:90},isLarge:!0},t))))}renderIdpSettings(e){return r.createElement(r.Fragment,null,r.createElement(or.a,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!0)},disabled:!this.isSamlEditable()},r.createElement(Ci.a,{isSelected:Boolean(e.useMetadataUrl)})," ",r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataURLOption.label",defaultMessage:"IDP metadata URL"})),r.createElement("div",{style:{maxWidth:"100%",marginLeft:32}},r.createElement(W.b,{value:e.idpMetadataUrl,onChange:this.handleIdpMetadataUrlChange,onBlur:this.handleIdpMetadataUrlBlur,placeholder:"https://...",style:{height:32},readOnly:!this.isSamlEditable()})),r.createElement(or.a,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!1)},disabled:!this.isSamlEditable()},r.createElement(Ci.a,{isSelected:!e.useMetadataUrl})," ",r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.label",defaultMessage:"IDP metadata XML"})),r.createElement("div",{style:{maxWidth:"100%",marginLeft:32}},r.createElement(W.b,{textarea:!0,value:e.idpMetadata,onChange:this.handleIdpMetadataChange,onBlur:this.handleIdpMetadataBlur,placeholder:this.props.intl.formatMessage({id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.input.placeholder",defaultMessage:"IDP metadata XML"}),readOnly:!this.isSamlEditable()}),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:ji.captionStyle},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.caption",defaultMessage:"Enter the value provided by your Identity Provider (IDP)."}))))}renderCreateAccountToggle(e){const t=!this.isSamlEditable();return r.createElement("div",null,r.createElement(A.a,{size:24,style:{marginTop:12}}),r.createElement("div",{style:ji.settingOptionStyle(t),onClick:this.handleCreateAccountToggle},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.label",defaultMessage:"Automatically create accounts on sign-in"}),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:ji.captionStyle},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.caption",defaultMessage:"Allow users to create Notion accounts without provisioning from the IDP."}))),r.createElement(En.a,{on:e,disabled:t})),r.createElement(A.a,{size:24}))}renderEnableSamlToggle(e,t){return r.createElement("div",null,r.createElement("div",{style:ji.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnableSamlToggle},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.label",defaultMessage:"Enable SAML"}),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:ji.captionStyle},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.caption",defaultMessage:"This allows users with emails on the configured domains to log in with SAML. SAML authentication can be enforced below."}))),r.createElement("div",null,t?r.createElement(rt.a,{delayThreshold:0,renderTooltip:()=>r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.tooltip",defaultMessage:"SAML can be enabled once it is fully configured."}),alignment:Mi.a.End,render:e=>r.createElement("div",Object.assign({},e),r.createElement(En.a,{on:!1,disabled:!0}))}):r.createElement(En.a,{on:"disabled"!==e&&"unconfigured"!==e,disabled:!this.isSamlEditable()}))),r.createElement(A.a,{size:24}))}renderEnforceSamlToggle(e,t){return r.createElement("div",{style:ji.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnforceSamlToggle},r.createElement("div",{style:this.getTitleStyle()},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.label",defaultMessage:"Enforce SAML"}),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:ji.captionStyle},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.captionMulti",defaultMessage:"Once enforced, workspace members with an email on the domains configured above can only use SAML SSO to log in. Administrator accounts can still log in using email."}))),r.createElement("div",null,t?r.createElement(rt.a,{delayThreshold:0,renderTooltip:()=>r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.tooltip",defaultMessage:"Enable SAML to access this option."}),alignment:Mi.a.End,render:e=>r.createElement("div",Object.assign({},e),r.createElement(En.a,{on:!1,disabled:!0}))}):r.createElement(En.a,{on:"enforced"===e,disabled:!this.isSamlEditable()})))}renderSamlConfig(){const e=this.props.samlConfigStore.state,t=this.isInvalidSamlConfig(e);return r.createElement(r.Fragment,null,r.createElement("div",{style:this.getHeaderStyle()},r.createElement(m.b,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),this.renderSamlHelp(),this.renderSamlUneditable(e.id),this.renderEmailDomains(e.emailDomains),this.renderSpaceNames(e.spaceIds),this.renderSingleSignOnUrl(),this.renderIdpSettings(e),this.renderCreateAccountToggle(e.createAccount),this.renderEnableSamlToggle(e.status,t),this.renderEnforceSamlToggle(e.status,t))}renderScimSettings(){return r.createElement(sr.a,{requestStore:this.stores.botsRequestStore,request:{environment:this.environment,table:$r.a,id:this.props.spaceStore.id,type:"scim"},performRequest:ai,render:this.renderScimBotTokens})}renderScimContactUs(){var e=this;return r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:ji.captionStyle},r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.contactUs",defaultMessage:"To generate a SCIM API token, please <contactlink>contact support</contactlink>.",values:{contactlink:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement(Me.a,{onClick:e.handleScimTokenContactUsClick},n)}}}))}renderScimHelp(){return r.createElement("div",{style:{marginTop:18,marginBottom:24}},r.createElement(oe.a,{title:r.createElement(m.b,{id:"securitySAMLSettings.SCIMSection.helpButton.label",defaultMessage:"Learn about SCIM"}),href:Object(Ie.a)("guides.scim"),analyticsFrom:"scim_settings"}))}renderControlRow(){if(this.isSecuritySubscribed()||Object(Pi.f)(this.environment))return r.createElement("div",{style:{display:"flex"}},r.createElement($.a,{isLarge:!0,onClick:this.handleUpdateClick},r.createElement(m.b,{id:"securitySAMLSettings.updateButton.label",defaultMessage:"Update"})),r.createElement(J.a,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},r.createElement(m.b,{id:"securitySAMLSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},r.createElement(m.b,{defaultMessage:"Please go online to manage security settings.",id:"securitySAMLSettings.offline.message"})))}closeSettings(){x.a.setState(Di({},x.a.state,{open:!1}))}isSamlAvailable(){return this.props.samlConfigStore.state.emailDomains.length>0||"enterprise"===he.i(this.environment)}isSamlEditable(){const e=this.props.samlConfigStore.state;return this.isSamlAvailable()&&(!e.id||e.id===this.props.spaceStore.id)}isSecuritySubscribed(){const e=he.i(this.environment);if("enterprise"===e)return!0;if("team"===e||"team_free"===e){const{data:e}=dt.a.state;return e&&"subscribed_admin"===e.type&&e.created<v.d}return!1}isInvalidSamlConfig(e){return 0===e.emailDomains.length||e.useMetadataUrl&&!e.idpMetadataUrl||!e.useMetadataUrl&&!e.idpMetadata}saveSecuritySettings(){const{securitySettingsStore:e,spaceStore:t}=this.props,{disablePublicAccess:n,disableGuests:r,disableMoveToSpace:i,disableExport:a,disableSpacePageEdits:s,disablePublicAccessRequests:o}=e.state;return H.d(this.environment,e=>{f.x({environment:this.environment,transaction:e,spaceStore:t,disablePublicAccess:n,disableGuests:r,disableMoveToSpace:i,disableExport:a,disableSpacePageEdits:s,disablePublicAccessRequests:o})})}async saveSamlConfig(){if(this.isSamlAvailable()){const e=this.props.samlConfigStore.state,t=await s.b(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount});"failed"===t.type&&this.props.securitySettingsStore.setState(Di({},this.props.securitySettingsStore.state,{error:t}))}}static settingOptionStyle(){return{display:"flex",alignItems:"center",width:"100%",cursor:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"default":"pointer"}}getHeaderStyle(){return{fontWeight:Y.a.fontWeight.medium,fontSize:18,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:6,marginBottom:12,display:"flex",alignItems:"center"}}getTitleStyle(){return{fontSize:14,marginRight:8,flexGrow:1}}getRadioTitleStyle(){return{marginTop:8,marginBottom:4}}}ji.captionStyle={marginTop:4,width:"85%"};var xi=Object(m.h)(ji);var Bi=function(e){return e=i.assign({percent:.1},e),r.createElement("div",{style:i.assign({position:"relative",minWidth:30,height:5,borderRadius:1,overflow:"hidden"},e.style)},r.createElement("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:"100%",background:"currentColor",opacity:.1}}),r.createElement("div",{style:{position:"absolute",top:0,left:0,height:"100%",width:100*e.percent+"%",minWidth:2,background:"currentColor",opacity:.6}}))};class Ai extends B.a{constructor(){super(...arguments),this.handleClick=()=>{Ei.a(this.environment,{from:"sidebar"===this.props.source?"block_limit_sidebar":"block_limit_settings",for:"team"})}}renderComponent(){const{data:e}=dt.a.state;if(!e||!he.L(this.environment))return;const t=he.p(this.environment,e);return"sidebar"===this.props.source&&t<le.a?void 0:r.createElement(r.Fragment,null,this.renderDivider("settings"===this.props.source),r.createElement(Yr.a,{style:Ai.buttonStyle,onClick:this.handleClick},r.createElement("div",{style:Ai.headerStyle},r.createElement(m.b,{id:"spaceSettings.sidebar.upgradeLink",defaultMessage:"Upgrade to go unlimited"})),r.createElement("div",{style:Ai.labelStyle},r.createElement("div",{style:this.usageLabelStyle(t)},he.o(this.environment,e)),r.createElement(Bi,{style:{marginTop:12,marginBottom:12},percent:t}),r.createElement("div",{style:Ai.ctaStyle},r.createElement(m.b,{id:"spaceSettings.sidebar.button.upgrade",defaultMessage:"Upgrade plan"})))))}renderDivider(e){return e?r.createElement(A.a,{size:27,style:{paddingLeft:14,paddingRight:14}}):r.createElement(A.a,{size:0})}usageLabelStyle(e){return e>le.b?this.theme.calloutBlockColors.red:{}}}Ai.buttonStyle={padding:14,fontSize:12,lineHeight:1.4},Ai.headerStyle={fontWeight:500,lineHeight:2},Ai.labelStyle={fontWeight:400},Ai.ctaStyle={textDecoration:"underline"};var Fi=Ai,Ri=n(415),Li=n(277);function Ui(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ui(Object(n),!0).forEach((function(t){Wi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ui(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Wi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class qi extends B.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Jr.a},this.handleSelectChange=e=>{const{label:t}=this.getItemLabelAndCaption(e);if(this.props.confirm){const n=()=>{this.props.onChange(e)};l.c({showCancel:!0,keepFocus:!1,message:r.createElement(m.b,{id:"languagePicker.changeLanguage.confirmationMessage",defaultMessage:"Are you sure you want to update the language to {language}?",values:{language:t}}),items:[{label:r.createElement(m.b,{id:"languagePicker.changeLanguage.updateButton.label",defaultMessage:"Update"}),color:"red",onAccept:n}]})}else this.props.onChange(e)}}renderComponent(){const{device:e}=this.environment;if(!e.isMobile)return r.createElement(di.a,{popupType:di.a.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>r.createElement(or.a,Object.assign({style:{marginLeft:-8,paddingLeft:8,paddingRight:8}},e),this.getItemLabelAndCaption(this.props.currentLocale).label,ge.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor})),placementToOrigin:Li.b.Bottom,alignmentToOrigin:Li.a.Start,render:e=>{let t;t="on"===De.a.getGroup(this.environment,"polyglot")?[...Ri.b,...Ri.c]:Ri.b;const n=[{key:"languages",render:e=>r.createElement(ct.a,Object.assign({},e,{topBorder:0!==e.index})),items:t.map(t=>({key:t,render:e=>this.getItem(t,e.focused,e),action:()=>{this.handleSelect(t),e.close()}}))}],i={menuType:st.b.MenuType.Popup,width:216};return r.createElement(st.b,Object.assign({className:Qr.A},i),r.createElement(ot.a,{type:ot.a.Type.Vertical,initialFocus:void 0,sections:n}))}})}renderItem(e){return r.createElement(lt.a,Object.assign({focused:e.focused},e.props,{title:r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement("div",{style:_i({},e.style,{marginRight:0})},e.label)),caption:e.caption&&r.createElement("span",{style:{color:this.theme.mediumTextColor}},e.caption),shouldWrapCaption:!0}))}handleSelect(e){this.props.currentLocale!==e&&this.handleSelectChange(e)}getItemLabelAndCaption(e){var t;return{"en-US":{label:"English",caption:(t=this.props.intl).formatMessage({defaultMessage:"English (US)",id:"languagePicker.captions.englishUS"})},"ko-KR":{label:"한국어",caption:t.formatMessage({defaultMessage:"Korean",id:"languagePicker.captions.koreanKo"})},"zh-CN":{label:"简体中文",caption:t.formatMessage({defaultMessage:"Simplified Chinese",id:"languagePicker.captions.chineseS"})},"zh-TW":{label:"繁體中文",caption:t.formatMessage({defaultMessage:"Traditional Chinese",id:"languagePicker.captions.chineseT"})},"ja-JP":{label:"日本語",caption:t.formatMessage({defaultMessage:"Japanese",id:"languagePicker.captions.japaneseJa"})},"es-ES":{label:"Español",caption:t.formatMessage({defaultMessage:"Spanish (Spain)",id:"languagePicker.captions.spanishEs"})},"es-419":{label:"Español (Latinoamérica)",caption:t.formatMessage({defaultMessage:"Spanish (Latin America)",id:"languagePicker.captions.spanishLatam"})},"pt-BR":{label:"Português",caption:t.formatMessage({defaultMessage:"Portuguese (Brazil)",id:"languagePicker.captions.portugueseBr"})},"fr-FR":{label:"Français",caption:t.formatMessage({defaultMessage:"French",id:"languagePicker.captions.frenchFr"})}}[e]}getItem(e,t,n){return this.renderItem(_i({},this.getItemLabelAndCaption(e),{focused:t,props:n}))}}var Ni=Object(m.h)(qi),zi=n(102);class Vi extends B.a{renderComponent(){return r.createElement("div",{style:this.getSettingsOptionStyle()},r.createElement("div",{style:{display:"flex",alignItems:"flex-start",width:"100%"}},r.createElement("div",{style:{flex:1}},r.createElement(Ni,{confirm:!0,onChange:async e=>{const t=await s.Ub(this.environment,{locale:e});"success"===t.type?(zi.a.set("preferredLocale",e),await p.a.drain(),window.location.reload(!0)):l.d(t)},currentLocale:this.props.locale}),r.createElement(ce.a,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},r.createElement(m.b,{id:"languageSettings.languageSwitcher.subtitle",defaultMessage:"Choose a language you'd like to use with Notion."})))))}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}var Hi=Vi,Gi=n(198);class Yi extends B.a{constructor(){super(...arguments),this.handleStartOfWeekToggle=()=>{const e=this.getLanguageRegionSettingsState();if(!e)return;const{startDayOfWeek:t}=e;(1===t?L.d:L.c)(this.environment)}}renderComponent(){return Z.a.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return r.createElement(N.a,null,r.createElement(ce.a,{isSmall:!0,style:{textAlign:"center"}},r.createElement(m.b,{defaultMessage:"Please go online to manage your language and region.",id:"languageSettings.offline.message"})))}renderSettings(){const{currentUserSettingsStore:e}=d.a.state;if(!e)return;const t=this.getLanguageRegionSettingsState();if(!t)return;const{locale:n,startDayOfWeek:i}=t;return r.createElement(N.a,null,r.createElement(z.a,{large:!0,divider:"full"},r.createElement(m.b,{id:"languageSettings.languageSection.title",defaultMessage:"Language & region"})),r.createElement(Hi,{locale:n,userSettingsStore:e}),r.createElement(A.a,{size:24}),r.createElement(me.a,{onClick:this.handleStartOfWeekToggle,startDayOfWeek:i}))}getLanguageRegionSettingsState(){const{currentUserSettingsStore:e}=d.a.state;if(!e)return;const t=e.getValue();if(!t||!t.settings)return;const{settings:n}=t;return{locale:n.preferred_locale||Gi.a,startDayOfWeek:void 0===n.start_day_of_week?Object(v.H)():n.start_day_of_week}}}var Qi=Object(m.h)(Yi),Ki=n(1485);function Zi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Zi(Object(n),!0).forEach((function(t){$i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Zi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ji extends B.a{constructor(){super(...arguments),this.lastSpaceSettingsModalStoreOpen=!1,this.storeTypes={spaceBasicSettingsStore:C,spaceProfileSettingsStore:M,securitySettingsStore:k,spaceSecuritySamlSettingsStore:j},this.renderContent=()=>{const e={profile:this.renderProfile,notifications:this.renderNotifications,settings:this.renderSettings,members:this.renderMembers,plans:this.renderPlans,billing:this.renderBilling,appearance:this.renderAppearance,credit:this.renderCredit,connected_apps:this.renderConnectedApps,bots:this.renderBotSettings,security_saml:this.renderSecuritySaml,language_and_region:this.renderLanguageAndRegion};return r.createElement(Pt.a,{capture:!0,allowEsc:!0,render:t=>r.createElement(kt.a,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,focusOffscreenInput:!1,render:()=>r.createElement(Qe,Object.assign({sidebar:this.renderSidebar(),sidebarStyle:{width:200}},t),e[x.a.state.currentTab]())})})},this.renderProfile=()=>r.createElement(Ve,{isEducationPlan:he.w(dt.a.state.data),spaceProfileSettingsStore:this.stores.spaceProfileSettingsStore}),this.renderLanguageAndRegion=()=>r.createElement(Qi,null),this.renderNotifications=()=>r.createElement(N.a,null,r.createElement(Ot.a,null)),this.renderSettings=()=>r.createElement(wt,{spaceStore:this.props.spaceStore,spaceBasicSettingsStore:this.stores.spaceBasicSettingsStore}),this.renderMembers=()=>r.createElement(Ct.a,{store:this.props.spaceStore}),this.renderPlans=()=>{const{data:e}=dt.a.state;if(e)return r.createElement(er,{spaceStore:this.props.spaceStore,data:e})},this.renderBilling=()=>{const{data:e}=dt.a.state;if(e&&("subscribed_admin"===e.type||"unsubscribed_admin"===e.type))switch(e.type){case"subscribed_admin":return r.createElement(Mr,{spaceStore:this.props.spaceStore,data:e});case"unsubscribed_admin":return r.createElement(Cr,{spaceStore:this.props.spaceStore,data:e})}},this.renderAppearance=()=>r.createElement(N.a,null,r.createElement(Ki.a,null)),this.renderCredit=()=>{const{data:e}=dt.a.state;if(e)return r.createElement(Lr,{data:e})},this.renderConnectedApps=()=>r.createElement(Gr,null),this.renderBotSettings=()=>{const{spaceStore:e,userStore:t}=this.props;return r.createElement(vi,{spaceStore:e,userStore:t})},this.renderSecuritySaml=()=>r.createElement(xi,{spaceStore:this.props.spaceStore,securitySettingsStore:this.stores.securitySettingsStore,samlConfigStore:this.stores.spaceSecuritySamlSettingsStore}),this.handleModalOpen=()=>{y.f(this.environment)},this.handleModalDismiss=()=>this.attemptCloseCurrentTab(()=>{x.a.setState(Xi({},x.a.state,{open:!1}))})}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{securitySettingsStore:n}=this.stores,r=n.getValueForSpace(t);r&&n.setState(r)}willMountOrUpdate(e){super.willMountOrUpdate(e);const{open:t}=x.a.state,n=x.a.state;this.lastSpaceSettingsModalStoreOpen===t&&i.isEqual(this.lastSpaceSettingsStoreState,n)||t&&u.Qc(this.environment,{tab:n.currentTab}),this.lastSpaceSettingsModalStoreOpen=t,this.lastSpaceSettingsStoreState=i.clone(n)}renderComponent(){const{open:e}=x.a.state;return r.createElement(F.a,{open:e,innerStyle:{width:960,maxWidth:"calc(100vw - 100px)",height:"calc(100vh - 100px)",overflow:"hidden",borderRadius:3,maxHeight:695},onOpen:this.handleModalOpen,onDismiss:this.handleModalDismiss,render:this.renderContent,className:Qr.ib})}renderSidebar(){const{spaceStore:e}=this.props,{data:t}=dt.a.state,n=Object(de.g)(this.environment),i=e.canAdmin()&&"has-alpha-api"===De.a.getGroup(this.environment,"alpha-api"),a="on"===De.a.getGroup(this.environment,"lion-tamer");return r.createElement("div",{style:Ji.sidebarStyle},r.createElement("div",null,r.createElement("div",{style:this.getSidebarHeader()},n&&n.email||r.createElement(m.b,{id:"spaceSettings.sidebar.personalSettingsSection.title",defaultMessage:"Me"})),this.renderTabButton("profile"),this.renderTabButton("notifications"),this.renderTabButton("connected_apps"),a&&this.renderTabButton("language_and_region"),this.renderTabButton("appearance"),t&&t.creditEnabled&&this.renderTabButton("credit"),r.createElement(A.a,{size:18,isHidden:!0}),r.createElement("div",{style:this.getSidebarHeader()},r.createElement(m.b,{id:"spaceSettings.sidebar.workspaceSettingsSection.title",defaultMessage:"Workspace"})),this.renderTabButton("settings"),e.canRead()&&this.renderTabButton("members"),e.canRead()&&this.renderTabButton("plans"),e.canAdmin()&&t&&("subscribed_admin"===t.type||"unsubscribed_admin"===t.type)&&this.renderTabButton("billing"),e.canAdmin()&&this.renderTabButton("security_saml"),i&&this.renderTabButton("bots"),r.createElement(A.a,{size:21,style:Ji.dividerStyle}),e.canRead()&&r.createElement(Fi,{source:"settings"})))}renderTabButton(e){const t=x.a.state.currentTab===e,n=x.b[e](this.environment),i=x.c[e]();return r.createElement(Yr.a,{hovered:t,style:Xi({display:"flex",alignItems:"center",padding:"5px 15px"},t&&{fontWeight:Y.a.fontWeight.semibold}),onClick:t=>{this.attemptCloseCurrentTab(()=>{x.a.setState(Xi({},x.a.state,{currentTab:e})),u.pe(this.environment,{tab:e})})}},r.createElement("div",{style:this.getIconWrapStyle()},n),r.createElement(ce.a,null,i))}async attemptCloseCurrentTab(e){const{spaceStore:t}=this.props,{spaceProfileSettingsStore:n}=this.stores,{currentUserStore:a,currentUserSettingsStore:o}=d.a.state;if(!a||!o)throw new Error("No user or settings store.");const c=r.createElement(m.b,{id:"spaceSettings.closeSettingsDialog.confirmationMessage",defaultMessage:"Do you want to update your changes?"}),p=r.createElement(m.b,{id:"spaceSettings.closeSettingsDialog.confirmationButton.label",defaultMessage:"Yes",description:"Label for button that appears below the question, 'Do you want to update your changes?' to confirm that the user would like to apply updates."}),{currentTab:h}=x.a.state;if("profile"===h){if(!i.isEqual(n.state,n.getValueForUser(a,o))){const{givenName:t,familyName:i,profilePhoto:a,startDayOfWeek:s}=n.state;return l.c({message:c,showCancel:!0,keepFocus:!0,items:[{label:r.createElement(m.b,{id:"spaceSettings.closeSettingsDialog.updateSettingsButton.label",defaultMessage:"Update"}),color:"blue",onAccept:()=>{H.d(this.environment,e=>{const{currentUserStore:n}=d.a.state;if(n&&b({userStore:n,data:{givenName:t,familyName:i,profilePhoto:a},transaction:e}),o){o.getSettings().start_day_of_week!==s&&Object(L.e)({userSettingsStore:o,data:{start_day_of_week:s},transaction:e})}}),e()}}],handleCancel:()=>{e()}}),!0}e()}else if("settings"===h&&t.canEdit()){const{spaceBasicSettingsStore:n}=this.stores;if(!i.isEqual(n.state,n.getValueForSpace(t))){const{name:t,domain:r,emailDomains:i}=n.state,a=await l.a({message:c,acceptLabel:p});return u.j(this.environment,{confirmed:a,domains:i}),a?(f.y({environment:this.environment,name:t,domain:r||void 0,emailDomains:i,spaceStore:this.props.spaceStore}),e()):e(),!0}e()}else if("security_saml"===h&&t.canAdmin()){const{securitySettingsStore:n,spaceSecuritySamlSettingsStore:r}=this.stores,a=!i.isEqual(n.state,n.getValueForSpace(t)),o=await r.getValueForSpace(this.environment,t),d=(r.state.emailDomains.length>0||"enterprise"===he.i(this.environment))&&(!r.state.id||r.state.id===t.id)&&!i.isEqual(r.state,o);if(a||d){if(await l.a({message:c,acceptLabel:p})){const{disablePublicAccess:t,disableGuests:i,disableMoveToSpace:o,disableExport:c,disableSpacePageEdits:u,disablePublicAccessRequests:p}=n.state;if(a&&H.d(this.environment,e=>{f.x({environment:this.environment,disablePublicAccess:t,disableGuests:i,disableMoveToSpace:o,disableExport:c,disableSpacePageEdits:u,disablePublicAccessRequests:p,transaction:e,spaceStore:this.props.spaceStore})}),d){const{state:e}=r,t=await s.b(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount});"failed"===t.type&&l.d(t)}e()}else e();return!0}e()}else e();return!1}getSidebarHeader(){return{letterSpacing:"0.03em",textTransform:"uppercase",fontSize:11,lineHeight:1,marginBottom:1,color:this.theme.mediumTextColor,fontWeight:Y.a.fontWeight.medium,padding:"5px 15px",textOverflow:"ellipsis",overflow:"hidden"}}getIconWrapStyle(){return{width:20,height:20,marginRight:8,color:this.theme.regularIconColor,fill:this.theme.regularIconColor}}}Ji.dividerStyle={paddingLeft:14,paddingRight:14},Ji.sidebarStyle={display:"flex",flexDirection:"column",height:"100%",paddingTop:10,paddingBottom:12,justifyContent:"space-between"};t.default=Ji},1149:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n.n(r),a=n(848),s=n(44),o=n(3),l=n(189);class c extends o.a{constructor(){super(...arguments),this.handleContextMenu=e=>{const{device:t}=this.environment;t.isAndroid||l.b.isOnboarding||Object(s.d)({event:e,context:s.a.EditorContextMenu,callback:()=>{t.isElectron||this.environment.currentUser.isLoggedIn()&&e.preventDefault()}})},this.handleDragStart=e=>{e.preventDefault()}}didMount(){window.addEventListener("contextmenu",this.handleContextMenu),window.addEventListener("dragstart",this.handleDragStart)}willUnmount(){window.removeEventListener("contextmenu",this.handleContextMenu),window.removeEventListener("dragstart",this.handleDragStart)}}var d=c,u=(n(15),n(12),n(2)),p=n(23),m=n(87),h=n(129),g=n(26),b=n(10),f=n(349),y=n(32),S=n(78),v=n(429),E=n(348),M=n(239),w=n(330),C=n(328),O=n(72),k=n(840),P=n(83),T=n(146),D=n(632),I=n(9);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class A extends o.a{constructor(){super(...arguments),this.didTouchEnd=!1,this.handleWindowMouseMove=e=>{if(this.didTouchEnd)return void(this.didTouchEnd=!1);const{isDragging:t}=m.b.state;t?this.updateDragState():this.updateHoverState(e.target,e.clientX,e.clientY)},this.handleWindowKeyEvent=e=>{const{isDragging:t}=m.b.state;t&&this.updateDragState()},this.handleWindowMouseMoveThrottled=u.throttle(this.handleWindowMouseMove,60),this.handleWindowTouchEnd=e=>{this.didTouchEnd=!0},this.handleWindowScroll=()=>{p.i(),this.clearHoverState()},this.handleWindowResize=()=>{p.i(),this.clearHoverState()},this.handleGlobalMenuIsOpenChange=()=>{const e=M.a.state,t=P.n.state;e.isOpen&&!e.menuIsOpen&&t&&M.a.reset()},this.memoizedCanDragCache=new WeakMap,this.memoizedCanDrag=e=>{const t=this.memoizedCanDragCache.get(e);if(this.memoizedCanDragCache.has(e))return t;const n=Object(I.o)({environment:this.environment,blocks:e});return this.memoizedCanDragCache.set(e,n),n}}leftRightLeeway(){const{device:e}=this.environment;return e.isMobile?9999:0}didMount(){super.didMount();const{device:e}=this.environment;h.a(window,"mousemove",this.handleWindowMouseMoveThrottled),e.isIOS&&h.a(window,"touchend",this.handleWindowTouchEnd),h.a(window,"keydown",this.handleWindowKeyEvent),h.a(window,"keyup",this.handleWindowKeyEvent),m.b.addListener(this.handleWindowMouseMoveThrottled),h.a(window,"scroll",this.handleWindowScroll,!0),h.a(window,"resize",this.handleWindowResize),P.n.addListener(this.handleGlobalMenuIsOpenChange),p.h()}willUnmount(){super.willUnmount();const{device:e}=this.environment;h.b(window,"mousemove",this.handleWindowMouseMoveThrottled),e.isIOS&&h.b(window,"touchend",this.handleWindowTouchEnd),h.b(window,"keydown",this.handleWindowKeyEvent),h.b(window,"keyup",this.handleWindowKeyEvent),m.b.removeListener(this.handleWindowMouseMoveThrottled),h.b(window,"scroll",this.handleWindowScroll,!0),h.b(window,"resize",this.handleWindowResize),P.n.removeListener(this.handleGlobalMenuIsOpenChange)}updateDragState(){const e=m.b.state;if(!e.isDragging)return;const{draggedStores:t,currentX:n,currentY:r,offsetX:i,offsetY:a,isNativeDrag:s}=e,o={x:n,y:r},l={x:n-i,y:r-a},c=this.findNearbyDropZones({mousePoint:o,originPoint:l},t[0],s);if(c.ontoDropZone)m.b.setState(x({},e,{currentDropZone:c.ontoDropZone,currentHintDropZones:[],currentParentStore:void 0}));else if(c.verticalDropZone)m.b.setState(x({},e,{currentDropZone:c.verticalDropZone,currentHintDropZones:[],currentParentStore:void 0}));else{if(c.horizontalDropZones.length>0){const t=c.horizontalDropZones[0],n=u.tail(c.horizontalDropZones),r=S.a.findSelectableFromStore(t.store);if(r){const i=r.getContextClosestSelectable();let a;return i&&i.props.store!==t.store&&i.props.shouldShowParentHalo&&(a=i.props.store),void m.b.setState(x({},e,{currentDropZone:t,currentHintDropZones:n,currentParentStore:a}))}}m.b.setState(x({},e,{currentDropZone:void 0,currentHintDropZones:[],currentParentStore:void 0}))}}clearHoverState(){const e=M.a.state;e.isOpen&&!e.menuIsOpen&&M.a.reset()}updateHoverState(e,t,n){const r=M.a.state;if(!r.isOpen||!r.menuIsOpen){const i=this.findHoverMenuTarget(e,t,n);i?r.isOpen&&i.selectable.props.store===r.currentStore||M.a.setState({isOpen:!0,currentStore:i.selectable.props.store,container:i.container,menuIsOpen:!1}):M.a.reset()}}findNearbyDropZones(e,t,n){const{device:r}=this.environment,i=f.a(),{selectableRectMap:a}=E.a.state,s=a.keys();let o=s.next();const l=S.a.findSelectableFromStore(t),c=l?l.getContextSelectableContainer():void 0,d=[];for(;!o.done;){const t=o.value;o=s.next();const l=a.get(t),u=t.getContextSelectableContainer(),p=t.props.dropzoneMustBeWithinHorizontalBound?0:this.leftRightLeeway();if(r.isMobile&&u!==c)continue;if(!u||u.props.disable)continue;const h=t.getReferencePoint(e);if(l&&e.mousePoint.x>=l.left&&e.mousePoint.x<=l.right&&e.mousePoint.y>=l.top&&e.mousePoint.y<=l.bottom&&this.selectableIsDragging(t)&&!i.option)return{ontoDropZone:void 0,verticalDropZone:void 0,horizontalDropZones:[]};const{mousePoint:g}=e;(n?t.props.canNativeDropOnto:t.props.canDropOnto)&&l&&g.x>=l.left&&g.x<=l.right&&g.y>=l.top&&g.y<=l.bottom&&!this.selectableIsDragging(t)&&this.selectableCanAcceptDrop(t,m.a.Onto)&&d.push({selectable:t,direction:m.a.Onto,left:l.left,top:l.top,width:l.width,height:l.height}),(n?t.props.canNativeDropLeft:t.props.canDropLeft)&&l&&h.y>=l.top&&h.y<=l.bottom&&Math.abs(h.x-l.left)<=A.verticalDropZoneMaxHorizontalOffset&&(i.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,m.a.Left)&&d.push({selectable:t,direction:m.a.Left,left:l.left,top:l.top,width:0,height:l.height}),(n?t.props.canNativeDropRight:t.props.canDropRight)&&l&&h.y>=l.top&&h.y<=l.bottom&&Math.abs(h.x-l.right)<=A.verticalDropZoneMaxHorizontalOffset&&(i.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,m.a.Right)&&d.push({selectable:t,direction:m.a.Right,left:l.right,top:l.top,width:0,height:l.height}),(n?t.props.canNativeDropAbove:t.props.canDropAbove)&&l&&h.x>=l.left-A.verticalDropZoneExtraLeftEdgeOffset-p&&h.x<=l.right+p&&(i.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,m.a.Above)&&d.push({selectable:t,direction:m.a.Above,left:l.left,top:l.top,width:l.width,height:0}),(n?t.props.canNativeDropBelow:t.props.canDropBelow)&&l&&h.x>=l.left-A.verticalDropZoneExtraLeftEdgeOffset-p&&h.x<=l.right+p&&(i.option||!this.selectableIsDragging(t))&&this.selectableCanAcceptDrop(t,m.a.Below)&&d.push({selectable:t,direction:m.a.Below,left:l.left,top:l.bottom,width:l.width,height:0})}const p=d.filter(e=>e.direction===m.a.Above||e.direction===m.a.Below),h=u.minBy(p,t=>{let{selectable:n,top:r}=t;return Math.abs(r-n.getReferencePoint(e).y)});let g=p.filter(e=>{let{top:t}=e;return Math.abs(t-(h?h.top:0))<=A.competingHorizontalDropZoneMinDist});if(g.length>1){g=g.filter(t=>{let{selectable:n,left:r,width:i}=t;const a=n.getReferencePoint(e).x;return a>=r-this.leftRightLeeway()&&a<=r+i+this.leftRightLeeway()}),g=u.sortBy(g,e=>{let{left:t}=e;return t});let t=0;for(;t<g.length-1;t++){const n=g[t+1],r=n.selectable.getReferencePoint(e).x;if(n.left>r)break}g=g.slice(0,t+1),g.reverse()}const b=u.map(g,e=>{let{selectable:t,direction:n}=e;return{store:t.props.store,direction:n}});let y;const v=d.filter(e=>e.direction===m.a.Onto),M=u.minBy(v,e=>e.height);if(M){p.some(t=>{const n=t.selectable.getReferencePoint(e).y;return Math.abs(t.top-n)<A.competingOntoDropZoneVerticalOffset})||(y={store:M.selectable.props.store,direction:M.direction})}let w;const C=d.filter(e=>e.direction===m.a.Left||e.direction===m.a.Right);let O=u.minBy(C,t=>{const n=t.selectable.getReferencePoint(e).x;return Math.abs(t.left-n)});if(O){const e=O,t=C.filter(t=>Math.abs(t.left-e.left)<A.verticalDropZoneAmbiguousDist);t.length>0&&(O=u.minBy(t,e=>e.left))}if(O){const e=O;p.some(t=>t.top>=e.top&&t.top+t.height<=e.top+e.height)||(w={store:O.selectable.props.store,direction:O.direction})}return{ontoDropZone:y,verticalDropZone:w,horizontalDropZones:b}}findHoverMenuTarget(e,t,n){if(m.b.state.isDragging||T.a.state.isActive||P.n.state)return;const{selectableRectMap:r}=E.a.state,i=D.a.getSortedComponents().find(t=>{const n=t.getNode();return Boolean(n&&n.contains(e))}),{defaultContainer:a}=y.b.state,s=i||a;if(!s)return;const o=r.keys();let l=o.next();const c=[];for(;!l.done;){const e=l.value,i=r.get(e);(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)&&e.getContextSelectableContainer()===s&&i&&n>=i.top&&n<=i.bottom&&t>=i.left-A.hoverMaxHorizontalOffset&&t<=i.right&&c.push(e),l=o.next()}const d=u.sortBy(c,e=>{const t=r.get(e);return t?-t.left:1/0}),p=d.find(e=>{const t=e.getNode();if(t){if(d.find(n=>{if(n!==e){const e=n.getNode();return Boolean(e&&t.contains(e))}return!1}))return!1}return!0});return p?{selectable:p,container:s}:void 0}selectableIsDragging(e){const t=m.b.state;if(!t.isDragging)return;const{draggedStores:n}=t;for(;e;){if(n.indexOf(e.props.store)>=0)return!0;e=e.getContextClosestSelectable()}return!1}selectableCanAcceptDrop(e,t){if(C.a.state.isOpen&&!O.c.state.open)return!1;if(w.a.state.isOpen)return!1;const n=m.b.state,r=n.isDragging?n.draggedStores:[],i=!!n.isDragging&&n.isNativeDrag,a=e.props.store;let s,o,l=!1,c=!1;if(r.find(e=>{const t=v.a.findOutlinerItemFromStore(e);return!!t&&(s=t.props.type,l=t.props.isTopLevelItem,!0)}),t===m.a.Onto&&"collection"===a.getParentTable()){const e=a.getParentId();if(r.find(t=>Boolean(t instanceof g.a&&"collection"===t.getParentTable()&&t.getParentId()===e)))return!1}const d=Boolean(r.find(e=>e.isCollectionView()));if(d&&"collection"===a.getParentTable()&&t!==m.a.Onto&&"bookmarks"!==s)return!1;if(d&&a.isCollectionView()&&t===m.a.Onto)return!1;if(d&&a.isCollectionView()&&!a.recordStoreParent()&&t!==m.a.Onto)return!1;const u=v.a.findOutlinerItemFromStore(a);if(u&&(o=u.props.type,c=u.props.isTopLevelItem),o&&i)return!1;if("bookmarks"===s&&l&&("bookmarks"!==o||!c||t===m.a.Onto))return!1;if("bookmarks"===o&&c&&t!==m.a.Onto&&("bookmarks"!==s||!l))return!1;if("shared"===o&&"shared"!==s&&t!==m.a.Onto)return!1;if("shared"===s&&"shared"!==o&&r.some(e=>!e.isTopLevel()))return!1;if(o&&c&&t!==m.a.Onto){if(r.find(e=>{const t=e.getType();return Boolean(!t||!b.r[t])}))return!1}const{device:p}=this.environment;return!(o&&p.isMobile&&t===m.a.Onto&&c)&&((!r.find(e=>Boolean(e instanceof g.a&&e.isInlineCollectionView()))||t!==m.a.Left&&t!==m.a.Right)&&(r.some(e=>Boolean(k.a.findCollectionTemplatePickerItemFromStore(e)))===Boolean(k.a.findCollectionTemplatePickerItemFromStore(a))&&(!(t===m.a.Onto&&a&&!Object(I.p)({environment:this.environment,blocks:[a]}))&&!!this.memoizedCanDrag(r))))}}A.verticalDropZoneMaxHorizontalOffset=200,A.hoverMaxHorizontalOffset=150,A.competingOntoDropZoneVerticalOffset=7,A.verticalDropZoneExtraLeftEdgeOffset=14,A.verticalDropZoneAmbiguousDist=20,A.competingHorizontalDropZoneMinDist=2;var F=A,R=n(220),L=n(17),U=n(422),_=n(265);class W extends o.a{constructor(){super(...arguments),this.mouseSpeed=1/0,this.setPreviousMousePosition=(e,t)=>{this.previousMousePosition={x:e,y:t},clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.previousMousePosition=void 0},100)},this.handleWindowMouseMove=e=>{Object(s.d)({event:e,context:s.a.SidebarMouseMove,callback:()=>{if(this.updatePageViewRectThrottled(),void 0!==this.previousMousePosition&&(this.mouseSpeed=Math.sqrt(Math.pow(e.clientX-this.previousMousePosition.x,2)+Math.pow(e.clientY-this.previousMousePosition.y,2))),this.setPreviousMousePosition(e.clientX,e.clientY),this.cachedPageViewRect){const{sidebarMinTriggerWidth:t,sidebarOpenWidthPercent:n}=W,r=_.b.state,i=_.d.state,a=e.clientX,s=this.cachedPageViewRect.left,o=Math.max(s*n,t);a<o&&!O.c.state.open&&this.mouseSpeed<W.mouseSpeedThreshold&&0!==this.mouseSpeed&&!r&&R.d(),a>i&&a>o&&r&&R.b()}}})},this.handleWindowMouseOut=e=>{e.toElement||e.relatedTarget||R.b()},this.updatePageViewRectThrottled=u.throttle(this.updatePageViewRect,500)}didMount(){window.addEventListener("mousemove",this.handleWindowMouseMove),window.addEventListener("mouseout",this.handleWindowMouseOut)}willUnmount(){window.removeEventListener("mousemove",this.handleWindowMouseMove),window.removeEventListener("mouseout",this.handleWindowMouseOut)}updatePageViewRect(){const e=this.getPageViewWrapEl();this.cachedPageViewRect=e?e.getBoundingClientRect():document.body.getBoundingClientRect()}getPageViewWrapEl(){const{currentBlockStore:e}=L.a.state,t=U.a.findComponent(t=>t.props.store===e);if(t){const e=t.getContentWrapEl();if(e)return e}}}W.sidebarOpenWidthPercent=.38,W.sidebarMinTriggerWidth=18,W.mouseSpeedThreshold=5;var q=W,N=n(334),z=n(41),V=n(40),H=n(210),G=n(728),Y=n(33),Q=n(42),K=n(731),Z=n(132),X=n(13),$=n(550),J=n(16);function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ne extends J.a{constructor(){super(...arguments),this.pause=()=>{this.setState({active:!1,onActive:[]})},this.resume=()=>{this.state.onActive.map(e=>e()),this.setState({active:!0,onActive:[]})}}getInitialState(){return{active:!0,onActive:[]}}whenActive(e){this.state.active?e():this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.state,{onActive:u.uniq([...this.state.onActive,e])}))}}var re=new ne,ie=n(176),ae=n(243),se=n(1),oe=n(93);class le extends o.a{constructor(){super(...arguments),this.handleNotificationEmit=async()=>{const e=await V.eb(this.environment,{size:21});if("failed"===e.type)return;const{results:t}=e.data;$.a.setState({results:t}),this.syncInitialBadgeNumber();const n=u.union.apply(null,t.map(e=>e.unreceived.notificationIds));for(const r of n)this.displayNotification(r)},this.handleNotificationEmitThrottled=u.throttle(this.handleNotificationEmit,1e3),this.handleNotificationEmitWhenActive=()=>{re.whenActive(this.handleNotificationEmitThrottled)},this.updateBadgeNumbers=()=>{const{results:e}=$.a.state,{reactNative:t}=this.environment,n=e.reduce((e,t)=>e+t.unread.mentions,0);t&&t.setBadgeNumber(n),n>0?Z.q("".concat(n)):Z.q("")},this.syncInitialBadgeNumber=u.once(this.updateBadgeNumbers)}willMount(){this.startMessageListeners(),$.a.addListener(this.updateBadgeNumbers)}willUnmount(){this.stopMessageListeners(),$.a.removeListener(this.updateBadgeNumbers)}startMessageListeners(){const{currentUserStore:e}=L.a.state;if(e){const t=Object(ae.f)(e.id);this.listenerReference=ie.a.addListener(t,this.handleNotificationEmitWhenActive,void 0)}}stopMessageListeners(){this.listenerReference&&ie.a.removeListener(this.listenerReference)}async displayNotification(e){const t=Object(z.c)(this.props.rootStore,{table:N.a,id:e});await t.load();const n=t.getValue();if(!n)return;const r=Object(oe.b)(t,n.activity_id,n.space_id);await r.load();const i=r.getValue(),{currentUserStore:a,currentSpaceViewStore:s}=L.a.state;if(a&&s&&i&&!i.invalid&&!H.k(i,a.id)&&await Z.s()&&"undefined"!=typeof Notification){await s.load();const e=s.getValue();if(!e)return;if(!H.l(i))return;if(!e.notify_desktop)return;const n=Object(G.a)({activity:i,getRecordValue:t.getRecordValue,userTimeZone:X.m,intl:this.props.intl});if(!n)return;const{subject:r,body:a}=n;new Notification(r,{body:a,silent:!0}).addEventListener("click",()=>{const e=H.j({activity:i,getRecordValue:t.getRecordValue,baseUrl:Y.a.baseURL}),n=H.f(i),r=Object(K.b)(e,[n,"desktop_push"]);Q.f({environment:this.environment,url:r})})}}}var ce=Object(se.h)(le),de=n(855);class ue extends o.a{constructor(){super(...arguments),this.handleOpen=()=>{de.a.setState({open:!0})},this.handleClose=()=>{de.a.setState({open:!1})}}willMount(){Z.j.started.addListener(this.handleOpen),Z.j.stopped.addListener(this.handleClose)}willUnmount(){Z.j.started.removeListener(this.handleOpen),Z.j.stopped.removeListener(this.handleClose)}}var pe=ue,me=n(222),he=n(343),ge=n(45),be=n(14),fe=n(24),ye=n(167),Se=n(21),ve=n(105),Ee=n(633),Me=n(434),we=n(360),Ce=n(91),Oe=n(136),ke=n(838);function Pe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class De extends o.a{constructor(){super(...arguments),this.renderOverlay=()=>{const{device:e}=this.environment,t=Me.a.state;if(!t.isActive)return;const{originBlockRect:n,actions:i,inputValue:a}=t,s={environment:this.environment,blocks:t.stores,originRect:n},o=t.showInput&&this.renderInputSection(),l=t.stores[0];let c;return c=e.isPhone?{menuType:Se.b.MenuType.Modal,title:r.createElement(se.b,{defaultMessage:"Actions",id:"blockMenu.actionButton.label"}),right:r.createElement(Ce.DoneMenuText,null),onClickRight:this.handleOverlayBgClick,header:o}:{menuType:Se.b.MenuType.Popup,width:220,header:o},r.createElement(ve.a,{capture:!0,onBackspace:u.identity},r.createElement(Se.b,Object.assign({},c),r.createElement(he.a,{filter:a,context:s,sections:i,onAccept:this.handleAccept,initialFocus:a?0:void 0}),!a&&this.renderBlockAuthorInfo(),!a&&r.createElement(ke.a,{store:l}),!a&&l.isCollectionView()&&this.renderCollectionHelpButton()))},this.handleOverlayBgClick=()=>{me.a()},this.handleAccept=e=>{const t=Me.a.state;if(!t.isActive)return;const{stores:n}=y.b.state,{analyticsFrom:r}=t,i=n[0];if(i){const t=i.getValue();t&&be.o(this.environment,{analyticsName:e.analyticsName,from:r,block_type:t.type})}e.closeParentMenu&&me.a()},this.handleInputChange=e=>{Me.a.state.isActive&&Me.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Pe(Object(n),!0).forEach((function(t){Te(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Pe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Me.a.state,{inputValue:e.target.value}))}}renderComponent(){const{device:e}=this.environment,t=Me.a.state;return r.createElement(ge.c,{popupType:e.isPhone?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originBlockRect:void 0,onDismiss:this.handleOverlayBgClick,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Start,originGap:0,preventScaleTransition:!0,render:this.renderOverlay,preventBlockRenderQueueOnEnter:e.isMobile})}renderBlockAuthorInfo(){const e=Me.a.state;if(e.isActive&&!(e.stores.length>1))return r.createElement(Ee.a,{store:e.stores[0],isPageMoreButton:!1})}renderInputSection(){const{device:e}=this.environment,{intl:t}=this.props,n=Me.a.state;if(!n.isActive||e.isPhone)return;const{inputValue:i}=n;return r.createElement(fe.a,{isInput:!0},r.createElement(ye.a,{value:i,onChange:this.handleInputChange,focus:!0,focusAfterAnimation:!0,placeholder:t.formatMessage({defaultMessage:"Filter actions…",id:"blockMenu.filterForActions.placeholder"}),allowDelete:!0}))}renderCollectionHelpButton(){return r.createElement(fe.a,{topBorder:!0,disableDesktopPadding:!0},r.createElement(we.a,{title:r.createElement(se.b,{defaultMessage:"Learn about databases",id:"blocks.blockMenu.collectionHelpButton"}),href:Object(Oe.a)("guides.database"),analyticsFrom:"block_menu"}))}}var Ie=Object(se.h)(De),je=n(153),xe=n(729),Be=n(84);function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Re extends o.a{constructor(){super(...arguments),this.handleOverlayBgClick=e=>{xe.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){Fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},xe.a.state,{active:!1,stringValue:""}))}}renderComponent(){const{device:e}=this.environment,{active:t,stringValue:n}=xe.a.state,i=window.innerWidth/2-150,a=window.innerHeight/2;return r.createElement(ge.c,{popupType:e.isReactNative?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t,originRect:{top:a,left:i},onDismiss:this.handleOverlayBgClick,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Start,originGap:0,render:()=>r.createElement(ve.a,{capture:!0,onEnter:u.identity,onCommandEnter:u.identity,onCommandShiftEnter:u.identity,onCommandSlash:u.identity,onDelete:u.identity,onBackspace:u.identity,onEsc:u.identity,onLeft:u.identity,onRight:u.identity,onUntab:u.identity,onTab:u.identity,onSelectAll:u.identity,onRedo:u.identity,onUndo:u.identity,onToggleBold:u.identity,onToggleItalics:u.identity,onToggleStrike:u.identity,onToggleCode:u.identity,onCut:u.identity,onCopy:u.identity,onPaste:u.identity,onKeypress:u.identity},r.createElement("div",{style:{padding:8,width:300}},r.createElement(je.b,{style:{width:"100%",fontSize:12},value:n,focus:!0,textarea:!0,selectAll:!0,readOnly:!0}),r.createElement(Be.a,{isSmall:!0,style:{marginTop:6,pointerEvents:"none"}},r.createElement(se.b,{defaultMessage:"Right click and copy the link above",id:"clipboardInputRenderer.copyLink.message"}))))})}}var Le=Re,Ue=n(58);class _e extends o.a{didMount(){super.didMount();const e=Ue.findDOMNode(this);e&&e instanceof Element&&this.props.ghostElement.forEach((t,n)=>{let{cloned:r}=t;e.children[n].appendChild(r)})}renderComponent(){return r.createElement("div",null,this.props.ghostElement.map((e,t)=>{let{rect:{left:n,top:i,width:a,height:s}}=e;return r.createElement("div",{key:t,style:{position:"absolute",top:i,left:n,width:a,height:s,opacity:this.environment.device.isMobile?.25:.4,pointerEvents:"none"}})}))}}var We=_e,qe=n(363);class Ne extends o.a{constructor(){super(...arguments),this.renderGhost=()=>{const e=m.b.state;if(!e.isDragging)return;const t=e.draggedStores.map((t,n)=>r.createElement(We,{key:"".concat(n),store:t,ghostElement:e.ghostElements[n]}));return r.createElement("div",{style:this.getGhostStyle()},t)},this.isDragging=this.createComputedStore(()=>m.b.state.isDragging)}renderComponent(){return r.createElement(qe.a,{open:this.isDragging.state,render:this.renderGhost})}getGhostStyle(){const e=m.b.state;if(!e.isDragging)return;const{startX:t,startY:n,currentX:r,currentY:i}=e,a=i-n;return{position:"absolute",top:0,left:0,transform:"translate3d(".concat(r-t,"px, ").concat(a,"px, 0)")}}}var ze=Ne,Ve=n(228),He=n(171),Ge=n(126),Ye=n(751),Qe=n(460),Ke=n(22),Ze=n(578),Xe=n(19),$e=n(77),Je=n(507);function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){nt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class rt extends o.a{constructor(){super(...arguments),this.renderOverlay=()=>{const{isOpen:e,renderFullScreenNode:t,fullScreenNodeRect:n}=Ze.a.state;if(!n)return;const i=window.innerWidth,a=window.innerHeight,s=i-2*rt.edgePadding,o=a-2*rt.edgePadding;let l=s,c=l/n.width*n.height;if(c>o){const e=c/o;c/=e,l/=e}const d=(i-l)/2,p=(a-c)/2,m={translateX:n.left,translateY:n.top,width:n.width,height:n.height},h={translateX:d,translateY:p,width:l,height:c};let g;return t&&(g=t()),Object(Ve.a)(t=>r.createElement(ve.a,{capture:e,onEsc:this.handleClose,onEnter:u.identity,onSpace:this.handleClose,onCommandEnter:this.handleClose,onCommandShiftEnter:u.identity,onCommandSlash:u.identity,onUp:u.identity,onDown:u.identity,onDelete:u.identity,onBackspace:u.identity,onLeft:u.identity,onRight:u.identity,onUntab:u.identity,onTab:u.identity,onSelectAll:u.identity,onRedo:u.identity,onUndo:u.identity,onToggleBold:u.identity,onToggleItalics:u.identity,onToggleStrike:u.identity,onToggleCode:u.identity,onCut:u.identity,onCopy:u.identity,onPaste:u.identity,onKeypress:u.identity},r.createElement(Ye.a,{capture:e},r.createElement("div",Object.assign({onClick:this.handleClose,ref:e=>{this.rootEl=e},style:this.getStyle(e)},t),r.createElement(Ge.a,{isVisible:e,enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:.8},render:()=>r.createElement("div",{style:rt.backgroundStyle}),onAnimationEnd:this.handleBackgroundAnimationEnd}),r.createElement(Ge.a,{ref:e=>{this.animatedEl=e},isVisible:e,enterAnimationStyle:m,exitAnimationStyle:m,animationStyle:h,springConfig:{translateX:rt.springConfig,translateY:rt.springConfig,width:rt.springConfig,height:rt.springConfig},render:()=>r.createElement("div",{style:rt.fullScreenNodeWrapStyle},g),onAnimationEnd:this.handleFullscreenNodeAnimationEnd}),r.createElement("div",{style:this.getCloseButtonStyle(e)},r.createElement($e.a,{onClick:this.handleClose,style:{color:"#fff"}},r.createElement(se.b,{defaultMessage:"Close",id:"fullscreenRenderer.closeButton.label",description:"Shown in the top right corner when viewing an asset (image, file, etc.) in full screen mode, to close out of full screen mode."})))))))},this.handleClose=()=>{Je.a(),p.e(this.environment)},this.handleResize=()=>{const{isOpen:e}=Ze.a.state;e&&this.enqueueForceUpdate()},this.handleFrameScrollerUpdate=()=>{this.updateRootElFromScroll()},this.handleBackgroundAnimationEnd=()=>{const{isOpen:e}=Ze.a.state;e||Ze.a.setState(tt({},Ze.a.state,{backgroundAnimationComplete:!0}))},this.handleFullscreenNodeAnimationEnd=()=>{const{isOpen:e}=Ze.a.state;e||Ze.a.setState(tt({},Ze.a.state,{fullscreenNodeAnimationComplete:!0}))}}didMount(){super.didMount(),window.addEventListener("resize",this.handleResize),Qe.a.addListener(this.handleFrameScrollerUpdate)}didMountOrUpdate(){super.didMountOrUpdate(),this.updateRootElFromScroll()}willUnmount(){super.willUnmount(),window.removeEventListener("resize",this.handleResize),Qe.a.removeListener(this.handleFrameScrollerUpdate)}renderComponent(){const{isOpen:e,fullscreenNodeAnimationComplete:t,backgroundAnimationComplete:n}=Ze.a.state;return r.createElement(qe.a,{open:e||!t||!n,render:this.renderOverlay})}getRenderedEl(){const e=Ue.findDOMNode(this.animatedEl);if(e)return e.childNodes[0]}updateRootElFromScroll(){if(this.getRenderedEl()){const{scrollTop:e}=Qe.a.state,{startScrollTop:t}=Ze.a.state,n=e-t;this.rootEl.style.transform="translateY(".concat(-n,"px)")}}getStyle(e){return{zIndex:He.i,position:"fixed",top:0,left:0,right:0,bottom:0,pointerEvents:e?"auto":"none",cursor:"zoom-out"}}getCloseButtonStyle(e){const{WindowSizeStore:t}=this.environment;return{position:"absolute",top:t.getSafePaddingBottomCSS(16),right:t.getSafePaddingRightCSS(18),display:e?"block":"none",fontWeight:Ke.a.fontWeight.medium}}}rt.edgePadding=32,rt.springConfig={stiffness:65,damping:10,precision:.001},rt.fullScreenNodeWrapStyle={position:"absolute",top:0,left:0,display:"flex"},rt.backgroundStyle={position:"absolute",top:0,left:0,right:0,bottom:0,background:Xe.f.black};var it=rt,at=n(150),st=n(439),ot=n(721),lt=n(200),ct=n(826),dt=n(774),ut=n(230),pt=n(39),mt=n(750),ht=n(249),gt=n(1290),bt=n(1400),ft=n(767),yt=n(8),St=n(106),vt=n(581),Et=n(125),Mt=n(626),wt=n(34),Ct=n(257),Ot=n(182),kt=n(195),Pt=n(181),Tt=n(168),Dt=n(99),It=n(483),jt=n(53),xt=n(508),Bt=n(67),At=n(5),Ft=n(300),Rt=n(94);function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){_t(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Wt=Object(se.g)({embedPlaceholder:{id:"mediaPicker.embedPlaceholder.text",defaultMessage:"Paste in https://…"},filterPlaceholder:{id:"mediaPicker.emojiFilter.text",defaultMessage:"Filter…"},unsplashPlaceholder:{id:"mediaPicker.unsplashPlaceholder.text",defaultMessage:"Search for an image…"}});class qt extends o.a{constructor(){super(...arguments),this.storeTypes={embedInputStore:lt.a,emojiInputStore:lt.a,emojiPickerStore:vt.a,unsplashInputStore:lt.a},this.renderUnsplashResults=(e,t,n,i)=>i?!n||n&&!n.length?r.createElement(ct.a,{shouldWrapCaption:!0,caption:r.createElement(se.b,{defaultMessage:"No results found.",id:"mediaPicker.unsplash.noResultsText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}):r.createElement(r.Fragment,null,n.map(t=>this.renderUnsplashImage(e,t)),r.createElement(ct.a,{shouldWrapCaption:!0,caption:r.createElement(se.b,{defaultMessage:"Search to find more results.",id:"mediaPicker.unsplash.searchText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}})):r.createElement("div",{style:this.getLoadingContainerStyle()},r.createElement(Dt.a,null)),this.renderUnsplashImage=(e,t)=>{const{device:n}=this.environment;return r.createElement("div",{key:t.id,style:{width:n.isMobile?"33%":"25%",padding:3}},r.createElement(wt.a,{hoveredStyle:{opacity:.85},onClick:()=>this.handleSelectUnsplashImage(e,t)},r.createElement(ut.a,{src:t.thumbUrl,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center 0%",borderRadius:3}})),r.createElement(Be.a,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:2,marginBottom:4}},r.createElement(se.b,{defaultMessage:"by <inlinetextlink>{authorName}</inlinetextlink>",id:"mediaPicker.unsplash.byAuthor",description:"Caption attributing the author of the Unsplash image",values:{authorName:t.authorName,inlinetextlink:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.createElement(It.a,{external:!0,href:t.unsplashUrl},n)}}})))},this.handleEmbedSubmit=e=>()=>{const t=this.stores.embedInputStore.state.inputValue;t&&e.onChange(t)},this.handleSelectUnsplashImage=async(e,t)=>{const n=await Object(Ft.b)({environment:this.environment,url:t.downloadUrl,method:"GET",json:!0});"success"===n.type&&e.onChange({url:n.data.url})},this.handleSwipeLeft=()=>{if(!Mt.a.state.isActive)return;const e=this.getTabs(),t=e.map(e=>e.type).indexOf(Mt.a.state.currentTab),n=e[t+1];void 0!==n&&this.handleTabChange(n.type)},this.handleSwipeRight=()=>{if(!Mt.a.state.isActive)return;const e=this.getTabs(),t=e.map(e=>e.type).indexOf(Mt.a.state.currentTab),n=e[t-1];void 0!==n&&this.handleTabChange(n.type)},this.handleTabChange=e=>{Mt.a.state.isActive&&Mt.a.setState(Ut({},Mt.a.state,{currentTab:e}))},this.handleRandomEmojiClick=()=>{const{device:e}=this.environment,t=this.getTabs().find(e=>e.type===this.props.currentTab);if(t&&"emoji"===t.type){const n=Object(Rt.c)();t.onChange(n,{keepVisible:!e.isMobile})}},this.handleEmojiFilterChange=e=>{const{emojiInputStore:t,emojiPickerStore:n}=this.stores;t.setState(Ut({},t.state,{inputValue:e.currentTarget.value})),n.setState(Ut({},n.state,{loadEmojiCount:vt.a.emojisPerPage}))}}renderComponent(){const{device:e}=this.environment,t=this.renderTabsHeader(),n=this.renderInputHeader(),i=(t||n)&&r.createElement(r.Fragment,null,t,n);let a;return e.isMobile?a={menuType:Se.b.MenuType.Modal,title:this.props.title,header:i,right:r.createElement(se.b,{defaultMessage:"Close",id:"mediaPicker.mobileCloseButton.label"}),onClickRight:this.props.onCancel,left:this.props.onDelete&&r.createElement(se.b,{defaultMessage:"Remove",id:"mediaPicker.mobileRemoveButton.label"}),onClickLeft:this.props.onDelete}:(a={menuType:Se.b.MenuType.Popup,header:i},a.width=this.props.popupWidth||300,a.height=this.props.popupHeight,a.maxHeight=this.props.maxHeight,a.maxWidth=this.props.maxWidth),r.createElement(bt.a,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>r.createElement(Se.b,Object.assign({},a,e,{className:Bt.D}),this.renderCurrentTab())})}renderTabsHeader(){const{device:e}=this.environment;if(!(this.getTabs().length<=1)||this.props.onDelete){const t={gallery:r.createElement(se.b,{id:"mediaPicker.tabs.gallery",defaultMessage:"Gallery"}),embed:r.createElement(se.b,{id:"mediaPicker.tabs.embedLink",defaultMessage:"Embed link"}),file:r.createElement(se.b,{id:"mediaPicker.tabs.upload",defaultMessage:"Upload"}),emoji:r.createElement(se.b,{id:"mediaPicker.tabs.emoji",defaultMessage:"Emoji"}),unsplash:r.createElement(r.Fragment,null,yt.a.unsplashLogo({width:12,marginRight:4,height:12}),r.createElement("span",null,"Unsplash")),drive:r.createElement(se.b,{id:"mediaPicker.tabs.browse",defaultMessage:"Browse"})},n=this.getTabs(),i=n.findIndex(e=>e.type===this.props.currentTab),a=n.map(e=>e.title||t[e.type]),s=n.find(e=>e.type===this.props.currentTab),o=s&&"emoji"!==s.type&&e.isAndroid;return r.createElement(gt.a,{tabs:a,selectedIndex:i,onChange:e=>{const t=n[e];this.handleTabChange(t.type)},right:r.createElement(r.Fragment,null,s&&"emoji"===s.type&&r.createElement($e.a,{isGray:!0,icon:yt.a.random,onClick:this.handleRandomEmojiClick},r.createElement(se.b,{id:"mediaPicker.emojiTab.random",defaultMessage:"Random"})),this.props.onDelete&&!e.isMobile&&r.createElement($e.a,{isGray:!0,onClick:this.props.onDelete},r.createElement(se.b,{id:"mediaPicker.tabs.remove",defaultMessage:"Remove"}))),style:Ut({},o&&{borderBottom:"none"})})}}renderInputHeader(){const{device:e}=this.environment,t=this.getTabs().find(e=>e.type===this.props.currentTab),n=!e.isMobile||void 0;if(t&&"emoji"===t.type)return r.createElement("div",{style:{margin:e.isMobile?0:"10px 0"}},r.createElement(ye.a,{value:this.stores.emojiInputStore.state.inputValue,focusInitial:n,placeholder:At.a.formatMessage(Wt.filterPlaceholder),showClearButton:!0,left:yt.a.searchThick(this.getSearchIconStyle()),onChange:this.handleEmojiFilterChange,style:Ut({},e.isAndroid&&{borderBottom:"none"})}))}renderCurrentTab(){const e=this.getTabs().find(e=>e.type===this.props.currentTab);if(!e)return r.createElement(se.b,{defaultMessage:"Uh oh! Something went wrong.",id:"mediaPicker.errorMessage"});switch(e.type){case"embed":return this.renderEmbedTab(e);case"file":return this.renderUploadTab(e);case"emoji":return this.renderEmojiTab(e);case"gallery":return this.renderGalleryTab(e);case"unsplash":return this.renderUnsplashTab(e);case"drive":return this.renderGoogleDriveTab(e)}}renderEmojiTab(e){return r.createElement(dt.a,{onSubmit:e.onChange,filter:this.stores.emojiInputStore.state.inputValue,store:this.stores.emojiPickerStore,isCallout:this.props.isCallout})}renderGalleryTab(e){return r.createElement("div",{style:{paddingBottom:8}},u.map(ot.a,(t,n)=>r.createElement(fe.a,{key:n,title:r.createElement(Ot.a,{style:{marginLeft:-5},href:t.url,external:!0},r.createElement(Ct.a,null,At.a.formatMessage(t.title))),isTitleUppercase:!0,noTextOverflow:!0},r.createElement("div",{style:this.getGalleryWrapStyle()},t.items.map((t,n)=>{let{coverUrl:i,title:a,subtitle:s,position:o}=t;return r.createElement("div",{key:n,style:{width:"25%",padding:3}},r.createElement(pt.a,{originGap:0,placement:pt.a.Placement.Bottom,delayThreshold:600,renderTooltip:()=>r.createElement("div",{style:{maxWidth:180,whiteSpace:"normal"}},r.createElement("span",{style:{color:this.theme.regularInvertedTextColor}},At.a.formatMessage(a))," ",r.createElement("span",{style:{color:this.theme.mediumInvertedTextColor}},s&&At.a.formatMessage(s))),render:t=>r.createElement(wt.a,Object.assign({hoveredStyle:{opacity:.85}},t,{onClick:()=>{e.onChange({url:i,position:o})}}),r.createElement(kt.a,{url:i,width:200,isAuthenticated:!1,render:(e,t)=>t&&r.createElement(ut.a,{src:t,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center ".concat(100*(o||0),"%"),borderRadius:3}})}))}))})))))}renderUnsplashTab(e){const{device:t}=this.environment;return r.createElement("div",{style:{paddingBottom:8}},r.createElement(fe.a,{desktopStyle:{marginTop:8,marginBottom:6}},r.createElement(ye.a,{value:this.stores.unsplashInputStore.state.inputValue,placeholder:At.a.formatMessage(Wt.unsplashPlaceholder),showClearButton:!0,focus:!t.isMobile||void 0,onChange:e=>{this.stores.unsplashInputStore.setState(Ut({},this.stores.unsplashInputStore.state,{inputValue:e.target.value}))}})),r.createElement("div",{style:this.getGalleryWrapStyle()},r.createElement(Pt.a,{request:this.stores.unsplashInputStore.state.inputValue,debounce:Tt.b,performRequest:async e=>{const t=await V.Pb(this.environment,{query:e,page:0});if("success"===t.type)return t.data.results;throw t.error},render:(t,n,r)=>this.renderUnsplashResults(e,t,n,r)})))}renderUploadTab(e){const{data:t}=Et.a.state;return r.createElement(r.Fragment,null,e.fileUpload&&r.createElement(fe.a,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},r.createElement(ft.a,{title:r.createElement(se.b,{defaultMessage:"Choose a file",id:"mediaPicker.chooseFile.button.label"}),focused:!1,onClick:()=>this.handleUpload(e),fullWidth:this.props.isSmallWidth})),this.renderMediaCapture(e),e.caption&&r.createElement(ct.a,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}),e.preventUploadLimitFreeFileSize||t&&St.z(t)&&r.createElement("div",{style:{height:8}}),t&&!e.preventUploadLimitFreeFileSize&&!St.z(t)&&r.createElement(ct.a,{shouldWrapCaption:!0,caption:r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:this.props.isSmallWidth?"flex-start":"center"}},r.createElement("div",{style:{marginRight:6,color:this.theme.mediumTextColor}},r.createElement(se.b,{defaultMessage:"The maximum size per file is {filesize} MB.",id:"mediaPicker.maximumFileSize.notice",values:{filesize:ht.a}})),!l.b.isOnboarding.state&&r.createElement(mt.a,{subscriptionTier:St.k(this.environment)||"team",onClick:()=>{this.props.onCancel&&this.props.onCancel()},analyticsName:"media_picker",desktopStyle:{marginBottom:1}}))}))}renderMediaCapture(e){if(e.imageUpload||e.videoUpload)return r.createElement(fe.a,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},e.imageUpload&&r.createElement(ft.a,{title:r.createElement(se.b,{defaultMessage:"Choose an image",id:"mediaPicker.chooseImage.buttonText"}),focused:!1,onClick:()=>this.handleUpload(e,"image/*"),fullWidth:this.props.isSmallWidth}),e.videoUpload&&r.createElement(ft.a,{title:r.createElement(se.b,{defaultMessage:"Choose a video",id:"mediaPicker.chooseVideo.buttonText"}),focused:!1,onClick:()=>this.handleUpload(e,"video/*"),fullWidth:this.props.isSmallWidth}))}renderEmbedTab(e){const{device:t}=this.environment;return r.createElement(r.Fragment,null,r.createElement(fe.a,{desktopStyle:{marginTop:8,marginBottom:6}},r.createElement(ye.a,{type:"url",value:this.stores.embedInputStore.state.inputValue,placeholder:e.inputPlaceholder||At.a.formatMessage(Wt.embedPlaceholder),showClearButton:!0,focus:!t.isMobile||void 0,onSubmit:this.handleEmbedSubmit(e),onChange:e=>{this.stores.embedInputStore.setState(Ut({},this.stores.embedInputStore.state,{inputValue:e.target.value}))}})),r.createElement(fe.a,null,r.createElement(ft.a,{onClick:this.handleEmbedSubmit(e),focused:!1,title:e.buttonText||r.createElement(se.b,{defaultMessage:"Embed link",id:"mediaPicker.embedTab.embedLinkButtonText"}),fullWidth:this.props.isSmallWidth})),e.caption&&r.createElement(ct.a,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:t.isMobile?"left":"center"}}))}renderGoogleDriveTab(e){return r.createElement(Pt.a,{request:this.environment,performRequest:st.b,render:(t,n,i)=>{if(!i)return r.createElement(fe.a,null,r.createElement(xt.a,null));const a=n&&n.accounts?n.accounts:[];return this.renderGoogleDriveAccounts(e,a)}})}renderGoogleDriveAccounts(e,t){return 0===t.length?r.createElement(fe.a,null,r.createElement(jt.a,{title:r.createElement(se.b,{defaultMessage:"Connect Google account",id:"mediaPicker.menuItem.connectFirstGoogleAccount.label"}),onClick:()=>e.onSelect(),focused:!1,style:{color:this.theme.blueColor}}),r.createElement(ct.a,{shouldWrapCaption:!1,caption:r.createElement(se.b,{defaultMessage:"Find and embed your Google Drive files.",id:"mediaPicker.menuItem.connectFirstGoogleAccount.caption"})})):r.createElement(r.Fragment,null,r.createElement(fe.a,null,t.map((t,n)=>r.createElement(jt.a,{key:t.accountId,title:r.createElement(se.b,{defaultMessage:"Choose from {accountName}",id:"mediaPicker.menuItem.choosePagesFromAccount.label",values:{accountName:t.accountName}}),onClick:()=>e.onSelect(t),focused:!1}))),r.createElement(fe.a,{topBorder:!0},r.createElement(jt.a,{title:r.createElement(se.b,{defaultMessage:"Connect another account",id:"mediaPicker.menuItem.connectMoreGoogleAccounts.label"}),onClick:()=>e.onSelect(),style:{color:this.theme.mediumTextColor},focused:!1})))}getTabs(){return this.props.tabs}async handleUpload(e,t){const n=await ht.b({multiple:!1,accept:t});n.length&&e.onUpload(n[0])}getLoadingContainerStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",minHeight:320,flex:1}}getSearchIconStyle(){return{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,color:this.theme.regularIconColor}}getGalleryWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexWrap:"wrap",alignContent:"flex-start",background:this.theme.popoverBackground,paddingTop:e.isMobile?12:0,paddingBottom:e.isMobile?12:0,paddingLeft:e.isMobile?t.getSafePaddingLeftCSS(14):12,paddingRight:e.isMobile?t.getSafePaddingRightCSS(14):12,boxShadow:e.isMobile?"0 1px 0 ".concat(this.theme.regularDividerColor):""}}}var Nt=qt;class zt extends o.a{constructor(){super(...arguments),this.handleCloseOverlay=()=>{at.a()}}renderComponent(){const{device:e}=this.environment,{state:t}=Mt.a;return r.createElement(ge.c,{popupType:e.isMobile?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originRect:void 0,originGap:t.isActive?t.originGap:void 0,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Center,preventScaleTransition:!0,onDismiss:this.handleCloseOverlay,render:()=>{if(t.isActive)return r.createElement(Nt,Object.assign({},t,{onCancel:this.handleCloseOverlay}))}})}}var Vt=zt,Ht=n(215),Gt=n(11);class Yt extends o.a{constructor(){super(...arguments),this.handleDragOver=e=>{e.preventDefault(),this.startDrag(e),this.continueDragThrottled(e)},this.handleDrop=e=>{e.preventDefault();const t=Array.from(e.dataTransfer.files);t.length>0&&Gt.d(this.environment,e=>{Ht.d({environment:this.environment,files:t,analyticsFrom:"native_drag",transaction:e})})},this.startDrag=e=>{Ht.g(this.environment,{startX:e.clientX,startY:e.clientY,stores:[],isNativeDrag:!0,getGhostElement:void 0})&&p.e(this.environment)},this.continueDrag=e=>{this.cancelDragTimeout&&window.clearTimeout(this.cancelDragTimeout),this.cancelDragTimeout=window.setTimeout(this.cancelDrag,this.getCancelDragTimeoutMS()),Ht.e(this.environment,{currentX:e.clientX,currentY:e.clientY})},this.continueDragThrottled=u.throttle(this.continueDrag,Yt.dragOverThrottleMS),this.cancelDrag=()=>{Ht.a(this.environment)}}didMount(){super.didMount(),window.addEventListener("dragover",this.handleDragOver),window.addEventListener("drop",this.handleDrop)}willUnmount(){super.willUnmount(),window.removeEventListener("dragover",this.handleDragOver),window.removeEventListener("drop",this.handleDrop)}getCancelDragTimeoutMS(){const{device:e}=this.environment;return e.isLinux?2e3:200}}Yt.dragOverThrottleMS=62.5;var Qt=Yt,Kt=n(509),Zt=n(88),Xt=n(121),$t=n(27),Jt=n(420),en=n(46);class tn extends o.a{constructor(){super(...arguments),this.renderPopupContent=()=>r.createElement(rn,null)}renderComponent(){const{device:e}=this.environment,{blockStore:t,originRect:n}=Jt.a.state;return r.createElement(ge.c,{popupType:e.isMobile?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:Boolean(t),originRect:n,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Center,originGap:4,onDismiss:()=>Kt.a(this.environment),render:this.renderPopupContent})}}class nn extends o.a{constructor(){super(...arguments),this.handleRecordIconChange=e=>{const{blockStore:t}=Jt.a.state;if(t){const n=t.getIconStore();n&&Gt.d(this.environment,t=>{$t.c({store:n,value:e,transaction:t})})}}}didMount(){const{blockStore:e}=Jt.a.state;if(!e)return;const t=e.getTitleStore();t&&en.j({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{blockStore:t}=Jt.a.state;if(!t)return;const n=t.getTitleStore();if(!n)return;let i;return i=e.isMobile?{menuType:Se.b.MenuType.ActionSheet}:{menuType:Se.b.MenuType.Popup,width:380},r.createElement(Se.b,Object.assign({},i),r.createElement("div",{style:this.getWrapStyle()},this.renderIcon(t),r.createElement(Xt.a,{store:n,disabled:!t.canEdit(),onEsc:()=>Kt.a(this.environment),onEnter:()=>Kt.a(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Untitled",id:"renamePageMenuPopup.input.placeholder"}),style:this.getInputStyle()})))}renderIcon(e){const t={width:28,height:28,marginRight:6,flexShrink:0,flexGrow:0,boxShadow:"inset 0 0 0 1px ".concat(this.theme.darkDividerColor)};return e.canEdit()?r.createElement(Zt.a,{disabled:!1,bucket:"secure",icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t,onChange:this.handleRecordIconChange}):r.createElement(Zt.a,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t})}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const rn=Object(se.h)(nn);var an=tn,sn=n(856),on=n(288),ln=n(568),cn=n(272),dn=n(567),un=n(221);function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach((function(t){hn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const gn=[on.a.Open,on.a.Resolved];class bn extends o.a{constructor(){super(...arguments),this.handleChangeTab=e=>{const t=on.b.state;t.open&&on.b.setState(mn({},t,{tab:gn[e]}))}}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:Se.b.MenuType.Modal,title:r.createElement(se.b,{defaultMessage:"Discussion",id:"blockDiscussionMenu.mobileMenu.title"}),header:this.renderMenuHeader(),right:r.createElement(Ce.DoneMenuText,null),onClickRight:cn.a,whiteBackground:!0}:{menuType:Se.b.MenuType.Popup,header:this.renderMenuHeader(),width:480,maxHeight:"50vh",onClickOutside:cn.a},r.createElement(Ye.a,{capture:!0},r.createElement(un.a,{capture:!0,render:()=>r.createElement(ve.a,{capture:!0,onEsc:cn.a},r.createElement(Se.b,Object.assign({},t),this.renderMenuContent()))}))}renderMenuHeader(){const{device:e}=this.environment,t=oe.m(this.props.blockStore).length,n=oe.l(this.props.blockStore).length;return r.createElement(gt.a,{tabs:[t?r.createElement(se.b,{defaultMessage:"Open ({numberOfOpenDiscussions})",id:"blockDiscussionMenu.openDiscussionsTab.title",values:{numberOfOpenDiscussions:t}}):r.createElement(se.b,{defaultMessage:"Open",id:"blockDiscussionMenu.openDiscussionsTabEmpty.title"}),n?r.createElement(se.b,{defaultMessage:"Resolved ({numberOfResolvedDiscussions})",id:"blockDiscussionMenu.resolvedDiscussionsTab.title",values:{numberOfResolvedDiscussions:n}}):r.createElement(se.b,{defaultMessage:"Resolved",id:"blockDiscussionMenu.resolvedDiscussionsTabEmpty.title"})],selectedIndex:gn.indexOf(this.props.tab),onChange:this.handleChangeTab,style:mn({},e.isAndroid&&{borderBottom:"none"})})}renderMenuContent(){const{device:e}=this.environment;if(this.props.tab===on.a.Open){const t=oe.m(this.props.blockStore);if(t.length){const n=t.map((e,t,n)=>r.createElement(ln.a,{key:e.id,store:e,format:ln.a.Format.Menu,isFirst:0===t,isOnly:1===n.length,discussionLocation:"block_menu",alwaysShowResolve:!0,blockStore:this.props.blockStore,onDismiss:cn.a})),i=this.props.blockStore.getType(),a=i&&b.q[i];if(e.isMobile&&a){const e=dn.a(this.props.blockStore);return e?r.createElement(r.Fragment,null,r.createElement("div",{style:{padding:"12px 16px",boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}},r.createElement(e,{store:this.props.blockStore,disabled:!0,hideContent:!0,style:{fontSize:14,pointerEvents:"none"},isQuickFind:!0})),n):n}return n}return this.renderEmptyState(r.createElement(se.b,{defaultMessage:"No comments to show.",id:"blockDiscussionMenu.emptyState.noCommentsMessage"}))}{const e=oe.l(this.props.blockStore);return e.length?e.map((e,t,n)=>r.createElement(ln.a,{key:e.id,store:e,format:ln.a.Format.Menu,isFirst:0===t,isOnly:1===n.length,discussionLocation:"block_menu",alwaysShowResolve:!0,blockStore:this.props.blockStore,onDismiss:cn.a})):this.renderEmptyState(r.createElement(se.b,{defaultMessage:"No resolved comments.",id:"blockDiscussionMenu.emptyStatte.noResolvedCommentsMessage"}))}}renderEmptyState(e){const{device:t}=this.environment;return r.createElement("div",{style:{textAlign:"center",padding:t.isMobile?"64px 18px":"32px 18px 36px",fontSize:14,color:this.theme.mediumTextColor}},e)}}var fn=bn;class yn extends o.a{constructor(){super(...arguments),this.renderDiscussionMenu=()=>{if(on.b.state.open)return r.createElement(fn,{rect:on.b.state.rect,tab:on.b.state.tab,blockStore:on.b.state.blockStore})}}renderComponent(){const{device:e}=this.environment,{open:t,rect:n}=on.b.state;return r.createElement(ge.c,{popupType:e.isMobile?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t,originRect:n,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Center,disableMouseCapture:!0,originGap:4,render:this.renderDiscussionMenu,preventScaleTransition:!0,preventOpacityTransition:!0,onDismiss:cn.a})}}var Sn=yn,vn=n(54),En=n(512),Mn=n(391),wn=n(860),Cn=n(290);class On extends o.a{constructor(){super(...arguments),this.renderDiscussionInput=()=>{if(Cn.a.state.open){const{blockStore:e,discussionInputStore:t}=Cn.a.state;return r.createElement(wn.a,{capture:!0},r.createElement(un.a,{capture:!0,render:()=>r.createElement("div",{style:this.getStyle()},r.createElement(En.a,{parentStore:e,onCancel:this.handleDismiss,onSubmit:this.handleSubmit,discussionInputStore:t,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1}))}))}},this.handleSubmit=()=>{const e=Cn.a.state;if(e.open){const t=e.discussionInputStore.state.textStore.getValue();t&&t.length>0&&("inline"===e.type?Gt.d(this.environment,n=>{Mn.c({environment:this.environment,textStore:e.textStore,selection:e.selection,commentTextValue:t,transaction:n})}):"block"===e.type&&Gt.d(this.environment,n=>{Mn.b({environment:this.environment,blockStore:e.blockStore,commentTextValue:t,transaction:n})})),Mn.a(this.environment)}},this.handleDismiss=()=>{const e=Cn.a.state;if(e.open){const t=e.discussionInputStore.state.textStore.getValue();t&&t.length>0?vn.c({message:r.createElement(se.b,{id:"newDiscussionMenu.discardCommentConfirmationDialog.prompt",defaultMessage:"Do you want to discard the comment?"}),showCancel:!0,keepFocus:!0,items:[{label:r.createElement(se.b,{id:"newDiscussionMenu.discardCommentConfirmationDialog.discardButton.label",defaultMessage:"Discard"}),color:"red",onAccept:()=>Mn.a(this.environment)}]}):Mn.a(this.environment)}}}renderComponent(){const{device:e}=this.environment,{open:t,rect:n}=Cn.a.state;return r.createElement(ge.c,{popupType:e.isReactNative?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,keepFocus:!0,open:t,originRect:n,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Center,originGap:4,onDismiss:this.handleDismiss,render:this.renderDiscussionInput})}getStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{width:e.isReactNative?"100%":470,maxWidth:e.isMobileBrowser?"90vw":"100%",paddingTop:8,paddingBottom:e.isAndroid?12:8,paddingLeft:e.isReactNative?t.getSafePaddingLeftCSS(10):10,paddingRight:e.isReactNative?t.getSafePaddingRightCSS(10):10}}}var kn=On,Pn=n(466),Tn=n(474);class Dn extends o.a{constructor(){super(...arguments),this.renderDiscussion=()=>{const{device:e}=this.environment;if(Tn.a.state.open){const{discussionStore:t,discussionInputStore:n,blockStore:i}=Tn.a.state;let a;return a=e.isMobile?{menuType:Se.b.MenuType.Modal,title:r.createElement(se.b,{defaultMessage:"Discussion",id:"discussion.mobileReplyMenu.title"}),right:r.createElement(se.b,{defaultMessage:"Close",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>Pn.a(this.environment),whiteBackground:!0}:{menuType:Se.b.MenuType.Popup,width:420,maxWidth:e.isMobileBrowser?"80vw":"100%"},r.createElement(Se.b,Object.assign({},a),r.createElement(un.a,{capture:!0,render:()=>r.createElement(ln.a,{store:t,discussionInputStore:n,onDismiss:()=>Pn.a(this.environment),format:ln.a.Format.Menu,isFirst:!0,isOnly:!0,discussionLocation:"reply_menu",alwaysShowResolve:!0,blockStore:i})}))}}}renderComponent(){const{device:e}=this.environment,{open:t,rect:n}=Tn.a.state;return r.createElement(ge.c,{popupType:e.isMobile?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t,originRect:n,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Center,originGap:4,onDismiss:()=>Pn.a(this.environment),render:this.renderDiscussion})}}var In=Dn,jn=(n(326),n(169),n(364)),xn=n(55),Bn=n(590),An=n(285),Fn=n(154),Rn=n(297),Ln=n(746),Un=n(756),_n=n(4),Wn=n(689),qn=n(206),Nn=n(80),zn=n(849),Vn=n(188),Hn=n(687),Gn=n(29),Yn=n(37),Qn=n(108),Kn=n(764),Zn=n(38),Xn=n(139),$n=n(229),Jn=n(155),er=n(368),tr=n(73),nr=n(591),rr=(n(366),n(79));function ir(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ar(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const sr=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ir(Object(n),!0).forEach((function(t){ar(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ir(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Ke.a.textOverflowStyle,{fontWeight:Ke.a.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"});function or(e){const{pageTitle:t}=e;return t?r.createElement(se.b,{defaultMessage:"New “{filterText}” page in…",id:"createPageMenuItem.title.withPageName",values:{filterText:r.createElement("span",{style:sr},t)}}):r.createElement(se.b,{defaultMessage:"Add new page in…",id:"createPageMenuItem.title.withoutPageName"})}function lr(e){const{pageTitle:t}=e;return t?r.createElement(se.b,{defaultMessage:"New “{filterText}” sub-page",id:"createSubpageMenuItem.title.withPageName",values:{filterText:r.createElement("span",{style:sr},t)}}):r.createElement(se.b,{defaultMessage:"Add new sub-page",id:"createSubpageMenuItem.title.withoutPageName"})}o.a;var cr=n(258),dr=n(20),ur=n(92),pr=n(1291),mr=n(247),hr=n(255),gr=n(134);function br(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?br(Object(n),!0).forEach((function(t){yr(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):br(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Sr=Object(se.g)({mentionAll:{defaultMessage:"Mention a person, page, or date…",id:"mentionMenu.personPageDate.prompt2"},mentionPersonPage:{defaultMessage:"Mention a person or page…",id:"mentionMenu.personPage.prompt2"},mentionPersonDate:{defaultMessage:"Mention a person or date…",id:"mentionMenu.personDate.prompt2"},mentionPageDate:{defaultMessage:"Mention a page or date…",id:"mentionMenu.pageDate.prompt2"},mentionPerson:{defaultMessage:"Mention a person…",id:"mentionMenu.person.prompt2"},mentionDate:{defaultMessage:"Mention a date…",id:"mentionMenu.date.prompt2"},mentionPage:{defaultMessage:"Type to link or add page…",id:"mentionMenu.page.prompt2"},addPage:{defaultMessage:"Type to add or link page…",id:"mentionMenu.addPage.prompt2"}}),vr=Object(se.g)({autocompleteToday:{defaultMessage:"Today",id:"mentionMenu.date.autocomplete.today"},autocompleteNextTuesday:{defaultMessage:"Next Tuesday 3pm",id:"mentionMenu.date.autocomplete.nextTuesday"},autocompleteReminder:{defaultMessage:"Remind tomorrow 9am",id:"mentionMenu.date.autocomplete.reminder"},reminder:{defaultMessage:"Remind {dateTime}",id:"mentionMenu.date.remindAtDateTime",description:"dateTime will be a message representing the date (with or without time) that the user wants to be reminded at, like 'Tomorrow 3pm' or 'Mar 1, 2020'"},noResults:{defaultMessage:"No results",id:"mentionMenu.noSearchResults.title",description:"A label describing that no results have been found."}});class Er extends o.a{constructor(){super(...arguments),this.storeTypes={ignoreSelectionAreaStore:nr.a,localPageMentionRequestStore:hr.a,localCachePageMentionRequestStore:hr.a},this.renderMentionResult=(e,t)=>{const{intl:n}=this.props,i=Vn.a.state,a=i.open&&i.insertionType,s={sections:[],nextSectionShouldHaveTopBorder:()=>s.sections.length>0,addSection(e){e&&this.sections.push(e)}};"+"===a&&s.addSection(this.getCreatePageMenuSection(s.nextSectionShouldHaveTopBorder())),s.addSection(this.getDateResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),s.addSection(this.getUserResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),s.addSection(this.getBotResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),s.addSection(this.getPageResultsMenuSection(t,s.nextSectionShouldHaveTopBorder())),("@"===a&&this.filterStore.state||"[["===a)&&s.addSection(this.getCreatePageMenuSection(s.nextSectionShouldHaveTopBorder()));const{sections:o}=s;let l,c;if(Nn.a.state.online){const e=i.mentionTypes.user,t=i.mentionTypes.page,r=i.mentionTypes.date;let a="";const s=Sr;e&&t&&r?a=n.formatMessage(s.mentionAll):e&&t?a=n.formatMessage(s.mentionPersonPage):e&&r?a=n.formatMessage(s.mentionPersonDate):t&&r?a=n.formatMessage(s.mentionPageDate):e?a=n.formatMessage(s.mentionPerson):r?a=n.formatMessage(s.mentionDate):t&&i&&(a=i.open&&"+"===i.insertionType?n.formatMessage(Sr.addPage):n.formatMessage(s.mentionPage)),this.setTemporaryInputData({title:a,icon:this.renderTemporaryInputEmptyIcon(),allowTabCompletion:!1}),l=void 0}else l=r.createElement(Fn.a,{title:r.createElement(se.b,{defaultMessage:"Please go online to mention a person or page.",id:"mentionMenu.offlineMessage"})});0===o.length&&(c=r.createElement(fe.a,null,r.createElement(Fn.a,{title:r.createElement(se.b,Object.assign({},vr.noResults))})));const{device:d}=this.environment;let u;return u=this.isActionSheet()?{menuType:Se.b.MenuType.ActionSheet,disableBottomPadding:!0}:{menuType:Se.b.MenuType.Popup,width:this.getMenuDesktopWidth(),maxHeight:d.isMobile?"30vh":"40vh",onClickOutside:jn.d},r.createElement(Se.b,Object.assign({},u,{header:l}),r.createElement(ve.a,{capture:Vn.a.state.open,onBackspace:this.shouldCaptureBackspace()?this.handleEmptyBackspace:void 0,onTab:this.handleTab}),r.createElement(xn.a,{type:xn.a.Type.Vertical,initialFocus:this.getMenuInitialFocus(),sections:o,onEmptyEnter:this.handleCancel}),c)},this.handleCreateInAutocompleteQueryChange=e=>{this.updateOpenState({createInQuery:e})},this.renderCreateInMenu=()=>{const e=Vn.a.state;if(!e.open)return;const t="block"===e.textStore.table?e.textStore.id:void 0;return r.createElement(Ln.a,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:e=>{jn.b({environment:this.environment,titleText:this.getNormalizedFilter(),ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,createInValue:e})},captureSelection:!0,restoreSelection:!0,parentBlockId:t,onAutocompleteQueryChange:this.handleCreateInAutocompleteQueryChange,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,autocompleteQuery:e.createInQuery,desktopWidth:this.getMenuDesktopWidth(),onCancel:this.handleCreateInCancel})},this.handleCreateInStart=()=>{this.updateOpenState({showCreateIn:!0})},this.handleCreateInCancel=()=>{this.updateOpenState({showCreateIn:!1,createInQuery:""})},this.handleEmptyBackspace=e=>{this.shouldCaptureBackspace()&&e.preventDefault(),this.handleCancel()},this.handleCancel=()=>{jn.d()},this.handleTab=e=>{e.preventDefault();const t=this.tabCompletionString;if(!t)return;const n=Gn.a.state;if("editing"!==n.mode)return;const r=Vn.a.state;r.open&&r.textStore===n.store&&Gt.d(this.environment,e=>{tr.n({environment:this.environment,transaction:e,string:t,store:n.store,selection:n.selection,disableMentions:!0,disableDateMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0})})},this.tabCompletionString=void 0,this.letterCharacterClass=(()=>{try{return/(?:[A-Za-z\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u1884\u1887-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u212F-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2183\u2184\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2E2F\u3005\u3006\u3031-\u3035\u303B\u303C\u3041-\u3096\u309D-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6E5\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7C6\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB67\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF40\uDF42-\uDF49\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2]|\uD808[\uDC00-\uDF99]|\uD809[\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D])/}catch(e){return/[a-zA-Z]/}})(),this.inputSelectionsStore=this.createComputedStore(()=>{const e=Vn.a.state;if(e.open)return Un.c(e.textStore,e.oldTextValue,e.insertionType)}),this.filterStore=this.createComputedStore(()=>{const e=this.inputSelectionsStore.state,t=Vn.a.state;if(e&&t.open)return Un.b(t.textStore,e)}),this.popupOpenStore=this.createComputedStore(()=>{const e=Vn.a.state;return!!e.open&&("+"!==e.insertionType||""!==this.getNormalizedFilter())}),this.performUserMentionRequest=async e=>{const t=Vn.a.state;if(!t.open)return;const n=t.mentionTypes.user?await this.getUserResults(e):[];return""===e?n.slice(0,2):n.slice(0,20)},this.performBotMentionRequest=async e=>{const t=Vn.a.state;if(!t.open)return;const n=t.mentionTypes.bot?await this.getBotResults(e):[];return""===e?n.slice(0,2):n.slice(0,20)},this.performLocalCachePageMentionRequest=async()=>{const{currentSpaceStore:e,currentSpaceViewStore:t}=L.a.state;if(e)return Hn.h({environment:this.environment,currentSpaceStore:e,currentSpaceViewStore:t})},this.performLocalPageMentionRequest=async e=>{const{localCachePageMentionRequestStore:t}=this.stores,n=t.state.result;if(!n)return;const r=await Hn.g({input:e,cache:n});if(!r)return;if(0===r.results.length)return{error:mr.d.NoResults};const i=P.d();if(!i)return;const a=Hn.n({sort:e.query.sort,unsorted:r.results,batchSize:pr.b,currentUserId:this.environment.currentUser.id}).results.map(e=>fr({},e,{store:g.a.createChildStore(i,{table:b.b,id:e.id})}));return{value:{total:a.length,results:a}}},this.performPageMentionRequest=async e=>{const t=Vn.a.state;if(!t.open)return[];const n=t.mentionTypes.page?await this.getPageResults(e):[];return""===e?n.slice(0,2):n.slice(0,20)},this.getUserResults=async e=>{if(Nn.a.state.online){return await Tt.l({environment:this.environment,query:e,membersOnly:!1})}return[]},this.getBotResults=async e=>{if(!("has-alpha-api"===Qn.a.getGroup(this.environment,"alpha-api")))return[];if(Nn.a.state.online){return await Tt.j({environment:this.environment,query:e})}return[]},this.getPageResults=async e=>{if(!Nn.a.state.online)return[];const t=Vn.a.state,n=t.open&&Object(oe.n)(t.textStore)&&t.textStore;return await Tt.e({nearBlock:n||void 0,environment:this.environment,query:e,source:"mention_menu",limit:20})},this.getDateResults=e=>{const t=Vn.a.state;if(!t.open)return[];const{intl:n}=this.props,r=t.mentionTypes.reminder;return t.mentionTypes.date?function(e,t,n){if(0===e.length)return u.compact([{label:n.formatMessage(vr.autocompleteToday),value:()=>X.nb(X.m)},t?void 0:{label:n.formatMessage(vr.autocompleteNextTuesday),value:()=>{const e=X.ob(X.m),t=e.clone().day(2);return t.isSameOrBefore(e)&&t.add(1,"week"),t.add(1,"week"),t.hour(15),{type:"datetime",start_date:t.format(X.ib),start_time:t.format(X.kb),time_zone:X.m}}},t?{label:n.formatMessage(vr.autocompleteReminder),value:()=>({type:"datetime",start_date:X.pb(X.m).start_date,start_time:"09:00",reminder:{unit:"day",value:0,time:X.w},time_zone:X.m})}:void 0]);const r=t?Object(Wn.e)(e,n):Object(Wn.d)(e,n);if(r){let e=Object(qn.a)({value:r,date_format:"relative",userTimeZone:X.m,intl:n,allowRelativeDates:!0});return r.reminder&&(e=n.formatMessage(vr.reminder,{dateTime:e})),[{label:e,value:()=>r}]}return[]}(e,r,n).slice(0,6):[]}}willMountOrUpdate(){const e=Vn.a.state,t=this.filterStore.state;if(e.open){const n=Gn.a.state,r="editing"===n.mode&&n.store===e.textStore,i=this.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,a=i&&"editing"===i.mode&&i.store===e.textStore;if(!r&&!a)return void jn.d();const s=r&&"editing"===n.mode&&n.selection,o=this.inputSelectionsStore.state;if(o&&s&&(s.startIndex<o.filter.startIndex||s.endIndex>o.filter.endIndex))return void jn.d();const l=this.filterStore.state&&this.filterStore.state[0];if("+"===e.insertionType&&l&&!l.match(this.letterCharacterClass))return void jn.d();if(void 0===t)return void jn.d()}}renderComponent(){const{device:e}=this.environment,t=Vn.a.state,n=zn.a.findComponent(e=>e.props.capture),i=this.popupOpenStore.state;let a;if(n&&e.isMobile){const e=n.stores.store.state.rect;e&&(a={height:"calc(100vh - ".concat(e.height,"px)")})}const s=t.open&&t.showCreateIn;return r.createElement(ge.c,{popupType:this.isActionSheet()?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:i,originRect:t.open?t.selectionRect:void 0,slideUpWrapStyle:a,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Start,originGap:8,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,disableDarkOverlayBackground:e.isMobile&&!n,keepFocus:!0,render:()=>e.isMobile?r.createElement(r.Fragment,null,this.renderMentionSearch(),r.createElement(ge.c,{popupType:ge.c.PopupType.SlideUp,render:this.renderCreateInMenu,open:s,keepFocus:!0})):s?this.renderCreateInMenu():this.renderMentionSearch()})}renderMentionSearch(){const e=this.getNormalizedFilter(),t=Vn.a.state,n=gr.a.createMetric("rum.mention_menu_ready");return r.createElement(Pt.a,{requestStore:t.userRequestStore,request:e,performRequest:this.performUserMentionRequest,render:i=>r.createElement(Pt.a,{requestStore:t.botRequestStore,request:e,performRequest:this.performBotMentionRequest,render:a=>r.createElement(Pt.a,{requestStore:t.pageRequestStore,request:e,performRequest:this.performPageMentionRequest,debounce:Tt.b,render:t=>r.createElement(Pt.a,{requestStore:this.stores.localCachePageMentionRequestStore,request:L.a.state.currentSpaceStore&&L.a.state.currentSpaceStore.id,performRequest:this.performLocalCachePageMentionRequest,render:s=>r.createElement(Pt.a,{requestStore:this.stores.localPageMentionRequestStore,debounce:Tt.a,request:{query:{text:e,filters:mr.e({isDeletedOnly:!1,isNavigableOnly:!0,excludeTemplates:!0,requireEditPermissions:void 0}),sort:"Relevance"},limit:5},performRequest:this.performLocalPageMentionRequest,render:e=>this.renderMentionResult(i||a||t||e,this.getCurrentMentionResults(n))})})})})})}getDateResultsMenuSection(e,t){const{dateResults:n}=e;if(0!==n.length)return this.applySectionLimit("date",{key:"date results",render:e=>r.createElement(fe.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Date",id:"mentionMenu.dateSection.title"}),topBorder:t,isTitleUppercase:!0})),items:n.map(e=>{let{label:t,value:n}=e;return{key:t,render:e=>(e.focused&&this.setTemporaryInputData({title:t,icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),r.createElement(jt.a,Object.assign({},e,{title:t}))),action:()=>{Gt.d(this.environment,e=>{jn.a({environment:this.environment,annotation:["d",fr({},n(),{date_format:"relative"})],transaction:e})})}}})})}renderSpinner(e){return r.createElement(Rn.a,{show:e,showDelay:500,showHold:300,render:e=>r.createElement(Dt.a,{style:{textAlign:"center",visibility:e?"visible":"hidden",display:"inline",marginLeft:8}})})}renderTemporaryInputEmptyIcon(){const e=Vn.a.state;if(e.open)return"+"===e.insertionType?this.renderTemporaryInputAddIcon():r.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},yt.a.searchThick())}renderTemporaryInputAddIcon(){return r.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},yt.a.plus())}renderTemporaryInputPageIcon(e){const t=e.getValue();if(t)return Object(Xn.h)({pageValue:t,showEmojiInline:!0,emojiType:Object($n.a)(this.environment),baseUrl:Y.a.baseURL,getRecordValue:e.getRecordValue,isClient:!0,isSafariOrIOS:this.environment.device.isSafari||this.environment.device.isIOS,currentUserId:this.environment.currentUser.id})}renderTemporaryInputAtMentionIcon(){return r.createElement("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},yt.a.at())}getUserResultsMenuSection(e,t){const{userResults:n}=e;if(0!==n.length)return this.applySectionLimit("user",{key:"user results",render:e=>r.createElement(fe.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"People",id:"mentionMenu.peopleSection.title"}),topBorder:t,isTitleUppercase:!0})),items:u.compact(n.map(e=>({key:e.id,render:t=>(t.focused&&this.setTemporaryInputData({title:Object(Yn.d)(e),icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),r.createElement(Bn.a,Object.assign({},t,{user:e}))),action:()=>{Gt.d(this.environment,t=>{jn.a({environment:this.environment,annotation:Object(_n.n)(e.id),transaction:t})})}})))})}getBotResultsMenuSection(e,t){const{botResults:n}=e;if(0!==n.length)return this.applySectionLimit("bot",{key:"bot results",render:e=>r.createElement(fe.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Bots",id:"mentionMenu.botsSection.title"}),topBorder:t,isTitleUppercase:!0})),items:u.compact(n.map(e=>({key:e.id,render:t=>(t.focused&&this.setTemporaryInputData({icon:this.renderTemporaryInputAtMentionIcon(),title:Object(Jn.a)(e),allowTabCompletion:!0}),r.createElement(Kn.a,Object.assign({},t,{bot:e}))),action:()=>{Gt.d(this.environment,t=>{jn.a({environment:this.environment,annotation:Object(_n.c)(e.id),transaction:t})})}})))})}getPageResultsMenuSection(e,t){const{pageResults:n}=e,i=r.createElement(r.Fragment,null,0===n.length?r.createElement(se.b,Object.assign({},vr.noResults)):r.createElement(se.b,{defaultMessage:"Link to page",id:"mentionMenu.pagesSection.title2"}),this.renderSpinner(Vn.a.state.pageRequestStore.state.loading));return this.applySectionLimit("page",{key:"page results",render:e=>r.createElement(fe.a,Object.assign({},e,{title:i,topBorder:t,isTitleUppercase:!0})),items:u.compact(n.map(e=>{const t=P.d();if(!t)return;const n=g.a.createChildStore(t,{table:b.b,id:e});return{key:e,render:e=>{if(e.focused){const e=n.getValue();if(e){const t=Object(Zn.h)({table:n.table,value:e,getRecordValue:n.getRecordValue,userTimeZone:X.m,intl:this.props.intl});this.setTemporaryInputData({title:t||"",icon:this.renderTemporaryInputPageIcon(n),allowTabCompletion:!0})}}return r.createElement(An.a,Object.assign({},e,{store:n}))},action:()=>{Gt.d(this.environment,t=>{jn.a({environment:this.environment,annotation:["p",e],transaction:t})})}}}))})}getCreatePageMenuSection(e){if(!this.canCreatePage())return;const t=Vn.a.state;if(!t.open)return;const{intl:n}=this.props,i=this.getNormalizedFilter(),a="@"===t.insertionType?r.createElement(se.b,{id:"mentionMenu.createPageSection.title",defaultMessage:"New page"}):void 0;return{key:"create page",render:t=>r.createElement(fe.a,Object.assign({title:a,isTitleUppercase:!0},t,{topBorder:e})),items:[{key:"add new subpage",action:async()=>{const e=Object(er.c)(t.textStore);e&&await jn.b({environment:this.environment,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,titleText:this.getNormalizedFilter(),createInValue:e.createInValue,onPageCreated:e=>{e&&""===_n.X(e.getTitleValue())&&Q.h({environment:this.environment,store:e})}})},render:e=>{e.focused&&this.setTemporaryInputData({title:0===i.length?n.formatMessage(Sr.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=t=>r.createElement(jt.a,Object.assign({},Object(ur.a)(t||{},e),{icon:yt.a.plus({width:16}),title:r.createElement(lr,{pageTitle:this.getNormalizedFilter()})}));return this.environment.device.isMobile?t():r.createElement(pt.a,{renderTooltip:()=>r.createElement(cr.a,{imageURL:dr.a.images.tooltips.pageMenu.newSubpagePng,imageWidth:140,imageHeight:100,caption:r.createElement(se.b,Object.assign({},Ln.b.createSubpage))}),placement:pt.a.Placement.Right,delayThreshold:0,render:e=>t(e)})}},{key:"open create in menu",action:this.handleCreateInStart,render:e=>{e.focused&&this.setTemporaryInputData({title:0===i.length?n.formatMessage(Sr.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=r.createElement(or,{pageTitle:this.getNormalizedFilter()}),a=n=>r.createElement(jt.a,Object.assign({},Object(ur.a)(n||{},e),{icon:yt.a.alias({width:16}),title:t}));return this.environment.device.isMobile?a():r.createElement(pt.a,{renderTooltip:()=>r.createElement(cr.a,{imageURL:dr.a.images.tooltips.pageMenu.newPageInPng,imageWidth:140,imageHeight:100,caption:r.createElement(se.b,Object.assign({},Ln.b.newPageIn))}),placement:pt.a.Placement.Right,delayThreshold:0,render:e=>a(e)})}}]}}applySectionLimit(e,t){const n=Vn.a.state;if(!n.open)return t;if(n.expandSection&&n.expandSection===e)return t;const{items:i}=t,a=this.environment.device.isPhone?3:5;return i.length<=a?t:fr({},t,{items:[...i.slice(0,a),{key:"show more",render:e=>r.createElement(jt.a,Object.assign({},e,{icon:yt.a.dots({width:16,fill:this.theme.mediumTextColor}),title:r.createElement("span",{style:{color:this.theme.mediumTextColor}},r.createElement(se.b,{defaultMessage:"{numberMore} more results",id:"mentionMenu.showMoreResultsButton.title",values:{numberMore:i.length-a}}))})),action:()=>{this.updateOpenState({expandSection:e})}}]})}updateOpenState(e){const t=Vn.a.state;t.open&&Vn.a.setState(fr({},t,{},e))}getNormalizedFilter(){const e=this.filterStore.state;return e?Vn.a.state.open&&"[["===Vn.a.state.insertionType&&e.endsWith("]]")?e.slice(0,-2).trim():e.trim():""}setTemporaryInputData(e){const t=Vn.a.state;if(!t.open)return;if(!e)return void t.temporaryInputData.set(void 0);const{device:n}=this.environment,{title:r,icon:i,allowTabCompletion:a}=e,s=this.filterStore.state||"",o=r.toLowerCase().startsWith(s)?r.slice(s.length):"";this.tabCompletionString=a?o:void 0;const l=n.isFirefox?void 0:i;t.temporaryInputData.set({prefix:t.insertionType,suffix:"[["===t.insertionType&&s.endsWith("]]")?"]]":"",completion:o,prefixIcon:l})}getCurrentMentionResults(e){const t=Vn.a.state,n=t.userRequestStore.state.result||[],r=t.botRequestStore.state.result||[],i=t.pageRequestStore.state.result||[],a=this.getDateResults(this.getNormalizedFilter());let s=i;const{result:o}=this.stores.localPageMentionRequestStore.state;if(o&&!o.error){const e=o.value.results,t=P.d();s=t?Hn.b({environment:this.environment,isOnline:Nn.a.state.online,results:{local:e,server:i.map(e=>fr({},e,{store:g.a.createChildStore(t,{table:b.b,id:e.id})}))}})||[]:e}const l=t.userRequestStore.state.ready&&t.botRequestStore.state.ready&&t.pageRequestStore.state.ready;return l&&gr.a.emit(this.environment,e),{userResults:n,botResults:r,pageResults:s.map(e=>e.id),dateResults:a,ready:l}}canCreatePage(){return!!Vn.a.state.mentionTypes.createPage}isActionSheet(){const{device:e}=this.environment;return e.isReactNative&&!e.isTablet}shouldCaptureBackspace(){return""===this.filterStore.state}getMenuInitialFocus(){if(""!==this.getNormalizedFilter())return 0}getMenuDesktopWidth(){return 330}}var Mr=Object(se.h)(Er);var wr=n(464),Cr=n(563),Or=n(172),kr=n(238);class Pr extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=kr.a.state;if(!t.open)return;const n=this.getSections(t),i=this.getFilter(t);let a;return a=e.isReactNative&&!e.isTablet?{menuType:Se.b.MenuType.ActionSheet}:{menuType:Se.b.MenuType.Popup,width:324,maxHeight:"40vh",onClickOutside:wr.d},r.createElement(Se.b,Object.assign({},a),r.createElement(he.a,{sections:n,onAccept:this.handleAccept,context:{environment:this.environment,blocks:y.b.state.stores,originRect:t.selectionRect},filter:i,initialFocus:0,onEmptyEnter:this.handleCancel,useLimit:!0}))},this.handleCancel=()=>{wr.d()},this.handleAccept=e=>{const t=y.b.state.stores[0];t&&be.o(this.environment,{analyticsName:e.analyticsName,from:"slash_menu",block_type:t.getType()}),Gt.d(this.environment,e=>{wr.a({environment:this.environment,transaction:e})})}}willMountOrUpdate(){const e=kr.a.state;if(e.open){const t=Gn.a.state,n=this.getFilter(e),r=Object(Cr.a)(this.getSections(e),{blocks:y.b.state.stores,environment:this.environment},n||"");("editing"!==t.mode||t.store!==e.textStore||Un.d(n,!0,r.length))&&wr.d()}}renderComponent(){const{device:e}=this.environment,t=kr.a.state;return r.createElement(ge.c,{popupType:e.isReactNative&&!e.isTablet?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,render:this.renderMenu})}getFilter(e){return Un.a(e.textStore,e.oldTextValue,!e.isAddMenu)}getSections(e){return e.isAddMenu?Or.i:Or.n}}var Tr=Pr,Dr=n(635),Ir=n(165),jr=n(6),xr=n(31),Br=n(266),Ar=n(173);const Fr=Object(se.g)({image:{defaultMessage:"Embed image",id:"embedMenu.action.image"},video:{defaultMessage:"Embed video",id:"embedMenu.action.video"},tweet:{defaultMessage:"Embed Tweet",id:"embedMenu.action.tweet"},drive:{defaultMessage:"Embed Google Drive",id:"embedMenu.action.drive"},gist:{defaultMessage:"Embed GitHub Gist",id:"embedMenu.action.gist"},figma:{defaultMessage:"Embed Figma",id:"embedMenu.action.figma"},invision:{defaultMessage:"Embed Invision project",id:"embedMenu.action.invision"},abstract:{defaultMessage:"Embed Abstract project",id:"embedMenu.action.abstract"},framer:{defaultMessage:"Embed Framer prototype",id:"embedMenu.action.framer"},whimsical:{defaultMessage:"Embed Whimsical board",id:"embedMenu.action.whimsical"},miro:{defaultMessage:"Embed Miro board",id:"embedMenu.action.miro"},audio:{defaultMessage:"Embed audio",id:"embedMenu.action.audio"},maps:{defaultMessage:"Embed Google Map",id:"embedMenu.action.maps"},loom:{defaultMessage:"Embed Loom",id:"embedMenu.action.loom"},typeform:{defaultMessage:"Embed Typeform",id:"embedMenu.action.typeform"},codepen:{defaultMessage:"Embed CodePen",id:"embedMenu.action.codepen"},pdf:{defaultMessage:"Embed PDF",id:"embedMenu.action.pdf"},embed:{defaultMessage:"Create embed",id:"embedMenu.action.createEmbed"}}),Rr=Object(se.g)({linkToPage:{defaultMessage:"Link to page",id:"embedMenu.actions.linkToPage.title"},mentionPage:{defaultMessage:"Mention page",id:"embedMenu.actions.mentionPage.title"},createLinkedDatabase:{defaultMessage:"Create linked database",id:"embedMenu.actions.createLinkedDatabase.title"},bookmarkMenuItem:{defaultMessage:"Create bookmark",id:"embedMenu.actions.createBookmark.title"},dismissItem:{defaultMessage:"Dismiss",id:"embedMenu.actions.dismiss.title"}}),Lr={image:At.a.formatMessage(Fr.image),video:At.a.formatMessage(Fr.video),tweet:At.a.formatMessage(Fr.tweet),drive:At.a.formatMessage(Fr.drive),gist:At.a.formatMessage(Fr.gist),figma:At.a.formatMessage(Fr.figma),invision:At.a.formatMessage(Fr.invision),abstract:At.a.formatMessage(Fr.abstract),framer:At.a.formatMessage(Fr.framer),whimsical:At.a.formatMessage(Fr.whimsical),miro:At.a.formatMessage(Fr.miro),audio:At.a.formatMessage(Fr.audio),maps:At.a.formatMessage(Fr.maps),loom:At.a.formatMessage(Fr.loom),typeform:At.a.formatMessage(Fr.typeform),codepen:At.a.formatMessage(Fr.codepen),pdf:At.a.formatMessage(Fr.pdf),embed:At.a.formatMessage(Fr.embed)};class Ur extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=Br.a.state;if(!t.open)return;const n=this.getSections(t);let i;return i=e.isMobile?{menuType:Se.b.MenuType.ActionSheet}:{menuType:Se.b.MenuType.Popup,width:320,maxHeight:"40vh"},r.createElement(Se.b,Object.assign({},i,{className:Bt.s}),r.createElement(xn.a,{type:xn.a.Type.Vertical,sections:n,initialFocus:0}))},this.handleDismiss=()=>{Dr.c()},this.handleAccept=e=>{Dr.a({environment:this.environment,blockType:e})}}willMountOrUpdate(){const e=Br.a.state;if(e.open){const t=Gn.a.state;"empty"!==t.mode&&"readOnly"!==t.mode&&t.store.id===e.textStore.id&&t.selection.endIndex===e.urlSelection.endIndex||Dr.c()}}renderComponent(){const{device:e}=this.environment,t=Br.a.state;return r.createElement(ge.c,{popupType:e.isReactNative&&!e.isTablet?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,disableDarkOverlayBackground:e.isMobile,keepFocus:e.isMobile,render:this.renderMenu,onDismiss:this.handleDismiss})}getSections(e){const{device:t}=this.environment,{url:n,textStore:i}=e,a=[],s=Object(Ar.k)({url:n,baseUrl:Y.a.baseURL,isMobile:t.isMobile,protocol:Y.a.protocol,currentUrl:window.location.href});if("page"===s.name){const e=g.a.createChildStore(i,{table:b.b,id:s.blockId});a.push({name:At.a.formatMessage(Rr.mentionPage),validator:()=>!0,type:"mention-page"}),a.push({name:At.a.formatMessage(Rr.linkToPage),validator:()=>!e.isCollectionView(),type:jr.a.page}),a.push({name:At.a.formatMessage(Rr.createLinkedDatabase),validator:()=>e.isCollectionView(),type:jr.a.collectionViewPage})}const o=xr.j(Lr);for(const r of o)"embed"!==r&&a.push({name:Lr[r],validator:Ir.b[r],type:r});return a.push({name:At.a.formatMessage(Rr.bookmarkMenuItem),validator:Ir.i,type:jr.a.bookmark}),a.push({name:Lr.embed,validator:Ir.b.embed,type:"embed"}),[{key:"embed section",render:e=>r.createElement(fe.a,Object.assign({},e)),items:[{key:"dismiss",render:e=>r.createElement(jt.a,Object.assign({},e,{title:At.a.formatMessage(Rr.dismissItem)})),action:this.handleDismiss},...u.compact(a.map(e=>{let{name:t,validator:i,type:a}=e;if(i({url:n,baseUrl:Y.a.baseURL})){return{key:"embed ".concat(t),render:e=>r.createElement(jt.a,Object.assign({},e,{title:t})),action:()=>this.handleAccept(a)}}}))]}]}}var _r=Ur,Wr=n(95),qr=n(319),Nr=n(49),zr=n(1486),Vr=n(1487),Hr=n(1488),Gr=n(202),Yr=n(1287),Qr=n(405),Kr=n(1491),Zr=n(194),Xr=n(47),$r=n(831),Jr=n(278),ei=n(847),ti=n(1492),ni=n(417),ri=n(725),ii=n(522);class ai extends J.a{getInitialState(){return{open:!1}}}var si=new ai,oi=n(629),li=n(1493),ci=n(214),di=n(137),ui=n(69),pi=n(303);function mi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function hi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mi(Object(n),!0).forEach((function(t){gi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function gi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class bi extends o.a{constructor(){super(...arguments),this.mouseIsDownExternally=!1,this.renderOverlay=()=>{const{isActive:e}=ii.a.state;return r.createElement(Ge.a,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},render:this.renderAnimated,onAnimationEnd:this.handleAnimationEnd})},this.renderAnimated=()=>{const{top:e,left:t}=ii.a.state;return r.createElement("div",{className:Bt.ob,style:{pointerEvents:"none",position:"absolute",top:e,left:0,display:"flex",width:"100%"}},r.createElement("div",{style:{flexShrink:1,width:Math.max(t-bi.leftOffset,0),minWidth:24}}),Object(Ve.a)(e=>r.createElement("div",Object.assign({style:{pointerEvents:"none",padding:12}},e),this.lastRenderState&&this.renderMenu(this.lastRenderState))),r.createElement("div",{style:{flexGrow:1,flexShrink:1,minWidth:36}}))},this.updateRichTextState=()=>{const e=ii.a.state;if(ni.a.state.open||ri.a.state.open)return;if(ci.b.state)return $r.a();const t=Gn.a.state;if("editing"!==t.mode)return $r.a();const n=t.store;if(n.table!==b.b&&n.table!==Zr.a&&n.table!==Xr.a)return $r.a();if(!this.environment.currentUser.isLoggedIn()||!n.canComment())return;const r=Wr.b();if(!n||P.k())return $r.a();const i=Jr.a.findEditableWithStore(n);if(i&&i.props.disableAnnotation)return $r.a();if(i&&i.props.disabled)return $r.a();const a=i?i.getContextClosestSelectable():void 0,s=a?a.props.store:void 0;if(s&&(s.isLocked()||s.isNavigableAncestorLocked()))return $r.a();if(this.mouseIsDownExternally&&e.blockTarget!==s)return $r.a();let o=!1;if(n.table===b.b){const e=n.getRecordStoreAtRootPath().getValue();e&&(o=bi.richTextMenuBlockTypesBlacklist[e.type])}if(!n||Jt.a.isActive()||oi.a.isActive()||pi.a.isOpen()||o||!r||!this.hasNonCollapsedTextSelection()||si.state.open)$r.a();else{let e=0,t=0;const n=Wr.c(r);if(n&&(e=n.left,t=n.top-bi.height-25,t<this.getTopbarHeight()))return $r.a();0===Math.abs(ii.a.state.top-t)&&Math.abs(ii.a.state.left-e)<10&&(t=ii.a.state.top,e=ii.a.state.left),ii.a.setState(hi({},ii.a.state,{isActive:!0,isAnimatingClosed:!1,top:t,left:e,blockTarget:y.b.state.stores[0]}))}},this.updateRichTextStateThrottled=u.throttle(this.updateRichTextState,200,{leading:!1}),this.handleAnimationEnd=()=>{ii.a.state.isActive||ii.a.setState(hi({},ii.a.state,{isAnimatingClosed:!1})),this.lastRenderState=this.renderStateStore.state},this.renderStateStore=this.createComputedStore(()=>{const{isActive:e,blockTarget:t}=ii.a.state,n=Gn.a.state;if(e&&"editing"===n.mode){const e=Gn.a.isEditingComment(),r=Gn.a.isEditingCaption(),i=t&&t.getParentTable()===Xr.a,a=Object(ui.i)(n.store)&&di.a.getMode(this.environment,n.store),s=(!a||"edit"===a)&&n.store.canEdit(),o=t&&t.getType(),l=o&&bi.richTextMenuActionsBlacklist[o],c={showTurnInto:Boolean(!e&&!i&&!r&&t&&s),showBold:Boolean(s),showItalic:Boolean(s),showStrikethrough:Boolean(s),showUnderline:Boolean(s),showCode:Boolean(s),showLink:Boolean(s),showHighlight:Boolean(s&&!e),showDiscuss:Boolean(!e&&t&&!i),showEquation:Boolean(s),showMention:Boolean(!e&&t&&!i&&s),showActionButton:Boolean(!e&&!r&&t&&!i),blockTarget:t,isComment:e};if(l&&l.size>0)for(const t of l)c[t]=!1;return c}})}didMount(){y.b.addListener(this.updateRichTextStateThrottled),Gn.a.addListener(this.updateRichTextStateThrottled),Qe.a.addListener(this.updateRichTextState),ei.a.addListener(this.updateRichTextState),ti.a.addListener(this.updateRichTextState)}willUnmount(){Gn.a.removeListener(this.updateRichTextStateThrottled),y.b.removeListener(this.updateRichTextStateThrottled),Qe.a.removeListener(this.updateRichTextState),ei.a.removeListener(this.updateRichTextState),ti.a.removeListener(this.updateRichTextState)}willMountOrUpdate(){const e=this.renderStateStore.state;e&&(this.lastRenderState=e)}renderComponent(){const{isActive:e,isAnimatingClosed:t}=ii.a.state;return r.createElement(qe.a,{open:e||t,render:this.renderOverlay})}renderMenu(e){const{isActive:t}=ii.a.state;return r.createElement("div",{style:{display:"inline-flex",alignItems:"stretch",height:bi.height,background:this.theme.popoverBackground,overflow:"hidden",fontSize:14,lineHeight:1.2,borderRadius:3,boxShadow:this.theme.mediumBoxShadow,pointerEvents:t?"auto":"none"},onMouseDown:e=>e.preventDefault()},e.showTurnInto&&e.blockTarget&&this.renderTurnInto(e.blockTarget),e.showLink&&this.renderLinkButton(!0),e.showDiscuss&&e.blockTarget&&this.renderCommentButton(e.blockTarget),r.createElement("div",{style:{display:"flex"}},e.showBold&&this.renderBoldButton(),e.showItalic&&this.renderItalicButton(),e.showUnderline&&this.renderUnderlineButton(),e.showStrikethrough&&this.renderStrikethroughButton(),e.showCode&&this.renderCodeButton(),e.showEquation&&this.renderEquationButton()),e.showHighlight&&r.createElement(li.a,{style:this.getBorderRight()}),e.showMention&&this.renderMention(),e.showActionButton&&e.blockTarget&&this.renderActionButton(e.blockTarget))}renderTurnInto(e){let t=r.createElement(se.b,{defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.label"});const{intl:n}=this.props,i=e.getType();if(i){const e=qr.b[i];t=e&&e.displayName||t}return r.createElement(Nr.a,{popupType:Nr.a.PopupType.Popup,buttonPopupStore:ri.a,originGap:4,renderOrigin:e=>r.createElement(pt.a,{renderTooltip:()=>n.formatMessage({defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.tooltip"}),render:n=>r.createElement(wt.a,Object.assign({style:hi({display:"flex",alignItems:"center",padding:"0 8px",whiteSpace:"nowrap"},this.getBorderRight())},Object(ur.a)(e,n)),t,yt.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}),render:()=>r.createElement(Se.b,{menuType:Se.b.MenuType.Popup},r.createElement(he.a,{context:{blocks:[e],environment:this.environment},sections:[Or.r],onAccept:t=>{$r.a(),be.o(this.environment,{analyticsName:t.analyticsName,from:"rich_text_menu",block_type:e.getType()})}})),onClick:()=>{be.Ed(this.environment,{action:"turn_into"})}})}renderBoldButton(){return r.createElement(zr.a,{type:"b",tooltipLabel:r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(se.b,{defaultMessage:"Bold",id:"richTextMenu.boldButton.tooltip"})),r.createElement("div",null,r.createElement(Qr.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleBold"})))},"B")}renderItalicButton(){return r.createElement(zr.a,{type:"i",tooltipLabel:r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(se.b,{defaultMessage:"Italicize",id:"richTextMenu.italicsButton.tooltip"})),r.createElement("div",null,r.createElement(Qr.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleItalics"})))},r.createElement("span",{style:{fontStyle:"italic"}},"i"))}renderStrikethroughButton(){return r.createElement(zr.a,{type:"s",tooltipLabel:r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(se.b,{defaultMessage:"Strike-through",id:"richTextMenu.strikeThroughButton.tooltip"})),r.createElement("div",null,r.createElement(Qr.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleStrike"})))},r.createElement("span",{style:{textDecoration:"line-through"}},"S"))}renderUnderlineButton(){return r.createElement(zr.a,{type:"_",tooltipLabel:r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(se.b,{defaultMessage:"Underline",id:"richTextMenu.underlineButton.tooltip"})),r.createElement("div",null,r.createElement(Qr.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleUnderline"})))},r.createElement("span",{style:{textDecoration:"underline"}},"U"))}renderCodeButton(){return r.createElement(zr.a,{type:"c",style:{padding:"0 6px"},tooltipLabel:r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(se.b,{defaultMessage:"Mark as code",id:"richTextMenu.markAsCodeButton.tooltip"})),r.createElement("div",null,r.createElement(Qr.a,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleCode"})))},yt.a.code({width:15,height:15}))}renderLinkButton(e){const t=this.environment.device.isMobile;return r.createElement(Vr.a,{style:this.getBorderRight()},e&&yt.a.alias({width:t?18:16,height:t?18:16,marginRight:4,fill:this.theme.regularIconColor}),r.createElement("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},r.createElement(se.b,{defaultMessage:"Link",id:"richTextMenu.linkButton.tooltip"})),e&&yt.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}renderEquationButton(){return r.createElement(Hr.a,{style:this.getBorderRight(),onClick:()=>{be.Ed(this.environment,{action:"e"}),$r.a()}},yt.a.equation({width:16,height:16}))}renderMention(){return r.createElement(pt.a,{renderTooltip:()=>r.createElement(r.Fragment,null,r.createElement("div",null,r.createElement(se.b,{defaultMessage:"Mention a person,{br}page, or date",id:"richTextMenu.mentionButton.tooltip",values:{br:r.createElement("br",null)}})),r.createElement("div",{style:{color:this.theme.mediumInvertedTextColor}},"@")),render:e=>r.createElement(wt.a,Object.assign({style:hi({},this.getBorderRight(),{padding:"0 8px"})},e,{onClick:()=>{jn.e(this.environment,{page:!0,createPage:!0,user:!0,bot:!0,date:!0,reminder:!0}),be.Ed(this.environment,{action:"mention"})}}),yt.a.mention({width:14,fill:this.theme.regularTextColor}))})}renderCommentButton(e){return r.createElement(Kr.a,{style:this.getBorderRight(),blockStore:e})}renderActionButton(e){return r.createElement(Gr.a,{store:e,style:{borderRight:"none",borderRadius:0,padding:0,width:30,height:"none"},iconStyle:{fill:this.theme.regularTextColor},fadeIn:!1,onClick:()=>{be.Ed(this.environment,{action:"more"})}})}hasNonCollapsedTextSelection(){const e=Wr.b();return!!e&&!e.collapsed&&"editing"===Gn.a.state.mode&&Gn.a.state.selection.startIndex!==Gn.a.state.selection.endIndex}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?Yr.a.desktopMacHeight:Yr.a.defaultHeight}getBorderRight(){return{boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor),marginRight:1}}}bi.richTextMenuBlockTypesBlacklist={[jr.a.factory]:!0},bi.richTextMenuActionsBlacklist={[jr.a.code]:new Set(["showMention","showCode"])},bi.leftOffset=60,bi.height=32;var fi=Object(se.h)(bi),yi=n(133),Si=n(407),vi=new(n(799).a),Ei=n(36);function Mi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function wi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ci extends o.a{constructor(){super(...arguments),this.handleContextMenu=(e,t)=>{if(e.preventDefault(),t.misspelledWord){const e=Gn.a.state;if("editing"===e.mode&&e.selection.startIndex===e.selection.endIndex){const n=_n.s(e.store.getValue()||[],t.misspelledWord),r=e.selection.startIndex,i=_n.u(n,r);i&&en.l({store:e.store,selection:i})}}si.setState({open:!0,menuInfo:t})},this.handleDismiss=()=>{si.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mi(Object(n),!0).forEach((function(t){wi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},si.state,{open:!1}))}}willMount(){Z.e&&Z.e.contextMenu&&Z.e.contextMenu.addListener(this.handleContextMenu)}willUnmount(){Z.e&&Z.e.contextMenu&&Z.e.contextMenu.removeListener(this.handleContextMenu)}renderComponent(){const{menuInfo:e,open:t}=si.state,{device:n}=this.environment,{x:i,y:a}=this.getClickPosition(e),s={bottom:a,top:a,height:0,left:i,right:i,width:0},o=e?this.getMenuSections(e):[],l=document.activeElement,c=Wr.b();let d=null,u=null;(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)&&(d=l.selectionStart,u=l.selectionEnd);for(const r of o)for(const e of r.items){const t=e.action;e.action=e=>{l.focus(),l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?(l.selectionStart=d,l.selectionEnd=u):c&&Wr.g(c,n),Ei.a.afterNextFlush(()=>{t(e)})}}return r.createElement(ge.c,{open:t&&o.length>0,popupType:ge.c.PopupType.Popup,originRect:s,render:()=>r.createElement(Si.a,{capture:!0,allowEsc:!0},r.createElement(Se.b,{menuType:Se.b.MenuType.Popup},r.createElement(xn.a,{type:xn.a.Type.Vertical,sections:o,initialFocus:void 0,onAccept:this.handleDismiss}))),onDismiss:this.handleDismiss,overlayContainerStore:vi})}getClickPosition(e){const t=Object(Z.g)();return{x:e?e.x/t:0,y:e?e.y/t:0}}getMenuSections(e){const t=[],n=this.getSpellingCorrectionItems(e);if(n.length>0){const e=t.length>0;t.push({key:"spellingCorrectionItems",items:n,render:t=>r.createElement(fe.a,Object.assign({},t,{topBorder:e}))})}const i=this.getDisableSpellCheckItems(e);if(i.length>0){const e=t.length>0;t.push({key:"disableSpellCheckItems",items:i,render:t=>r.createElement(fe.a,Object.assign({},t,{topBorder:e}))})}const a=this.getSearchItems(e);if(a.length>0){const e=t.length>0;t.push({key:"searchItems",items:a,render:t=>r.createElement(fe.a,Object.assign({},t,{topBorder:e}))})}const s=this.getLinkMenuItems(e);if(s.length>0){const e=t.length>0;t.push({key:"linkMenuItems",items:s,render:t=>r.createElement(fe.a,Object.assign({},t,{topBorder:e}))})}const o=this.getImageMenuItems(e);if(o.length>0){const e=t.length>0;t.push({key:"imageMenuItems",items:o,render:t=>r.createElement(fe.a,Object.assign({},t,{topBorder:e}))})}const l=this.getTextEditingItems(e);if(l.length>0){const e=t.length>0;t.push({key:"textEditingItems",items:l,render:t=>r.createElement(fe.a,Object.assign({},t,{topBorder:e}))})}const c=this.getEnableSpellCheckItem(e);if(c.length>0){const e=t.length>0;t.push({key:"enableSpellCheckItems",items:c,render:t=>r.createElement(fe.a,Object.assign({},t,{topBorder:e}))})}return t}getLinkMenuItems(e){const t=[];return e.linkURL&&e.linkURL.length>0&&(e.linkURL.startsWith("mailto:")?t.push({key:"copy-email",action:()=>{Z.e&&Z.e.copyText&&Z.e&&Z.e.copyText(e.linkText)},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Copy email address",id:"desktop.rightClickMenu.copyEmailAddress"})}))}):t.push({key:"copy-link",action:()=>{Z.e&&Z.e.copyText&&Z.e&&Z.e.copyText(e.linkURL)},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Copy link",id:"desktop.rightClickMenu.copyLink"})}))}),t.push({key:"open-link",action:()=>{Z.e&&Z.e.openExternalUrl(e.linkURL)},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Open link",id:"desktop.rightClickMenu.openLink"})}))})),t}getImageMenuItems(e){const t=[];return e.hasImageContents&&e.srcURL&&e.srcURL.length>0&&(t.push({key:"copy-image",action:()=>{Z.e&&Z.e.copyImage&&Z.e.copyImage(e.srcURL)},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Copy image",id:"desktop.rightClickMenu.copyImage"})}))}),t.push({key:"copy-image-address",action:()=>{Z.e&&Z.e.copyText&&Z.e.copyText(e.srcURL)},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Copy image address",id:"desktop.rightClickMenu.copyImageAddress"})}))})),t}isEditing(e){return e.isEditable||e.inputFieldType&&"none"!==e.inputFieldType}hasMisspelling(e){return this.isEditing(e)&&e.misspelledWord&&e.misspelledWord.length>0}getSpellingCorrectionItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,n=[];if(this.hasMisspelling(e)&&t&&t.isEnabled()){const i=t.getCorrections(e);for(const e of i)n.push({key:e,action:()=>{Z.e&&Z.e.replaceMisspelling&&Z.e.replaceMisspelling(e)},render:t=>r.createElement(jt.a,Object.assign({},t,{title:e}))})}return n}getDisableSpellCheckItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,n=[];return this.hasMisspelling(e)&&t&&t.isEnabled()&&n.push({key:"disable",action:()=>{t.setEnabled(!1)},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Disable spell check",id:"desktop.spellcheckMenuItem.disableSpellcheck.title"})}))}),n}getEnableSpellCheckItem(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,n=[];return this.isEditing(e)&&t&&!t.isEnabled()&&n.push({key:"enable",action:()=>{t.setEnabled(!0)},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Enable spell check",id:"desktop.spellcheckMenuItem.enableSpellcheck.title"})}))}),n}getSearchItems(e){const t=[];return e.selectionText&&e.selectionText.length>0&&t.push({key:"google",action:()=>{if(Z.e){const t="https://www.google.com/#q=".concat(encodeURIComponent(e.selectionText.trim()));Z.e.openExternalUrl(t)}},render:e=>r.createElement(jt.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Search with Google",id:"desktop.searchMenuItem.searchWithGoogle.title"})}))}),t}getTextEditingItems(e){const t=[];return this.isEditing(e)&&(e.editFlags.canCut&&t.push({key:"cut",action:()=>{Z.e&&Z.e.cut&&Z.e.cut()},render:e=>r.createElement(yi.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Cut",id:"desktop.textEditingMenuItem.cutAction.title"}),shortcuts:["cut"]}))}),e.editFlags.canCopy&&t.push({key:"copy",action:()=>{Z.e&&Z.e.copy&&Z.e.copy()},render:e=>r.createElement(yi.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Copy",id:"desktop.textEditingMenuItem.copyAction.title"}),shortcuts:["copy"]}))}),e.editFlags.canPaste&&t.push({key:"paste",action:()=>{Z.e&&Z.e.paste&&Z.e.paste()},render:e=>r.createElement(yi.a,Object.assign({},e,{title:r.createElement(se.b,{defaultMessage:"Paste",id:"desktop.textEditingMenuItem.pasteAction.title"}),shortcuts:["paste"]}))})),t}}var Oi=Ci,ki=n(850),Pi=n(675),Ti=n(235);function Di(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Ii(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ji(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ii(Object(n),!0).forEach((function(t){xi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ii(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Bi extends o.a{constructor(){super(...arguments),this.handleChangeValue=e=>{if(!e)return void this.removeDateAnnotation();const t=this.getEverythingIWant();if(!t)return;const{date_format:n,time_format:r}=t;this.setDateAnnotationData(ji({date_format:n,time_format:r},e))},this.handleChangeDateFormat=e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:n,time_format:r}=t;this.setDateAnnotationData(ji({date_format:e,time_format:r},n))},this.handleChangeTimeFormat=e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:n,date_format:r}=t;this.setDateAnnotationData(ji({date_format:r,time_format:e},n))},this.setDateAnnotationData=e=>{const t=this.getEverythingIWant();if(!t)return;const{textStore:n,textValue:r,tokenIndex:i,annotations:a}=t,s=r.map((t,n)=>{if(n===i){const n=a.map(t=>_n.pb(t)?["d",e]:t);return _n.m(t[0],n)}return t});Gt.d(this.environment,e=>{$t.c({store:n,value:s,transaction:e})})},this.removeDateAnnotation=()=>{const e=this.getEverythingIWant();if(!e)return;const{textStore:t,textValue:n,tokenIndex:r}=e,i=n.filter((e,t)=>t!==r);Gt.d(this.environment,e=>{$t.c({store:t,value:i,transaction:e})})}}renderComponent(){const{device:e}=this.environment,t=Pi.a.state;return r.createElement(ge.c,{popupType:e.isMobile?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:t.open,originRect:t.originRect,onDismiss:ki.a,render:()=>{const e=this.getEverythingIWant();if(!e)return null;const{date_format:n,time_format:i,dateValue:a}=e;return r.createElement(Ti.a,{dependency:Ti.j.menus},e=>{let{DatePropertyMenu:s}=e;return r.createElement(s,{firstDayOfWeek:P.q.state,value:a,locked:!1,onChangeValue:this.handleChangeValue,dateFormat:n,onChangeDateFormat:this.handleChangeDateFormat,timeFormat:i,onChangeTimeFormat:this.handleChangeTimeFormat,onDismiss:ki.a,disabled:!1,shouldShowReminder:!!t.open&&t.allowReminders})})}})}getEverythingIWant(){const e=Pi.a.state;if(e.open){const{textStore:t,tokenIndex:n}=e,r=t.getValue();if(r){const e=r[n];if(e){const i=_n.cb(e),a=_n.w(i);if(a){const s=_n.I(a),{date_format:o,time_format:l}=s;return{textStore:t,textValue:r,tokenIndex:n,token:e,annotations:i,date_format:o,time_format:l,dateValue:Di(s,["date_format","time_format"])}}}}}}}var Ai=Bi,Fi=n(742),Ri=n(127),Li=n(825),Ui=n(160),_i=n(116),Wi=n(109);function qi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ni(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qi(Object(n),!0).forEach((function(t){zi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Vi extends o.a{constructor(){super(...arguments),this.storeTypes={mouseStore:Wi.a},this.handleMouseEnter=()=>{this.stores.mouseStore.setState(Ni({},this.stores.mouseStore.state,{mouseEntered:!0}))},this.handleMouseLeave=()=>{this.stores.mouseStore.setState(Ni({},this.stores.mouseStore.state,{mouseEntered:!1}))},this.handleMouseDown=()=>{this.stores.mouseStore.setState(Ni({},this.stores.mouseStore.state,{mousePressed:!0}))},this.handleMouseUp=()=>{this.stores.mouseStore.setState(Ni({},this.stores.mouseStore.state,{mousePressed:!1}))},this.handleWindowMouseUp=()=>{this.stores.mouseStore.setState(Ni({},this.stores.mouseStore.state,{mousePressed:!1,mouseEntered:!1}))}}willMount(){Object(h.a)(window,"mouseup",this.handleWindowMouseUp)}willUnmount(){Object(h.b)(window,"mouseup",this.handleWindowMouseUp)}renderComponent(){const{mouseEntered:e,mousePressed:t}=this.stores.mouseStore.state;return this.props.render({mouseEntered:e,mousePressed:t,events:{onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp}})}}var Hi=Vi;function Gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){Qi(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ki extends o.a{renderComponent(){const{device:e}=this.environment,{title:t,caption:n,image:i,onClick:a}=this.props;return r.createElement(Hi,{render:s=>{let{mouseEntered:o,events:l}=s;return r.createElement("div",Object.assign({},l,{onClick:a,style:this.getWrapStyle(o)}),r.createElement("img",{src:i,style:this.getImageStyle(o)}),r.createElement("div",{style:this.getInfoStyle()},r.createElement("div",{style:this.getTitleStyle()},r.createElement("span",{style:this.getMobileTitleStyle()},t)),!e.isMobile&&r.createElement("div",{style:this.getCaptionStyle()},n)))}})}getWrapStyle(e){const{device:t}=this.environment;return Yi({display:"flex",flexDirection:t.isMobile?"column":"row",alignItems:"center",flexGrow:0},e&&{cursor:"pointer"},{},t.isMobile?{padding:"12px 4px 16px"}:{marginBottom:8})}getImageStyle(e){const{device:t}=this.environment,{selected:n}=this.props,r=(()=>n?"0 0 0 2px ".concat(Xe.f.blue):e?"0 0 0 2px ".concat(this.theme.darkDividerColor):"0 0 0 1px ".concat(this.theme.darkDividerColor))(),i=t.isMobile?"42vw":"169px";return{display:"flex",flexDirection:"column",borderRadius:3,boxShadow:r,transition:"box-shadow 200ms ease-out",marginTop:8,marginBottom:t.isMobile?12:8,height:"calc(".concat(i," / (169 / 97))"),maxHeight:97,maxWidth:i}}getInfoStyle(){const{device:e}=this.environment;return Yi({display:"flex",flexDirection:"column"},!e.isMobile&&{marginLeft:16})}getTitleStyle(){const{device:e}=this.environment,{selected:t}=this.props;return Yi({display:"flex",fontSize:14},t&&!e.isMobile&&{fontWeight:600},{marginBottom:2},e.isMobile&&{justifyContent:"center"})}getMobileTitleStyle(){const{device:e}=this.environment,{selected:t}=this.props;return e.isMobile?Yi({fontSize:12,padding:"2px 10px",borderRadius:20,textAlign:"center"},t&&{background:Xe.f.blue,color:Xe.f.white}):{}}getCaptionStyle(){return{fontSize:12,color:this.theme.mediumTextColor}}}var Zi=Ki,Xi=n(546),$i=n(342),Ji=n(295),ea=n(1200);function ta(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function na(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ta(Object(n),!0).forEach((function(t){ra(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ta(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ra(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ia extends o.a{constructor(){super(...arguments),this.storeTypes={databaseSearchButtonPopupStore:rr.a},this.renderDesktopModalContent=()=>{const{currentBlockStore:e}=L.a.state,t=Xi.a.state;if(t.open&&e)return r.createElement("div",{style:ia.modalStyle},r.createElement("div",{style:ia.modalHeaderStyle},r.createElement(se.b,{id:"database.relationProperty.createModal.header",defaultMessage:"Create a relation to another database"})),r.createElement("div",{style:ia.sourceSectionStyle},r.createElement("div",{style:ia.defaultTextStyle},r.createElement(se.b,{id:"database.relationProperty.createModal.description",defaultMessage:"A relation allows you to link pages from other databases."})),this.renderDatabaseButtonPopup()),t.relationCollectionId===t.targetCollectionId&&r.createElement("div",{style:ia.selfRelationSectionStyle},r.createElement("div",{style:ia.defaultTextStyle},r.createElement(se.b,{id:"database.relationProperty.createModal.selfRelationPrompt",defaultMessage:"You selected the same database. In which property should the linked pages appear?"})),this.renderSelfRelationConfigure()),r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement(ea.a,{title:r.createElement(se.b,{id:"database.relationProperty.createModal.helpCenterLink",defaultMessage:"Learn about relations"}),href:Object(Oe.a)("guides.relations"),analyticsFrom:"configure_relation_modal"}),r.createElement(Ji.a,{isLarge:!0,style:{marginLeft:"auto",marginRight:12},onClick:this.handleCancelClick},r.createElement(se.b,{id:"database.relationProperty.createModal.cancelButton",defaultMessage:"Cancel"})),r.createElement($i.a,{isLarge:!0,onClick:this.handleDoneClick,disabled:!this.canAccept()},r.createElement(se.b,{id:"database.relationProperty.createModal.confirmButton",defaultMessage:"Create relation"}))))},this.renderMobilePopupContent=()=>{const e=Xi.a.state;if(e.open)return r.createElement(Se.b,{menuType:Se.b.MenuType.Modal,right:r.createElement(Ce.DoneMenuText,null),left:r.createElement(Ce.CancelMenuText,null),title:r.createElement(se.b,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}),onClickRight:this.handleDoneClick,onClickLeft:this.handleCancelClick,rightDisabled:!this.canAccept()},r.createElement(fe.a,{title:r.createElement(se.b,{id:"database.relationProperty.createModal.databaseSelect.mobile.title",defaultMessage:"Database source"})},r.createElement(Ui.a,{title:this.renderDatabaseButtonPopup()})),r.createElement("div",{style:this.getMobileSectionCaption()},r.createElement(se.b,{id:"database.relationProperty.createModal.databaseSelect.mobile.caption",defaultMessage:"The database you wish to link to."})),e.relationCollectionId===e.targetCollectionId&&r.createElement(r.Fragment,null,r.createElement("div",{style:na({},this.getMobileSectionHeading(),{marginTop:28})},r.createElement(se.b,{id:"database.relationProperty.createModal.selfRelationPrompt.mobileTitle",defaultMessage:"Self-relation type"})),r.createElement("div",{style:this.getMobileSectionCaption()},r.createElement(se.b,{id:"database.relationProperty.createModal.selfRelationPrompt",defaultMessage:"You selected the same database. In which property should the linked pages appear?"})),r.createElement(fe.a,{disableMobilePadding:!0},r.createElement(Ui.a,{title:this.renderSelfRelationConfigure()})),r.createElement("div",{style:this.getMobileSectionCaption()},this.renderSelfRelationCaption(e.selfRelationType))),r.createElement(fe.a,null,r.createElement(we.a,{title:r.createElement(se.b,{id:"database.relationProperty.createModal.helpCenterLinkMobile",defaultMessage:"Learn about relations"}),href:Object(Oe.a)("guides.relations"),analyticsFrom:"configure_relation_modal"})))},this.renderDatabaseButtonPopupOrigin=e=>{const{device:t}=this.environment,{currentBlockStore:n}=L.a.state;if(Xi.a.state.open&&n)return t.isMobile?r.createElement(wt.a,Object.assign({mobileFeedback:!0,style:{width:"100%"}},e),this.getButtonTitle()):r.createElement(Ji.a,Object.assign({isLarge:!0,style:{width:"100%"}},e),this.getButtonTitle(),yt.a.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))},this.renderDatabaseButtonPopupContent=()=>{const{device:e}=this.environment,{currentBlockStore:t}=L.a.state,n=Xi.a.state;if(!n.open||!t)return;const i={request:n.collectionSearchQuery,debounce:Tt.b,performRequest:this.getCollectionAutocompleteItems,render:(i,a,s)=>{let o;if(i&&(o=r.createElement(fe.a,null,r.createElement(Fn.a,{title:"Something went wrong."}))),s||(o=r.createElement(fe.a,null,r.createElement(Fn.a,{title:"Loading..."}))),a&&0===a.length)o=r.createElement(fe.a,null,r.createElement(Fn.a,{title:this.props.intl.formatMessage({id:"database.relationProperty.createModal.noResults",defaultMessage:"No results"})}));else{const e=(a||[]).map(e=>{const n=Ri.a.createChildStore(t,{table:Xr.a,id:e});return{key:e,render:e=>r.createElement(An.a,Object.assign({store:n},e)),action:()=>{this.handleSelectCollection(e)}}});o=r.createElement(xn.a,{type:xn.a.Type.Vertical,initialFocus:n.collectionSearchQuery?0:void 0,sections:[{key:"results",render:e=>r.createElement(fe.a,Object.assign({},e)),items:e}]})}return e.isMobile?r.createElement(r.Fragment,null,o):r.createElement("div",{style:ia.customPopupStyle},o)}},a=r.createElement(fe.a,{isInput:!0},this.renderDatabaseInputMenuItem());let s;return s=e.isMobile?{menuType:Se.b.MenuType.Modal,title:r.createElement(se.b,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}),right:r.createElement(Ce.DoneMenuText,null),header:a,onClickRight:this.handleDatabaseSearchDoneClick}:{menuType:Se.b.MenuType.Popup,width:"100%",header:a},r.createElement(Se.b,Object.assign({},s),r.createElement(Pt.a,Object.assign({},i)))},this.handleSamePropertyClick=()=>{const e=Xi.a.state;e.open&&Xi.a.setState(na({},e,{selfRelationType:"same_property"}))},this.handleSeparatePropertyClick=()=>{const e=Xi.a.state;e.open&&Xi.a.setState(na({},e,{selfRelationType:"separate_property"}))},this.getCollectionAutocompleteItems=async e=>Tt.c(this.environment,{query:e,limit:20,source:"relation_setup_menu"}),this.handleDatabaseSearchInputChange=e=>{const t=Xi.a.state;t.open&&Xi.a.setState(na({},t,{collectionSearchQuery:e.target.value}))},this.handleSelectCollection=e=>{const t=Xi.a.state;t.open&&(Xi.a.setState(na({},t,{targetCollectionId:e})),this.stores.databaseSearchButtonPopupStore.setState({open:!1}))},this.handleDatabaseSearchDoneClick=()=>{this.stores.databaseSearchButtonPopupStore.setState({open:!1})},this.handleCancelClick=()=>{Li.b()},this.handleDoneClick=()=>{Li.a(this.environment)},this.handleDatabaseButtonPopupClick=()=>{const e=Xi.a.state;e.open&&Xi.a.setState(na({},e,{collectionSearchQuery:""}))}}renderComponent(){const{device:e}=this.environment,{open:t}=Xi.a.state;return e.isMobile?r.createElement(ge.a,{popupType:ge.b.SlideUp,alignmentToOrigin:ge.a.Alignment.Start,open:t,render:this.renderMobilePopupContent,onDismiss:Li.b}):r.createElement(Fi.a,{open:t,render:this.renderDesktopModalContent,onDismiss:Li.b})}renderSelfRelationConfigure(){const e=Xi.a.state;if(e.open)return r.createElement("div",{style:this.getSelfRelationButtonWrapStyle()},r.createElement(Zi,{title:r.createElement(se.b,{id:"database.relationProperty.createModal.selfRelationPrompt.createNewPropertyOption.title",defaultMessage:"Create a new property"}),caption:this.renderSelfRelationCaption("separate_property"),image:dr.a.images.selfRelationSeparateSvg,selected:"separate_property"===e.selfRelationType,onClick:this.handleSeparatePropertyClick}),r.createElement(Zi,{title:r.createElement(se.b,{id:"database.relationProperty.createModal.selfRelationPrompt.samePropertyOption.title",defaultMessage:"Use the same property"}),caption:this.renderSelfRelationCaption("same_property"),image:dr.a.images.selfRelationSameSvg,selected:"same_property"===e.selfRelationType,onClick:this.handleSamePropertyClick}))}getButtonTitle(){const{currentBlockStore:e}=L.a.state,t=Xi.a.state;if(t.open&&e){if(t.targetCollectionId){const n=Ri.a.createChildStore(e,{table:Xr.a,id:t.targetCollectionId});return r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement(Zt.a,{disabled:!0,icon:n.getIcon(),isEmptyPage:!1,size:20}),r.createElement(_i.a,{store:n,style:{margin:"0 6px"}}))}return r.createElement("span",{style:{color:this.theme.mediumTextColor}},r.createElement(se.b,{id:"database.relationProperty.createModal.databaseSelect.label",defaultMessage:"Select a database"}))}}renderDatabaseButtonPopup(){const{device:e}=this.environment;return r.createElement(Nr.a,{popupType:e.isMobile?ge.b.SlideUp:ge.b.Popup,renderOrigin:this.renderDatabaseButtonPopupOrigin,render:this.renderDatabaseButtonPopupContent,buttonPopupStore:this.stores.databaseSearchButtonPopupStore,onClick:this.handleDatabaseButtonPopupClick,style:{width:440}})}renderDatabaseInputMenuItem(){const e=Xi.a.state;if(e.open)return r.createElement(ye.a,{focus:!0,focusAfterAnimation:!0,value:e.collectionSearchQuery,onChange:this.handleDatabaseSearchInputChange,placeholder:this.props.intl.formatMessage({id:"database.relationProperty.createModal.databaseSelect.placeholder",defaultMessage:"Search for a database…"})})}renderSelfRelationCaption(e){var t=this;return"same_property"===e?r.createElement(r.Fragment,null,r.createElement(se.b,{id:"database.relationProperty.createModal.selfRelationPrompt.createNewPropertyOption.caption",defaultMessage:'<b>No syncing.</b> Use this option when modeling a "Related tasks" property in a "Task" database.',values:{b:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.createElement("b",{style:{color:t.theme.regularTextColor}},n)}}})):r.createElement(r.Fragment,null,r.createElement(se.b,{id:"database.relationProperty.createModal.selfRelationPrompt.samePropertyOption.caption",defaultMessage:'<b>Sync both ways.</b> Use this option when modeling "Parent Task" and "Child Task" properties in a "Task" database.',values:{b:function(){for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.createElement("b",{style:{color:t.theme.regularTextColor}},n)}}}))}canAccept(){const e=Xi.a.state;return e.open&&e.targetCollectionId}getSelfRelationButtonWrapStyle(){const{device:e}=this.environment;return{display:"flex",flexDirection:e.isMobile?"row":"column",justifyContent:"space-between"}}getMobileSectionHeading(){return{marginTop:8,marginRight:16,marginBottom:8,marginLeft:16,fontSize:12,textTransform:"uppercase",color:this.theme.mediumTextColor}}getMobileSectionCaption(){return{marginTop:8,marginRight:16,marginBottom:8,marginLeft:16,fontSize:12,color:this.theme.mediumTextColor}}}ia.defaultTextStyle={marginBottom:8,fontSize:14},ia.modalStyle={padding:30,width:538},ia.modalHeaderStyle={fontWeight:600,marginBottom:20},ia.sourceSectionStyle={marginBottom:30},ia.selfRelationSectionStyle={marginBottom:30},ia.customPopupStyle={maxHeight:"24vh"};var aa=Object(se.h)(ia),sa=(n(159),n(1477)),oa=n(1395);function la(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ca(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?la(Object(n),!0).forEach((function(t){da(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):la(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function da(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ua extends o.a{constructor(){super(...arguments),this.renderModal=()=>{if(!this.lastOpenState)return;const{acceptLabel:e,requiredInputValue:t}=this.lastOpenState,n=[{key:"accept",render:t=>r.createElement(Ji.a,Object.assign({isRed:!0,isLarge:!0,style:ua.buttonStyle,hovered:t.focused},t),e),action:this.handleAccept},{key:"cancel",render:e=>r.createElement(Ji.a,Object.assign({isLarge:!0,style:ua.buttonStyle,hovered:e.focused},e),r.createElement(se.b,{id:"confirmationInputDialog.cancelButton.label",defaultMessage:"Cancel"})),action:this.handleCancel}];return r.createElement(Ye.a,{capture:!0},r.createElement("div",null,r.createElement("div",{style:{minHeight:64,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16}},this.lastOpenState.message),r.createElement(je.b,{value:this.lastOpenState.inputValue,onChange:this.handleInputChange,style:{height:38,marginBottom:2},placeholder:t}),r.createElement(xn.a,{type:xn.a.Type.Vertical,initialFocus:void 0,sections:[{key:"dialog",render:e=>r.createElement(fe.a,Object.assign({},e)),items:n}]})))},this.handleAccept=()=>{const e=sa.a.state;e.open&&(this.cleanAcceptInput(e.inputValue)===this.cleanAcceptInput(e.requiredInputValue)?oa.a({didConfirm:!0}):vn.e(r.createElement(se.b,{id:"confirmDialogInput.incorrectInputError.message",defaultMessage:'Please type "{requiredInputValue}" to continue',values:{requiredInputValue:e.requiredInputValue}})))},this.cleanAcceptInput=e=>e.trim().toLowerCase().replace(/’/g,"'"),this.handleCancel=()=>{oa.a({didConfirm:!1})},this.handleInputChange=e=>{const t=sa.a.state;t.open&&sa.a.setState(ca({},t,{inputValue:e.target.value}))}}renderComponent(){const e=sa.a.state;return e.open&&(this.lastOpenState=ca({},e)),r.createElement(Fi.a,{open:e.open,keepFocus:!0,overlayZIndex:He.a,onDismiss:this.handleCancel,preventHideChildrenWhileOpening:!0,innerStyle:{borderRadius:3,paddingTop:24,paddingBottom:16,paddingLeft:32,paddingRight:32,width:this.lastOpenState&&this.lastOpenState.width||336,fontSize:16,boxShadow:this.theme.largeBoxShadow,background:this.theme.contentBackground,maxHeight:"90vh",overflowY:"scroll",marginLeft:24,marginRight:24},render:this.renderModal})}}ua.buttonStyle={width:"100%",marginTop:16};var pa=ua,ma=n(610),ha=n(70),ga=n(346),ba=n(170),fa=n(487),ya=n(208),Sa=n(143),va=n(52),Ea=n(193),Ma=n(164);function wa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ca(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Oa extends o.a{constructor(){super(...arguments),this.handleOverrideLinkClick=e=>{Object(ma.b)(),Q.f({environment:this.environment,url:e})},this.loadSnapshot=async e=>{const t=this.props.blockStore.id,n=this.props.timestamp,r=await V.W(this.environment,e);if("failed"===r.type)throw r.error;const i=r.data,a=u.flatten(await Promise.all(i.signedUrls.map(async e=>{const t=await fetch(e);return await t.json()}))),s=this.environment.currentUser.id,o=new ga.a;for(const{table:u,value:h}of a){const e={table:u,id:h.id};o.setRecord({pointer:e,userId:s},{role:"reader",value:h})}o.snapshotData={blockId:t,timestamp:n};const l=u.uniq(u.flatten(a.map(e=>{let{table:t,value:n}=e;if(t===b.b){const e=n;return[...Zn.e(e),...Zn.z(e)?[]:e.content||[]].filter(e=>!o.getRecord({pointer:{table:b.b,id:e},userId:s}))}return[]}))).filter(va.f),c=u.compact(l.map(e=>Object(z.c)(this.props.blockStore,{table:b.b,id:e}))),d=new Set,p=new Set;for(const{table:u,value:h}of a)if(u===b.b){const e=h;for(const t of Zn.k(e))d.add(t);e.created_by_table&&e.created_by_id&&(e.created_by_table===Yn.a?d.add(e.created_by_id):p.add(e.created_by_id)),e.last_edited_by_table&&e.last_edited_by_id&&(e.last_edited_by_table===Yn.a?d.add(e.last_edited_by_id):p.add(e.last_edited_by_id))}else if(u===Zr.a){const e=h;e.created_by_id&&e.created_by_table&&(e.created_by_table===Yn.a?d.add(e.created_by_id):p.add(e.created_by_id))}const m=[...c,...u.compact(Array.from(d).map(e=>Object(z.c)(this.props.blockStore,{table:Yn.a,id:e}))),...u.compact(Array.from(p).map(e=>Object(z.c)(this.props.blockStore,{table:Ea.a,id:e})))];return await Promise.all(m.map(async e=>{await e.load();const t=e.getValue();t&&o.setRecord({pointer:{table:e.table,id:t.id},userId:s},{role:"reader",value:t})})),{blockStore:new g.a(this.environment,{table:b.b,id:t},{inMemoryRecordCacheStore:o}),timestamp:n}}}getChildContext(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?wa(Object(n),!0).forEach((function(t){Ca(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):wa(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},this.context,{overrideLinkClick:this.handleOverrideLinkClick})}renderComponent(){const e={request:{blockId:this.props.blockStore.id,timestamp:this.props.timestamp},performRequest:this.loadSnapshot,render:(e,t,n)=>r.createElement(Rn.a,{show:!n||!t,showDelay:400,showHold:400,render:n=>n?r.createElement("div",{style:this.getSpinnerWrapperStyles()},r.createElement(Dt.a,null)):e?r.createElement("div",{style:{padding:32}},r.createElement(se.b,{defaultMessage:"Something went wrong.",id:"pageSnapshotPreview.unknownPreviewLoadError.message"})):t?r.createElement(fa.a,{key:t.timestamp,store:t.blockStore,isDefaultContainer:!0,render:e=>r.createElement(ba.b,Object.assign({style:{background:this.theme.contentBackground,zIndex:1,flexGrow:1},type:this.useSeparateHorizontalScroller(t.blockStore)?ba.b.OverflowType.Y:ba.b.OverflowType.All},e),r.createElement(ya.b,{store:t.blockStore,disabled:!0,loadingContainerStore:void 0,context:ya.a.InAppTemplatePreview,paddingBottom:ya.b.paddingBottom(this.environment),paddingLeft:ya.b.defaultPaddingLeftRight(this.environment),paddingRight:ya.b.defaultPaddingLeftRight(this.environment),pageCoverHeight:ya.b.defaultPageCoverHeight(this.environment)}))}):void 0})};return r.createElement(Pt.a,Object.assign({},e))}useSeparateHorizontalScroller(e){return!e.isCollectionView()||!Sa.b(this.environment)}getSpinnerWrapperStyles(){return{padding:32,display:"flex",alignItems:"center",justifyContent:"center"}}}Oa.contextTypes=o.b,Oa.childContextTypes=Ma.a;var ka=Oa,Pa=n(183);class Ta extends o.a{constructor(){super(...arguments),this.handleScroll=e=>{if(this.props.loading)return;e>(this.props.loadMoreOffsetThreshold||200)||this.props.resultSize>=this.props.fetchSize&&this.props.onLoadMore()}}renderComponent(){return r.createElement(Pa.a,{onChange:this.handleScroll})}}var Da=Ta,Ia=n(361),ja=n(308),xa=n(588);function Ba(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Aa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ba(Object(n),!0).forEach((function(t){Fa(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ba(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ra extends o.a{constructor(){super(...arguments),this.renderSnapshotsListRequest=()=>{const{device:e}=this.environment,t=ja.a.state;if(!t.open)return;const n={request:{blockId:t.blockStore.id,size:t.size},performRequest:e=>this.loadSnapshotsList(e,t),render:(n,i,a)=>r.createElement(Rn.a,{show:Boolean(!i||i.snapshots.length>=t.size&&t.openSnapshotNearTimestamp),showDelay:400,showHold:100,render:r=>e.isMobile?this.renderMobileHistory({snapshotValues:i?i.snapshots:[],menuState:t,error:n,initialLoading:r,loadingMore:!a}):this.renderDesktopHistory({snapshotValues:i?i.snapshots:[],menuState:t,error:n,initialLoading:r,loadingMore:!a})})};return r.createElement(Pt.a,Object.assign({},n))},this.renderMobileHistory=e=>{let t,n;return this.historyIsEnabled()?e.loadingMore||0!==e.snapshotValues.length||(t=this.renderUnavailableMessage(Ra.noSnapshotsMessage,!1)):t=this.renderUnavailableMessage(this.getUnavailableMessage(),St.k(this.environment)||"team"),n=e.error?r.createElement("div",{style:Ra.wrapStyle},r.createElement(se.b,{defaultMessage:"Something went wrong",id:"historyModal.errorMessage"})):e.initialLoading?r.createElement("div",{style:Ra.wrapStyle},r.createElement(Dt.a,null)):r.createElement(r.Fragment,null,r.createElement(ba.b,{type:ba.b.OverflowType.Y},this.renderSnapshotsMenuList(e)),this.renderMobileSnapshotPreview(e.menuState)),r.createElement(Se.b,{menuType:Se.b.MenuType.Modal,title:r.createElement(se.b,{defaultMessage:"History",id:"historyModal.mobileHistoryMenu.title"}),left:this.renderMobileHelpButton(),right:r.createElement(Ce.DoneMenuText,null),onClickRight:ma.b,header:t},n)},this.renderDesktopHistory=e=>{let t;return t=e.error?r.createElement("div",{style:Ra.wrapStyle},r.createElement(se.b,{defaultMessage:"Something went wrong",id:"historyModal.desktopModal.errorMessage"})):e.initialLoading?r.createElement("div",{style:Ra.wrapStyle},r.createElement(Dt.a,null)):this.historyIsEnabled()?e.menuState.snapshot&&!this.snapshotIsAvailable(e.menuState.snapshot)?this.renderUnavailableMessage(Ra.restrictedMessage,"enterprise"):e.loadingMore||0!==e.snapshotValues.length?this.renderDesktopSnapshotPreview(e.menuState):this.renderUnavailableMessage(Ra.noSnapshotsMessage,!1):this.renderUnavailableMessage(this.getUnavailableMessage(),St.k(this.environment)||"team"),r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",flexDirection:"column",width:"calc(100% - ".concat(Ra.sidebarWidth,"px)"),boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor)}},t),this.renderDesktopSidebar(e))},this.renderSnapshotsMenuList=e=>{const{device:t}=this.environment,{menuState:n,loadingMore:i}=e,a=u.compact(e.snapshotValues.map(e=>{const i=this.snapshotIsAvailable(e);return{key:e.id,action:()=>{ma.f(this.environment,e)},render:a=>{const s=e.authors||[],o=this.props.intl.formatList(u.compact(s.map((e,t)=>{if(e.table===Yn.a){const t=Object(z.c)(n.blockStore,e).getValue();if(!t)return;return Object(Yn.d)(t)}{const t=Object(z.c)(n.blockStore,e).getValue();if(!t)return;return t.name}})),{type:"conjunction",style:"narrow"}),l=r.createElement("div",{style:Aa({},Ke.a.textOverflowStyle)},o),c=Boolean(n.snapshot&&n.snapshot.id===e.id);if(i){const n=Object(ha.a)(parseInt(e.timestamp)).format("lll");return r.createElement(pt.a,{key:a.key,render:n=>r.createElement(jt.a,Object.assign({},Object(ur.a)(a,n),{title:Object(ha.a)(parseInt(e.timestamp)).calendar(),focused:!t.isMobile&&c,caption:l})),renderTooltip:()=>r.createElement("div",{style:{maxWidth:270,whiteSpace:"normal"}},r.createElement("div",null,n),r.createElement("div",null,o))})}{const n=!this.historyIsEnabled();return r.createElement(pt.a,{key:a.key,render:i=>r.createElement(jt.a,Object.assign({},Object(ur.a)(i,a),{title:r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},r.createElement("div",{style:Aa({},t.isMobile&&{display:"flex",flex:1},{},Ke.a.textOverflowStyle)},Object(ha.a)(parseInt(e.timestamp)).calendar()),!n&&r.createElement(mt.a,{subscriptionTier:"enterprise",analyticsName:"history_modal",desktopStyle:{marginLeft:8},onClick:()=>this.handleUpgrade("enterprise")})),focused:!t.isMobile&&c,disabled:n,caption:l})),renderTooltip:()=>r.createElement(se.b,{defaultMessage:"Upgrade to view this snapshot.",id:"historyModal.snapshotsMenuList.upgrade.tooltip"}),disableTooltip:!n})}}}})),s=n.snapshot&&n.snapshot.id,o=a.findIndex(e=>s===e.key),l=[{key:"snapshots",render:e=>r.createElement(fe.a,Object.assign({},e)),items:a}];return r.createElement(r.Fragment,null,r.createElement(xn.a,{type:xn.a.Type.Vertical,initialFocus:o,sections:l}),r.createElement(Da,{loading:i,fetchSize:n.size,resultSize:e.snapshotValues.length,onLoadMore:ma.c}),r.createElement(Rn.a,{show:i,showDelay:300,showHold:100,render:e=>e&&r.createElement("div",{style:Ra.wrapStyle},r.createElement(Dt.a,null))}))},this.handleUpgrade=e=>{Ia.a(this.environment,{from:"history_modal",for:e})},this.loadSnapshotsList=async(e,t)=>{const{device:n}=this.environment,r=await V.X(this.environment,e);if("failed"===r.type)throw r.error;const{snapshots:i}=r.data;if(t.openSnapshotNearTimestamp){const e=parseInt(t.openSnapshotNearTimestamp),n=i.findIndex(t=>parseInt(t.timestamp)<e);0===i.length||(0===n?ma.f(this.environment,i[n]):n>0?ma.f(this.environment,i[n-1]):i.length<t.size?ma.f(this.environment,i[i.length-1]):ma.c())}else Boolean(t.snapshot)||n.isMobile||ja.a.setState(Aa({},t,{snapshot:i[0]}));return r.data},this.iconSize=()=>{const{device:e}=this.environment;return e.isMobile?24:20}}renderComponent(){const{device:e}=this.environment,t=ja.a.state;return e.isMobile?r.createElement(ge.c,{popupType:ge.c.PopupType.SlideUp,open:t.open,render:this.renderSnapshotsListRequest,onDismiss:ma.b}):r.createElement(Fi.a,{open:t.open,innerStyle:{height:"80vh",width:"80vw",overflow:"hidden",display:"flex"},onDismiss:ma.b,render:this.renderSnapshotsListRequest,className:Bt.y})}renderMobileSnapshotPreview(e){if(this.historyIsEnabled())return r.createElement(ge.c,{popupType:ge.c.PopupType.SlideUp,open:Boolean(e.snapshot),forceFullScreenSlideUp:!0,render:()=>{if(!e.snapshot)return;const t=this.snapshotIsAvailable(e.snapshot),n=t?r.createElement(ka,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}):this.renderUnavailableMessage(Ra.restrictedMessage,"enterprise");return r.createElement(Se.b,{menuType:Se.b.MenuType.Modal,title:Object(ha.a)(parseInt(e.snapshot.timestamp)).calendar(),right:r.createElement(Ce.DoneMenuText,null),onClickRight:ma.a,leftDisabled:!t,left:r.createElement(se.b,{defaultMessage:"Restore",id:"historyModal.mobileSnapshotMenu.restoreButton.label"}),onClickLeft:()=>ma.e(this.environment),whiteBackground:t,forceFullScreenSlideUp:!0},n)}})}renderDesktopSidebar(e){const{menuState:t}=e,n=Boolean(t.snapshot&&this.snapshotIsAvailable(t.snapshot)),i=!this.historyIsEnabled();return r.createElement("div",{style:this.getSidebarStyle()},r.createElement(ba.b,{type:ba.b.OverflowType.Y,style:{flex:1}},this.renderSnapshotsMenuList(e)),r.createElement("div",{style:{display:"flex",padding:14,borderTop:"\n\t\t\t\t\t\t\t1px solid ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}},r.createElement(pt.a,{disableTooltip:!i,renderTooltip:()=>r.createElement(se.b,{defaultMessage:"Upgrade to restore snapshots.",id:"historyModal.desktopModal.sidebar.upgradeMessage.tooltip"}),render:e=>r.createElement($i.a,Object.assign({isLarge:!0,onClick:()=>ma.e(this.environment),disabled:!n},e),r.createElement(se.b,{defaultMessage:"Restore version",id:"historyModal.desktopModal.restoreButton.label"}))}),r.createElement(Ji.a,{isLarge:!0,style:{marginLeft:12},onClick:ma.b},r.createElement(se.b,{defaultMessage:"Cancel",id:"historyModal.desktopModal.cancelButton.label"}))),r.createElement(fe.a,{topBorder:!0,disableDesktopPadding:!0},r.createElement(we.a,{title:r.createElement(se.b,{id:"historyModal.desktopModal.learnMoreButton.label",defaultMessage:"Learn about page history"}),href:Object(Oe.a)("guides.pageHistory"),analyticsFrom:"page_history"})))}renderDesktopSnapshotPreview(e){if(e.snapshot)return r.createElement(r.Fragment,null,r.createElement("div",{style:{display:"flex",alignItems:"center",flexShrink:0,height:45,fontSize:14,paddingLeft:14}},e.blockStore.hasIcon()&&r.createElement(Zt.a,{disabled:!0,icon:e.blockStore.getIcon(),isEmptyPage:e.blockStore.isEmptyPage(),size:this.iconSize(),style:{marginRight:6}}),r.createElement(_i.a,{store:e.blockStore})),r.createElement(ka,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}))}renderUnavailableMessage(e,t){const{device:n}=this.environment;return r.createElement("div",{style:this.getUnavailableMessageStyle()},!n.isMobile&&this.renderVersionHistoryIcon(),r.createElement("div",{style:Aa({},!n.isMobile&&{maxWidth:340})},e),!n.isMobile&&t&&r.createElement($i.a,{isLarge:!0,onClick:()=>this.handleUpgrade(t),style:{marginTop:16}},r.createElement(se.b,{defaultMessage:"Upgrade",id:"historyModal.upgradeForHistoryButton.label"})))}renderVersionHistoryIcon(){return yt.a.versionHistory({width:64,height:"auto",fill:this.theme.lightIconColor,marginBottom:12})}renderMobileHelpButton(){return r.createElement(xa.a,{href:Object(Oe.a)("guides.pageHistory"),analyticsFrom:"page_history"})}snapshotIsAvailable(e){return!!Y.a.isAdminMode||!!this.historyIsEnabled()&&(!!St.O(this.environment,"enterprise")||parseInt(e.timestamp)>Date.now()-30*xr.a)}historyIsEnabled(){return!!Y.a.isAdminMode||St.H(this.environment)}getUnavailableMessage(){const{device:e}=this.environment,t=e.isIOS&&e.isNative;return r.createElement(r.Fragment,null,r.createElement(se.b,{defaultMessage:"Version history is not available for free workspaces.",id:"historyModal.unavailableForFreeWorkspaces.messagePart1"}),!t&&r.createElement("br",null),!t&&r.createElement(se.b,{defaultMessage:"Please upgrade to one of our paid plans.",id:"historyModal.unavailableForFreeWorkspaces.messagePart2"}))}getSidebarStyle(){return{display:"flex",flexDirection:"column",flexShrink:0,width:Ra.sidebarWidth}}getUnavailableMessageStyle(){const{device:e}=this.environment;return Aa({display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",marginTop:28,padding:16,textAlign:"center",fontSize:14},e.isMobile?{position:"relative",zIndex:1,background:this.theme.popoverBackground,boxShadow:"\n\t\t\t\t\t\t\t0 -1px 0 ".concat(this.theme.regularDividerColor,",\n\t\t\t\t\t\t\t0 1px 0 ").concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}:{height:"100%"})}}Ra.sidebarWidth=240,Ra.restrictedMessage=r.createElement(se.b,{defaultMessage:"Please upgrade to the Enterprise Plan to access versions older than 30 days.",id:"historyModal.upgradeToEnterprise.message"}),Ra.noSnapshotsMessage=r.createElement(se.b,{defaultMessage:"This page does not have any snapshots yet. Allow up to 10 minutes for the first snapshot to be generated.",id:"historyModal.noSnapshotsYet.message"}),Ra.wrapStyle={display:"flex",justifyContent:"center",padding:32};var La=Object(se.h)(Ra),Ua=n(628);class _a extends o.a{constructor(){super(...arguments),this.renderPopupContent=()=>r.createElement(qa,null)}renderComponent(){const{device:e}=this.environment,{blockStore:t,originRect:n}=oi.a.state;return r.createElement(ge.c,{popupType:e.isMobile?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:Boolean(t),originRect:n,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Center,originGap:4,onDismiss:()=>Ua.a(this.environment),render:this.renderPopupContent})}}class Wa extends o.a{didMount(){const{blockStore:e}=oi.a.state;if(!e)return;const t=e.getTitleStore();t&&en.j({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{blockStore:t}=oi.a.state;if(!t)return;const n=t.getTitleStore();if(!n)return;let i;return i=e.isMobile?{menuType:Se.b.MenuType.ActionSheet}:{menuType:Se.b.MenuType.Popup,width:380},r.createElement(Se.b,Object.assign({},i),r.createElement("div",{style:this.getWrapStyle()},r.createElement(Xt.a,{store:n,disabled:!t.canEdit(),onEsc:()=>Ua.a(this.environment),onEnter:()=>Ua.a(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Untitled",id:"renameFileMenuPopup.input.placeholder"}),style:this.getInputStyle()})))}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const qa=Object(se.h)(Wa);var Na=_a,za=n(630),Va=n(287);class Ha extends o.a{constructor(){super(...arguments),this.renderMenu=()=>{const{device:e}=this.environment,t=Va.a.state;if(!t.open)return;let n;return n=e.isReactNative&&!e.isTablet?{menuType:Se.b.MenuType.ActionSheet}:{menuType:Se.b.MenuType.Popup,width:410,maxHeight:270,onClickOutside:za.c},r.createElement(Se.b,Object.assign({},n),r.createElement(dt.a,{filter:this.getFilter(t)||"",onSubmit:this.handleSubmit,onNoResults:this.handleNoResults,isCallout:!1}))},this.handleNoResults=()=>{const e=Va.a.state;if(!e.open)return;const t=this.getFilter(e),n=u.last(t);n&&/\s/g.test(n)&&za.c()},this.handleSubmit=e=>{Gt.d(this.environment,t=>{za.a({environment:this.environment,emoji:e,transaction:t})})},this.handleCancel=()=>{za.c()}}willMountOrUpdate(){const e=Va.a.state;if(e.open){const t=Gn.a.state,n=this.getFilter(e);("editing"!==t.mode||t.store!==e.textStore||void 0===n||":"===n||n.startsWith("\n")||n.startsWith(" "))&&za.c()}}renderComponent(){const{device:e}=this.environment,t=Va.a.state;let n=!1;if(t.open){const e=this.getFilter(t);e&&e.length>0&&(n=!0),t.showPopupWithEmptyFilter&&(n=!0)}return r.createElement(ge.c,{popupType:e.isReactNative&&!e.isTablet?ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,open:n,originRect:t.open?t.selectionRect:void 0,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,render:this.renderMenu,keepFocus:!0})}getFilter(e){return Un.a(e.textStore,e.oldTextValue,!0)}}var Ga=Ha,Ya=n(730),Qa=n(393),Ka=n(837),Za=n(119),Xa=n(138);function $a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ja(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class es extends o.a{constructor(){super(...arguments),this.input=r.createRef(),this.handleInputChange=(e,t)=>{pi.a.isOpen()&&pi.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$a(Object(n),!0).forEach((function(t){Ja(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},pi.a.state,{value:e,error:t}))},this.handleSubmit=()=>{Gt.d(this.environment,e=>{Qa.c({environment:this.environment,equationStore:pi.a,transaction:e})})},this.handleClose=()=>{Qa.a()},this.handleLeft=e=>{if(!this.input.current)return;const t=this.input.current.getSelection();t&&"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&0===t.startIndex&&0===t.endIndex&&(this.handleSubmit(),Qa.a("Backward"))},this.handleRight=e=>{if(!pi.a.isOpen())return;if(!this.input.current)return;const t=this.input.current.getSelection();if(!t)return;const n=pi.a.state.value.length;"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&t.startIndex===n&&t.endIndex===n&&(this.handleSubmit(),Qa.a())},this.isDisabled=()=>{if("editing"!==Gn.a.state.mode&&!pi.a.isOpen())return!0;if(pi.a.isOpen()&&!pi.a.state.savedTextSelectionState.store.canEdit())return!0;if(pi.a.isOpen()){const e=Object(Za.b)(pi.a.state.savedTextSelectionState.store);if(e&&e.isLocked())return!0}if(pi.a.isOpen()&&pi.a.state.savedTextSelectionState.store.table===Zr.a){const e=this.getCommentValue(pi.a.state.savedTextSelectionState.store),{currentUserStore:t}=L.a.state;if(!e||!t)return!0;if(e.created_by_table!==Yn.a||t.id!==e.created_by_id)return!0}const e={[_n.b.User]:_n.b.User,[_n.b.Page]:_n.b.Page,[_n.b.Bot]:_n.b.Bot,[_n.b.Date]:_n.b.Date,[_n.b.TemporaryPage]:_n.b.TemporaryPage};for(const t of Object.values(e))if(Object(Xa.o)(t))return!0;return!1},this.INPUT_ORIGIN_GAP_PX=8}renderComponent(){if(pi.a.isOpen())return r.createElement(Ka.a,{ref:this.input,isOpen:!0,equationValue:pi.a.state.value,error:pi.a.state.error,displayMode:"inline",disabled:this.isDisabled(),originRect:this.getInputOriginRect(),originGap:this.INPUT_ORIGIN_GAP_PX,onDismiss:this.handleClose,onChange:this.handleInputChange,onSubmit:this.handleSubmit,onLeft:this.handleLeft,onRight:this.handleRight})}getCommentValue(e){return Ya.a.createChildStore(e,{table:Zr.a,id:e.id}).getValue()}getInputOriginRect(){if(pi.a.isOpen())return pi.a.state.savedTextSelectionRect}}var ts=es;class ns extends o.a{constructor(){super(...arguments),this.renderTooltip=()=>r.createElement(ve.a,{capture:!0,onEnter:this.handleEnter,onCommandEnter:this.handleCommandEnter},r.createElement(r.Fragment,null,r.createElement(se.b,{defaultMessage:"Open page",id:"pageMentionOverlay.openPage"}),r.createElement("div",null,r.createElement(Qr.a,{onlyShowFirst:!0,name:"enter",style:{color:this.theme.mediumInvertedTextColor}})))),this.handleEnter=e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:n,store:r}=t;if(!n)return;e.preventDefault&&e.preventDefault();const i=g.a.createChildStore(r,{table:b.b,id:n});Q.h({store:i,environment:this.environment,visitType:"Link"})},this.handleCommandEnter=e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:n,store:r}=t;if(!n)return;e.preventDefault();const i=g.a.createChildStore(r,{table:b.b,id:n});Q.h({store:i,environment:this.environment,visitType:"Link",metaClick:!0})},this.pageMentionTokenStore=this.createComputedStore(()=>{const e=Gn.a.state;if("editing"!==e.mode)return;const{selection:t,store:n}=e;if(t.endIndex!==t.startIndex+1)return;const r=n.getValue(),i=_n.fb(r,t.startIndex);if(!i||!_n.zb(i))return;const[a]=_n.V([i]);return{pageId:a,store:n}})}renderComponent(){if(this.environment.device.isMobile)return;const e=Wr.d(),t=this.pageMentionTokenStore.state;return r.createElement(pt.a,{render:()=>{},renderTooltip:this.renderTooltip,originRect:e,forceVisibleState:Boolean(t&&e),placement:pt.a.Placement.Bottom})}}var rs=ns,is=n(260);class as extends o.a{constructor(){super(...arguments),this.handleKey=e=>{T.a.state.isActive&&(e.preventDefault(),Object(is.b)({environment:this.environment,currentX:T.a.state.currentX,currentY:T.a.state.currentY,toggle:e.shiftKey}))},this.handleMouseMove=e=>{T.a.state.isActive&&(e.preventDefault(),Object(is.b)({environment:this.environment,currentX:e.clientX,currentY:e.clientY,toggle:e.shiftKey}))},this.handleMouseUp=e=>{T.a.state.isActive&&(e.preventDefault(),Object(is.a)(this.environment))}}willMount(){window.addEventListener("keydown",this.handleKey),window.addEventListener("keyup",this.handleKey),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)}willUnmount(){window.removeEventListener("keydown",this.handleKey),window.removeEventListener("keyup",this.handleKey),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)}renderComponent(){return null}}var ss=as,os=n(406),ls=n(587),cs=n(560),ds=n(81),us=n(274),ps=n(723),ms=n(64),hs=n(625),gs=n(686),bs=n(30),fs=n(299),ys=n(250),Ss=n(264);function vs(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Es(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vs(Object(n),!0).forEach((function(t){Ms(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vs(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ms(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ws(e){const[t]=Object(os.b)(ni.a),n=Object(ls.a)(),a=Object(os.a)(()=>{if(!t.open)return!1;if(t.focusMenu)return!1;const e=Gn.a.state;if("editing"!==e.mode)return!0;const{store:n,selection:r}=e;return Object(Xa.m)(r)?!_n.lb(n.getValue(),r.startIndex,r.endIndex,_n.b.Link):!Object(Xa.n)(e.selection,t.savedTextSelectionState.selection)},[t]);return Object(r.useEffect)(()=>{a&&cs.a()},[a]),i.a.createElement(ge.c,{popupType:n.isMobile?n.isTablet?ge.c.PopupType.Popup:ge.c.PopupType.SlideUp:ge.c.PopupType.Popup,style:{width:330},keepFocus:n.isPhone,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:ge.c.Placement.Bottom,alignmentToOrigin:ge.c.Alignment.Center,originGap:8,disableContentScroll:!0,onDismiss:cs.a,render:()=>t.open?i.a.createElement(Cs,{state:t}):void 0})}function Cs(e){const{state:t}=e,n=Object(ls.d)(),a=Object(se.i)(),s=a.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder",description:"Placeholder text in the link input field when there is no current link"}),o=a.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder",description:"Placeholder text in the link input field when there is an existing link that will be modified"}),[l,c]=Object(r.useState)(!0);if(Object(r.useEffect)(()=>c(!1),[]),t.showCreateIn&&!n)return i.a.createElement(Os,{state:t});const d=!n||!t.showCreateIn,u=n?void 0:!t.showCreateIn&&t.focusMenu,p=t.editingToken?o:s,m=i.a.createElement(fe.a,{isInput:!0,desktopStyle:Fs(t)?{marginBottom:8}:void 0},d&&i.a.createElement(ye.a,{onFocus:xs,placeholder:p,value:t.url,onChange:js,focus:u,focusInitial:n,focusAfterAnimation:!0,allowArrows:!0}));let h;return h=n?{menuType:Se.b.MenuType.Modal,title:i.a.createElement(se.b,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:i.a.createElement(Ce.CancelMenuText,null),onClickRight:cs.a,header:m,footer:i.a.createElement(ge.c,{popupType:ge.c.PopupType.SlideUp,open:t.showCreateIn||!1,render:()=>i.a.createElement(Os,{state:t})})}:{menuType:Se.b.MenuType.Popup,header:m},i.a.createElement(Si.a,{capture:t.open&&(l||t.focusMenu),allowEsc:!0},i.a.createElement(Se.b,Object.assign({},h),i.a.createElement(ks,{state:t})),i.a.createElement(ve.a,{capture:!0,onCommandSlash:xs}))}function Os(e){const{state:t}=e,n=Object(ls.b)(),a=Object(r.useCallback)(async e=>{if(!ds.k(n))return;const r=Gt.c(n),i=Object(er.e)({environment:n,transaction:r,titleText:t.url||"",createInValue:e,recordStoreParent:t.savedTextSelectionState.store}),[a]=i.createdPages;a&&cs.b({environment:n,url:Object(us.a)({pageId:a.id}),transaction:r,editingToken:t.editingToken,savedTextSelectionState:t.savedTextSelectionState}),await i.moveToStorePromise,await Gt.b({environment:n,transaction:r}),await Object(er.a)({analyticsFrom:"link_menu",createInState:i})},[t,n]),s="block"===t.savedTextSelectionState.store.table?t.savedTextSelectionState.store.id:void 0;return i.a.createElement(Ln.a,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:a,captureSelection:!1,restoreSelection:!1,parentBlockId:s,onAutocompleteQueryChange:Ps,autocompleteQuery:t.createInQuery||"",desktopWidth:330,onCancel:Ds})}function ks(e){const{state:t}=e,n=Object(ls.b)(),a=Object(ls.d)(),s=Object(gs.b)(),[{online:o}]=Object(os.b)(Nn.a),l=Object(r.useMemo)(()=>As(t),[t]),c=Object(r.useMemo)(()=>Rs(l),[l]),d=Object(r.useMemo)(()=>{const{store:e}=t.savedTextSelectionState;if(Object(oe.n)(e))return e},[t]),[{value:p,status:m}]=Object(ps.a)(async()=>{if(!l||!o)return[];return(await Object(Tt.e)({nearBlock:d,environment:n,query:l,source:"mention_menu",limit:10})).map(e=>e.id)},[l,d,n,o]),h=Object(r.useMemo)(()=>{if(c&&"notion"===c.type){const e=p?u.without(p,c.notionPage.blockId):[];return[c,...e]}return p},[p,c]),f=Object(r.useMemo)(()=>{if(!h||0===h.length)return;if(c&&"web"===c.type&&c.url===l)return;const e=fs.a.withListenerIgnored(P.d);if(!e)return;const r=t.url?5:3,a=i.a.createElement(se.b,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block",description:"Shown beneath a page title if linking to a block inside that page"}),s=i.a.createElement(se.b,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"}),o=u.compact(h.map(r=>{const s="object"==typeof r?r.notionPage.peekViewBlockId||r.notionPage.blockId:r,o=g.a.createChildStore(e,{table:b.b,id:s});return{key:s,action:()=>{if("object"==typeof r){const e=Object(us.a)({pageId:r.notionPage.blockId,peekViewBlockId:r.notionPage.peekViewBlockId,discussionId:r.notionPage.discussionId,collectionViewId:r.notionPage.collectionViewId,scrollToBlockId:r.notionPage.scrollToBlockId});Is(n,t,e)}else Is(n,t,Object(us.a)({pageId:s}))},render:e=>{const t="object"==typeof r&&r.notionPage.scrollToBlockId;return i.a.createElement(An.a,Object.assign({},e,{store:o,caption:t?a:void 0,placeholder:i.a.createElement(Rn.a,{showHold:300,showDelay:300,show:"resolved"===m,render:e=>e?i.a.createElement(se.b,{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}):i.a.createElement(se.b,{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}))}}})).slice(0,r),d=h.some(e=>Boolean("object"==typeof e&&e.notionPage.scrollToBlockId));return{key:"mention results",items:o,render:e=>i.a.createElement(fe.a,Object.assign({},e,{title:d?s:a,isTitleUppercase:!0}))}},[h,t,n,l,c,m]),y=Object(r.useMemo)(()=>{const e=i.a.createElement(se.b,{defaultMessage:"Linked to",id:"selectionLinkButton.linkedToSection.title"}),r=Bs(t),a=r?Object(us.c)(r):void 0;if(a&&r){const t=fs.a.withListenerIgnored(P.d);if(!t)return;const s=g.a.createChildStore(t,{table:b.b,id:a});return{key:"linked to",render:t=>i.a.createElement(fe.a,Object.assign({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to page",action:e=>{let{event:t}=e;const i=t&&t.metaKey;i||ni.a.setState({open:!1}),Object(Q.f)({environment:n,url:r,metaClick:i})},render:e=>i.a.createElement(An.a,Object.assign({},e,{store:s}))}]}}if(r)return{key:"linked to",render:t=>i.a.createElement(fe.a,Object.assign({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to web",action:e=>{let{event:t}=e;return Object(Q.f)({environment:n,url:r,metaClick:t&&t.metaKey})},render:e=>i.a.createElement(jt.a,Object.assign({},e,{title:r,caption:i.a.createElement(se.b,{defaultMessage:"Web page",id:"selectionLinkButton.linkedToSection.webPage"}),icon:yt.a.globe2({width:16,fill:s.mediumIconColor})}))}]}},[n,t,s]),S=Object(r.useMemo)(()=>{if(!c)return;if("notion"===c.type&&o)return;let e;if("web"===c.type)e=i.a.createElement(se.b,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"});else if("notion"===c.type)e=i.a.createElement(se.b,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"});else{if("other"!==c.type)throw Object(bs.e)(c);e=i.a.createElement(se.b,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"})}return{key:"link to url",action:()=>Is(n,t,l),render:t=>i.a.createElement(jt.a,Object.assign({},t,{title:e,icon:yt.a.link({width:16})}))}},[t,l,n,o,c]),v=Object(r.useMemo)(()=>{if(t.editingToken)return{key:"copy link",action:()=>function(e,t){const n=Bs(t);if(!n)return;const r=Object(us.c)(n),i=r?Object(Ss.a)({pageId:r,baseUrl:Y.a.baseURL}):n;ys.c({environment:e,stringValue:i}),cs.a()}(n,t),render:e=>i.a.createElement(jt.a,Object.assign({},e,{title:i.a.createElement(se.b,{id:"selectionLinkButton.copyLink",defaultMessage:"Copy link",description:"Copies the URL for the focused link to the user's clipboard"}),icon:yt.a.copy({width:16})}))}},[t,n]),E=Object(r.useMemo)(()=>{if(t.editingToken)return{key:"unlink",action:()=>cs.d(n),render:e=>i.a.createElement(jt.a,Object.assign({},e,{title:i.a.createElement(se.b,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:yt.a.trash({width:16})}))}},[t.editingToken,n]),M=Object(r.useMemo)(()=>{if(!l)return;if(!t.savedTextSelectionState.store.isDefaultRecordCache())return;const e=Rs(l);return!e||e.url!==l&&!e.notionPage?{key:"create page",action:Ts,render:e=>i.a.createElement(jt.a,Object.assign({},e,{icon:yt.a.alias({width:16}),title:i.a.createElement(or,{pageTitle:l})}))}:void 0},[l,t.savedTextSelectionState.store]),w=u.compact([f,y]),C=w.length>0,O=Object(r.useMemo)(()=>{const e=u.compact([S,v,E,M]);if(0!==e.length)return{key:"link actions",render:e=>i.a.createElement(fe.a,Object.assign({topBorder:C},e)),items:e}},[C,S,v,E,M]),k=u.compact([...w,O]),T=Object(r.useMemo)(()=>{if(a)return;if(!c||!O||!S)return 0===k.length?void 0:0;const e=u.sum(w.map(e=>e.items.length))+O.items.indexOf(S);return Math.max(e,0)},[a,c,O,S,k,w]);return i.a.createElement(xn.a,{type:xn.a.Type.Vertical,initialFocus:T,sections:k})}function Ps(e){const t=ni.a.state;t.open&&ni.a.setState(Es({},t,{createInQuery:e}))}function Ts(){const e=ni.a.state;e.open&&ni.a.setState(Es({},e,{showCreateIn:!0}))}function Ds(){const e=ni.a.state;e.open&&ni.a.setState(Es({},e,{showCreateIn:!1,createInQuery:""}))}function Is(e,t,n){const r=Object(hs.a)(n);r&&Gt.d(e,n=>{cs.b({environment:e,transaction:n,url:r,editingToken:t.editingToken,savedTextSelectionState:t.savedTextSelectionState})})}const js=e=>{const t=ni.a.state;t.open&&ni.a.setState(Es({},t,{url:e.target.value,focusMenu:!0}))};function xs(){const e=ni.a.state;e.open&&(e.focusMenu||ni.a.setState(Es({},e,{focusMenu:!0})))}function Bs(e){const{editingToken:t}=e;if(!t)return;const n=_n.cb(t),r=_n.z(n);return r?_n.Q(r):void 0}function As(e){return e.url||""}function Fs(e){return""===As(e)&&void 0===Bs(e)}function Rs(e){const t=_n.S(e);if(t&&"url"===t.type){const e=Object(Ar.k)({url:t.href,baseUrl:Y.a.baseURL,isMobile:!1,protocol:void 0,currentUrl:void 0});return"page"===e.name?{type:"notion",url:t.href,notionPage:e}:{type:"web",url:t.href}}const n=Object(ms.h)({str:e,allowNoProtocol:!1});if(n)return{type:"other",url:n}}var Ls=n(525),Us=n(131),_s=n(755),Ws=n(304),qs=n(432);function Ns(e){const[t]=Object(os.b)(Ls.a),n="on"===Object(ls.c)("link-hover-preview"),a=Object(os.c)(Us.a),s=Object(Ws.b)(t,400,Object.is),o=t&&t===s,l=Object(r.useMemo)(()=>s&&s.token.node.getBoundingClientRect(),[s]);return n?i.a.createElement(ge.c,{disableMouseCapture:!0,preventCaptureEsc:!0,preventPointerEvents:!0,preventScaleTransition:!0,preventOpacityTransition:!0,popupType:ge.c.PopupType.Popup,open:Boolean(!a&&o),originRect:l,originGap:8,alignmentToOrigin:ge.c.Alignment.Start,placementToOrigin:ge.c.Placement.Bottom,useLightBoxShadow:!0,render:()=>s&&i.a.createElement(zs,{state:s})}):null}function zs(e){const{annotation:t,store:n}=e.state,a=Object(ls.b)(),s=Object(gs.b)(),o=_n.Q(t),l=Object(us.c)(o),c=Object(gs.a)(e=>({wrapper:{fontSize:Ke.a.fontSize.UISmall.desktop,padding:"4px 8px",color:e.mediumTextColor,fontWeight:Ke.a.fontWeight.medium,fill:e.mediumIconColor,maxWidth:450},icon:{height:"1em",width:"1em",marginRight:"0.25em",fill:e.mediumIconColor}}),[]),d=Object(os.a)(()=>{if(!l)return;const e=g.a.createChildStore(n,{table:b.b,id:l}),t=e.getValue(),r=t&&Object(Xn.h)({pageValue:t,baseUrl:Y.a.baseURL,getRecordValue:n.getRecordValue,emojiType:Object($n.a)(a),isSafariOrIOS:a.device.isSafari||a.device.isIOS,isClient:!0,showEmojiInline:a.device.isWindows,currentUserId:a.currentUser.id}),s=t&&t.parent_id!==n.id?yt.a.alias(c.icon):void 0;return i.a.createElement(i.a.Fragment,null,r,s,i.a.createElement(_i.a,{style:Ke.a.textOverflowStyle,store:e}))},[l,s,c]);return Object(r.useEffect)(()=>{const e=u.throttle(qs.a,200,{leading:!0});return h.a(window,"scroll",e,!0),()=>h.b(window,"scroll",e,!0)},[]),i.a.createElement(_s.a,{style:c.wrapper,alignItems:"center"},d||i.a.createElement(i.a.Fragment,null,yt.a.globe2(c.icon),i.a.createElement("div",{style:Ke.a.textOverflowStyle},o)))}class Vs extends o.a{willMount(){this.environment.device.isMobile&&document.addEventListener("gesturestart",(function(e){e.preventDefault()}))}renderComponent(){const e=this.environment.currentUser.isLoggedIn(),{isMobile:t,isElectron:n}=this.environment.device,{currentSpaceStore:i}=L.a.state;return r.createElement(r.Fragment,null,r.createElement(pe,null),r.createElement(Sn,null),r.createElement(kn,null),r.createElement(In,null),r.createElement(d,null),r.createElement(a.a,{isRoot:!0,capture:!0}),r.createElement(F,null),e&&!t&&r.createElement(q,null),e&&i&&r.createElement(ce,{rootStore:i}),r.createElement(ze,null),r.createElement(Qt,null),r.createElement(Ie,null),r.createElement(an,null),r.createElement(Na,null),r.createElement(it,null),r.createElement(Le,null),!t&&r.createElement(fi,null),r.createElement(ts,null),r.createElement(rs,null),r.createElement(Vt,null),r.createElement(sn.a,{store:C.a}),r.createElement(sn.a,{store:w.a}),r.createElement(Mr,null),r.createElement(Tr,null),r.createElement(Ga,null),r.createElement(_r,null),r.createElement(ws,null),n&&r.createElement(Oi,null),r.createElement(Ai,null),r.createElement(aa,null),r.createElement(pa,null),r.createElement(ss,null),e&&r.createElement(La,null),r.createElement(Ns,null))}}t.default=Vs},1151:function(e,t,n){"use strict";n.r(t);n(15),n(12),n(169);var r=n(2),i=n(0),a=n(14),s=n(168),o=n(17),l=n(26),c=n(10),d=n(67),u=n(8),p=n(221),m=n(747),h=n(154),g=n(21),b=n(55),f=n(242),y=n(1496),S=n(69),v=n(161),E=n(688),M=n(53),w=n(311),C=n(116),O=n(687),k=n(3),P=n(22),T=n(192),D=n(37),I=n(1);function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function A(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class F extends k.a{constructor(){super(...arguments),this.createBlockStore=e=>{const{parentStore:t}=this.props;return l.a.createChildStore(t,{table:c.b,id:e})},this.createUserStore=e=>{const{parentStore:t}=this.props;return T.a.createChildStore(t,{table:D.a,id:e})},this.getUserValue=e=>this.createUserStore(e).getValue(),this.getCreatedTimeDetail=e=>{const{intl:t}=this.props,{starting:n,ending:r}=e;return n&&r?i.createElement(I.b,{defaultMessage:"Created {startDate} to {endDate}",id:"search.recentMenuItem.createdDateWithRange.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created in a specific date range. {startDate} and {endDate} are dates including the month, day, and year.",values:{startDate:O.c(n,t),endDate:O.c(r,t)}}):n?i.createElement(I.b,{defaultMessage:"Created after {startDate}",id:"search.recentMenuItem.createdDateAfter.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created after a specific date. {startDate} is a date including the month, day, and year.",values:{startDate:O.c(n,t)}}):r?i.createElement(I.b,{defaultMessage:"Created before {endDate}",description:"Shown as part of the subtitle if the recent search involved searching for content created before a specific date. {endDate} is a date including the month, day, and year.",id:"search.recentMenuItem.createdDateBefore.subtitle",values:{endDate:O.c(r,t)}}):void 0},this.getLastEditedTimeDetail=e=>{const{intl:t}=this.props,{starting:n,ending:r}=e;return n&&r?i.createElement(I.b,{defaultMessage:"Last edited {startDate} to {endDate}",id:"search.recentMenuItem.lastEditedDateWithRange.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content last edited in a specific date range. {startDate} and {endDate} are dates including the month, day, and year.",values:{startDate:O.c(n,t),endDate:O.c(r,t)}}):n?i.createElement(I.b,{defaultMessage:"Last edited after {startDate}",id:"search.recentMenuItem.lastEditedDateAfter.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content last edited after a specific date. {startDate} is a date including the month, day, and year.",values:{startDate:O.c(n,t)}}):r?i.createElement(I.b,{defaultMessage:"Last edited before {endDate}",description:"Shown as part of the subtitle if the recent search involved searching for content last edited before a specific date. {endDate} is a date including the month, day, and year.",id:"search.recentMenuItem.lastEditedDateBefore.subtitle",values:{endDate:O.c(r,t)}}):void 0},this.styles={recentSearchItem:()=>{const{device:e}=this.environment;return{minHeight:void 0,paddingTop:e.isMobile?12:8,paddingBottom:e.isMobile?12:8}},inlineCaption:{display:"block",marginTop:1},queryText:{flexShrink:0},detailEmphasis:{fontWeight:P.a.fontWeight.medium},enterIcon:{height:14,width:14},textWrapper:{marginLeft:8},iconWrapper:{height:19,width:19,display:"flex",alignItems:"center"}}}renderComponent(){const{device:e}=this.environment,t=this.props,{query:n}=t,r=A(t,["query"]),a=this.styles,s=this.getThemeColors(),o=i.createElement("div",{style:a.queryText},n.text.trim()),l=x({},a.recentSearchItem(),{},this.environment.device.isMobile&&s.menuItemMobile),c=!e.isMobile;return i.createElement(M.a,Object.assign({},r,{style:l,inline:c,icon:this.renderIcon(),title:o,caption:this.renderRecentSearchCaption(),captionStyle:c?a.inlineCaption:void 0,right:this.renderEnterIcon(),disableTransition:!0,dontShrinkRight:!0,textWrapperStyle:a.textWrapper,className:"notranslate"}))}renderRecentSearchCaption(){const{query:e}=this.props,{isNavigableOnly:t,ancestors:n,createdBy:r,editedBy:a,lastEditedTime:s,createdTime:o}=e.filters,l=[];if(t&&l.push(i.createElement(I.b,{defaultMessage:"Only match titles",id:"search.recentMenuItem.onlyMatchTitles.subtitle"})),n.length>0){const e=this.renderRecentSearchAncestors(n);l.push(i.createElement(I.b,{defaultMessage:"In {pages}",id:"search.recentMenuItemDetail.inPage.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content in specific pages. {pages} is the title of the first page that the search was conducted in, with something like '+ 1' or '+ 2' following it, depending on the number of additional pages that were searched.",values:{pages:this.renderListItems(e)}}))}if(r.length>0){const e=this.renderRecentSearchUsers(r);l.push(i.createElement(I.b,{defaultMessage:"Created by {people}",id:"search.recentMenuItemDetail.createdBy.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content created by specific people. {people} is the name of the first person, with something like '+ 1' or '+ 2' following it, depending on the number of additional people in the search.",values:{people:this.renderListItems(e)}}))}if(a.length>0){const e=this.renderRecentSearchUsers(a);l.push(i.createElement(I.b,{defaultMessage:"Edited by {people}",id:"search.recentMenuItemDetail.editedBy.subtitle",description:"Shown as part of the subtitle if the recent search involved searching for content edited by specific people. {people} is the name of the first person, with something like '+ 1' or '+ 2' following it, depending on the number of additional people in the search.",values:{people:this.renderListItems(e)}}))}if(o.starting||o.ending){const e=this.getCreatedTimeDetail(o);l.push(e)}if(s.starting||s.ending){const e=this.getLastEditedTimeDetail(s);l.push(e)}if(l.length>0)return Object(w.a)(l,()=>" · ")}renderListItems(e){if(0===e.length)return;if(1===e.length)return e;const[t,...n]=e,r=n.length;return i.createElement(I.b,{defaultMessage:"{firstPageOrPerson} + {numberRemaining}",id:"search.recentMenuItem.listOfPeopleOrPages.label",values:{firstPageOrPerson:t,numberRemaining:r},description:"This shows the people or pages the recent search item was conducted against. The '+' symbol means 'and'."})}renderRecentSearchAncestors(e){const t=this.styles;return e.map(e=>i.createElement(i.Fragment,{key:e}," ",i.createElement(C.a,{key:e,store:this.createBlockStore(e),style:t.detailEmphasis,shouldWrap:!0})))}renderRecentSearchUsers(e){const t=this.styles;return e.map(e=>{const n=this.getUserValue(e);return i.createElement(i.Fragment,{key:e}," ",i.createElement("span",{style:t.detailEmphasis},Object(D.d)(n)))})}renderEnterIcon(){const{device:e}=this.environment,{focused:t}=this.props,n=this.styles,r=this.getThemeColors();if(e.isMobile)return;const i=x({},n.enterIcon,{},r.enterIcon);return t?u.a.enter(i):void 0}renderIcon(){const{icon:e}=this.props;return i.createElement("div",{style:this.styles.iconWrapper},e)}getThemeColors(){return{menuItemMobile:{boxShadow:"0 1px 0 ".concat(this.theme.lightDividerColor)},enterIcon:{fill:this.theme.mediumIconColor}}}}F.contextTypes=g.c;var R=Object(I.h)(F),L=n(181),U=n(255),_=n(42),W=n(183),q=n(160),N=n(30);const z={listStyleType:"none",padding:0,margin:0};P.a.fontWeight.regular;function V(e,t){const n="UIRegular"===t?P.a.fontSize.UIRegular:"UISmall"===t?P.a.fontSize.UISmall:Object(N.e)(t);return e.device.isMobile?n.mobile:n.desktop}function H(e,t){const n="UIRegular"===t?P.a.lineHeight.UIRegular:"UISmall"===t?P.a.lineHeight.UISmall:Object(N.e)(t);return e.device.isMobile?n.mobile:n.desktop}function G(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function Y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Y(Object(n),!0).forEach((function(t){K(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Z extends k.a{constructor(){super(...arguments),this.styles={menuItem:Q({minHeight:void 0},this.environment.device.isMobile&&{background:void 0,boxShadow:void 0},{paddingTop:32,paddingBottom:32}),text:{textAlign:"center"},title:{margin:0,fontWeight:P.a.fontWeight.medium,fontSize:V(this.environment,"UIRegular"),lineHeight:H(this.environment,"UIRegular")},caption:{fontSize:V(this.environment,"UIRegular")}}}renderComponent(){const e=this.props,{style:t}=e,n=G(e,["style"]),r=t?Q({},this.styles.menuItem,{},t):this.styles.menuItem;return i.createElement(q.a,Object.assign({},n,{title:this.renderTitle(),caption:this.renderCaption(),textWrapperStyle:this.styles.text,style:r}))}renderTitle(){const{title:e}=this.props;if(!e)return;const t=this.styles,n=this.getThemeColors(),r=Q({},t.title,{},n.title);return i.createElement("h4",{role:"alert",style:r},e)}renderCaption(){const{caption:e}=this.props;if(!e)return;const t=this.styles,n=this.getThemeColors(),r=Q({},t.caption,{},n.caption);return i.createElement("div",{style:r},e)}getThemeColors(){return{title:{color:this.theme.mediumTextColor},caption:{color:this.theme.lightTextColor}}}}Z.contextTypes=Q({},g.c);var X=Z,$=n(182),J=n(247),ee=n(744);function te(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ne(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?te(Object(n),!0).forEach((function(t){re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):te(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ie extends k.a{constructor(){super(...arguments),this.handleSendMessageClick=()=>{ee.a({environment:this.environment,from:"quick_find"})},this.styles={menuItem:{marginTop:"auto",marginBottom:"auto"},reportProblemButton:{display:"inline"}}}renderComponent(){return i.createElement(X,Object.assign({},this.getErrorMessage(),{style:this.styles.menuItem}))}renderNoResults(){const{searchStore:e}=this.props,t=O.l(e.state.query.filters);return{title:ie.noResultsTitle,caption:t?i.createElement(I.b,{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}):i.createElement(I.b,{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}}renderOffline(){return{title:ie.noResultsTitle,caption:i.createElement(I.b,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"})}}renderRequestFailed(){var e=this;const t=this.styles,n=this.getThemeColors(),r=ne({},t.reportProblemButton,{},n.reportProblemButton);return{title:i.createElement(I.b,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:i.createElement(I.b,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:function(){for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];return i.createElement($.a,{onClick:e.handleSendMessageClick,style:r},n)}}})}}getErrorMessage(){const{error:e}=this.props;switch(e.type){case J.d.NoResults.type:return this.renderNoResults();case J.d.Offline.type:return this.renderOffline();case J.d.RequestFailed.type:return this.renderRequestFailed();default:return Object(N.e)(e)}}getThemeColors(){return{reportProblemButton:{color:this.theme.blueColor}}}}ie.contextTypes=ne({},g.c),ie.noResultsTitle=i.createElement(I.b,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});var ae=ie,se=n(302),oe=n(99),le=n(1291),ce=n(24),de=n(297);function ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ue(Object(n),!0).forEach((function(t){me(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function me(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class he extends k.a{constructor(){super(...arguments),this.renderKeyboardShortcut=(e,t)=>{const n=this.styles,r=this.getThemeColors(),a=pe({},n.keyboardShortcut,{},r.keyboardShortcut,{},t);return i.createElement("span",{style:a},e)},this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?P.a.fontSize.UIRegular.mobile:P.a.fontSize.UIRegular.desktop}},footerText:pe({fontSize:V(this.environment,"UISmall")},P.a.textOverflowStyle),inlineHint:{display:"inline",marginRight:16},resultCountWrapper:pe({display:"flex",alignItems:"center"},P.a.textOverflowStyle),resultCount:{fontWeight:P.a.fontWeight.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*V(this.environment,"UISmall")},commandGlyph:{fontSize:.75*V(this.environment,"UIRegular")}}}renderComponent(){return this.props.mode===le.c.Mode.Results?this.renderResultState(this.props.results):this.renderSection(this.renderHelpText())}renderResultState(e){const t=this.styles,n=this.getThemeColors(),r=pe({},t.resultCount,{},n.resultCount),{count:a,isLowerBound:s}=this.getResultCount(e),o=i.createElement("span",{style:t.resultText},s?this.props.intl.formatMessage({id:"searchFooter.helpText.resultCountApproximate",description:"Approximate number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, other {<resultwrapper>{resultCount}+</resultwrapper> results}}"},{resultCount:a,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.createElement("span",{style:r},t)}}):this.props.intl.formatMessage({id:"searchFooter.helpText.resultCount",description:"Exact number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, one {<resultwrapper>{resultCount}</resultwrapper> result} other {<resultwrapper>{resultCount}</resultwrapper> results}}"},{resultCount:a,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return i.createElement("span",{style:r},t)}})),l=i.createElement("div",{style:t.resultCountWrapper},o,this.props.mode===le.a.Results&&this.renderSpinner(this.props.showSpinner));return this.renderSection(l)}renderSpinner(e){const t=this.styles;return i.createElement(de.a,{show:e,showDelay:500,showHold:200,render:e=>e&&i.createElement(oe.a,{style:t.spinner})})}renderSection(e){const t=this.styles,n=this.getThemeColors(),r=pe({},t.footerText,{},n.footerText);return i.createElement(ce.a,{topBorder:!0,style:t.footer(),disableDesktopPadding:!0},i.createElement(q.a,{title:e,style:r}))}renderHelpText(){const e=this.styles,t=this.getThemeColors(),n=pe({},z,{},e.footerText,{},t.footerText),r=pe({},e.commandGlyph,{},t.keyboardShortcut),{command:a}=se.a(this.environment),{device:s}=this.environment;return i.createElement("ul",{style:n},i.createElement("li",{style:e.inlineHint},this.renderKeyboardShortcut("↑↓"),this.props.intl.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})),i.createElement("li",{style:e.inlineHint},this.renderKeyboardShortcut("Enter"),this.props.intl.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})),i.createElement("li",{style:e.inlineHint},i.createElement("span",{style:r},a),this.renderKeyboardShortcut("+Enter"),s.isElectron?this.props.intl.formatMessage({id:"searchFooter.helpText.openNewWindow",defaultMessage:"Open in a new window"}):this.props.intl.formatMessage({id:"searchFooter.helpText.openNewTab",defaultMessage:"Open in a new tab"})))}getResultCount(e){const t=e.server?e.server.total:e.local.total;return{count:t,isLowerBound:Boolean(e.server&&e.local&&t<le.b)}}getThemeColors(){return{footerText:{color:this.theme.lightTextColor},resultCount:{color:this.theme.mediumTextColor},keyboardShortcut:{color:this.theme.mediumTextColor}}}}var ge=Object(I.h)(he),be=n(77),fe=n(49),ye=n(79),Se=n(13),ve=n(19),Ee=n(16);const Me="Invalid date",we="Invalid range";class Ce extends Ee.a{getInitialState(){return{edited:!1,temporary:"",error:void 0}}}var Oe=Ce,ke=n(153),Pe=n(167),Te=n(689),De=n(39);function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){xe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Be(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class Ae extends k.a{constructor(){super(...arguments),this.storeTypes={store:Oe},this.renderInput=()=>{const{device:e}=this.environment,t=this.props,{store:n,hideClearButton:r,focused:a}=t,s=Be(t,["store","hideClearButton","focused"]),o=e.isMobile?"date":"text",l="date"===o?ke.b.Format.Transparent:ke.b.Format.Large,c=e.isMobile?void 0:a;return i.createElement(Pe.a,Object.assign({},s,{type:o,format:l,left:this.renderMobilePlaceholder(o),showClearButton:this.showClearButton(),focus:c,onFocus:this.handleFocus,onClearButtonClick:this.handleClear,onChange:this.handleChange,onSubmit:this.handleSubmit,onBlur:this.handleBlur,value:this.getInputValue()},this.getInputStyles()))},this.handleFocus=e=>{const{onFocus:t}=this.props,{store:n}=this.stores;n.setState(je({},n.state,{edited:!1})),t&&t(e)},this.handleClear=()=>{const{onClear:e,onUpdate:t}=this.props,{store:n}=this.stores;n.setState(je({},n.state,{edited:!0,temporary:"",error:void 0}));const r=this.validateCurrent();r&&t(r),n.setState(je({},n.state,{edited:!1})),e&&e()},this.handleChange=e=>{const{device:t}=this.environment,{store:n}=this.stores;n.setState(je({},n.state,{edited:!0,temporary:e.target.value||""})),t.isAndroid&&this.handleBlur()},this.handleSubmit=e=>{const{onUpdate:t,onSubmit:n}=this.props,{store:r}=this.stores,i=this.validateCurrent();i&&(t(i),i.error?r.setState(je({},r.state,{edited:!1,error:i.error})):r.reset()),n&&n(e,i)},this.handleBlur=e=>{const{onUpdate:t,onBlur:n}=this.props,{store:r}=this.stores,i=this.validateCurrent();i?(t(i),i.error?r.setState(je({},r.state,{edited:!1,error:i.error})):r.reset()):r.setState(je({},r.state,{edited:!1})),e&&n&&n(e)},this.styles={menuItem:{marginBottom:this.environment.device.isMobile?1:12},inputWrapper:{borderRadius:3,height:28,paddingRight:this.showClearButton()?6:0,position:"relative"},inputEditRegion:{width:this.showClearButton()?"calc(100% - 14px)":"100%"},inputEditRegionMobile:{padding:"2px 6px",position:"relative"},placeholder:{position:"absolute",left:6,top:"50%",transform:"translateY(-50%)"},tooltipOriginGap:-8}}didUpdate(e){const{store:t}=this.stores;r.isEqual(e.value,this.props.value)||t.reset()}renderComponent(){const e=this.styles,t=this.getError();return t?i.createElement(De.a,{renderTooltip:()=>t,forceVisibleState:!0,placement:De.a.Placement.Left,render:this.renderInput,originGap:e.tooltipOriginGap}):this.renderInput()}renderMobilePlaceholder(e){const{placeholder:t,value:n}=this.props,r=this.styles,a=this.getThemeColors();if("date"===e&&!n)return i.createElement("div",{style:je({},r.placeholder,{},a.placeholder)},t)}getInputValue(){const{device:e}=this.environment,{value:t,dateFormat:n,intl:r}=this.props,{store:i}=this.stores;return e.isMobile?t?O.c(t,r,"YYYY-MM-DD"):"":i.state.temporary?i.state.temporary:i.state.edited?i.state.temporary:t?O.c(t,r,n):""}getError(){const{store:e}=this.stores,{intl:t}=this.props;if(e.state.error)switch(e.state.error){case Me:return t.formatMessage({id:"dateInputError.invalidDateError.tooltip",defaultMessage:"Invalid date"});case we:return t.formatMessage({id:"dateInputError.invalidDateRangeError.tooltip",defaultMessage:"Invalid range"});default:return Object(N.e)(e.state.error)}}validateCurrent(){const{validate:e}=this.props,t=this.parseCurrentValue();if(t)return e?e(t):t}parseCurrentValue(){const{store:e}=this.stores;if(!e.state.edited)return;if(!e.state.temporary)return{value:void 0};const t=Object(Te.a)(e.state.temporary,this.props.intl);return t?{value:{type:"date",start_date:t}}:{error:Me}}showClearButton(){const{device:e}=this.environment,{hideClearButton:t}=this.props;return!!e.isMobile||!t}getInputStyles(){const{device:e}=this.environment,{inputStyle:t,inputOuterStyle:n,style:r}=this.props,i=this.styles;return{style:je({},i.menuItem,{},r),inputOuterStyle:je({},this.getInputBorders(),{},i.inputWrapper,{},n),inputStyle:je({},i.inputEditRegion,{},e.isMobile&&i.inputEditRegionMobile,{},t)}}getInputBorders(){const{disabled:e,focused:t}=this.props,n=this.getThemeColors(),r=this.getError();if(!e)return r?n.inputError:t?n.inputFocused:n.inputDefault}getThemeColors(){return{inputDefault:{background:this.theme.inputBackground,boxShadow:this.theme.inputBoxShadow},inputFocused:{background:ve.f.blueWithAlpha(.15),boxShadow:"inset 0 0 0 2px ".concat(ve.f.blue)},inputError:{background:ve.f.redWithAlpha(.15),boxShadow:"inset 0 0 0 2px ".concat(ve.f.red)},placeholder:{color:this.theme.lightTextColor}}}}var Fe=Object(I.h)(Ae),Re=n(765),Le=n.n(Re),Ue=n(151),_e=n(70),We=n(83),qe=n(184),Ne=n(1497);function ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ze(Object(n),!0).forEach((function(t){He(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function He(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ge extends k.a{constructor(){super(...arguments),this.renderMonthControl=e=>{const{device:t}=this.environment,n=this.styles;return i.createElement("div",{style:n.monthControl},i.createElement(Ue.a,{mobileFeedback:t.isMobile,icon:u.a.chevronLeft,onClick:()=>e.onPreviousClick()}),i.createElement(Ue.a,{mobileFeedback:t.isMobile,icon:u.a.chevronRight,onClick:()=>e.onNextClick()}))},this.handleDayClick=e=>{const{disabled:t,store:n,value:r,validate:i,onUpdate:a}=this.props,s=n.getFocus(),o=Se.i.toPersistedDate(e);if(t)return;const l="starting"===s?"ending":"starting",c=r[l];if(c&&o.start_date===c.start_date)n.setState(Ve({},n.state,{focus:l}));else{const e=i(s,{value:o});if(a(e.error?e:{value:{[s]:e.value[s]}}),n.setState(Ve({},n.state,{hovered:void 0})),e.error)return;"starting"!==s||r.ending||n.setState(Ve({},n.state,{focus:"ending"}))}},this.handleDayMouseEnter=e=>{const{disabled:t,store:n,value:r}=this.props,i=n.getFocus(),a=Se.i.toMoment(e);if(!t)if("starting"===i&&r.ending&&!r.starting){Se.i.toMoment(r.ending).isSameOrAfter(a)&&n.setState(Ve({},n.state,{hovered:e}))}else if("ending"===i&&r.starting&&!r.ending){Se.i.toMoment(r.starting).isSameOrBefore(a)&&n.setState(Ve({},n.state,{hovered:e}))}},this.handleMonthChange=e=>{const{store:t}=this.props;t.setState(Ve({},t.state,{displayMonth:Object(_e.a)(e)}))},this.styles={dayPickerWrapper:{display:"block"},monthControl:{position:"absolute",top:0,right:0,display:"flex"},selectedRange:{backgroundColor:ve.f.blueWithAlpha(.15)},active:{backgroundColor:ve.f.blue,color:ve.f.white},inactive:{backgroundColor:ve.f.blueWithAlpha(.5)},disabled:{pointerEvents:"none"},today:{fontWeight:P.a.fontWeight.regular}}}renderComponent(){const e=this.styles,t=this.getDisplayMonth();return i.createElement(Le.a,{className:"notion-calendar-picker",containerProps:{style:e.dayPickerWrapper},initialMonth:t,month:t,numberOfMonths:1,firstDayOfWeek:this.getFirstDayOfWeek(),locale:qe.a,localeUtils:Ne.a,showOutsideDays:!0,fixedWeeks:!0,navbarElement:this.renderMonthControl,onDayClick:this.handleDayClick,onDayMouseEnter:this.handleDayMouseEnter,onMonthChange:this.handleMonthChange,modifiers:this.getModifiers(),modifiersStyles:this.getModifiersStyles()})}getCurrentDate(){if(!this.currentDate){const e=Se.nb(Se.m);this.currentDate=Se.i.toNative(e)}return this.currentDate}getDisplayMonth(){const{value:e,store:t}=this.props;if(t.state.displayMonth)return t.state.displayMonth.toDate();if("starting"===t.getFocus()){if(e.starting)return Se.i.toNative(e.starting);if(e.ending)return Se.i.toNative(e.ending)}if("ending"===t.getFocus()){if(e.ending)return Se.i.toNative(e.ending);if(e.starting)return Se.i.toNative(e.starting)}return this.getCurrentDate()}getFirstDayOfWeek(){return We.q.state}getModifiers(){const{store:e,disabled:t,value:n}=this.props,r=this.getDisabledModifier(),{hovered:i}=e.state;if(t)return{disabled:r};if(n.starting&&n.ending){const e=Se.i.toNative(n.starting),t=Se.i.toNative(n.ending);return{range:{from:e,to:t},start:e,end:t,disabled:r}}if(n.starting){const e=Se.i.toNative(n.starting);return{range:i&&{from:e,to:i},start:e,end:i,disabled:r,selected:[e,i]}}if(n.ending){const e=Se.i.toNative(n.ending);return{range:i&&{from:i,to:e},start:i,end:e,disabled:r,selected:[e,i]}}}getDisabledModifier(){const{value:e,disabled:t,store:n}=this.props;if(t)return e=>!0;const r=e=>"ending"===n.getFocus()?{before:e}:void 0,i=e=>"starting"===n.getFocus()?{after:e}:void 0;if(e.starting&&e.ending){const t=Se.i.toNative(e.starting),n=Se.i.toNative(e.ending);return r(t)||i(n)}if(e.starting){return r(Se.i.toNative(e.starting))}if(e.ending){return i(Se.i.toNative(e.ending))}}getModifiersStyles(){const{store:e}=this.props,t=this.styles,n=this.getThemeColors(),r=e.getFocus(),i=t.selectedRange,a=Ve({},t.disabled,{},n.disabled),s=Ve({},t.today,{},n.today);return{range:i,start:"starting"===r?t.active:t.inactive,end:"ending"===r?t.active:t.inactive,disabled:a,today:s}}getThemeColors(){return{disabled:{color:this.theme.lightTextColor},today:{color:ve.f.white}}}}var Ye=Ge,Qe=n(5),Ke=n(91);function Ze(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ze(Object(n),!0).forEach((function(t){$e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ze(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const Je=Object(I.g)({startingMessage:{defaultMessage:"Starting",id:"search.dateRangeMenu.startingMessage"},endingMessage:{defaultMessage:"Ending",id:"search.dateRangeMenu.endingMessage"}});class et extends k.a{constructor(){super(...arguments),this.renderInputs=()=>{const{value:e,store:t,disabled:n}=this.props,r=t.getFocus(),a=this.getRangeBounds();return i.createElement(i.Fragment,null,i.createElement(Fe,{disabled:n,placeholder:Qe.a.formatMessage(Je.startingMessage),focused:"starting"===r,value:e.starting,validate:this.validateStart,onUpdate:this.handleUpdateStart,onFocus:()=>this.handleFocus("starting"),onSubmit:this.handleStartSubmit,inputElementAttributes:{max:a.latestValidStarting},inputOuterStyle:this.styles.firstDateInput}),i.createElement(Fe,{disabled:n,placeholder:Qe.a.formatMessage(Je.endingMessage),focused:"ending"===r,value:e.ending,validate:this.validateEnd,onUpdate:this.handleUpdateEnd,onFocus:()=>this.handleFocus("ending"),onSubmit:this.handleEndSubmit,inputElementAttributes:{min:a.earliestValidEnding}}))},this.renderCalendar=()=>{const{device:e}=this.environment,{value:t,store:n,onUpdate:r}=this.props,a=this.styles,s=this.getThemeColors(),o=Xe({},a.pickerSection,{},e.isMobile&&a.pickerSectionMobile,{},e.isMobile&&s.pickerSectionMobile);return i.createElement(ce.a,null,i.createElement("div",{style:o},i.createElement(Ye,{value:t,store:n,onUpdate:r,validate:this.validateField})))},this.handleFocus=e=>{const{store:t}=this.props;t.setState(Xe({},t.state,{focus:e}))},this.handleUpdateStart=e=>{const{onUpdate:t}=this.props;e.error||t({value:{starting:e.value}})},this.handleUpdateEnd=e=>{const{onUpdate:t}=this.props;e.error||t({value:{ending:e.value}})},this.handleStartSubmit=(e,t)=>{const{store:n}=this.props;t&&t.error||n.setState(Xe({},n.state,{focus:"ending"}))},this.handleEndSubmit=(e,t)=>{const{onDismiss:n}=this.props;t&&t.error||n&&n(e)},this.validateStart=e=>{const t=this.validateField("starting",e);return t.error?t:{value:t.value.starting}},this.validateEnd=e=>{const t=this.validateField("ending",e);return t.error?t:{value:t.value.ending}},this.validateField=(e,t)=>{const{value:n}=this.props;return t.error?t:this.validateRange(Xe({},n,{[e]:t.value}))},this.validateRange=e=>{if(e.starting&&e.ending){const t=Se.i.toMoment(e.starting);return Se.i.toMoment(e.ending).isSameOrAfter(t)?{value:e}:{error:we}}return{value:e}},this.getMenuProps=()=>{const{device:e}=this.environment,{onDismiss:t,title:n}=this.props;if(e.isMobile){return{menuType:g.b.MenuType.Modal,title:n,right:i.createElement(Ke.DoneMenuText,null),onClickRight:t,header:this.renderInputs()}}return{menuType:g.b.MenuType.Popup,onClickOutside:t}},this.styles={pickerSection:{paddingLeft:16,paddingRight:16},pickerSectionMobile:{paddingTop:16,paddingBottom:8},firstDateInput:{marginTop:2}}}renderComponent(){const{device:e}=this.environment;return i.createElement(g.b,Object.assign({},this.getMenuProps()),!e.isMobile&&this.renderInputs(),this.renderCalendar())}getRangeBounds(){const{value:e,intl:t}=this.props;return{earliestValidEnding:e.starting&&O.c(e.starting,t,Se.ib),latestValidStarting:e.ending&&O.c(e.ending,t,Se.ib)}}getThemeColors(){return{pickerSectionMobile:{background:this.theme.popoverBackground,boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}}}}var tt=Object(I.h)(et),nt=n(105);function rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class at extends k.a{constructor(){super(...arguments),this.styles={removeFilterButton:{height:void 0,width:void 0},removeFilterButtonMobile:{marginRight:-12,marginTop:-12,marginBottom:-12,paddingRight:12,paddingTop:12,paddingBottom:12}}}renderComponent(){const{onClick:e,disabled:t}=this.props,n=this.styles,{device:r}=this.environment,a=r.isMobile?function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(n),!0).forEach((function(t){it(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},n.removeFilterButton,{},n.removeFilterButtonMobile):n.removeFilterButton;return i.createElement(Ue.a,{icon:u.a.clearInput,onClick:e,disabled:t,disableBackground:!0,style:a})}}var st=at,ot=n(45);class lt extends Ee.a{getInitialState(){return{isOpen:!1,focus:"starting",temporary:{},displayMonth:void 0,hovered:void 0}}getFocus(){return this.state.focus}}var ct=lt,dt=n(256);function ut(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class pt extends k.a{constructor(){super(...arguments),this.styles={menuItem:{background:void 0,minHeight:void 0,fontSize:this.environment.device.isMobile?P.a.fontSize.UISmall.mobile:P.a.fontSize.UIRegular.desktop,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginTop:0},rightWrapper:{display:"flex",alignItems:"center",marginTop:"-50%",marginBottom:"-50%",height:44}}}renderComponent(){const e=this.props,{disabled:t,label:n,title:r,onClick:a,isToggle:s}=e,o=ut(e,["disabled","label","title","onClick","isToggle"]),l=this.getThemeColors(),c=this.styles,d=i.createElement("span",{style:l.menuItemLabel},n);return i.createElement(M.a,Object.assign({focused:!1},o,{inline:s,disabled:t,icon:d,title:r,right:this.renderRight(),onClick:a,dontShrinkIcon:!0,dontShrinkRight:!0,shouldWrapTitle:!0,style:c.menuItem,desktopIconStyle:c.menuItemLabel}))}renderRight(){const{disabled:e}=this.props,t=this.styles.rightWrapper;return this.props.isToggle?i.createElement("div",{style:t},i.createElement(dt.a,{on:this.props.isToggleActive,onClick:this.props.onClick})):i.createElement(st,{disabled:e,onClick:this.props.onClickClear})}getThemeColors(){return{menuItemLabel:{color:this.theme.lightTextColor}}}}var mt,ht=pt,gt=n(1265),bt=n(51),ft=n(501);function yt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function St(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Token="token",e.Text="text"}(mt||(mt={}));class vt extends k.a{constructor(){super(...arguments),this.storeTypes={requestStore:U.a,menuListStore:f.a},this.renderRequest=(e,t,n)=>{const{labelText:r,value:a}=this.props,{menuListStore:s}=this.stores,o=e=>i.createElement(ce.a,Object.assign({},e,{title:r.resultSectionTitle,loading:!n}));if(e)return bt.c({level:"error",from:r.componentDebugName,type:"requestFailed",data:{error:e,query:a}}),i.createElement(o,null,i.createElement(h.a,{title:i.createElement(I.b,{defaultMessage:"Something went wrong.",id:"search.inputMenu.errorMessage"})}));if(!t)return i.createElement(o,null,i.createElement(h.a,{title:i.createElement(I.b,{defaultMessage:"Loading…",id:"search.inputMenu.loading.message"})}));if(t&&0===t.length)return i.createElement(o,null,i.createElement(h.a,{title:i.createElement(I.b,{defaultMessage:"No results found.",id:"search.inputMenu.noResults.message"})}));const l={key:"results",items:t.map(this.getResultMenuItem),render:o};return i.createElement(b.a,{type:b.a.Type.Vertical,store:s,initialFocus:0,sections:[l]})},this.handleMenuInputRemoveLast=()=>{if(this.props.inputType!==mt.Token)return;const{items:e,onRemove:t}=this.props,n=r.last(e);n&&t(n)},this.getResultMenuItem=e=>{const{renderResultMenuItem:t,onConfirm:n}=this.props;return{key:e,action:()=>n(e),render:n=>t(e,n)}},this.styles={input:{borderBottomLeftRadius:0,borderBottomRightRadius:0,boxShadow:this.theme.borderBoxShadow},menu:{width:250,maxHeight:"40vh"}}}renderComponent(){const{value:e,items:t,performRequest:n}=this.props,{requestStore:r}=this.stores,a={query:e,current:t};return i.createElement(g.b,Object.assign({},this.getMenuProps()),i.createElement(L.a,{debounce:100,requestStore:r,request:a,performRequest:n,render:this.renderRequest}))}renderSearchInput(){return this.props.inputType===mt.Token?this.renderTokenInput(this.props):this.props.inputType===mt.Text?this.renderTextInput(this.props):void Object(N.e)(this.props)}renderTokenInput(e){const{labelText:t,value:n,items:r,disabled:a,onChange:s,renderToken:o,onRemove:l}=e,c=r.map(e=>o(e,{onRemove:()=>l(e)}));return i.createElement(ft.a,{format:ft.a.Format.Group,focus:!this.isMobile()||void 0,focusInitial:this.isMobile(),focusAfterAnimation:!0,placeholder:t.tokenInputPlaceholder,value:n,tokens:c,disabled:Boolean(a),onChange:s,onRemoveLastToken:this.handleMenuInputRemoveLast})}renderTextInput(e){const{labelText:t,value:n,items:r,disabled:a,onChange:s,onClear:o}=e,l=this.styles,c=this.isMobile()?Pe.a:ke.b;return i.createElement(c,{format:ke.b.Format.Large,disabled:a,showClearButton:!0,placeholder:t.tokenInputPlaceholder,value:n,onChange:s,onClearButtonClick:o,focus:!this.isMobile()||void 0,focusInitial:this.isMobile(),focusAfterAnimation:!0,style:this.isMobile()?void 0:l.input})}getMenuProps(){const{onDismiss:e,labelText:t}=this.props,n=this.styles;if(this.isMobile()){return{menuType:g.b.MenuType.Modal,title:t.title,right:i.createElement(Ke.DoneMenuText,null),onClickRight:e,header:this.renderSearchInput()}}return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yt(Object(n),!0).forEach((function(t){St(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({menuType:g.b.MenuType.Popup,onClickOutside:e,header:this.renderSearchInput()},n.menu)}isMobile(){const{device:e}=this.environment;return e.isMobile}}vt.InputType=mt;var Et=vt;class Mt extends Ee.a{getInitialState(){return{isMenuOpen:!1,inputTemporaryValue:"",indexToReplace:void 0,popupOriginRect:void 0}}}var wt,Ct=Mt;function Ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function kt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ot(Object(n),!0).forEach((function(t){Pt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Button="Button",e.Section="Section"}(wt||(wt={}));class Tt extends k.a{constructor(){super(...arguments),this.origin=i.createRef(),this.storeTypes={componentStore:Ct},this.renderMobileFilterSummary=e=>{const{title:t,items:n,renderItemForSummary:r}=this.props,{disableFilters:a}=e,s=this.styles,o=kt({},z,{},s.summary),l=n.length-1,c=i.createElement("ul",{style:o},n.map((e,t)=>i.createElement("li",{key:e,style:s.summaryItem},i.createElement(i.Fragment,null,r(e),t!==l&&","," "))));return i.createElement(ht,{disabled:a,onClick:this.handleMenuOpenMobile,onClickClear:this.clearItems,label:t,title:c})},this.renderMenu=()=>{const{renderToken:e}=this.props,{componentStore:{state:t}}=this.stores,n={inputType:Et.InputType.Token,onRemove:this.handleFilterRemove,renderToken:e},r={inputType:Et.InputType.Text},a=this.getMenuType()===Et.InputType.Token?n:r;return i.createElement(Et,Object.assign({},this.props,{value:t.inputTemporaryValue,onChange:this.handleMenuInputChange,onDismiss:this.handleMenuClose,onConfirm:this.handleItemConfirm,onClear:this.handleClearTemporary},a))},this.handleMenuOpen=e=>{this.scheduleMeasurement(void 0,t=>kt({},t,{isMenuOpen:!0,indexToReplace:e}))},this.handleMenuOpenMobile=()=>{const{componentStore:e}=this.stores;e.setState(kt({},e.state,{isMenuOpen:!0}))},this.handleMenuClose=()=>{const{onMenuDismiss:e}=this.props,{componentStore:t}=this.stores;t.setState(kt({},t.state,{isMenuOpen:!1,indexToReplace:void 0})),e&&e()},this.handleClearTemporary=()=>{const{componentStore:e}=this.stores;e.setState(kt({},e.state,{inputTemporaryValue:""}))},this.handleItemConfirm=e=>{const{items:t}=this.props,{componentStore:n}=this.stores,{indexToReplace:r}=n.state;"number"==typeof r&&r<t.length?this.replaceItem(r,e):this.addItem(e),this.clearInput(),this.getMenuType()===Et.InputType.Text&&this.handleMenuClose()},this.handleFilterRemove=e=>{this.removeItem(e)},this.handleMenuInputChange=e=>{const{componentStore:t}=this.stores,{target:n}=e;t.setState(kt({},t.state,{inputTemporaryValue:String(n.value)}))},this.scheduleMeasurement=(e,t)=>{this.animationFrame=requestAnimationFrame(this.measureOriginRect(t))},this.measureOriginRect=e=>t=>{const{componentStore:n}=this.stores;if(!this.origin)return;if(!this.origin.current)return;const r=e?e(n.state):n.state;n.setState(kt({},r,{popupOriginRect:this.origin.current.getBoundingClientRect()}))},this.isMenuOpen=()=>{const{componentStore:{state:e}}=this.stores;return e.isMenuOpen},this.removeItem=e=>{const{items:t,onChange:n}=this.props;n(t.filter(t=>t!==e))},this.clearItems=()=>{const{onChange:e}=this.props;e([])},this.replaceItem=(e,t)=>{const{items:n,onChange:r}=this.props;r(n.slice(0,e).concat(t,n.slice(e+1)))},this.clearInput=()=>{const{componentStore:e}=this.stores;e.setState(kt({},e.state,{inputTemporaryValue:"",indexToReplace:void 0}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},appendListItemButton:{minHeight:void 0,paddingTop:4,paddingBottom:4,fontSize:V(this.environment,"UIRegular")},icon:{height:14,width:14,fill:"currentColor"},iconSmall:{height:12,width:12},summary:{display:"inline"},summaryItem:{display:"inline"}}}didMount(){window.addEventListener("resize",this.scheduleMeasurement)}willUnmount(){window.removeEventListener("resize",this.scheduleMeasurement),this.animationFrame&&(cancelAnimationFrame(this.animationFrame),this.animationFrame=void 0)}didUpdate(e){(e.items.length!==this.props.items.length||e.mode!==this.props.mode)&&this.scheduleMeasurement()}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t,disabled:n}=this.props,{componentStore:{state:r}}=this.stores,a=n||r.isMenuOpen,s=e===Tt.Mode.Section,o=s?t:void 0,l=s?this.renderSectionOrigin():this.renderButtonOrigin();return i.createElement(gt.a,{title:o,marginAfter:s},this.renderFilters({disableFilters:a,showLabel:!1}),l,i.createElement(ot.c,{popupType:ot.c.PopupType.Popup,placementToOrigin:ot.c.Placement.Bottom,alignmentToOrigin:ot.c.Alignment.Start,open:this.isMenuOpen(),originRect:r.popupOriginRect,render:this.renderMenu,onDismiss:this.handleMenuClose,keepFocus:!0,preventScaleTransition:!0}))}renderButtonOrigin(){const{icon:e,title:t,disabled:n,focused:r}=this.props,a=this.styles,s=this.getThemeColors(),o=kt({},a.menuItem,{},s.buttonMenuItem);return i.createElement("div",{ref:this.origin},i.createElement(M.a,{disabled:n||this.isMenuOpen(),icon:e(a.icon),title:t,focused:r,onClick:e=>this.handleMenuOpen(),style:o}))}renderSectionOrigin(){const{addItemLabel:e,disabled:t}=this.props,n=this.styles,r=this.getThemeColors();return i.createElement(i.Fragment,null,i.createElement("div",{ref:this.origin}),i.createElement(M.a,{disabled:t||this.isMenuOpen(),icon:u.a.plus(n.iconSmall),title:e,focused:!1,onClick:e=>this.handleMenuOpen(),style:kt({},n.appendListItemButton,{},r.appendListItemButton)}))}renderMobile(e){const{disabled:t}=this.props,n=t||this.isMenuOpen(),r=e===Tt.Mode.Section?this.renderMobileFilterSummary({disableFilters:n}):this.renderMobileButtonOrigin({disableFilters:n});return i.createElement(ot.c,{popupType:ot.c.PopupType.SlideUp,open:this.isMenuOpen(),origin:r,render:this.renderMenu,onDismiss:this.handleMenuClose,keepFocus:!0})}renderMobileButtonOrigin(e){const{icon:t,title:n}=this.props,r=this.styles;return i.createElement(M.a,{disabled:e.disableFilters,focused:!1,icon:t(r.icon),title:n,onClick:e=>this.handleMenuOpenMobile()})}renderFilters(e){const{items:t,renderFilter:n}=this.props,{device:r}=this.environment,a=t.map((t,a)=>i.createElement("li",{key:"".concat(t,"_").concat(a)},n(t,{disabled:e.disableFilters,onRemove:()=>this.handleFilterRemove(t),onClick:()=>r.isMobile?this.handleMenuOpenMobile():this.handleMenuOpen(a)})));return i.createElement("ul",{style:z},a)}getMenuType(){const{device:e}=this.environment;return e.isMobile?Et.InputType.Token:Et.InputType.Text}addItem(e){const{items:t,onChange:n}=this.props,i=t.concat(e);n(r.uniq(i))}getThemeColors(){return{buttonMenuItem:{color:this.theme.mediumTextColor},appendListItemButton:{color:this.theme.lightTextColor}}}}Tt.Mode=wt;var Dt=Tt;function It(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?It(Object(n),!0).forEach((function(t){xt(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):It(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Bt extends k.a{constructor(){super(...arguments),this.storeTypes={store:ct},this.renderActiveButtonOrigin=()=>{const{value:e,dateFormat:t,disabled:n,focused:r,intl:a}=this.props,s=this.styles,o=this.getThemeColors(),l=jt({},s.menuItem,{},o.activeMenuItem),c=O.d(e,a,t),d=i.createElement(st,{onClick:this.handleClear,disabled:n});return i.createElement(M.a,{focused:r,disabled:n,icon:u.a.calendar(s.iconActiveDesktop),title:c,right:d,isTokenTitle:!0,alignIconTop:!0,onClick:this.handleOriginActivate,desktopTitleStyle:s.menuItemTitleDesktop,desktopIconStyle:s.iconActiveDesktopWrapper,style:l})},this.renderInactiveButtonOrigin=()=>{const{title:e,icon:t,disabled:n,focused:r}=this.props,a=this.styles,s=this.getThemeColors(),o=jt({},a.menuItem,{},s.buttonMenuItem);return i.createElement(M.a,{focused:r,disabled:n,icon:t(a.icon),title:e,onClick:this.handleOriginActivate,style:o})},this.renderPopupContents=()=>{const{title:e}=this.props,{store:t}=this.stores;return i.createElement(tt,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:t,onDismiss:this.handleMenuClose})},this.handleOriginActivate=()=>{const{disabled:e}=this.props,{store:t}=this.stores;e||t.setState(jt({},t.state,{isOpen:!0,focus:"starting"}))},this.handleMenuClose=e=>{const{onChange:t,onMenuDismiss:n}=this.props,{store:r}=this.stores,{temporary:i}=r.state;O.a(e)||(t(i),r.setState(jt({},r.state,{isOpen:!1,temporary:{}})),n&&n())},this.handleClear=()=>{const{onChange:e}=this.props;e({starting:void 0,ending:void 0})},this.handleMenuListKey=e=>{e.preventDefault&&e.preventDefault()},this.updateTemporary=e=>{const{store:t}=this.stores;if(!e.error)return t.setState(jt({},t.state,{temporary:jt({},t.state.temporary,{},e.value)}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t}=this.props,{store:n}=this.stores,r=this.styles,a=e===wt.Section,s=a?t:void 0,o=a?this.renderActiveButtonOrigin():this.renderInactiveButtonOrigin();return i.createElement(gt.a,{title:s,marginAfter:a},i.createElement(nt.a,{capture:n.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey},i.createElement(ot.c,{popupType:this.getPopupType(),open:n.state.isOpen,origin:o,render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:ot.c.Placement.Bottom,alignmentToOrigin:ot.c.Alignment.Start,keepFocus:!0,style:r.popup})))}renderMobile(e){const{store:t}=this.stores,n=e===wt.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return i.createElement(ot.c,{popupType:ot.c.PopupType.SlideUp,open:t.state.isOpen,origin:n,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:n}=this.props,r=this.styles;return i.createElement(M.a,{disabled:n,focused:!1,icon:e(r.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:n,disabled:r,intl:a}=this.props,s=this.styles,o=i.createElement("div",{style:s.summary},u.a.calendar(s.iconActiveMobile),O.d(t,a,n));return i.createElement(ht,{disabled:r,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:o})}getCurrentValue(){const{value:e}=this.props,{store:t}=this.stores,{temporary:n}=t.state;return jt({},e,{},n)}getPopupType(){const{device:e}=this.environment;return e.isMobile?fe.a.PopupType.SlideUp:fe.a.PopupType.Popup}getThemeColors(){return{buttonMenuItem:{color:this.theme.mediumTextColor},activeMenuItem:{color:this.theme.regularTextColor}}}}var At,Ft=Object(I.h)(Bt),Rt=n(34);function Lt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ut(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Lt(Object(n),!0).forEach((function(t){_t(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem"}(At||(At={}));class Wt extends k.a{constructor(){super(...arguments),this.handleFilterClick=e=>{const{onMenuDismiss:t}=this.props;this.applyFilter(e),this.openSidebar(),t&&t()},this.applyFilter=e=>{const{searchStore:t}=this.props;t.updateFilters(e)},this.openSidebar=()=>{const{searchStore:e}=this.props;e.isSidebarOpen()||e.setState(Ut({},e.state,{isSidebarOpen:!0}))},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:Ut({},P.a.textOverflowStyle),icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}}}renderComponent(){const{mode:e}=this.props;return e===At.Button?this.renderAsButton():e===At.MenuItem?this.renderAsMenuItem():void Object(N.e)(e)}renderAsButton(){const{icon:e,title:t,filter:n}=this.props,r=this.styles,a=this.getThemeColors();return i.createElement(Rt.a,{style:Ut({},r.buttonFilter,{},a.buttonFilter),onClick:()=>this.handleFilterClick(n)},e&&e(Ut({},r.icon,{},r.buttonIcon)),i.createElement("span",{style:r.buttonText},t))}renderAsMenuItem(){const{icon:e,title:t,filter:n,focused:r}=this.props,a=this.styles,s=this.getThemeColors(),o=Ut({},a.menuItem,{},s.menuItem);return i.createElement(M.a,{icon:e&&e(a.icon),focused:r,title:t,onClick:()=>this.handleFilterClick(n),style:o})}getThemeColors(){const{device:e}=this.environment;return{menuItem:Ut({color:e.isDesktop?this.theme.mediumTextColor:void 0},this.props.isLastInSection&&{boxShadow:void 0}),buttonFilter:{color:this.theme.mediumTextColor}}}}Wt.Mode=At;class qt extends k.a{renderComponent(){const e=qt.getCurrentPageFilter();if(e)return i.createElement(Wt,Object.assign({icon:u.a.searchInPage,title:i.createElement(I.b,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:e},this.props))}static isActive(e){const t=qt.getCurrentPageFilter();if(!t)return!1;if(!t.ancestors)return!1;const n=t.ancestors[0];return-1!==e.ancestors.indexOf(n)}}qt.getCurrentPageFilter=()=>{const{currentBlockStore:e}=o.a.state;if(e&&e.id)return{ancestors:[e.id]}};class Nt extends k.a{renderComponent(){const e=Nt.getCurrentUserFilter(this.environment);if(e)return i.createElement(Wt,Object.assign({icon:u.a.person,title:i.createElement(I.b,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:e},this.props))}static isActive(e,t){const n=Nt.getCurrentUserFilter(e);if(!n)return!1;if(!n.createdBy)return!1;const r=n.createdBy[0];return-1!==t.createdBy.indexOf(r)}}Nt.getCurrentUserFilter=e=>{const{id:t}=e.currentUser;if(t)return{createdBy:[t]}};class zt extends k.a{renderComponent(){const e=zt.getPastWeekFilter();if(e)return i.createElement(Wt,Object.assign({icon:u.a.calendar,title:i.createElement(I.b,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:e},this.props))}static isActive(e){const{lastEditedTime:t}=zt.getPastWeekFilter();return r.isEqual(t,e.lastEditedTime)}}zt.getPastWeekFilter=()=>({lastEditedTime:{starting:Se.bb(Se.m),ending:Se.nb(Se.m)}});var Vt=n(285),Ht=n(147),Gt=n(88);const Yt=Object(I.g)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});class Qt extends k.a{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:n,onRemove:r,onClick:a}=t;const s=this.styles,o=this.createBlockStore(e),l=i.createElement(st,{disabled:n,onClick:r});return i.createElement(Vt.a,{disabled:n,focused:!1,store:o,right:l,style:s.menuItem,desktopTitleStyle:s.menuItemTitle,onClick:a})},this.renderItemForSummary=e=>i.createElement(C.a,{store:this.createBlockStore(e),shouldWrap:!0,maxLength:50}),this.renderToken=(e,t)=>{const{blockIds:n}=this.props,r=this.tokenStyles,a=1===n.length,s=this.createBlockStore(e),o=i.createElement("div",{style:r.token},i.createElement(Gt.a,{disabled:!0,icon:s.getIcon(),isEmptyPage:!1,size:20,style:r.icon}),i.createElement(C.a,{store:s}));return i.createElement(Ht.b,{key:e,format:Ht.b.Format.Large,value:o,showRemoveButton:!0,onClickRemove:t.onRemove,isSingle:a,shouldShrink:!0})},this.renderResultMenuItem=(e,t)=>{const n=this.createBlockStore(e);return i.createElement(Vt.a,Object.assign({},t,{key:e,store:n}))},this.performRequest=async e=>{let{query:t,current:n}=e;const{currentSpaceStore:r}=o.a.state;if(!r)return[];const{results:i}=await s.f({environment:this.environment,query:t,limit:20,spaceId:r.id,requireEditPermissions:!1,excludeTemplates:!1,source:"quick_find_ancestor_filter"}),a=new Set(n);return i.filter(e=>!a.has(e))},this.createBlockStore=e=>{const{parentStore:t}=this.props;return l.a.createChildStore(t,{table:c.b,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}},this.tokenStyles={token:{display:"flex",alignItems:"center"},icon:{marginRight:4}}}renderComponent(){const{mode:e,title:t,blockIds:n,onChange:r,disabled:a,focused:s,onMenuDismiss:o}=this.props;return i.createElement(Dt,{mode:e,title:t,icon:u.a.searchInPage,items:n,onChange:r,focused:s,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:i.createElement(I.b,{defaultMessage:"Add a page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:t,tokenInputPlaceholder:Qe.a.formatMessage(Yt.searchPages),resultSectionTitle:Qe.a.formatMessage(Yt.selectAPage),componentDebugName:"SearchPageFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,disabled:a,onMenuDismiss:o})}}var Kt=Qt,Zt=n(209),Xt=n(590),$t=n(89);class Jt extends k.a{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:n,onRemove:r,onClick:a}=t;const s=this.styles,o=this.getUserValue(e),l=i.createElement(st,{disabled:n,onClick:r});return i.createElement(Xt.a,{key:e,disabled:n,focused:!1,user:o,right:l,style:s.menuItem,desktopTitleStyle:s.menuItemTitle,onClick:a})},this.renderItemForSummary=e=>Object(D.d)(this.getUserValue(e)),this.renderToken=(e,t)=>{const{userIds:n}=this.props,r=1===n.length,a=this.getUserValue(e);if(a)return i.createElement(Zt.c,{key:e,format:Zt.c.Format.Large,showRemoveButton:!0,isSingle:r,onClickRemove:t.onRemove,actor:Object($t.i)(a)})},this.renderResultMenuItem=(e,t)=>{const n=this.getUserValue(e);return i.createElement(Xt.a,Object.assign({},t,{key:e,user:n}))},this.performRequest=async e=>{let{query:t,current:n}=e;const r=new Set(n);return(await s.l({environment:this.environment,query:t,membersOnly:!1})).filter(e=>!r.has(e.id)).slice(0,20).map(e=>e.id)},this.getUserValue=e=>this.createUserStore(e).getValue(),this.createUserStore=e=>{const{parentStore:t}=this.props;return T.a.createChildStore(t,{table:D.a,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:4}}}renderComponent(){const{mode:e,title:t,userIds:n,onChange:r,disabled:a,focused:s,onMenuDismiss:o,intl:l}=this.props;return i.createElement(Dt,{mode:e,title:t,icon:u.a.person,items:n,onChange:r,disabled:a,focused:s,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:i.createElement(I.b,{defaultMessage:"Add a person",id:"search.filterMenu.addAPersonButton.label"}),labelText:{title:t,tokenInputPlaceholder:l.formatMessage({defaultMessage:"Search people",id:"search.filterMenu.searchPeople.placeholder"}),resultSectionTitle:l.formatMessage({defaultMessage:"Select a person",id:"search.filterMenu.searchPeople.resultsTitle"}),componentDebugName:"SearchPersonFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:o})}}var en=Object(I.h)(Jt);function tn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function nn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class rn extends k.a{renderComponent(){return i.createElement(q.a,Object.assign({},this.props,{right:i.createElement(dt.a,Object.assign({},this.props)),dontShrinkRight:!0}))}}rn.contextTypes=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?tn(Object(n),!0).forEach((function(t){nn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):tn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},g.c);var an=rn;function sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function on(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ln(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}class cn extends k.a{constructor(){super(...arguments),this.handleToggle=()=>{const{value:e,onChange:t}=this.props;t(!e)},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const t=e===wt.Section;return i.createElement(gt.a,{marginAfter:t},this.renderSwitcherMenuItem())}renderMobile(e){const{title:t,value:n,disabled:r}=this.props;return e===wt.Button?this.renderSwitcherMenuItem():i.createElement(ht,{disabled:r,onClick:this.handleToggle,label:t,isToggle:!0,isToggleActive:n})}renderSwitcherMenuItem(){const e=this.props,{title:t,icon:n,value:r,style:a}=e,s=ln(e,["title","icon","value","style"]),o=this.styles,l=this.getThemeColors(),c=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sn(Object(n),!0).forEach((function(t){on(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},o.menuItem,{},l.menuItem,{},a);return i.createElement(an,Object.assign({title:t,icon:n(o.icon),on:r,onClick:this.handleToggle,style:c},s))}getThemeColors(){return{menuItem:{color:this.theme.mediumTextColor}}}}cn.Mode=wt;var dn,un=cn;function pn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?pn(Object(n),!0).forEach((function(t){hn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e.Button="Button",e.Section="Section"}(dn||(dn={}));class gn extends k.a{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:ye.a},this.renderAddFilterOrigin=e=>{const t=this.styles;return i.createElement(be.a,Object.assign({},e,{style:t.addFilterButtonMobile,icon:u.a.filterCircled,isBlue:!0}),i.createElement(I.b,{defaultMessage:"Add filter",id:"search.addFilter.button.label"}))},this.renderAddFilterMenu=()=>i.createElement(g.b,{menuType:g.b.MenuType.ActionSheet},this.renderSuggestedFilters(),i.createElement(gt.a,{title:this.renderMoreFiltersTitle()},this.renderCreatedByFilter(Dt.Mode.Button),this.renderCreatedTimeFilter(Dt.Mode.Button),this.renderLastEditedTimeFilter(Dt.Mode.Button),this.renderAncestorFilter(Dt.Mode.Button))),this.closeAddFilterMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState(mn({},e.state,{open:!1}))},this.styles={sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 220px",minHeight:400},sidebarHidden:{display:"none"},addFilterButtonMobile:{fontSize:this.props.isMobile?P.a.fontSize.UISmall.mobile:P.a.fontSize.UISmall.desktop,fontWeight:P.a.fontWeight.medium,marginRight:-8}}}renderComponent(){return this.props.isMobile?this.props.mode===dn.Button?this.renderAddButtonMobile():this.props.mode===dn.Section?this.renderActiveFiltersMobile():void Object(N.e)(this.props.mode):this.renderSidebar()}renderActiveFiltersMobile(){const{searchStore:{state:e}}=this.props,t=O.e(e.query.filters);return i.createElement(ce.a,{disableMobilePadding:!0,disableMobileBorders:!0},this.renderTitlesOnlyFilter(wt.Section),this.renderActiveFilters(t,Dt.Mode.Section))}renderAddButtonMobile(){const{buttonPopupStore:e}=this.stores;return i.createElement(fe.a,{popupType:fe.a.PopupType.SlideUp,buttonPopupStore:e,renderOrigin:this.renderAddFilterOrigin,render:this.renderAddFilterMenu})}renderSidebar(){const{searchStore:e,searchStore:{state:t}}=this.props,n=this.styles,r=this.getThemeColors(),a=O.e(t.query.filters),s=mn({},n.sidebar,{},r.sidebar,{},!e.isSidebarOpen()&&n.sidebarHidden);return i.createElement("aside",{style:s},this.renderTitlesOnlyFilter(wt.Section),this.renderActiveFilters(a,Dt.Mode.Section),this.renderSuggestedFilters(),this.renderInactiveFilters(a))}renderActiveFilters(e,t){return i.createElement(i.Fragment,null,e.createdBy&&this.renderCreatedByFilter(t),e.createdTime&&this.renderCreatedTimeFilter(t),e.lastEditedTime&&this.renderLastEditedTimeFilter(t),e.ancestors&&this.renderAncestorFilter(t))}renderInactiveFilters(e){if(!(e.ancestors&&e.createdBy&&e.createdTime&&e.lastEditedTime))return i.createElement(gt.a,{title:this.renderMoreFiltersTitle(),marginAfter:!0},!e.ancestors&&this.renderAncestorFilter(Dt.Mode.Button),!e.createdBy&&this.renderCreatedByFilter(Dt.Mode.Button),!e.createdTime&&this.renderCreatedTimeFilter(wt.Button),!e.lastEditedTime&&this.renderLastEditedTimeFilter(wt.Button))}renderSuggestedFilters(){const{searchStore:e}=this.props,{filters:t}=e.state.query,n=Nt.isActive(this.environment,t),r=zt.isActive(t),a=qt.isActive(t);if(!(n&&r&&a))return i.createElement(gt.a,{title:i.createElement(I.b,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0},!n&&i.createElement(Nt,{mode:At.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!r&&i.createElement(zt,{mode:At.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!a&&i.createElement(qt,{mode:At.MenuItem,searchStore:e,focused:!1,onMenuDismiss:this.closeAddFilterMenu,isLastInSection:!0}))}renderTitlesOnlyFilter(e){const{searchStore:t}=this.props,{filters:n}=t.state.query;return i.createElement(un,{mode:e,focused:!1,title:i.createElement(I.b,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Only match titles",description:"Label for only match titles toggle in search modal"}),icon:u.a.typesTitle,value:n.isNavigableOnly,onChange:this.createUpdateFunction("isNavigableOnly")})}renderMoreFiltersTitle(){return i.createElement(I.b,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}renderAncestorFilter(e){const{searchStore:t,parentStore:n}=this.props,{filters:r}=t.state.query;return i.createElement(Kt,{mode:e,focused:!1,title:i.createElement(I.b,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In page"}),parentStore:n,blockIds:r.ancestors,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("ancestors")})}renderCreatedByFilter(e){const{searchStore:t,parentStore:n}=this.props,{filters:r}=t.state.query;return i.createElement(en,{mode:e,focused:!1,title:i.createElement(I.b,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:n,userIds:r.createdBy,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdBy")})}renderCreatedTimeFilter(e){const{searchStore:t}=this.props,{filters:n}=t.state.query;return i.createElement(Ft,{mode:e,focused:!1,title:i.createElement(I.b,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:u.a.calendar,value:n.createdTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdTime")})}renderLastEditedTimeFilter(e){const{searchStore:t}=this.props,{filters:n}=t.state.query;return i.createElement(Ft,{mode:e,focused:!1,title:i.createElement(I.b,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:u.a.calendar,value:n.lastEditedTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("lastEditedTime")})}createUpdateFunction(e){const{searchStore:t}=this.props;return n=>t.updateFilters({[e]:n})}getThemeColors(){return{sidebar:{backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.regularDividerColor)}}}}var bn=gn,fn=n(1498);function yn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Sn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?yn(Object(n),!0).forEach((function(t){vn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):yn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function vn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class En extends k.a{constructor(){super(...arguments),this.openSidebar=()=>{const{searchStore:e}=this.props;e.setState(Sn({},e.state,{isSidebarOpen:!0}))},this.styles={menuItem:{minHeight:0},menuItemMobile:{paddingBottom:8},titleWrapper:{flex:void 0},showSidebarButton:()=>{const{device:e}=this.environment;return{padding:"0 4px",fontSize:e.isMobile?P.a.fontSize.UISmall.mobile:P.a.fontSize.UISmall.desktop,fontWeight:P.a.fontWeight.medium,borderRadius:3,height:20,lineHeight:"20px"}}}}renderComponent(){const{device:e}=this.environment,t=this.styles,n=Sn({},t.menuItem,{},e.isMobile&&t.menuItemMobile),r=this.shouldAllowFilters()&&this.renderAddFilterButton();return i.createElement(q.a,{title:this.renderSortMenu(),right:r,textWrapperStyle:t.titleWrapper,style:n})}renderSortMenu(){const{searchStore:e}=this.props;return i.createElement(fn.a,{currentSortBy:e.state.query.sort,setSortBy:t=>{e.state.mode===le.c.Mode.Default?e.setState(Sn({},e.state,{query:Sn({},e.state.query,{sort:t})})):e.state.mode===le.c.Mode.Results&&e.setState(Sn({},e.state,{query:Sn({},e.state.query,{sort:t})}))},sortOptions:this.sortOptions})}renderAddFilterButton(){const{device:e}=this.environment,{parentStore:t,searchStore:n}=this.props,r=this.styles;return e.isMobile?i.createElement(bn,{parentStore:t,searchStore:n,isMobile:!0,mode:dn.Button}):n.isSidebarOpen()?void 0:i.createElement(be.a,{icon:u.a.filterCircled,onClick:this.openSidebar,style:r.showSidebarButton(),isBlue:!0},i.createElement(I.b,{defaultMessage:"Add filter",id:"search.header.addFilter.button.label"}))}shouldAllowFilters(){const{isPublicPageSearch:e}=this.props;return!e}get sortOptions(){return[{key:"Relevance",formattedName:i.createElement(I.b,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"})},{key:"LastEditedNewest",formattedName:i.createElement(I.b,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"})},{key:"LastEditedOldest",formattedName:i.createElement(I.b,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"})},{key:"CreatedNewest",formattedName:i.createElement(I.b,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"})},{key:"CreatedOldest",formattedName:i.createElement(I.b,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"})}]}}var Mn=En,wn=n(770),Cn=n(4),On=n(120);function kn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Pn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?kn(Object(n),!0).forEach((function(t){Tn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Tn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Dn extends k.a{constructor(){super(...arguments),this.renderSpinner=()=>{const{showSpinner:e}=this.props,t=this.styles,n=Pn({},this.getThemeColors().searchIcon,{},t.searchIcon());return i.createElement(de.a,{show:e,showDelay:500,showHold:200,render:e=>e?i.createElement(oe.a,{style:n}):u.a.searchThick(n)})},this.handleQueryChange=e=>{const{searchStore:t,resultListStore:n}=this.props;this.handleTyping();const r=String(e.target.value);""===r?t.resetQuery({resetFilters:!1}):t.setState(Pn({},t.state,{mode:le.c.Mode.Results,query:Pn({},t.state.query,{text:r}),limit:le.b,allResultsLoaded:!1})),n.setState(Pn({},n.state,{focus:{section:0,indexLocal:0,indexGlobal:0}}))},this.handleClearButtonClick=()=>{const{searchStore:e}=this.props;e.resetQuery({resetFilters:!0}),e.setState(Pn({},e.state,{isSidebarOpen:!1}))},this.handleFocus=()=>{const{isFocusedStore:e}=this.props;e.get()||e.set(!0)},this.handleBlur=()=>{const{isFocusedStore:e}=this.props,{device:t}=this.environment;e.get()&&(e.set(!1),t.isReactNative&&wn.b.updateKeyboardPhase(wn.a.willHide))},this.setTypingStart=()=>{const{isTypingStore:e}=this.props;e.get()||e.set(!0)},this.setTypingEnd=()=>{const{isTypingStore:e}=this.props;e.set(!1)},this.styles={inputDesktop:{fontSize:18,height:Dn.DESKTOP_INPUT_HEIGHT,paddingLeft:16,paddingRight:16,flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px"},searchIcon:()=>{const{device:e}=this.environment;return{width:e.isMobile?16:18,height:e.isMobile?16:18,marginRight:e.isMobile?12:10,flexGrow:0,flexShrink:0}},input:Pn({minWidth:0},P.a.textOverflowStyle),clearButton:{marginLeft:8}}}willUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=void 0)}renderComponent(){const{device:e}=this.environment,{isOpen:t,searchStore:{state:n}}=this.props,r=this.styles,a=this.getThemeColors(),s=e.isMobile?ke.b.Format.ExtraLarge:ke.b.Format.Transparent,o=e.isMobile?Pn({},r.inputMobile,{},a.inputMobile):Pn({},r.inputDesktop,{},a.inputDesktop);return i.createElement(ke.b,{format:s,placeholder:this.getPlaceholderText(),left:this.renderSpinner(),value:n.query.text,focus:e.isMobile?void 0:t,focusInitial:e.isMobile,focusAfterAnimation:!0,showClearButton:!0,selectAll:!0,onChange:this.handleQueryChange,onClearButtonClick:this.handleClearButtonClick,onFocus:this.handleFocus,onBlur:this.handleBlur,style:o,inputStyle:r.input,clearButtonStyle:r.clearButton})}handleTyping(){this.typingTimer&&window.clearTimeout(this.typingTimer),this.setTypingStart(),this.typingTimer=window.setTimeout(this.setTypingEnd,Dn.TYPING_DEBOUNCE_MS)}getPlaceholderText(){const{currentSpaceStore:e,currentBlockStore:t}=o.a.state,n=e&&Object(On.getSpaceName)(this.environment,e);if(n)return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedSpace",defaultMessage:"Search {spaceName}…"},{spaceName:n});if(t){const e=Cn.bb(t.getTitleValue()).slice(0,Dn.MAX_PLACEHOLDER_TITLE_LENGTH);return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:e})}return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}getThemeColors(){return{inputDesktop:{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor)},inputMobile:{background:this.theme.inputBackground},searchIcon:{fill:this.theme.mediumIconColor}}}}Dn.TYPING_DEBOUNCE_MS=300,Dn.DESKTOP_INPUT_HEIGHT=52,Dn.MAX_PLACEHOLDER_TITLE_LENGTH=100;var In=Object(I.h)(Dn),jn=n(664),xn=n(564),Bn=n(827);function An(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?An(Object(n),!0).forEach((function(t){Rn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):An(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ln extends k.a{constructor(){super(...arguments),this.styles={title:{fontWeight:P.a.fontWeight.medium,lineHeight:"20px"},menuItem:{minHeight:36,paddingTop:this.environment.device.isMobile?12:8,paddingBottom:this.environment.device.isMobile?12:8},textWrapper:{marginLeft:8,alignItems:void 0,flex:void 0},inlineTextWrapper:{alignItems:"baseline"},highlight:{fontWeight:P.a.fontWeight.medium},enterIcon:{height:14,width:14},caption:{marginTop:1}}}renderComponent(){const{focused:e,isLastInSection:t,isBeforeFocused:n,inline:r}=this.props,a=this.styles,s=this.getThemeColors(),o=Fn({},a.menuItem,{},!r&&!t&&!n&&!e&&s.menuItemBorder),l=Fn({},a.caption,{},s.caption),c=Fn({},a.textWrapper,{},this.props.inline&&a.inlineTextWrapper);return i.createElement(M.a,Object.assign({},this.props,{title:this.renderTitle(),icon:this.renderIcon(),caption:this.renderCaption(),body:this.renderPreview(),right:this.renderEnterIcon(),disableTransition:!0,dontShrinkRight:!0,ignoreLocalHoverState:!0,captionStyle:l,style:o,textWrapperStyle:c,className:"notranslate"}))}renderTitle(){const{store:e,result:t,placeholder:n}=this.props,r=this.styles,a=this.getThemeColors(),s=Fn({},r.title,{},this.hasAnyHighlight()&&a.highlightedTitle),o=this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.pathText);t&&t.isNavigable&&o.push(...this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.text));const l=this.getWordHighlighter(o);return i.createElement(C.a,{style:s,store:e,placeholder:n,highlighter:l})}renderIcon(){const{store:e}=this.props;return i.createElement(Gt.a,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:19})}renderCaption(){const{store:e,result:t,inline:n}=this.props;if(!this.hasPath())return;const r=this.getWordHighlighter(this.getHighlightedWordsFromText(t&&t.highlight&&t.highlight.pathText)),{device:a}=this.environment,s=n||a.isMobile?0:2;return i.createElement(xn.a,{store:e,extraLength:s,showFullPathInTooltip:!0,highlighter:r})}renderPreview(){const{result:e}=this.props;if(!e)return;if(!e.highlight)return;if(e.isNavigable)return;if(!e.highlight.text)return;const t=this.styles,n=this.getThemeColors(),r=e.highlight.text;return i.createElement(Bn.a,{text:r,highlighter:{tokenize:e=>Object(jn.a)(Object(jn.b)(e)),style:Fn({},t.highlight,{},n.highlight)}})}getHighlightedWordsFromText(e){if(!e)return[];let t=Object(jn.b)(e);return t.some(e=>Object(jn.e)(e)&&1===Object(jn.c)(e).length)&&(t=Object(jn.a)(t)),r(t).filter(jn.e).map(jn.c).uniq().value()}getWordHighlighter(e){if(0===e.length)return;const t=this.styles,n=this.getThemeColors();return{tokenize:t=>Object(jn.d)(t,e),style:Fn({},t.highlight,{},n.highlight)}}renderEnterIcon(){const{device:e}=this.environment,{focused:t}=this.props,n=this.styles,r=this.getThemeColors();if(e.isMobile)return;const i=Fn({},n.enterIcon,{},r.enterIcon,{opacity:t?1:0});return u.a.enter(i)}hasPath(){const{hidePath:e,store:t}=this.props;return!e&&Object(xn.b)(t)}hasAnyHighlight(){const{result:e}=this.props;if(!e)return!1;const{highlight:t}=e;return!!t&&Boolean(t.text||t.pathText)}getThemeColors(){return{highlightedTitle:{color:this.theme.mediumTextColor},menuItemBorder:{boxShadow:"0 1px 0 ".concat(this.theme.lightDividerColor)},highlight:{color:this.theme.regularTextColor},enterIcon:{fill:this.theme.mediumIconColor},caption:{color:this.theme.mediumTextColor}}}}Ln.contextTypes=g.c;var Un=Ln,_n=n(317),Wn=n(220),qn=n(85),Nn=n(31),zn=n(59),Vn=n(80),Hn=n(134);function Gn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Yn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gn(Object(n),!0).forEach((function(t){Qn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Kn extends k.a{constructor(){super(...arguments),this.isOpen=!1,this.storeTypes={searchStore:le.c,resultListStore:f.a,serverRequestStore:U.a,localRequestStore:U.a,localCacheRequestStore:U.a,isTypingStore:zn.a.of(!1),isInputFocusedStore:zn.a.of(!1)},this.renderBody=e=>{const{device:t}=this.environment,{searchStore:{state:n}}=this.stores,r=this.layoutStyles,{currentSpaceStore:a}=o.a.state;return i.createElement(g.b,Object.assign({},this.getMenuProps(e),{className:d.W}),i.createElement("div",{style:r.body},!t.isMobile&&this.renderInput(),i.createElement(L.a,{requestStore:this.stores.localCacheRequestStore,request:a&&a.id,performRequest:this.performLocalCacheRequest,render:n.mode===le.c.Mode.Results?this.renderResults:this.renderDefaultBody})),this.shouldShowSidebar()&&this.renderFilterMenu())},this.renderDefaultBody=()=>{const{device:e}=this.environment,{resultListStore:t}=this.stores,n=this.defaultViewStyles;if(!this.recentPageStores.state)return;const a=this.getInitialFocus(),s={mode:le.c.Mode.Default,isMobile:e.isMobile,recentSearches:this.recentSearches.state,recentPages:this.recentPageStores.state};return i.createElement(i.Fragment,null,i.createElement("main",{style:n.wrapper},i.createElement(b.a,{type:b.a.Type.Vertical,store:t,initialFocus:a,disableKeyboardArrowWrap:!0,sections:r.compact([this.getRecentPagesSection(),this.getRecentSearchesSection()])})),this.shouldShowFooter(s)&&this.renderFooter())},this.renderResults=()=>{const{device:e}=this.environment,{searchStore:t,serverRequestStore:n,localRequestStore:r}=this.stores,a={query:t.state.query,limit:t.state.limit};return i.createElement(L.a,{debounce:s.b,requestStore:n,request:a,performRequest:this.performServerRequest,render:(t,n)=>i.createElement(L.a,{debounce:s.a,requestStore:r,request:a,performRequest:this.performLocalRequest,render:(t,r)=>i.createElement(i.Fragment,null,e.isMobile&&this.renderFilterMenu(),this.renderRequestResults({localResponse:r,serverResponse:n}))})})},this.renderRequestResults=e=>{const{device:t}=this.environment,{serverResponse:n,localResponse:r}=e,{serverRequestStore:a}=this.stores;if(!n&&!r)return;const s=O.f({localResponse:r,serverResponse:n,serverRequestStore:a}),o={mode:le.c.Mode.Results,isMobile:t.isMobile,errorState:s};return i.createElement(i.Fragment,null,this.shouldShowHeaderDesktop(o)&&this.renderHeader(),this.renderResultsSection({errorState:s,localResponse:r,serverResponse:n}),this.shouldShowFooter(o)&&this.renderFooter({localResponse:r,serverResponse:n}))},this.renderSearchResult=(e,t)=>{const{store:n}=e,r=n.isNavigableBlock()?n:n.getNavigableBlockStore();if(r)return{key:"".concat(n.id,":").concat(t),action:e=>this.handleSelectResult(n,e,"query_results"),render:n=>i.createElement(Un,Object.assign({},n,{isFirstInSection:0===t,store:r,hidePath:!1,result:e}))}},this.handleComponentOpenClose=()=>{this.isOpen!==_n.a.state.open&&(this.isOpen=_n.a.state.open,_n.a.state.open?clearTimeout(this.inactiveTimer):this.addRecentSearch())},this.handleComponentClose=()=>{const{device:e}=this.environment,{searchStore:t}=this.stores,{query:n}=t.state;E.a(),""===n.text.trim()?t.reset():O.l(n.filters)||t.setState(Yn({},t.state,{isSidebarOpen:!1})),this.inactiveTimer=window.setTimeout(this.resetState,2*Nn.d),e.isMobile&&Wn.b()},this.handleRecentSearch=(e,t)=>{const{searchStore:n}=this.stores;n.setState(Yn({},n.state,{query:e,mode:le.c.Mode.Results,isSidebarOpen:!0}))},this.handleSelectResult=(e,t,n)=>{const{searchStore:r}=this.stores,{event:i}=t,s=i.metaKey||i.ctrlKey;a.Fd(this.environment,{context:n,queryStringLength:r.state.query.text.trim().length,selectedItemIndex:t.index,isNavigable:e.isNavigableBlock()}),_.j(e,s,this.environment),s||this.handleComponentClose()},this.handleScrollOffsetChange=e=>{const{searchStore:t,searchStore:{state:n},serverRequestStore:{state:r}}=this.stores;!(e<=Kn.LOAD_MORE_RESULTS_SCROLL_OFFSET_PX)||r.loading||n.allResultsLoaded||t.setState(Yn({},n,{limit:n.limit+le.b}))},this.handleScrollResults=()=>{this.stores.isInputFocusedStore.get()&&this.blurInputDebounced()},this.handleSpaceChange=()=>{const e=o.a.state.currentSpaceStore&&o.a.state.currentSpaceStore.id;this.spaceId!==e&&(this.spaceId=e,this.resetState())},this.performLocalCacheRequest=async()=>{const{currentSpaceStore:e,currentSpaceViewStore:t}=o.a.state;if(!this.getPublicAccessPermissionForPage()&&e)return O.h({environment:this.environment,currentSpaceStore:e,currentSpaceViewStore:t})},this.performLocalRequest=async e=>{const{query:t}=e,{localCacheRequestStore:n}=this.stores,r=n.state.result;if(!r)return;if(!t.text.trim())return;if(this.getPublicAccessPermissionForPage())return;const i=Hn.a.createMetric("rum.local_quick_search_query"),a=await O.g({input:e,cache:r});if(!a)return;if(0===a.results.length)return{error:J.d.NoResults};const s=O.n({sort:t.sort,unsorted:a.results,batchSize:le.b,currentUserId:this.environment.currentUser.id}).results.map(e=>Yn({},e,{store:this.createBlockStore(e.id)})),o=this.isOnline()?O.m(this.environment,s):s,l=this.isOnline()?o.length:a.total;if(0===l)return{error:J.d.NoResults};const c={value:{total:l,results:o}};return Hn.a.emit(this.environment,i),c},this.performServerRequest=async e=>{const{searchStore:t}=this.stores,{currentSpaceStore:n}=o.a.state,{query:r,limit:i}=e;if(!r.text.trim()&&!O.l(r.filters))return;if(!this.isOnline())return{error:J.d.Offline};const a=Hn.a.createMetric("rum.server_quick_search_query"),s=await O.k({environment:this.environment,input:e,currentSpaceStore:n,publicAccessPermission:this.getPublicAccessPermissionForPage()});if(!s)return;if("failed"===s.type)return s.offline?{error:J.d.Offline}:{error:J.d.RequestFailed};if(0===s.data.results.length)return{error:J.d.NoResults};const{results:l,total:c}=O.n({sort:r.sort,unsorted:s.data.results,batchSize:le.b,currentUserId:this.environment.currentUser.id});return t.setState(Yn({},t.state,{allResultsLoaded:c<i})),Hn.a.emit(this.environment,a),{value:{results:l.map(e=>Yn({},e,{store:this.createBlockStore(e.id)})),total:s.data.total}}},this.recentPageStores=this.createComputedStore(()=>{const{currentSpaceStore:e}=o.a.state,t=(e?qn.s({currentUserId:this.environment.currentUser.id,spaceId:e.id}).slice(0,this.getMaxRecentPages()):[]).map(this.createBlockStore),n=t.map(S.l);return r.every(n)&&t.filter(e=>e.pathIsAlive())}),this.clearRecentlyVisitedPages=()=>{const{currentSpaceStore:e}=o.a.state;e&&(qn.i({currentUserId:this.environment.currentUser.id,spaceId:e.id}),this.recentPageStores.recompute())},this.recentSearches=this.createComputedStore(()=>{const{currentSpaceStore:e}=o.a.state;return e?qn.r({currentUserId:this.environment.currentUser.id,spaceId:e.id}).slice(0,Kn.MAX_RECENT_SEARCHES):[]}),this.clearRecentSearches=()=>{const{currentSpaceStore:e}=o.a.state;e&&(qn.h({currentUserId:this.environment.currentUser.id,spaceId:e.id}),this.recentSearches.recompute())},this.addRecentSearch=()=>{const{searchStore:e,serverRequestStore:t,localRequestStore:n}=this.stores,{currentSpaceStore:r}=o.a.state;if(!r)return;const{query:i}=e.state;if(!i.text.trim())return;const a=this.getCurrentResults(),s=a.local&&!n.state.loading,l=a.server&&!t.state.loading;(s||l)&&qn.c({currentUserId:this.environment.currentUser.id,spaceId:r.id,query:i})},this.createBlockStore=e=>{const{parentStore:t}=this.props;return l.a.createChildStore(t,{table:c.b,id:e})},this.shouldDismissKeyboardOnScroll=()=>{const{device:e}=this.environment;return!!e.isMobile&&(!e.isIOS||e.isReactNative)},this.blurInput=()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()},this.blurInputDebounced=r.debounce(this.blurInput,500,{leading:!0}),this.resetState=()=>{const{searchStore:e,resultListStore:t,serverRequestStore:n,localRequestStore:r,localCacheRequestStore:i}=this.stores;e.reset(),t.reset(),n.reset(),r.reset(),i.reset(),_n.a.reset()},this.searchIcon=()=>u.a.searchThick({height:14,width:14,marginLeft:2,marginRight:6,flexGrow:0,flexShrink:0,fill:this.theme.mediumIconColor}),this.layoutStyles={modal:{width:"75%",maxWidth:600,minHeight:Kn.MIN_MENU_HEIGHT,maxHeight:Kn.MAX_MENU_HEIGHT},modalWithSidebar:{maxWidth:820},body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:Kn.MAX_MENU_HEIGHT},footer:{flexShrink:0}},this.modalMenuStyles={topbar:{height:void 0},topbarLeftInput:{marginLeft:10,marginTop:10,marginBottom:10},topbarRightButtonWrapper:{flex:void 0},topbarButton:{fontWeight:void 0}},this.defaultViewStyles={wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},recentSection:{paddingTop:0,paddingBottom:8},recentTitle:{margin:0,padding:"0 14px",height:32,alignItems:"center",paddingTop:2},clearButton:{fontWeight:P.a.fontWeight.medium,padding:0,background:"none",fontSize:12,height:void 0},clearButtonDesktop:{textTransform:"none",letterSpacing:"normal",padding:"0 4px",fontSize:P.a.fontSize.UISmall.desktop,height:20,lineHeight:"20px",borderRadius:3}},this.resultStyles={results:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%"},messageMenuItem:Yn({},this.environment.device.isMobile&&{background:void 0,boxShadow:void 0})}}getMaxRecentPages(){const{device:e}=this.environment;return e.isMobile?5:7}didMount(){_n.a.addListener(this.handleComponentOpenClose),o.a.addListener(this.handleSpaceChange),this.recentPageStores.addListener(r.noop)}willUnmount(){_n.a.removeListener(this.handleComponentOpenClose),o.a.removeListener(this.handleSpaceChange),this.recentPageStores.removeListener(r.noop),this.inactiveTimer&&(clearTimeout(this.inactiveTimer),this.inactiveTimer=void 0)}renderComponent(){const{device:e}=this.environment,t=this.layoutStyles,n=Boolean(_n.a.state.open),r=Yn({},t.modal,{},this.shouldShowSidebar()&&t.modalWithSidebar);return i.createElement(y.a,{open:n,onDismiss:this.handleComponentClose,modalStyle:r,disableAnimation:!e.isMobile,renderContent:()=>i.createElement(m.a,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!e.isMobile,render:()=>i.createElement(p.a,{capture:!0,allowMenuList:!0,render:this.renderBody})})})}getMenuProps(e){const{device:t}=this.environment,{searchStore:n}=this.stores,r=this.modalMenuStyles,a=this.getThemeColors();if(t.isMobile){const{mode:t}=n.state,s=Yn({},r.topbarButton,{},a.topbarButton);return Yn({menuType:g.a.Modal,left:this.renderInput(),shouldRenderLeftDirectly:!0,leftOuterStyle:r.topbarLeftInput,right:i.createElement(Ke.CancelMenuText,null),onClickRight:this.handleComponentClose,rightOuterStyle:r.topbarRightButtonWrapper,header:this.shouldShowHeaderMobile({mode:t})&&this.renderHeader(),disableHeaderShadow:!0,topbarStyle:r.topbar,leftRightButtonStyle:s,onScroll:this.shouldDismissKeyboardOnScroll()?this.handleScrollResults:void 0},e)}return Yn({menuType:g.a.Popup,maxHeight:Kn.MAX_MENU_HEIGHT,minHeight:Kn.MIN_MENU_HEIGHT,disableScroller:!0,scrollerStyle:this.layoutStyles.scroller},e)}renderHeader(){const{parentStore:e}=this.props,{searchStore:t}=this.stores,n=Boolean(this.getPublicAccessPermissionForPage());return i.createElement(Mn,{parentStore:e,searchStore:t,isPublicPageSearch:n})}renderInput(){const{searchStore:e,resultListStore:t,isTypingStore:n,isInputFocusedStore:r}=this.stores;return i.createElement(In,{isOpen:Boolean(_n.a.state.open),searchStore:e,resultListStore:t,isTypingStore:n,isFocusedStore:r,showSpinner:this.showSpinner()})}getRecentPagesSection(){const{device:e}=this.environment,t=this.defaultViewStyles,n=this.recentPageStores.state;if(n&&0!==n.length)return{key:"recentlyVisitedPages",items:n.map((t,n)=>({key:"".concat(t.id,":").concat(n),action:e=>this.handleSelectResult(t,e,"recent_pages"),render:r=>i.createElement(Un,Object.assign({},r,{isFirstInSection:0===n,inline:!e.isMobile,store:t,hidePath:!1}))})),render:n=>i.createElement(gt.a,{key:n.key,title:i.createElement(I.b,{id:"search.recentlyVisitedPages.title",defaultMessage:"Recent pages",description:"Title text for recently visited pages"}),desktopTitleStyle:t.recentTitle,desktopStyle:t.recentSection,right:(void 0!==n.focusedIndex||e.isMobile)&&this.renderClearRecentsButton(this.clearRecentlyVisitedPages)},i.createElement("ul",{style:z},n.children))}}getRecentSearchesSection(){const{device:e}=this.environment,{parentStore:t}=this.props,n=this.defaultViewStyles,r=this.recentSearches.state;if(0!==r.length)return{key:"recentSearches",items:r.slice(0,Kn.MAX_RECENT_SEARCHES).map((e,n)=>({key:n,action:t=>this.handleRecentSearch(e,t),render:r=>i.createElement("li",{key:r.key},i.createElement(R,Object.assign({},r,{isFirstInSection:0===n,parentStore:t,query:e,icon:this.searchIcon()})))})),render:t=>i.createElement(gt.a,{key:t.key,title:i.createElement(I.b,{id:"search.recentSearches.title",defaultMessage:"Recent searches",description:"Title text for recent searches"}),desktopTitleStyle:n.recentTitle,desktopStyle:n.recentSection,right:(void 0!==t.focusedIndex||e.isMobile)&&this.renderClearRecentsButton(this.clearRecentSearches)},i.createElement("ul",{style:z},t.children))}}getInitialFocus(){if(this.stores.searchStore.state.query.text.trim())return;const e=this.recentPageStores.state;return e&&e.length>0?1:0}renderFooter(e){const{searchStore:t}=this.stores,n=this.layoutStyles,{mode:r}=t.state;if(r===le.c.Mode.Default)return i.createElement("footer",{style:n.footer},i.createElement(ge,{mode:r}));const a=this.getCurrentResultsWithCount(e);return a?i.createElement("footer",{style:n.footer},i.createElement(ge,{mode:r,results:a,showSpinner:this.showSpinner()})):void 0}renderClearRecentsButton(e){const{device:t}=this.environment,n=this.defaultViewStyles,r=this.getThemeColors(),a=Yn({},n.clearButton,{},r.clearButton,{},!t.isMobile&&n.clearButtonDesktop);return i.createElement(be.a,{onClick:e,style:a},i.createElement(I.b,{id:"search.clearRecentsButton.text",defaultMessage:"Clear",description:"Button text for clearing recent searches and pages"}))}renderResultsSection(e){const{localResponse:t,serverResponse:n,errorState:a}=e,{resultListStore:s}=this.stores,o=this.resultStyles,l=O.b({environment:this.environment,results:this.getCurrentResults({localResponse:t,serverResponse:n}),isOnline:this.isOnline()}),c=l&&{key:"results",render:e=>i.createElement(ce.a,Object.assign({},e,{shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0})),items:r.compact(l.map(this.renderSearchResult))};return i.createElement("section",{style:o.results},c&&i.createElement(b.a,{type:b.a.Type.Vertical,initialFocus:0,store:s,disableKeyboardArrowWrap:!0,sections:[c]}),this.renderError(a)||i.createElement(W.a,{onChange:this.handleScrollOffsetChange}))}renderError(e){const{searchStore:t}=this.stores;if(!e.isLoading)return e.showMajorError?i.createElement(ae,{error:e.serverError,searchStore:t}):e.serverError&&e.serverError!==J.d.NoResults?this.renderMessage(e.serverError.message):void 0}renderFilterMenu(){const{device:e}=this.environment,{parentStore:t}=this.props,{searchStore:n}=this.stores,r=e.isMobile?{isMobile:!0,mode:dn.Section}:void 0;return i.createElement(bn,Object.assign({parentStore:t,searchStore:n},r))}renderMessage(e){const t=this.resultStyles;return i.createElement(ce.a,{disableMobilePadding:!0,disableMobileBorders:!0},i.createElement(h.a,{title:e,style:t.messageMenuItem}))}getCurrentResults(e){const{serverRequestStore:t,localRequestStore:n}=this.stores,r=e&&e.localResponse||n.state.result,i=e&&e.serverResponse||t.state.result;return{local:O.i(r),server:O.i(i)}}getCurrentResultsWithCount(e){const{serverRequestStore:t,localRequestStore:n}=this.stores,r=e&&e.localResponse||n.state.result,i=e&&e.serverResponse||t.state.result,a=O.j(r),s=O.j(i);return s&&a?{server:s,local:a}:s?{server:s,local:void 0}:a?{server:void 0,local:a}:void 0}getPublicAccessPermissionForPage(){const{currentBlockStore:e}=o.a.state;return e&&v.g(this.environment,e)}isOnline(){return Boolean(Vn.a.state.online)}shouldShowSidebar(){const{device:e}=this.environment,{searchStore:t}=this.stores;if(!this.getPublicAccessPermissionForPage()&&!e.isMobile)return t.isSidebarOpen()}shouldShowHeaderDesktop(e){const{errorState:t,mode:n,isMobile:r}=e;if(r)return!1;if(n===le.c.Mode.Default)return!1;if(t.isLoading){const e=this.getCurrentResults();return Boolean(e.local||e.server)}return!t.showMajorError}shouldShowHeaderMobile(e){const{mode:t}=e;return t===le.c.Mode.Results}shouldShowFooter(e){const{isMobile:t}=e;if(t)return!1;if(e.mode===le.c.Mode.Default){const t=e.recentSearches.length>0,n=e.recentPages.length>0;return Boolean(t||n)}if(e.errorState.isLoading){const e=this.getCurrentResults();return Boolean(e.local||e.server)}return!e.errorState.showMajorError}showSpinner(){const{searchStore:e,serverRequestStore:t,isTypingStore:n}=this.stores;return this.isOnline()&&e.state.mode===le.c.Mode.Results&&!t.state.ready&&!n.get()}getThemeColors(){return{topbarButton:{color:this.theme.mediumTextColor},clearButton:{color:this.theme.lightTextColor}}}}Kn.MAX_RECENT_SEARCHES=5,Kn.LOAD_MORE_RESULTS_SCROLL_OFFSET_PX=200,Kn.MIN_MENU_HEIGHT=50,Kn.MAX_MENU_HEIGHT="80vh";t.default=Kn},1152:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(3),a=n(17),s=n(486),o=(n(15),n(12),n(182)),l=n(151),c=n(53),d=n(49),u=n(80),p=n(34),m=n(19),h=n(22);function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){f(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class y extends i.a{renderComponent(){const{title:e,actionButton:t,onClick:n}=this.props;return r.createElement(p.a,{onClick:n,style:this.getButtonStyle()},this.renderIcon(),r.createElement("div",{style:{minWidth:0,width:"100%"}},r.createElement("div",{style:{display:"flex"}},r.createElement("div",{style:y.titleStyle},e),r.createElement("div",{style:{marginLeft:"auto"}},t)),this.renderCaption()))}renderIcon(){const{icon:e,logo:t}=this.props;return t?r.createElement("img",{style:y.imageIconStyle,src:t}):e?r.createElement("div",{style:this.getIconWrapStyle()},e(this.getIconStyle())):void 0}renderCaption(){const{caption:e}=this.props;if(e)return r.createElement("div",{style:this.getCaptionStyle()},e)}getButtonStyle(){return{display:"flex",alignItems:this.props.caption?"flex-start":"center",padding:10,paddingRight:8,borderRadius:3,marginBottom:12,cursor:"pointer",boxShadow:this.theme.lightBoxShadow,transition:"background 200ms ease-out",background:this.theme.contentBackground}}getIconWrapStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",width:y.iconSize,height:y.iconSize,borderRadius:3,marginRight:8,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground}}getIconStyle(){return{flexShrink:0,width:y.iconSize,height:y.iconSize}}getCaptionStyle(){return b({fontSize:12,color:this.theme.mediumTextColor,wordBreak:"keep-all"},!this.props.shouldWrapCaption&&b({},h.a.textOverflowStyle))}}y.iconSize=28,y.imageIconStyle={flexShrink:0,width:y.iconSize,height:y.iconSize,borderRadius:3,marginRight:10,background:m.f.white},y.titleStyle={fontSize:16,fontWeight:h.a.fontWeight.medium};var S=y,v=n(99),E=n(21),M=n(55),w=n(181),C=n(255),O=n(24),k=n(39),P=n(45),T=n(14),D=(n(169),n(309),n(70)),I=n(74),j=n(26),x=n(40),B=n(27),A=n(11),F=n(249),R=n(117),L=n(111),U=n(54),_=n(61),W=n(1398),q=n(1399),N=n(2),z=n(10),V=n(6),H=n(1397),G=n(1),Y=n(5);const Q=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],K=["text/plain",".md",".mdown",".markdown",".mkdn",".mkd",".Rmd",".md.txt"],Z={markdown:K,csv:["text/plain",".csv"],html:["text/html"],docx:Q,gdocs:Q,dropbox:Q,quip:["text/html",K],workflowy:["text/plain"],confluence:["application/zip"]};var X=n(223);function $(e){var t;if("undefined"!=typeof Symbol){if(Symbol.asyncIterator&&null!=(t=e[Symbol.asyncIterator]))return t.call(e);if(Symbol.iterator&&null!=(t=e[Symbol.iterator]))return t.call(e)}throw new TypeError("Object is not async iterable")}const J=Object(G.g)({uploadingOneFile:{id:"importActions.uploadingOneFile.loadingMessage",defaultMessage:"Uploading… ({percentComplete}%)"},uploadingMultipleFilesNotStarted:{id:"importActions.uploadingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Uploaded 0 of {totalNumberOfFiles}"},uploadingMultipleFilesInProgress:{id:"importActions.uploadingMultipleFilesInProgress.loadingMessage",defaultMessage:"Uploaded {numberOfUploadedFiles} of {totalNumberOfFiles}"},uploadingMultipleFilesComplete:{id:"importActions.uploadingMultipleFilesComplete.loadingMessage",defaultMessage:"Uploaded {totalNumberOfFiles} of {totalNumberOfFiles}"},importingOneFile:{id:"importActions.importingOneFile.loadingMessage",defaultMessage:"Importing…"},importingMultipleFilesNotStarted:{id:"importActions.importingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Imported 0 of {totalNumberOfFiles}"},importingMultipleFilesInProgress:{id:"importActions.importingMultipleFilesInProgress.loadingMessage",defaultMessage:"Imported {numberOfImportedFiles} of {totalNumberOfFiles}"},importingMultipleFilesComplete:{id:"importActions.importingMultipleFilesComplete.loadingMessage",defaultMessage:"Imported {totalNumberOfFiles} of {totalNumberOfFiles}"},importingFromTrelloMessage:{id:"importActions.importingFromTrello.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} board from Trello} other {Importing {importingCount} boards from Trello}}"},importingFromAsanaMessage:{id:"importActions.importingFromAsana.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} project from Asana} other {Importing {importingCount} projects from Asana}}"},importingFromEvernoteMessage:{id:"importActions.importingFromEvernote.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} notebook from Evernote} other {Importing {importingCount} notebooks from Evernote}}"},importFailed:{id:"importActions.importFailedError.message",defaultMessage:"Import failed."},trelloImportFailed:{id:"importActions.trelloImportFailedError.message",defaultMessage:"Trello import failed."},asanaImportFailed:{id:"importActions.asanaImportFailedError.message",defaultMessage:"Asana import failed."},evernoteImportFailed:{id:"importActions.evernoteImportFailedError.message",defaultMessage:"Evernote import failed."},importTitle:{id:"importActions.importTitle",defaultMessage:"Import {date}",description:"'Import' is a noun"}});async function ee(e){const{environment:t,spaceStore:n,spaceViewStore:r,notebooks:i,userSettingsStore:a}=e;if(0===i.length)throw new Error("Expected at least one notebook");L.b({message:J.importingFromEvernoteMessage,interpolatedValues:{importingCount:i.length}}),H.a.setState({open:!1});const s=await async function(e){const{environment:t,spaceStore:n,spaceViewStore:r,notebooks:i}=e,a=A.c(t),s=N.uniq(N.compact(i.map(e=>e.stack))).sort().reverse(),o={};let l=e=>!0;i.length>1&&s.length>0&&(s.forEach(e=>{const s=R.b({environment:t,spaceStore:n,spaceViewStore:r,isPrivate:!0,prepend:!0,loading:!1,title:e,transaction:a}),l=s.getContentStore();i.filter(t=>t.stack===e).forEach(e=>{const n=B.a({environment:t,type:V.a.copyIndicator,inMemoryRecordCacheStore:s.inMemoryRecordCacheStore,transaction:a});_.a({parent:l,append:n,transaction:a}),o[e.guid]=n})}),l=e=>!Boolean(e.stack));return i.filter(l).reverse().forEach(e=>{const i=R.b({environment:t,spaceStore:n,spaceViewStore:r,isPrivate:!0,prepend:!0,loading:!0,title:e.title,transaction:a});o[e.guid]=i}),await A.b({environment:t,transaction:a}),o}({environment:t,spaceStore:n,spaceViewStore:r,notebooks:i}),o=s[i[0].guid];try{return await async function(e){const{environment:t,spaceStore:n,spaceViewStore:r,notebooks:i,waitForNotebook:a,notebookMapping:s,userSettingsStore:o}=e;let l;if(I.b(i,2,async e=>{await Promise.all(e.map(async e=>{const n=s[e.guid];if(!n)throw new Error("Missing notebook page ".concat(e.guid));const r=I.c();n===a&&(l=r),await async function(e){const{environment:t,notebookStore:n,notebook:r,firstCompleted:i}=e,a=x.ib(t,{notebookId:r.guid,blockId:n.id,timestamp:Date.now(),parentTable:z.b}),{value:s}=await a.next();if(s.error)throw console.error(s.error),A.d(t,e=>{const t=n.getParentBlockStore();if(t){const r=t.getContentStore();_.e({parent:r,remove:n,transaction:e})}}),s.error;i.resolve(void 0)}({environment:t,notebookStore:n,notebook:e,firstCompleted:r})}))}),!l)throw new Error("waitForNotebookFirstCompleted not defined.");o.getSettings().created_evernote_getting_started||await R.c({environment:t,type:"evernote",spaceStore:n,spaceViewStore:r,userSettingsStore:o});await l.promise}({environment:t,waitForNotebook:o,notebookMapping:s,notebooks:i,spaceStore:n,spaceViewStore:r,userSettingsStore:a}),L.a(),o}catch(l){throw U.e(Y.a.formatMessage(J.evernoteImportFailed)),L.a(),l}}var te=n(8),ne=n(20),re=n(154),ie=n(16);class ae extends ie.a{getInitialState(){return{searchQuery:"",selection:new Set}}}var se=ae,oe=n(167),le=n(312),ce=n(271),de=n(342),ue=n(160),pe=n(257);class me extends i.a{renderComponent(){return r.createElement("div",{style:this.getStyle()},"·")}getStyle(){return{display:"inline-block",textAlign:"center",color:this.props.disabled?this.theme.lightTextColor:this.theme.mediumTextColor,userSelect:"none",WebkitUserSelect:"none",width:8}}}var he=me,ge=n(84);function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){ye(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ye(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Se extends i.a{constructor(){super(...arguments),this.storeTypes={store:se},this.handleSelectAllClick=()=>{const{sections:e,analyticsName:t}=this.props,{store:n}=this.stores,{selection:r}=n.state;for(const i of e)for(const e of i.items)r.add(e.key);n.emit(),T.Tb(this.environment,{name:t})},this.handleDeselectAllClick=()=>{const{analyticsName:e}=this.props,{store:t}=this.stores,{selection:n}=t.state;n.clear(),t.emit(),T.Rb(this.environment,{name:e})},this.handleToggleItem=e=>{const{analyticsName:t}=this.props,{store:n}=this.stores,{selection:r}=n.state;r.has(e.key)?(r.delete(e.key),T.Ub(this.environment,{name:t})):(r.add(e.key),T.Sb(this.environment,{name:t})),n.emit()},this.handleImport=()=>{const{sections:e}=this.props,{selection:t}=this.stores.store.state,n=N.flatten(e.map(e=>e.items)),r=[];t.forEach(e=>{const t=n.find(t=>t.key===e);t&&r.push(t)}),this.props.onComplete(r)}}willMount(e){const t=this.stores.store.state.selection,[n]=e.sections;if(n){const[e]=n.items;e&&t.add(e.key)}this.stores.store.emit()}renderComponent(){return r.createElement(E.b,{menuType:E.b.MenuType.Popup,header:this.renderMenuHeader(),footer:this.renderMenuFooter(),width:280,maxHeight:350},this.renderMenuList())}renderMenuHeader(){const{searchInputPlaceholder:e}=this.props,{searchQuery:t}=this.stores.store.state,n=Boolean(t);return r.createElement(O.a,{isInput:!0,desktopStyle:{paddingBottom:2}},r.createElement(oe.a,{focus:!0,focusAfterAnimation:!0,value:t,onChange:e=>{const{store:t}=this.stores;t.setState(fe({},t.state,{searchQuery:e.target.value}))},placeholder:e}),r.createElement(ue.a,{isTokenTitle:!0,style:{marginTop:2},title:r.createElement("div",{style:{marginLeft:-3}},r.createElement(pe.a,{onClick:this.handleSelectAllClick,disabled:n,disabledFeedback:!0},r.createElement(G.b,{id:"importPopup.selectAll",defaultMessage:"Select all"})),r.createElement(he,{disabled:n}),r.createElement(pe.a,{onClick:this.handleDeselectAllClick,disabled:n,disabledFeedback:!0},r.createElement(G.b,{id:"importPopup.deselectAll",defaultMessage:"Deselect all"})))}))}renderMenuFooter(){const e=0===this.stores.store.state.selection.size;return r.createElement(O.a,{topBorder:!0,desktopStyle:{paddingTop:8,paddingBottom:8}},r.createElement(ue.a,{title:r.createElement(de.a,{disabled:e,onClick:this.handleImport},r.createElement(G.b,{id:"integrationImportPopup.importButton.label",defaultMessage:"Import"}))}))}renderMenuList(){const{sections:e,noSearchResultsPlaceholder:t}=this.props,{store:n}=this.stores,{searchQuery:i,selection:a}=n.state,s=e.map(e=>{const t=Object(ce.b)(i,e.items,t=>"".concat(t.name," ").concat(e.name));return fe({},e,{items:t})}).filter(e=>e.items.length>0);if(0===s.length)return r.createElement(O.a,null,r.createElement(re.a,{title:t}));const o=s.map(t=>({key:t.name,render:n=>r.createElement(O.a,Object.assign({},n,{title:e.length>1?t.name:void 0})),items:t.items.map(e=>{const t=()=>this.handleToggleItem(e);return{key:e.key,render:n=>r.createElement(c.a,Object.assign({},n,{title:e.name,icon:r.createElement(le.a,{checked:a.has(e.key),size:16,onClick:t}),right:void 0!==e.count&&r.createElement(ge.a,{isSmall:!0},e.count)})),action:t}})}));return r.createElement(M.a,{type:M.a.Type.Vertical,initialFocus:void 0,sections:o})}}var ve=Se,Ee=n(1484);class Me extends i.a{constructor(){super(...arguments),this.handleClickImportTrello=()=>{T.C(this.environment,{name:"trello",from:this.props.analyticsFrom})},this.handleTrelloAuth=async()=>{await Ee.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleRemoveTrello=async()=>{await x.v(this.environment,{}),await this.props.requestStore.refresh(),T.ud(this.environment,{name:"trello"})},this.handleImportTrelloComplete=async(e,t)=>{const{boards:n}=e,r=n.filter(e=>Boolean(t.find(t=>t.key===e.id)));T.Nb(this.environment,{name:"trello",count:t.length});const i=await async function(e){const{environment:t,boards:n,spaceStore:r,spaceViewStore:i}=e;L.b({message:J.importingFromTrelloMessage,interpolatedValues:{importingCount:n.length}}),q.a.setState({open:!1});const a=A.c(t),s=n.map(e=>R.b({environment:t,spaceStore:r,spaceViewStore:i,isPrivate:!0,prepend:!0,loading:!0,title:e.name,transaction:a}));await new Promise(e=>{a.postSubmitCallbacks.push(e),A.b({environment:t,transaction:a})});try{return await Promise.all(s.map(async(e,r)=>{const i=n[r],{value:a}=await x.kb(t,{boardId:i.id,blockId:e.id}).next();if(a.error)throw a.error})),L.a(),s[0]}catch(o){throw A.d(t,e=>{for(const t of s)_.e({parent:r.getPagesStore(),remove:t,transaction:e})}),U.e(Y.a.formatMessage(J.trelloImportFailed)),L.a(),new Error(o)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,boards:r});this.props.onComplete(i)}}renderComponent(){const{device:e}=this.environment,{trelloResult:t,intl:n}=this.props,{account:i,boards:a}=t,s={key:"default",name:n.formatMessage({id:"trelloImportOption.boardProperty.defaultName",defaultMessage:"Boards"}),items:a.map(e=>({key:e.id,name:e.name}))},o={title:"Trello",logo:ne.a.images.import.trelloPng,actionButton:i&&this.props.renderItemActionsButton([{name:n.formatMessage({id:"trelloImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>q.a.setState({open:!0})},{name:n.formatMessage({id:"trelloImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleTrelloAuth},{name:n.formatMessage({id:"trelloImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveTrello}]),onClick:()=>{}};return r.createElement(d.a,{popupType:e.isMobile?d.a.PopupType.SlideUp:d.a.PopupType.Popup,buttonPopupStore:q.a,onClick:this.handleClickImportTrello,render:()=>r.createElement(ve,{searchInputPlaceholder:n.formatMessage({id:"trelloImportOption.search.placeholder",defaultMessage:"Search for a board…",description:"'Board' is a Trello term."}),noSearchResultsPlaceholder:n.formatMessage({id:"trelloImportOption.search.noResultsPlaceholder",defaultMessage:"No boards",description:"'Board' is a Trello term."}),analyticsName:"trello",sections:[s],onComplete:e=>this.handleImportTrelloComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return r.createElement(S,Object.assign({},o,{onClick:i?t:this.handleTrelloAuth}))}})}}var we=Object(G.h)(Me),Ce=n(125),Oe=n(42),ke=n(1482),Pe=n(136);class Te extends i.a{constructor(){super(...arguments),this.handleClickImportEvernote=()=>{T.C(this.environment,{name:"evernote",from:this.props.analyticsFrom})},this.handleRemoveEvernote=async()=>{await x.u(this.environment,{}),await this.props.requestStore.refresh(),T.ud(this.environment,{name:"evernote"})},this.handleEvernoteAuth=async()=>{await ke.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleImportEvernoteComplete=async(e,t)=>{const{notebooks:n}=e,r=n.filter(e=>Boolean(t.find(t=>t.key===e.guid)));T.Nb(this.environment,{name:"evernote",count:t.length});const i=await ee({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore,notebooks:r});this.props.onComplete(i)},this.handleEvernoteHelpClick=()=>{Oe.i({environment:this.environment,url:Object(Pe.a)("guides.importEvernote")})}}renderComponent(){const{device:e}=this.environment,{evernoteResult:t,intl:n}=this.props,{userInfo:i,notebooks:a}=t,s=N.groupBy(a,e=>e.stack||""),o=Object.keys(s).map(e=>{const t=e||"Top-Level";return{key:t,name:t,items:(s[e]||[]).map(e=>({key:e.guid,name:e.title,count:e.noteCount}))}}),{data:l}=Ce.a.state,c=Boolean(l&&l.credits.find(e=>"import_evernote"===e.type&&e.activated)),u={title:"Evernote",logo:ne.a.images.import.evernotePng,shouldWrapCaption:!i&&!c,caption:i?i.name||i.username||i.email:c?void 0:n.formatMessage({id:"evernoteImportOption.caption.getCredit",defaultMessage:"Get $5 in credit on import"}),actionButton:i?this.props.renderItemActionsButton([{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.learnMore",defaultMessage:"Learn more"}),action:this.handleEvernoteHelpClick},{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>H.a.setState({open:!0})},{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleEvernoteAuth},{name:n.formatMessage({id:"evernoteImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveEvernote}]):this.props.defaultActionButton,onClick:()=>{}};return r.createElement(d.a,{popupType:e.isMobile?d.a.PopupType.SlideUp:d.a.PopupType.Popup,buttonPopupStore:H.a,onClick:this.handleClickImportEvernote,render:()=>r.createElement(ve,{searchInputPlaceholder:n.formatMessage({id:"evernoteImportOption.search.placeholder",defaultMessage:"Search for a notebook…",description:"'Notebook' is an Evernote term."}),noSearchResultsPlaceholder:n.formatMessage({id:"evernoteImportOption.search.noResultsPlaceholder",defaultMessage:"No notebooks",description:"'Notebook' is an Evernote term."}),analyticsName:"evernote",sections:o,onComplete:e=>this.handleImportEvernoteComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return r.createElement(S,Object.assign({},u,{onClick:i?t:this.handleEvernoteAuth}))}})}}var De=Object(G.h)(Te),Ie=(n(191),n(1483));class je extends i.a{constructor(){super(...arguments),this.handleClickImportAsana=()=>{T.C(this.environment,{name:"asana",from:this.props.analyticsFrom})},this.handleAsanaAuth=async()=>{await Ie.a({environment:this.environment,requestStore:this.props.requestStore})},this.handleRemoveAsana=async()=>{await x.s(this.environment,{}),await this.props.requestStore.refresh(),T.ud(this.environment,{name:"asana"})},this.handleImportAsanaComplete=async(e,t)=>{const n=N.flatten(N.values(e.projects)).filter(e=>Boolean(t.find(t=>t.key===e.gid.toString())));T.Nb(this.environment,{name:"asana",count:t.length});const r=await async function(e){const{environment:t,projects:n,spaceStore:r,spaceViewStore:i}=e;L.b({message:J.importingFromAsanaMessage,interpolatedValues:{importingCount:n.length}}),W.a.setState({open:!1});const a=A.c(t),s=n.map(e=>R.b({environment:t,spaceStore:r,spaceViewStore:i,isPrivate:!0,prepend:!0,loading:!0,title:e.name,transaction:a}));await A.b({environment:t,transaction:a});try{return await Promise.all(s.map(async(e,r)=>{const i=n[r],{value:a}=await x.gb(t,{blockId:e.id,projectId:i.gid}).next();if(a.error)throw a.error})),L.a(),s[0]}catch(o){throw A.d(t,e=>{for(const t of s)_.e({parent:r.getPagesStore(),remove:t,transaction:e})}),U.e(Y.a.formatMessage(J.asanaImportFailed)),L.a(),new Error(o)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,projects:n});this.props.onComplete(r)}}renderComponent(){const{asanaResult:e,intl:t}=this.props,{account:n,workspaces:i,projects:a}=e,s=i.map(e=>{const t=a[e.gid]||[];return{key:e.gid.toString(),name:e.name,items:t.map(e=>({key:e.gid.toString(),name:e.name}))}}),o={title:"Asana",logo:ne.a.images.import.asanaPng,caption:n&&n,actionButton:n&&this.props.renderItemActionsButton([{name:t.formatMessage({id:"asanaImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>W.a.setState({open:!0})},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleAsanaAuth},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveAsana}]),onClick:()=>{}},{device:l}=this.environment;return r.createElement(d.a,{popupType:l.isMobile?d.a.PopupType.SlideUp:d.a.PopupType.Popup,buttonPopupStore:W.a,onClick:this.handleClickImportAsana,render:()=>r.createElement(ve,{searchInputPlaceholder:t.formatMessage({id:"asanaImportOption.search.placeholder",defaultMessage:"Search for a project…",description:"'Project' is an Asana term."}),noSearchResultsPlaceholder:t.formatMessage({id:"asanaImportOption.search.noResultsPlaceholder",defaultMessage:"No projects",description:"'Project' is an Asana term."}),analyticsName:"asana",sections:s,onComplete:t=>this.handleImportAsanaComplete(e,t)}),renderOrigin:e=>{let{onClick:t}=e;return r.createElement(S,Object.assign({},o,{onClick:n?t:this.handleAsanaAuth}))}})}}var xe=Object(G.h)(je);async function Be(e){const t=await x.ab(e,{});return"success"===t.type?t.data:(console.error(t.error),{boards:[]})}async function Ae(e){const t=await x.B(e,{});if("success"===t.type){const{account:e}=t.data;return e?t.data:{workspaces:[],projects:{}}}return console.error(t.error),{workspaces:[],projects:{}}}async function Fe(e){try{const t=await x.J(e,{});if("success"===t.type){const{notebooks:e,userInfo:n}=t.data;return{notebooks:e,userInfo:n}}return console.error(t.error),{notebooks:[],userInfo:void 0}}catch(t){return console.error(t),{notebooks:[],userInfo:void 0}}}var Re=n(108);function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ue(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){_e(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _e(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class We extends i.a{constructor(){super(...arguments),this.storeTypes={trelloRequestStore:C.a,asanaRequestStore:C.a,evernoteRequestStore:C.a},this.handleFileUploadClick=async e=>{T.C(this.environment,{name:e,from:this.props.analyticsFrom});const t=await async function(e){const{environment:t,pageStore:n,spaceStore:r,isTeamPage:i,spaceViewStore:a,uploadType:s}=e;let o;try{const e=await F.b({multiple:!0,accept:Z[s].join(",")});if(0===e.length)return;const g=1===e.length,b=await new Promise((n,r)=>{F.f({environment:t,files:e,bucket:"temporary",preventLimitFreeFileSize:!0,onStart:()=>{L.b({message:g?J.uploadingOneFile:J.uploadingMultipleFilesNotStarted,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:0}})},onProgress:t=>{let{uploadedFiles:n,progressPercent:r}=t;L.b({message:g?J.uploadingOneFile:J.uploadingMultipleFilesInProgress,interpolatedValues:{numberOfUploadedFiles:n,totalNumberOfFiles:e.length,percentComplete:r}})},onComplete:t=>{L.b({message:g?J.uploadingOneFile:J.uploadingMultipleFilesComplete,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:100}}),n(t)},onError:r})});let f,y;if(n&&n.isEmptyPage())e.length>1||n.isInsideCollection()?(f=n.id,y="AppendToBlock"):(f=n.id,y="ReplaceBlock");else{const n=A.c(t),s=Y.a.formatMessage(J.importTitle,{date:Object(D.a)().format("ll")}),l=R.b({environment:t,spaceStore:r,spaceViewStore:a,isPrivate:!i,prepend:!i,title:s,transaction:n});o=l,f=l.id,y=e.length>1?"AppendToBlock":"ReplaceBlock";const c=I.c();n.postSubmitCallbacks.push(c.resolve),A.b({environment:t,transaction:n}),await c.promise}const S=b.map((t,n)=>({fileURL:t,fileName:e[n].name}));let v=0;L.b({message:g?J.importingOneFile:J.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:v,totalNumberOfFiles:e.length}});for(const{fileURL:n,fileName:i}of S){if("confluence"===s){const e=x.hb(t,{fileURL:n,fileName:i,pageId:f,spaceId:r.id});var l,c=!0,d=!1;try{for(var u,p,m=$(e);c=(u=await m.next()).done,p=await u.value,!c;c=!0){const e=p;if(e.error)throw e.error;e.value.isComplete||L.b(e.value.status)}}catch(h){d=!0,l=h}finally{try{c||null==m.return||await m.return()}finally{if(d)throw l}}}else if("AppendToBlock"===y){const{value:e}=await x.jb(t,{fileURL:n,fileName:i,importType:y,pageId:f}).next();if(e.error)throw e.error}else if("ReplaceBlock"===y){const{value:e}=await x.jb(t,{fileURL:n,fileName:i,importType:y,pageId:f}).next();if(e.error)throw e.error}v++,L.b({message:g?J.importingOneFile:J.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:v,totalNumberOfFiles:e.length}})}return L.a(),j.a.createChildStore(r,{table:z.b,id:f})}catch(g){let e;throw L.a(),A.d(t,e=>{o&&_.e({parent:r.getPagesStore(),remove:o,transaction:e})}),e=g.clientData&&g.clientData.type&&X.a[g.clientData.type]?Y.a.formatMessage(X.a[g.clientData.type],g.clientData.messageValues):Y.a.formatMessage(J.importFailed),U.e(e),g}}({environment:this.environment,pageStore:this.props.pageStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,uploadType:e});t&&this.props.onComplete(t)}}renderComponent(){if(!u.a.state.online)return r.createElement("div",{style:Ue({},We.wrapStyle,{fontSize:14,color:this.theme.mediumTextColor})},r.createElement(G.b,{id:"importOptions.offlineErrorMessage",defaultMessage:"Please go online to import."}));const{analyticsFrom:e}=this.props;return this.renderRequests(t=>t?r.createElement("div",{style:We.wrapStyle},this.renderOptions(t)):r.createElement("div",{style:"onboarding"===e?{}:We.wrapStyle},r.createElement(v.a,null)))}renderOptions(e){return r.createElement("div",{style:{display:"flex"}},r.createElement("div",{style:Ue({},We.optionsColumnStyle,{marginRight:16})},this.renderEvernoteImportOption(e.evernoteResult),this.renderTrelloImportOption(e.trelloResult),this.renderAsanaImportOption(e.asanaResult),this.renderConfluenceImportOption()),r.createElement("div",{style:Ue({},We.optionsColumnStyle,{marginRight:16})},r.createElement(S,{title:r.createElement(G.b,{id:"importOptions.textMarkdown.title",defaultMessage:"Text & Markdown",description:"Button title for importing plain text and/or Markdown content into Notion"}),icon:te.a.importText,onClick:()=>this.handleFileUploadClick("markdown")}),r.createElement(S,{title:"CSV",icon:te.a.importCSV,onClick:()=>this.handleFileUploadClick("csv")}),r.createElement(S,{title:"HTML",icon:te.a.importHTML,onClick:()=>this.handleFileUploadClick("html")}),r.createElement(S,{title:"Word",logo:ne.a.images.import.wordPng,onClick:()=>this.handleFileUploadClick("docx")})),r.createElement("div",{style:We.optionsColumnStyle},r.createElement(S,{title:"Google Docs",logo:ne.a.images.import.googleDocsPng,actionButton:this.renderHelpButtonToURL(Object(Pe.a)("guides.importGoogleDocs")),onClick:()=>this.handleFileUploadClick("gdocs")}),r.createElement(S,{title:"Dropbox Paper",logo:ne.a.images.import.dropboxPaperPng,actionButton:this.renderHelpButtonToURL(Object(Pe.a)("guides.importDropboxPaper")),onClick:()=>this.handleFileUploadClick("dropbox")}),r.createElement(S,{title:"Quip",logo:ne.a.images.import.quipPng,actionButton:this.renderHelpButtonToURL(Object(Pe.a)("guides.importQuip")),onClick:()=>this.handleFileUploadClick("quip")}),r.createElement(S,{title:"Workflowy",logo:ne.a.images.import.workflowyPng,actionButton:this.renderHelpButtonToURL(Object(Pe.a)("guides.importWorkflowy")),onClick:()=>this.handleFileUploadClick("workflowy")})))}renderRequests(e){return r.createElement(w.a,{request:this.environment,performRequest:Be,requestStore:this.stores.trelloRequestStore,render:(t,n)=>r.createElement(w.a,{request:this.environment,performRequest:Ae,requestStore:this.stores.asanaRequestStore,render:(t,i)=>r.createElement(w.a,{request:this.environment,performRequest:Fe,requestStore:this.stores.evernoteRequestStore,render:(t,r)=>e(n&&i&&r?{trelloResult:n,asanaResult:i,evernoteResult:r}:void 0)})})})}renderTrelloImportOption(e){return r.createElement(we,{trelloResult:e,analyticsFrom:this.props.analyticsFrom,renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.trelloRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderAsanaImportOption(e){return r.createElement(xe,{asanaResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.asanaRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderConfluenceImportOption(){var e;if(e=this.environment,"on"===Re.a.getGroup(e,"confluence-import"))return r.createElement(S,{title:"Confluence",logo:ne.a.images.import.confluencePng,onClick:()=>this.handleFileUploadClick("confluence"),actionButton:this.renderHelpButtonToURL(Object(Pe.a)("guides.importConfluence"))})}renderEvernoteImportOption(e){return r.createElement(De,{evernoteResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,defaultActionButton:this.renderHelpButtonToURL(Object(Pe.a)("guides.importEvernote")),onComplete:this.props.onComplete,requestStore:this.stores.evernoteRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderHelpButtonToURL(e){return r.createElement(k.a,{renderTooltip:()=>r.createElement(G.b,{id:"importOptions.helpButton.tooltip",defaultMessage:"Learn about how to import"}),render:t=>r.createElement(o.a,Object.assign({external:!0,href:e,style:{marginLeft:"auto"}},t),r.createElement(l.a,{icon:te.a.help}))})}renderItemActionsButton(e){return r.createElement(d.a,{popupType:P.b.Popup,renderOrigin:e=>r.createElement(l.a,Object.assign({icon:te.a.dots},e)),render:t=>{const n={key:"section",render:e=>r.createElement(O.a,Object.assign({},e)),items:e.map(e=>{let{name:n,action:i}=e;return{key:n,render:e=>r.createElement(c.a,Object.assign({},e,{title:n})),action:()=>{i(),t.close()}}})};return r.createElement(E.b,{menuType:E.b.MenuType.Popup,width:200},r.createElement(M.a,{type:M.a.Type.Vertical,initialFocus:void 0,sections:[n]}))}})}}We.wrapStyle={display:"flex",alignItems:"center",justifyContent:"center",width:752,minHeight:240},We.optionsColumnStyle={width:240};var qe=We,Ne=n(742),ze=n(77);class Ve extends i.a{constructor(){super(...arguments),this.handleModalDismiss=()=>{s.a.setState({open:!1})},this.handleImportComplete=e=>{s.a.setState({open:!1}),Oe.h({environment:this.environment,store:e})}}renderComponent(){const e=s.a.state;return r.createElement(Ne.a,{open:e.open,innerStyle:Ve.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>r.createElement(r.Fragment,null,r.createElement("div",{style:Ve.modalTopbarWrapStyle},r.createElement("div",{style:Ve.modalTopbarHeaderStyle},r.createElement(G.b,{id:"importModal.importButton.label",defaultMessage:"Import"})),this.renderHelpButton()),r.createElement("div",null,this.renderImportOptions(e))),onDismiss:this.handleModalDismiss})}renderHelpButton(){return r.createElement(o.a,{href:Object(Pe.a)("guides.import"),onClick:()=>T.A(this.environment,{from:"import"}),external:!0},r.createElement(ze.a,{isSmall:!0,icon:te.a.help,isGray:!0},r.createElement(G.b,{id:"importModal.helpButton.label",defaultMessage:"Learn about importing"})))}renderImportOptions(e){const{currentBlockStore:t,currentSpaceStore:n,currentSpaceViewStore:i,currentUserSettingsStore:s}=a.a.state;if(t&&n&&i&&s)return r.createElement(qe,{pageStore:e.open&&e.pageStore?e.pageStore:t,spaceStore:n,spaceViewStore:i,userSettingsStore:s,analyticsFrom:"modal",onComplete:this.handleImportComplete,readOnlyCreditButton:!1})}}Ve.wrapStyle={padding:"24px 36px 24px",minWidth:300},Ve.modalTopbarWrapStyle={display:"flex",alignItems:"center",marginTop:8,marginBottom:18},Ve.modalTopbarHeaderStyle={fontSize:24,lineHeight:1.2,marginBottom:6,fontWeight:h.a.fontWeight.bold,marginRight:"auto"};t.default=Ve},1153:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(3),a=n(742),s=(n(15),n(12),n(181)),o=n(26),l=n(40),c=n(346),d=n(208),u=n(487),p=n(16);class m extends p.a{getInitialState(){return{}}}var h=m,g=n(170),b=n(754),f=n(99),y=n(2),S=n(841),v=n(171),E=n(862),M=n(19),w=n(1287),C=n(1),O=n(14);class k extends i.a{renderComponent(){let e;return O.kc(this.environment,{type:"page"}),e=this.environment.PersistedRecordCache?r.createElement(C.b,{defaultMessage:"Please go online to load this page, then you'll be able to access it while offline.",id:"pageOfflineIndicator.hasLocalData.message"}):r.createElement(C.b,{defaultMessage:"Oops, you seem to be offline. Please go online to view this page.",id:"pageOfflineIndicator.noLocalData.message"}),r.createElement("div",{style:this.getContainerStyle()},r.createElement("div",{style:this.getGreetingStyle()},e))}isLoggedIn(){return this.environment.currentUser.isLoggedIn()}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?w.a.desktopMacHeight:w.a.defaultHeight}getContainerStyle(){const{device:e}=this.environment;return{height:"100%",minHeight:this.isLoggedIn()?"calc(100vh - ".concat(2*this.getTopbarHeight(),"px)"):"100vh",paddingLeft:e.isMobile?16:32,paddingRight:e.isMobile?16:32,display:"flex",justifyContent:"center",alignItems:"center"}}getGreetingStyle(){const{device:e}=this.environment;return{fontSize:e.isMobile?18:32,marginBottom:8,textAlign:"center",color:M.f.uiBlack,maxWidth:640,lineHeight:1.3}}}var P=k,T=n(846),D=n(148),I=n(297),j=n(6),x=n(853),B=n(143),A=n(17),F=n(460),R=n(265),L=n(365),U=n(72),_=n(233),W=n(634),q=n(67),N=n(276),z=n(80),V=n(389),H=n(126),G=n(475),Y=n(622),Q=n(235),K=n(1494);function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){$(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class J extends i.a{constructor(){super(...arguments),this.pageContextStore=this.createComputedStore(()=>{const{presenceStore:e,pageVisitStore:t,currentSpaceStore:n,currentSpaceViewStore:r}=A.a.state;return{pageStore:this.props.store,spaceStore:n,spaceViewStore:r,presenceStore:e,pageVisitStore:t}}),this.renderPageSpinner=e=>{if(!e)return;return r.createElement("div",{style:{position:"absolute",top:0,bottom:0,left:0,right:0,display:"flex",alignItems:"center",justifyContent:"center"},key:"spinner"},r.createElement(f.a,{style:{opacity:.5,width:J.spinnerSize,height:J.spinnerSize}}))},this.renderContent=e=>{const{store:t}=this.props,{pageVisitStore:n,presenceStore:i,currentLoadingContainerStore:a}=A.a.state,s=t.getValue();return s&&s.type===j.a.copyIndicator?r.createElement("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:16,marginTop:"12vh"}},r.createElement(f.a,null),r.createElement("div",{style:{fontSize:14,marginTop:8,color:this.theme.mediumTextColor}},r.createElement(C.b,{defaultMessage:"Importing…",id:"frame.importingMessage"}))):this.shouldShowOfflineIndicator(e)?r.createElement(P,{store:t}):r.createElement(r.Fragment,null,r.createElement(d.b,{context:d.a.Frame,store:t,loadingContainerStore:a,paddingBottom:d.b.paddingBottom(this.environment),paddingLeft:d.b.defaultPaddingLeftRight(this.environment),paddingRight:d.b.defaultPaddingLeftRight(this.environment),pageCoverHeight:d.b.defaultPageCoverHeight(this.environment),disabled:!1}),r.createElement(T.a,{pageVisitStore:n,presenceStore:i}))},this.handleScrollerMount=e=>{L.a.PageScroller=e},this.isOffline=this.createComputedStore(()=>!z.a.state.online)}willUnmount(){S.a({rootStore:this.props.store})}renderComponent(){const{device:e,RouterStore:t}=this.environment,{isMobile:n}=e,{store:i,collectionViewStore:a,routerState:s}=this.props,{historyState:o}=s,{currentLoadingContainerStore:l,pageVisitStore:c,presenceStore:d,currentSpaceStore:p,currentSpaceViewStore:m}=A.a.state,h=this.shouldShowOfflineIndicator(void 0),b=this.environment.currentUser.isLoggedIn(),S=o&&y.isNumber(o.scrollTop)?o.scrollTop:void 0,{currentBlockStore:v}=A.a.state;return r.createElement(Y.a,{value:this.pageContextStore.state},r.createElement(H.a,{isVisible:!0,animationStyle:{width:this.environment.WindowSizeStore.state.width-Object(V.b)(this.environment)},render:()=>r.createElement("div",{style:this.getStyle(),className:q.w},!n&&r.createElement(w.a,{store:i,collectionViewStore:a,spaceStore:p,spaceViewStore:m,pageVisitStore:c,presenceStore:d,showSidebarButton:!Object(V.f)(this.environment),isElectron:e.isElectron,isInvalidPage:h,banners:N.a.state.banners}),n&&r.createElement(Q.i,{store:i,collectionViewStore:a,spaceStore:p,spaceViewStore:m,pageVisitStore:c,presenceStore:d,isInvalidPage:h,shouldShowMoveTo:Boolean(s.route.showMoveTo&&i.canEdit()&&i.isEmptyPage()&&i.isEmptyTitle()&&b),saveParent:Boolean(s.route.saveParent),banners:N.a.state.banners,isOffline:this.isOffline.state}),r.createElement(u.a,{store:i,key:i.id,isDefaultContainer:!0,disable:Boolean(U.c.state.open||_.a.state.open),render:e=>r.createElement(E.a,{pageStore:i,pageVisitStore:c,scrollToBlockIds:W.a(t),scrollToPosition:S,store:l,onReady:()=>{x.a(this.environment)},onDone:()=>{this.props.store.isCollectionView()||"rendered"===A.a.state.renderPhase||A.a.setState(X({},A.a.state,{renderPhase:"rendered"}))},initialChunkSize:30,incrementChunkSize:30,incrementScrollOffset:window.innerHeight,loadNextChunkTimeout:1e3,render:t=>{let{error:n,ready:i}=t;return r.createElement(r.Fragment,null,r.createElement(g.b,Object.assign({ref:this.handleScrollerMount,disableScroll:D.e(this.environment)||!i,type:this.useSeparateHorizontalScroller()?g.b.OverflowType.Y:g.b.OverflowType.All,style:this.getScrollerStyle(i),store:F.a},e),i&&this.renderContent(n),!i&&r.createElement(f.a,{style:this.getSpinnerStyle()})),r.createElement(I.a,{show:!i,showDelay:300,showHold:0,render:this.renderPageSpinner}))}})}),b&&n&&r.createElement(Q.d,{position:e.isReactNative?K.a.Bottom:K.a.Floating,currentBlockStore:this.props.store}),this.shouldShowMobileBottomBar()&&b&&v&&r.createElement(Q.e,{store:v}))}))}shouldShowOfflineIndicator(e){const{store:t}=this.props,{currentLoadingContainerStore:n}=A.a.state;return!(!e||!n||n.state.endOfResultsReached)||(!t.getValue()||!t.canRead())}getPageViewBlockBottomPadding(){return"number"==typeof d.b.paddingBottom(this.environment)?"".concat(d.b.paddingBottom(this.environment),"px"):d.b.paddingBottom(this.environment)}shouldShowMobileBottomBar(){const{isTablet:e,isReactNative:t,isAndroid:n}=this.environment.device;return t&&(e||n)}getStyle(){const{device:e}=this.environment,t=X({flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",background:this.theme.contentBackground,zIndex:v.d,height:"100vh",maxHeight:"100%"},e.isTablet&&{position:"relative"},{},U.c.state.open&&G.a.getMode(this.environment)===U.a?{paddingRight:700}:{});if(!Object(V.a)(this.environment)){const e=R.b.state;Object(V.g)(this.environment)||(t.boxShadow=this.theme.mediumBoxShadow),t.pointerEvents=e?"none":"auto",t.transform="translateX(0)"}return t}useSeparateHorizontalScroller(){return this.props.store.isCollectionView()&&!B.b(this.environment)}getScrollerStyle(e){const t=X({display:"flex",flexDirection:"column",zIndex:1,flexGrow:1,position:"relative"},e?{}:J.hiddenStyle);return this.props.store.isCollectionView()?t:X({},t,{alignItems:"center"})}getSpinnerStyle(){return{zIndex:1,opacity:.5,width:J.spinnerSize,height:J.spinnerSize,marginTop:"calc(-".concat(J.spinnerSize," / 2 - ").concat(this.getPageViewBlockBottomPadding()," / 2)"),marginBottom:24,marginLeft:"auto",marginRight:"auto"}}}J.spinnerSize="1.375em",J.hiddenStyle={opacity:0,pointerEvents:"none",height:0};var ee=J,te=n(10),ne=n(4),re=n(33),ie=n(192),ae=n(1492),se=n(125),oe=n(173),le=n(106),ce=n(164),de=n(84),ue=n(37),pe=n(193),me=n(41),he=n(75);function ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ge(Object(n),!0).forEach((function(t){fe(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ye extends i.a{constructor(){super(...arguments),this.storeTypes={store:h,inMemoryRecordCacheStore:c.a},this.renderResult=(e,t)=>{const{device:n,WindowSizeStore:i}=this.environment,{navigatedRootId:a}=this.stores.store.state;if(t){let e;return e=a?o.a.createChildStore(t,{table:te.b,id:a}):t,r.createElement("div",{style:this.props.style},r.createElement("div",{style:be({fontSize:14,paddingTop:n.isMobile?4:8,paddingBottom:n.isMobile?4:8,paddingLeft:n.isMobile?10:12,paddingRight:n.isMobile?10:12,height:48,display:"flex",alignItems:"center",flexShrink:0},n.isMobile?{height:44,borderBottom:"\n\t\t\t\t\t\t\t\t\t\t\t1px solid ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t\t\t\t\t")}:{})},r.createElement(b.a,{store:e,maxAncestorCount:2,ancestorMaxWidth:240,currentPageMaxWidth:240,showCurrentPageControls:!1,isMobile:n.isMobile,style:{flexGrow:1,flexShrink:1,minWidth:0,paddingLeft:i.state.paddingLeftCSS,paddingRight:i.state.paddingRightCSS}}),this.props.topbarRightActionButton),r.createElement(u.a,{key:e.id,store:e,isDefaultContainer:!0,render:n=>r.createElement(g.b,Object.assign({style:this.getScrollerStyle(),key:e.id,type:this.useSeparateHorizontalScroller(t)?g.b.OverflowType.Y:g.b.OverflowType.All,store:ae.a,disableScroll:D.e(this.environment)},n),r.createElement(d.b,{store:e,loadingContainerStore:void 0,context:this.props.isFrontPage?d.a.FrontPageTemplatePreview:d.a.InAppTemplatePreview,paddingBottom:d.b.paddingBottom(this.environment),paddingLeft:d.b.defaultPaddingLeftRight(this.environment),paddingRight:d.b.defaultPaddingLeftRight(this.environment),pageCoverHeight:d.b.defaultPageCoverHeight(this.environment),disabled:this.props.disabled}))}))}return r.createElement("div",{style:be({display:"flex",alignItems:"center",justifyContent:"center"},this.props.style)},r.createElement(f.a,{style:{width:ee.spinnerSize,height:ee.spinnerSize}}))},this.handleOverrideLinkClick=e=>{const{device:t}=this.environment,n=Object(oe.k)({url:e,isMobile:t.isMobile,baseUrl:re.a.baseURL,protocol:re.a.protocol,currentUrl:window.location.href});"page"===n.name&&(n.peekViewBlockId?this.stores.store.setState(be({},this.stores.store.state,{navigatedRootId:n.peekViewBlockId})):this.stores.store.setState(be({},this.stores.store.state,{navigatedRootId:n.blockId})))},this.performRequest=async e=>{const t=await l.sb(this.environment,{blockId:e,shallow:!1});if("failed"===t.type)throw t.error;const{currentSpaceStore:n}=A.a.state,{data:r}=se.a.state,{inMemoryRecordCacheStore:i}=this.stores;i.reset(),i.isTemplatePreview=!0;const a=new Set,s=new Set,c=new he.a(t.data.subtreeRecordMap);for(const{pointer:o,value:l}of c){if(!l)return;if(i.setRecord({pointer:o,userId:this.environment.currentUser.id},{role:"editor",value:l.value}),"block"===o.table){const e=l.value;if(e){const t=e.properties||{};for(const e of Object.keys(t)){const n=Object(ne.jb)(t[e]);for(const e of n)a.add(e);const r=Object(ne.G)(t[e]);for(const e of r)s.add(e)}e.created_by_table&&e.created_by_id&&(e.created_by_table===ue.a?a.add(e.created_by_id):s.add(e.created_by_id)),e.last_edited_by_table&&e.last_edited_by_id&&(e.last_edited_by_table===ue.a?a.add(e.last_edited_by_id):s.add(e.last_edited_by_id))}}}if(r)for(const o of Object(le.u)(r))a.add(o.userId);const d=await Promise.all(Array.from(a).map(async e=>{if(n){const t=ie.a.createChildStore(n,{table:ue.a,id:e});return await t.load(),t.getValue()}{const t=await l.bc(this.environment,{table:ue.a,id:e,userId:this.environment.currentUser.id,version:-1});return t&&t.value}}));for(const o of d)o&&i.setRecord({pointer:{table:ue.a,id:o.id},userId:this.environment.currentUser.id},{role:"reader",value:o});const u=await Promise.all(Array.from(s).map(async e=>{if(n){const t=Object(me.c)(n,{table:pe.a,id:e});return await t.load(),t.getValue()}{const t=await l.bc(this.environment,{table:pe.a,id:e,userId:this.environment.currentUser.id,version:-1});return t&&t.value}}));for(const o of u)o&&i.setRecord({pointer:{table:pe.a,id:o.id},userId:this.environment.currentUser.id},{role:"reader",value:o});const{currentUserStore:p}=A.a.state;return p&&(await p.load(),i.setRecord({pointer:p.pointer,userId:this.environment.currentUser.id},{role:"editor",value:p.getValue()})),new o.a(this.environment,{table:te.b,id:e},{inMemoryRecordCacheStore:i})}}getChildContext(){return be({},this.context,{overrideLinkClick:this.handleOverrideLinkClick})}renderComponent(){return z.a.state.online?r.createElement(s.a,{request:this.props.previewRootId,performRequest:this.performRequest,render:this.renderResult}):r.createElement("div",{style:be({display:"flex",alignItems:"center",justifyContent:"center"},this.props.style)},r.createElement(de.a,{isSmall:!0},r.createElement(C.b,{defaultMessage:"Please go online to view this template.",id:"pageTemplatePreview.offline.message"})))}useSeparateHorizontalScroller(e){return e.isCollectionView()&&!B.b(this.environment)}getScrollerStyle(){const{device:e}=this.environment;return be({flex:1},e.isSafari&&{zIndex:1})}}ye.contextTypes=i.b,ye.childContextTypes=ce.a;var Se=ye,ve=n(244),Ee=n(637),Me=n(1190),we=n(22),Ce=n(412),Oe=n(11),ke=n(91),Pe=n(45),Te=n(272),De=n(54),Ie=n(342),je=n(34),xe=n(8),Be=n(109);function Ae(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ae(Object(n),!0).forEach((function(t){Re(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ae(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Le extends i.a{constructor(){super(...arguments),this.storeTypes={mouseStore:Be.a,labelMouseStore:Be.a},this.handleToggleClick=()=>{const{section:e}=this.props;this.isOpen()?Ce.e(e.sectionName):Ce.g(e.sectionName)},this.handleMouseMove=()=>this.stores.mouseStore.setState(Fe({},this.stores.mouseStore.state,{mouseEntered:!0})),this.handleMouseLeave=()=>this.stores.mouseStore.setState(Fe({},this.stores.mouseStore.state,{mouseEntered:!1})),this.handleLabelMouseMove=()=>{const{labelMouseStore:e}=this.stores;e.setState(Fe({},e.state,{mouseEntered:!0}))},this.handleLabelMouseLeave=()=>{const{labelMouseStore:e}=this.stores;e.setState(Fe({},e.state,{mouseEntered:!1}))}}renderComponent(){const{renderSection:e}=this.props,t=!this.isOpen();return r.createElement("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,style:this.getButtonContainerStyle()},this.renderLabel(),!t&&e())}renderLabel(){const e=!this.isOpen();return r.createElement(Me.a,{isMobile:this.props.isMobile,disableMobileBorder:e,shouldShowMobileMarginBotton:e,style:this.getSectionSidebarItemStyle(),childrenStyle:{overflow:"visible"}},r.createElement("div",{style:{display:"flex",alignItems:"center"}},r.createElement(je.a,{onClick:this.handleToggleClick,onMouseMove:this.handleLabelMouseMove,onMouseLeave:this.handleLabelMouseLeave,style:this.getLabelButtonStyle()},!Boolean(this.props.forceOpen)&&xe.a.triangle(this.getArrowStyle()),r.createElement("span",{style:this.getToggleButtonStyle()},this.props.icon&&r.createElement("span",{style:{paddingRight:4,display:"inline-block"}},this.props.icon),this.props.section.name))))}isOpen(){const{section:e,expandedSections:t}=this.props;return!!t&&-1!==t.indexOf(e.sectionName)}getSectionSidebarItemStyle(){return{minHeight:24,padding:0}}getSectionLabelStyle(){return{lineHeight:1,marginBottom:1,color:this.theme.sidebarTextColor,fontWeight:we.a.fontWeight.semibold,marginLeft:9}}getMobileSectionLabelStyle(){return{lineHeight:1,color:this.theme.sidebarTextColor,fontWeight:we.a.fontWeight.semibold,marginLeft:9}}getLabelButtonStyle(){return Fe({display:"flex",alignItems:"center",paddingBottom:12,paddingTop:12,paddingLeft:25},this.props.isMobile&&{marginBottom:8},{width:"100%"})}getToggleButtonStyle(){const{labelMouseStore:e}=this.stores,{mouseEntered:t}=e.state;return Fe({},this.props.isMobile?this.getMobileSectionLabelStyle():this.getSectionLabelStyle(),{color:t?this.theme.regularTextColor:this.theme.mediumTextColor,transition:"color 100ms ease-out"})}getButtonContainerStyle(){const e=!this.isOpen(),{first:t}=this.props;return Fe({},t?{borderTop:"1px solid ".concat(this.theme.regularDividerColor)}:{},{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),width:"100%",paddingBottom:e?0:10})}getArrowStyle(){return{width:"0.6875em",height:"0.6875em",transition:"transform 200ms ease-out",transform:"rotateZ(".concat(this.isOpen()?180:90,"deg)"),fill:this.theme.regularIconColor}}}var Ue=Le,_e=n(42),We=n(66),qe=n(108);class Ne extends i.a{constructor(){super(...arguments),this.storeTypes={inMemoryRecordCacheStore:c.a},this.renderMobilePopup=()=>{const e=_.a.state;if(e.open)return r.createElement(ke.default,{title:r.createElement(C.b,{defaultMessage:"Try this template",id:"pageTemplateModal.mobileModal.title"}),left:r.createElement(ke.CancelMenuText,null),onClickLeft:this.handleDismiss,right:e.isLoading?r.createElement(f.a,null):r.createElement(C.b,{defaultMessage:"Use",id:"pageTemplateModal.mobileModal.useButton.label",description:"'Use' is utilized as a verb for a button label on the top right of a mobile menu, indicating to the user to click on the button to use the template they are previewing."}),onClickRight:this.handleUseTemplateClick,forceFullScreenSlideUp:!0},this.renderPreview(e))},this.renderModal=()=>{const e=_.a.state;if(e.open)return r.createElement("div",{style:Ne.modalStyle,className:q.S},this.renderPreview(e),this.renderSidebar(e))},this.handleDismiss=async()=>{const{inMemoryRecordCacheStore:e}=this.stores;if(e.state.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.close()}else this.close()},this.handleUseTemplateClick=async()=>{const{inMemoryRecordCacheStore:e}=this.stores;if(e.state.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.accept(!1)}else this.accept(!1)},this.handleItemClick=async e=>{const{inMemoryRecordCacheStore:t}=this.stores;if(t.state.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.setCurrentItem(e)}else this.setCurrentItem(e);O.be(this.environment,{name:e.name})}}willMountOrUpdate(){const e=_.a.state,{currentSpaceViewStore:t}=A.a.state;e.open&&t&&Oe.d(this.environment,n=>{Ce.j({item:e.item,spaceViewStore:t,transaction:n})})}renderComponent(){const{device:e}=this.environment,t=_.a.state;return e.isMobile?r.createElement(Pe.a,{open:t.open,render:this.renderMobilePopup,forceFullScreenSlideUp:!0,onDismiss:this.handleDismiss,popupType:e.isMobile?Pe.a.PopupType.SlideUp:Pe.a.PopupType.Popup}):r.createElement(a.a,{open:t.open,render:this.renderModal,onDismiss:this.handleDismiss})}renderSidebar(e){const{currentSpaceViewStore:t,currentSpaceStore:n}=A.a.state;if(!t||!n)return;const i=Ce.d(),a=Object(ve.a)(this.props.intl),s="on"===qe.a.getGroup(this.environment,"suggested-templates");return r.createElement("div",{style:this.getSidebarStyle()},r.createElement(Ie.a,{isLarge:!0,onClick:this.handleUseTemplateClick,style:Ne.useTemplateButtonStyle,disabled:e.isLoading||!z.a.state.online},e.isLoading&&r.createElement(f.a,{isWhite:!0,style:{marginRight:6}}),r.createElement(C.b,{defaultMessage:"Use this template",id:"pageTemplateModal.useTemplateButton.label"})),r.createElement(g.b,{style:Ne.scrollerStyle,type:g.a.Y},s&&r.createElement(Ue,{isMobile:!1,key:"suggested",section:a,expandedSections:[...i||[],"suggested"],spaceStore:n,spaceViewStore:t,showAddPageButton:!1,first:!0,forceOpen:!0,icon:xe.a.sparkles({width:12}),renderSection:()=>r.createElement(r.Fragment,null,a.items.map((t,n)=>{const i=e.item.rootId===t.rootId,a=i?this.hoveredButtonStyle():{};return r.createElement(je.a,Object.assign({hovered:i,style:a,key:n},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))}))}),e.sections.map((a,o)=>r.createElement(Ue,{isMobile:!1,key:a.sectionName,section:a,expandedSections:i,spaceStore:n,spaceViewStore:t,showAddPageButton:!1,first:!s&&0===o,renderSection:()=>r.createElement(r.Fragment,null,a.items.map((t,n)=>{const i=e.item.rootId===t.rootId,a=i?this.hoveredButtonStyle():{};return r.createElement(je.a,Object.assign({hovered:i,style:a,key:n},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))}))})),r.createElement(je.a,{onClick:()=>Object(_e.i)({environment:this.environment,url:We.gb}),style:this.fixedLinkStyle(),hoveredStyle:{background:this.theme.sidebarHideButtonHoveredBackground},pressedStyle:{background:this.theme.sidebarHideButtonPressedBackground}},xe.a.typesRelation(this.fixedLinkIconStyle()),r.createElement(C.b,{defaultMessage:"Browse more templates",id:"pageTemplateModal.goToFullTemplateGalleryButton.label"}))))}renderSidebarItem(e){return r.createElement(Me.a,{style:{paddingLeft:30,fontWeight:we.a.fontWeight.semibold},isMobile:!1,icon:r.createElement("div",{style:this.getIconWrapStyle()},r.createElement(Ee.a,{size:20,emoji:e.emoji}))},e.name)}renderPreview(e){const{device:t}=this.environment;return r.createElement(Se,{key:e.item.previewRootId,previewRootId:e.item.previewRootId,isFrontPage:!1,style:t.isMobile?Ne.previewMobileStyle:Ne.previewStyle,inMemoryRecordCacheStore:this.stores.inMemoryRecordCacheStore,disabled:!1})}accept(e){const{inMemoryRecordCacheStore:t}=this.stores,n=_.a.state,{currentSpaceViewStore:r,currentSpaceStore:i,currentBlockStore:a}=A.a.state;if(n.open&&r&&i){const s=a&&a.isEmptyPage()?a:void 0,o=U.c.state.open&&U.c.state.target&&U.c.state.target.isEmptyPage()?U.c.state.target:void 0;Ce.a({environment:this.environment,item:n.item,spaceStore:i,spaceViewStore:r,useRecordCacheStore:e?t:void 0,initializeStore:n.createNewPage?void 0:s||o,isPrivate:n.isPrivate})}}close(){Ce.b(this.environment),Te.a()}setCurrentItem(e){_.a.state.open&&Ce.i({templateItem:e,currentUserId:this.environment.currentUser.id})}showEditConfirmDialog(){return new Promise((e,t)=>{De.c({message:r.createElement(C.b,{id:"pageTemplateModal.modifiedTemplateDialog.prompt",defaultMessage:"It looks like you've modified the template. Would you like to save your edits?"}),showCancel:!1,keepFocus:!0,items:[{label:r.createElement(C.b,{id:"pageTemplateModal.modifiedTemplateDialog.saveButton.label",defaultMessage:"Save edits"}),onAccept:()=>{e(!0)}},{label:r.createElement(C.b,{id:"pageTemplateModal.modifiedTemplateDialog.discardEditsButton.label",defaultMessage:"Discard"}),color:"red",onAccept:()=>{e(!1)}}]})})}getSidebarStyle(){return{width:Ne.sidebarWidth,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground,display:"flex",flexDirection:"column",borderTopRightRadius:Ne.borderRadius,borderBottomRightRadius:Ne.borderRadius}}getIconWrapStyle(){return{color:this.theme.regularTextColor,position:"relative"}}hoveredButtonStyle(){return{color:this.theme.regularTextColor,fontWeight:we.a.fontWeight.medium}}fixedLinkStyle(){return{padding:12,color:this.theme.mediumTextColor,background:this.theme.sidebarBackground,fontSize:13,fontWeight:we.a.fontWeight.medium,display:"flex",alignItems:"center",position:"absolute",bottom:0,right:0,height:45,width:Ne.sidebarWidth,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}fixedLinkIconStyle(){return{width:12,height:12,marginLeft:8,marginRight:10,marginBottom:0,fill:this.theme.regularIconColor,fontWeight:we.a.fontWeight.medium}}}Ne.sidebarWidth=240,Ne.borderRadius=3,Ne.modalStyle={display:"flex",width:"85vw",height:"85vh",borderRadius:Ne.borderRadius},Ne.useTemplateButtonStyle={position:"relative",marginTop:16,marginLeft:20,marginRight:20,marginBottom:16,whiteSpace:"nowrap"},Ne.previewStyle={width:"calc(100% - ".concat(Ne.sidebarWidth,"px)"),flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"},Ne.previewMobileStyle={width:"100%",flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"},Ne.scrollerStyle={flexGrow:1,flexShrink:1,paddingBottom:44};t.default=Object(C.h)(Ne)},1154:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(3),a=n(33),s=n(81),o=n(589),l=n(752),c=n(113),d=n(106),u=n(54),p=n(22),m=n(1656),h=n(296),g=n(342),b=n(67),f=n(1),y=n(416),S=n(40),v=n(181),E=n(30),M=n(742),w=n(758),C=n(80),O=n(1481),k=n(170),P=n(1401),T=n(1135),D=n(34),I=n(331),j=n(53),x=n(617),B=n(153);class A extends i.a{renderComponent(){return r.createElement("div",null,r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.billingInformation.header",defaultMessage:"Billing information"}),this.renderInputField({key:"name",label:r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.billingInformation.name",defaultMessage:"Name"}),placeholder:"Ada Lovelace"}),this.renderInputField({key:"address",label:r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.billingInformation.address",defaultMessage:"Address"}),placeholder:"185 Berry St"}),this.renderInputField({key:"city",label:r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.billingInformation.city",defaultMessage:"City"}),placeholder:"San Francisco"}),this.renderInputField({key:"zipCode",label:r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.billingInformation.zipCode",defaultMessage:"Zip code"}),placeholder:"12345"}),this.renderCountryDropdown())}renderCountryDropdown(){const e=[{country:"us",name:this.props.intl.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.country.unitedStates",defaultMessage:"United States"})}],t={menuTitle:this.props.intl.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.country",defaultMessage:"country"}),items:e,getKey:e=>e.country,selectedItem:e[0],onSelect:()=>{},renderItem:e=>r.createElement(j.a,Object.assign({},e,{title:e.value.name})),renderOrigin:e=>r.createElement(x.a,Object.assign({focused:!1,title:r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.billingInformation.country",defaultMessage:"country"}),right:r.createElement(f.b,{defaultMessage:"Select a country",id:"spaceSubscriptionPaymentForm.billingInformation.country.select"})},e))};return r.createElement(I.a,Object.assign({},t))}renderInputField(e){return r.createElement("label",null,r.createElement("span",null,e.label),r.createElement(B.b,{placeholder:e.placeholder}))}}var F=Object(f.h)(A);class R extends i.a{renderComponent(){return r.createElement("div",null,r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.paymentInformation",defaultMessage:"Payment information"}),r.createElement("label",null,r.createElement("span",null,r.createElement(f.b,{id:"spaceSubscriptionPaymentForm.paymentInformation.card",defaultMessage:"Card"}))),r.createElement(T.CardElement,{options:{style:{base:{color:"#32325d",fontFamily:'"Helvetica Neue", Helvetica, sans-serif',fontSmoothing:"antialiased",fontSize:"16px","::placeholder":{color:"#aab7c4"}},invalid:{color:"#fa755a",iconColor:"#fa755a"}},hidePostalCode:!0}}))}}var L=Object(f.h)(R),U=n(17),_=n(1323),W=n(89),q=n(235);function N(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?N(Object(n),!0).forEach((function(t){V(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):N(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function V(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class H extends i.a{constructor(){super(...arguments),this.handleModalClose=()=>{l.a.reset()}}renderComponent(){const e=l.a.state;if(e.open)return r.createElement(q.a,{dependency:q.j.payments},t=>r.createElement(t.stripeReact.Elements,{stripe:Object(s.c)()},r.createElement(t.stripeReact.ElementsConsumer,null,t=>{let{stripe:n,elements:i}=t;return r.createElement("div",{style:this.getModalStyle()},r.createElement("div",{style:{flex:1,maxWidth:"65%",backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.lightDividerColor),padding:"24px 20px 0px",display:"flex",flexDirection:"column"}},r.createElement(k.b,{type:k.b.OverflowType.Y},r.createElement(P.a,{planInfo:{subscriptionTier:e.subscriptionTier,billingInterval:d.f(e)}}),this.renderBillingIntervalSection(e,void 0),r.createElement(F,null),r.createElement(L,null))),r.createElement("div",{style:{flex:1,maxWidth:"35%",backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.lightDividerColor),padding:"24px 20px 0px",display:"flex",flexDirection:"column"}},r.createElement(k.b,{type:k.b.OverflowType.Y},this.renderGrossOrderSummary(e,void 0),this.renderControls(e,n,i))))})))}renderControls(e,t,n){return r.createElement(r.Fragment,null,r.createElement(D.a,{onClick:()=>this.handleUpgrade(e,t,n,void 0)},this.getUpgradeButtonText(e)),r.createElement(D.a,{onClick:()=>{const{currentUserStore:e}=U.a.state,t=e&&e.getValue();_.a.setState({open:!0,email:t&&t.email,name:t&&Object(W.d)(this.props.intl,t)})}},r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.contactSales",defaultMessage:"Contact Sales"})))}renderGrossOrderSummary(e,t){const{planAmount:n,lineItems:i}=d.m({state:e,promo:t,data:this.props.data}),a=i.map((e,t)=>r.createElement("div",{key:t},e.name,e.formattedPrice));return r.createElement("div",null,r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.orderSummary.header",defaultMessage:"Order summary"}),this.getTierLineItemTitle(e),this.getTierLineItemSubtitle(e),Object(c.b)({amount:n,currency:"dollar",intl:this.props.intl}),a)}getUpgradeButtonText(e){const{subscriptionTier:t}=e;switch(t){case"personal":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.upgradeButton.personalProPlan",defaultMessage:"Upgrade to Personal Pro"});case"team":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.upgradeButton.teamPlan",defaultMessage:"Upgrade to Team"});case"enterprise":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.upgradeButton.enterprisePlan",defaultMessage:"Upgrade to Enterprise"});default:return Object(E.e)(t)}}getTierLineItemTitle(e){const{subscriptionTier:t}=e,n=d.t(this.props.data);switch(t){case"personal":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.orderSummary.personalPlan",defaultMessage:"Personal pro plan"});case"team":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.orderSummary.teamPlan",defaultMessage:"Team plan ({numberOfMembers, plural, one {# member} other {# members}})",values:{numberOfMembers:n}});case"enterprise":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.orderSummary.enterprisePlan",defaultMessage:"Enterprise plan ({numberOfMembers, plural, one {# member} other {# members}})",values:{numberOfMembers:n}});default:return Object(E.e)(t)}}getTierLineItemSubtitle(e){const{subscriptionTier:t}=e,n=d.f(e),i=d.j({subscriptionTier:t,billingInterval:n,intl:this.props.intl});switch(n){case"year":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedYearly",defaultMessage:"{price} / user / month · Billed yearly",values:{price:i}});case"month":return r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedMonthly",defaultMessage:"{price} / user / month · Billed monthly",values:{price:i}});default:return Object(E.e)(n)}}renderBillingIntervalSection(e,t){const{yearlyUnitPrice:n,monthlyUnitPrice:i}=d.m({state:e,promo:t,data:this.props.data}),a=d.f(e),s=1-n/(12*i),o=d.c(e.subscriptionTier,s,this.props.intl),c=r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.billingIntervalSection.header",defaultMessage:"Billing interval"});return r.createElement("div",{style:this.getSectionStyle()},r.createElement("div",{style:this.getSubheaderStyle()},r.createElement("div",null,c)),o.map(t=>{let{id:n,title:i,caption:s,unavailable:o}=t;return r.createElement(r.Fragment,{key:n},this.renderRadioButton({title:i,caption:s,isSelected:a===n,onClick:()=>{o||l.a.setState(z({},e,{temporaryBillingInterval:n}))},unavailable:o}))}))}renderRadioButton(e){const{title:t,caption:n,isSelected:i,onClick:a,unavailable:s}=e,o=s?.4:1;return r.createElement("div",{style:{cursor:"pointer",opacity:o},onClick:a},r.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14}},r.createElement(w.a,{isSelected:i}),t),r.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:12,marginLeft:24,marginTop:2,marginBottom:8}},n))}async handleUpgrade(e,t,n,r){if(n&&t){const i=n.getElement(T.CardElement);if(!i)return;const a=await t.createToken(i);if(a.error)return;if(a.token){const{spaceStore:t,data:n}=this.props,i=d.f(e),l=a.token.id,c=d.h(e,n),p=d.g(e),m=d.e(e,n),g=o.c[e.subscriptionTier][i];await Object(s.i)({environment:this.environment,spaceStore:t,plan:g,stripeToken:l,billing:p,billingEmail:m,creditAmount:c,coupon:void 0})&&("send_invoice"===p&&Object(u.e)(this.props.intl.formatMessage({id:"spaceSubscriptionSettings.upgradeModal.checkEmailDialog.message",defaultMessage:"Please check your email for the invoice."})),r&&Object(y.c)(this.environment.currentUser.id),this.handleModalClose(),h.a.setState(z({},h.a.state,{currentTab:"billing"})))}}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:3,width:640,maxHeight:800,height:"100vh",display:"flex"}}getSectionStyle(){return{marginBottom:16}}getSubheaderStyle(){return{display:"flex",alignItems:"center",marginBottom:4,fontSize:12,fontWeight:p.a.fontWeight.semibold,color:this.theme.mediumTextColor}}}var G=Object(f.h)(H),Y=n(108),Q=n(14);function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){X(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function X(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class $ extends i.a{constructor(){super(...arguments),this.renderModal=()=>{if(!l.a.state.open)return;if(!C.a.state.online)return r.createElement(O.a,null);if("on"===Y.a.getGroup(this.environment,"stripe-elements"))return r.createElement(G,{spaceStore:this.props.spaceStore,data:this.props.data});const e=l.a.state,t=y.a(this.environment.currentUser.id);return r.createElement(v.a,{request:t||null,performRequest:async e=>{if(e){const t=await S.P(this.environment,{code:e});if("success"===t.type&&t.data.promo)return t.data.promo}},render:(t,n,i)=>i&&r.createElement("div",{style:this.getModalStyle()},r.createElement("div",{style:{padding:28,width:"55%"}},r.createElement(k.b,{type:k.b.OverflowType.Y},r.createElement(P.a,{planInfo:{subscriptionTier:e.subscriptionTier,billingInterval:d.f(e)}}))),r.createElement("div",{style:{flex:1,maxWidth:"45%",backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.lightDividerColor),padding:"24px 20px 0px",display:"flex",flexDirection:"column"}},r.createElement(k.b,{type:k.b.OverflowType.Y},this.renderBillingIntervalSection(e,n),this.renderPaymentMethodSection(e,n),this.renderCreditSection(e,n),this.renderControls(e,n))))})},this.handleModalClose=()=>{l.a.reset()},this.handleUpgradeAccept=async(e,t)=>{const{spaceStore:n,data:r}=this.props,i=d.g(e),a=d.e(e,r),l=d.f(e),c=d.h(e,this.props.data);if(!a)return;let p;"charge_automatically"===i&&(p=await s.d({name:this.renderStripePopupName(e),panelLabel:this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeMenu.subscribeMessage",defaultMessage:"Subscribe"}),email:a}));const m=o.c[e.subscriptionTier][l],g=await s.i({environment:this.environment,spaceStore:n,plan:m,stripeToken:p,billing:i,billingEmail:a,creditAmount:c,coupon:t?t.id:void 0});g&&("send_invoice"===i&&Object(u.e)(this.props.intl.formatMessage({id:"spaceSubscriptionUpgradeMenu.checkEmailDialog.message",defaultMessage:"Please check your email for the invoice."})),t&&y.c(this.environment.currentUser.id),this.handleModalClose(),h.a.setState(Z({},h.a.state,{currentTab:"billing"}))),Q.Xd(this.environment,{succeeded:g})}}renderComponent(){return r.createElement(M.a,{open:l.a.state.open,render:this.renderModal,onDismiss:this.handleModalClose})}renderBillingIntervalSection(e,t){const{yearlyUnitPrice:n,monthlyUnitPrice:i}=d.m({state:e,promo:t,data:this.props.data}),a=d.f(e),s=1-n/(12*i),o=d.c(e.subscriptionTier,s,this.props.intl),c=r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.billingIntervalSection.title",defaultMessage:"Billing interval"});return r.createElement("div",{style:this.getSectionStyle()},r.createElement("div",{style:this.getSubheaderStyle()},r.createElement("div",null,c)),o.map(t=>{let{id:n,title:i,caption:s,unavailable:o}=t;return r.createElement(r.Fragment,{key:n},this.renderRadioButton({title:i,caption:s,isSelected:a===n,onClick:()=>{o||(Q.Ud(this.environment,{billingInterval:n}),l.a.setState(Z({},e,{temporaryBillingInterval:n})))},unavailable:o}))}))}renderCreditSection(e,t){const{data:n,intl:i}=this.props,{availableCredit:a}=n,{planAmount:s,creditAmount:o}=d.m({state:e,promo:t,data:this.props.data}),u=r.createElement(f.b,{id:"spaceSubscriptionBilling.upgradeModal.creditSection.title",defaultMessage:"Apply credit"}),p=r.createElement(f.b,{id:"spaceSubscriptionBilling.upgradeModal.creditSection.promotion.description",defaultMessage:"Promotion"}),h=r.createElement(f.b,{defaultMessage:"You're using more credit than needed right now, so we'll apply the difference ({creditAmountLeft}) as an account balance towards your future invoices.",id:"spaceSubscriptionUpgradeMenu.creditLeftover.message",values:{creditAmountLeft:r.createElement("b",null,Object(c.b)({amount:o-s,currency:"dollar",intl:i}))}});return r.createElement(r.Fragment,null,r.createElement("div",{style:this.getSubheaderStyle()},r.createElement("div",null,u)),r.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14}},r.createElement("div",{style:{width:80}},r.createElement(m.a,{availableCredit:a,onChange:t=>{Q.Td(this.environment,{credits:t}),l.a.setState(Z({},e,{temporaryUseCreditCents:t}))}})),r.createElement("div",{style:{whiteSpace:"nowrap",marginLeft:8,color:this.theme.mediumTextColor}},"/"," ",Object(c.b)({amount:a,currency:"dollar",intl:i}))),t&&r.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14,marginTop:12}},r.createElement("b",{style:{width:100}},p),r.createElement("div",{style:{color:this.theme.mediumTextColor}},this.renderPromoDescription(t))),o>s&&r.createElement("div",{style:{marginTop:12,fontSize:12,color:this.theme.mediumTextColor}},h))}renderPaymentMethodSection(e,t){const n=d.g(e),{payAmount:i}=d.m({state:e,promo:t,data:this.props.data}),a=r.createElement(f.b,{id:"spaceSubscriptionBilling.upgradeModal.paymentMethodSection.title",defaultMessage:"Payment method"}),s=r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeMenu.paymentExplanation",defaultMessage:"Note: We still require your payment information in case you're out of credit during the next billing cycle. We will send you an email 7 days before charging you."});return r.createElement("div",{style:this.getSectionStyle()},r.createElement("div",{style:this.getSubheaderStyle()},r.createElement("div",null,a)),d.C.map(t=>{let{id:i,title:a,caption:s}=t;return r.createElement(r.Fragment,{key:i},this.renderRadioButton({title:a,caption:s,isSelected:n===i,onClick:()=>{Q.Vd(this.environment,{billingType:i}),l.a.setState(Z({},e,{temporaryBillingType:i}))},unavailable:!1}))}),0===i&&r.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:12,color:this.theme.mediumTextColor}},s))}renderRadioButton(e){const{title:t,caption:n,isSelected:i,onClick:a,unavailable:s}=e,o=s?.4:1;return r.createElement("div",{style:{cursor:"pointer",opacity:o},onClick:a},r.createElement("div",{style:{display:"flex",alignItems:"center",fontSize:14}},r.createElement(w.a,{isSelected:i}),t),r.createElement("div",{style:{color:this.theme.mediumTextColor,fontSize:12,marginLeft:24,marginTop:2,marginBottom:8}},n))}renderControls(e,t){const{intl:n}=this.props;return r.createElement(r.Fragment,null,r.createElement("div",{style:{flexGrow:1,paddingTop:40}}),r.createElement("div",{style:{borderTop:"1px solid ".concat(this.theme.regularDividerColor),marginTop:12}},r.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginTop:12}},r.createElement("div",{style:{fontSize:14,color:this.theme.mediumTextColor}},r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.dueToday.label",defaultMessage:"Due today",description:"Show after calculating what the user owes if they upgrade today, e.g. Due today | $5"})),r.createElement("div",{style:{fontSize:20,fontWeight:p.a.fontWeight.medium}},Object(c.b)({amount:d.m({state:e,promo:t,data:this.props.data}).payAmount,currency:"dollar",intl:n}))),r.createElement("div",{style:{fontSize:12,paddingTop:18,paddingBottom:18,color:this.theme.mediumTextColor}},this.renderCalculationDescription(e,t)),t&&r.createElement("div",{style:{fontSize:14,paddingBottom:18,color:this.theme.mediumTextColor}},this.renderPromoCalculationDescription(t)),r.createElement("div",{style:{display:"flex"}},r.createElement(g.a,{isLarge:!0,style:{flex:1,marginBottom:20},onClick:()=>this.handleUpgradeAccept(e,t),className:b.jb},r.createElement(f.b,{id:"spaceSubscriptionUpgradeModal.continueButton.label",defaultMessage:"Continue"})))))}renderCalculationDescription(e,t){var n=this;const{intl:i}=this.props,{productId:s}=a.a.pricing[e.subscriptionTier],{yearlyUnitPrice:o,monthlyUnitPrice:l,creditAmount:u,accountBalance:p}=d.m({state:e,promo:t,data:this.props.data}),m=d.f(e),h=this.getMemberCount(),g=r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.memberPluralForm",defaultMessage:"{memberCount, plural, one {{memberCount} member} other {{memberCount} members}}",values:{memberCount:h}});let b;return u>0&&p<0?b=r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.chargeSummary.creditsAndBalanceAdjustment",defaultMessage:"We've also subtracted <bold>{creditAmountInDollars} credit</bold> and <bold>{accountBalanceInDollars} workspace balance</bold> from your bill.",values:{bold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("b",null,t)},creditAmountInDollars:Object(c.b)({amount:u,currency:"dollar",intl:i}),accountBalanceInDollars:Object(c.b)({amount:-p,currency:"dollar",intl:i})}}):u>0?b=r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.chargeSummary.creditsAdjustment",defaultMessage:"We've also subtracted <bold>{creditAmountInDollars} credit</bold> from your bill.",values:{bold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("b",null,t)},creditAmountInDollars:Object(c.b)({amount:u,currency:"dollar",intl:i})}}):p<0&&(b=r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.chargeSummary.workspaceBalanceAdjustment",defaultMessage:"We've also subtracted <bold>{accountBalanceInDollars} workspace balance</bold> from your bill.",values:{bold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.createElement("b",{style:{color:n.theme.regularTextColor}},t)},accountBalanceInDollars:Object(c.b)({amount:-p,currency:"dollar",intl:i})}})),s===a.a.pricing.personal.productId?r.createElement(r.Fragment,null,r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.chargeSummary.personalPlan",defaultMessage:"{billedYearly, select, true {You will be charged <bold>{chargeAmount} per month</bold>, times <bold>12 months</bold>.} other {You will be charged <bold>{chargeAmount} per month</bold>.}}",values:{billedYearly:"year"===m,bold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return r.createElement("b",{style:{color:n.theme.regularTextColor}},t)},chargeAmount:Object(c.b)({amount:"year"===m?o/12:l,currency:"dollar",intl:i})}})," ",b):r.createElement(r.Fragment,null,r.createElement(f.b,{id:"spaceSubscriptionSettings.upgradeModal.chargeSummary.teamPlan",defaultMessage:"{billedYearly, select, true {You will be charged for <bold>{chargeAmount} per member</bold> per month for {pluralizedMembers}, times <bold>12 months</bold>.} other {You will be charged for <bold>{chargeAmount} per member</bold> per month for {pluralizedMembers}.}}",values:{billedYearly:"year"===m,bold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r.createElement("b",null,t)},chargeAmount:Object(c.b)({amount:"year"===m?o/12:l,currency:"dollar",intl:i}),pluralizedMembers:r.createElement("b",null,g)}})," ",b)}renderPromoCalculationDescription(e){return"".concat(this.renderPromoDescription(e)," with promotion")}renderPromoDescription(e){const{intl:t}=this.props,n=e.amount_off?Object(c.b)({amount:e.amount_off,currency:"dollar",intl:t}):"".concat(e.percent_off,"%");return"forever"===e.duration?"".concat(n," off all payments"):"once"===e.duration?"".concat(n," off the first payment"):"repeating"===e.duration?"".concat(n," off for ").concat(e.duration_in_months," months"):void 0}getMemberCount(){return d.t(this.props.data)}renderStripePopupName(e){const{intl:t}=this.props;switch(e.subscriptionTier){case"personal":return t.formatMessage({id:"spaceSubscriptionUpgradeMenu.title.personalPlan",defaultMessage:"Notion Personal Pro"});case"team":return t.formatMessage({id:"spaceSubscriptionUpgradeMenu.title.teamPlan",defaultMessage:"Notion Team"});case"enterprise":return t.formatMessage({id:"spaceSubscriptionUpgradeMenu.title.enterprisePlan",defaultMessage:"Notion Enterprise"});default:return Object(E.e)(e.subscriptionTier)}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:3,width:560,maxHeight:600,height:"100vh",display:"flex"}}getSubheaderStyle(){return{display:"flex",alignItems:"center",marginBottom:4,fontSize:12,fontWeight:p.a.fontWeight.semibold,color:this.theme.mediumTextColor}}getSectionStyle(){return{marginBottom:16}}}t.default=Object(f.h)($)},1155:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(2),i=n(0),a=n(8),s=n(298),o=n(168),l=n(3),c=n(691),d=n(14),u=n(732),p=n(19),m=n(22),h=n(39),g=n(181),b=n(55),f=n(24),y=n(590),S=n(53),v=n(21),E=n(154),M=n(501),w=n(106),C=n(81),O=n(125),k=n(342),P=n(67),T=n(690),D=n(360),I=n(37),j=n(147),x=n(155),B=n(745),A=n(1),F=n(30);class R extends l.a{constructor(){super(...arguments),this.handleClickRemove=()=>{this.props.onClickRemove(this.props.target)}}renderComponent(){const{device:e}=this.environment;return i.createElement(j.b,{showRemoveButton:!0,isSingle:!1,format:e.isMobile?j.b.Format.Large:j.b.Format.Medium,onClickRemove:this.handleClickRemove,value:this.getTokenText()})}getTokenText(){const{target:e}=this.props;switch(e.type){case"newUser":return e.value.email.trim();case"existingUser":return Object(I.d)(e.value);case"bot":return Object(x.a)(e.value);case"group":return Object(B.a)({intl:this.props.intl,group:e.value});default:throw Object(F.e)(e)}}}var L=Object(A.h)(R),U=n(89),_=n(48),W=n(152),q=n(764),N=n(91),z=n(161),V=n(361);class H extends l.a{renderComponent(){return i.createElement(f.a,Object.assign({title:i.createElement(A.b,{id:"inviteUserModal.searchDropdown.selectPersonTitle",defaultMessage:"Select a person"}),loading:this.props.loading},this.props))}}var G=n(158),Y=n(136),Q=n(258),K=n(20),Z=n(1496),X=n(34);function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function J(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){ee(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class te extends l.a{renderComponent(){return i.createElement(X.a,{hovered:this.props.hovered,onClick:this.props.onClick,disabled:this.props.disabled,disabledFeedback:!0,style:J({},this.getButtonStyle(),{},this.props.isLarge&&{height:32},{},this.props.style),hoveredStyle:{background:this.theme.buttonHoveredBackground},pressedStyle:{background:this.theme.buttonPressedBackground},onMouseDown:this.props.onMouseDown,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,className:this.props.className},this.props.children)}getButtonStyle(){return{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,boxShadow:this.theme.plainButtonBoxShadow,background:this.theme.inputBackground,color:this.theme.mediumTextColor,fill:p.f.white,lineHeight:1.2,paddingLeft:12,paddingRight:12,fontSize:14}}}var ne=te,re=n(88),ie=n(17),ae=n(93);function se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?se(Object(n),!0).forEach((function(t){le(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function le(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class ce extends l.a{constructor(){super(...arguments),this.storeTypes={permissionsInviteStore:u.a},this.querySpaceBots=async e=>{const{store:t}=this.props;return Object(ae.n)(t)&&t.isCollectionView()?await o.j({environment:this.environment,query:e}):[]},this.renderOverlay=()=>{const{permissionsInviteStore:e}=this.stores,{inviteTargets:t,tokenQuery:n}=e.state,s=!this.props.isSpace,l=t.map(e=>{const t="newUser"===e.type?e.value.email:"".concat(e.type,"-").concat(e.value.id);return i.createElement(L,{key:t,target:e,onClickRemove:this.handleClickRemoveToken})}),c={request:n,performRequest:async e=>{const[t,n,i,{user:a,email:l}]=await Promise.all([o.l({environment:this.environment,query:e,membersOnly:this.props.membersOnly}),this.querySpaceBots(e),s?o.k({query:e,intl:this.props.intl}):[],o.d(this.environment,e)]),c=t.slice(0,10).map(e=>({type:"existingUser",value:e})),d=n.slice(0,10).map(e=>({type:"bot",value:e})),u=i.slice(0,10).map(e=>({type:"group",value:e}));return a&&c.push({type:"existingUser",value:a}),l&&c.push({type:"newUser",value:{email:l}}),{inviteUsers:r.uniqBy(c,e=>e.value.email),inviteBots:d,inviteGroups:u}},render:(t,r,o)=>{if(t)return i.createElement(H,{loading:!o},i.createElement(E.a,{title:i.createElement(A.b,{id:"inviteUserModal.searchInput.errorMessage",defaultMessage:"Something went wrong"})}));const l=(r&&r.inviteUsers||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!("existingUser"===e.type&&this.targetHasPermission(e))),c=(r&&r.inviteBots||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!this.targetHasPermission(e)),d=(r&&r.inviteGroups||[]).filter(e=>!this.alreadyInvitingTarget(e)&&!this.targetHasPermission(e)),{data:u}=O.a.state,p=l.map(e=>({key:"newUser"===e.type?e.value.email:e.value.id,render:t=>{const n=u?w.u(u):[],r="existingUser"===e.type&&n.find(t=>t.userId===e.value.id);let s;return r&&Object(_.a)(r.role)?s=i.createElement(h.a,{renderTooltip:()=>i.createElement(A.b,{id:"inviteUserModal.userRole.adminBadge.tooltip",defaultMessage:"This person is an admin in this workspace"}),render:e=>i.createElement("div",Object.assign({style:this.getBadgeStyle()},e),i.createElement(A.b,{id:"inviteUserModal.userRole.adminBadge.label",defaultMessage:"Admin"}))}):r&&Object(_.c)(r.role)?s=i.createElement(h.a,{renderTooltip:()=>i.createElement(A.b,{id:"inviteUserModal.userRole.memberBadge.tooltip",defaultMessage:"This person is a member in this workspace"}),render:e=>i.createElement("div",Object.assign({style:this.getBadgeStyle()},e),i.createElement(A.b,{id:"inviteUserModal.userRole.memberBadge.label",defaultMessage:"Member"}))}):r&&(s=i.createElement(h.a,{renderTooltip:()=>i.createElement(A.b,{id:"inviteUserModal.userRole.guest.tooltip",defaultMessage:"This person is a guest in this workspace"}),render:e=>i.createElement("div",Object.assign({style:this.getBadgeStyle()},e),i.createElement(A.b,{id:"inviteUserModal.userRole.guestBadge.label",defaultMessage:"Guest"}))})),"existingUser"===e.type?i.createElement(y.a,Object.assign({},t,{user:e.value,right:s})):i.createElement(S.a,Object.assign({},t,{icon:a.a.mail({width:ce.avatarSize,height:ce.avatarSize}),right:s,title:e.value.email.trim()}))},action:()=>{this.updateInviteTargetsStateWithPossibleRoleChange(oe({},this.stores.permissionsInviteStore.state,{inviteTargets:[...this.stores.permissionsInviteStore.state.inviteTargets,e],tokenQuery:""}))}})),g=c.map(e=>{const{value:t}=e;return{key:t.id,render:e=>{const n=(u?w.n(u):[]).find(e=>e.botId===t.id);let r;return n&&Object(_.a)(n.role)?r=i.createElement(h.a,{renderTooltip:()=>"This bot is an admin in this workspace",render:e=>i.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Admin")}):n&&Object(_.c)(n.role)?r=i.createElement(h.a,{renderTooltip:()=>"This bot is a member in this workspace",render:e=>i.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Member")}):n&&(r=i.createElement(h.a,{renderTooltip:()=>"This bot is a guest in this workspace",render:e=>i.createElement("div",Object.assign({style:this.getBadgeStyle()},e),"Guest")})),i.createElement(q.a,Object.assign({},e,{bot:t,right:r}))},action:()=>{this.updateInviteTargetsStateWithPossibleRoleChange(oe({},this.stores.permissionsInviteStore.state,{inviteTargets:[...this.stores.permissionsInviteStore.state.inviteTargets,e],tokenQuery:""}))}}}),{currentSpaceStore:v}=ie.a.state,M=d.map(e=>{const{value:t}=e,n=Object(B.a)({intl:this.props.intl,group:t}),r=v&&t.icon?{table:v.table,id:v.id,icon:t.icon}:void 0;return{key:t.id,render:e=>i.createElement(S.a,Object.assign({},e,{icon:i.createElement(re.a,{disabled:!0,size:22,icon:r,isEmptyPage:!1,title:n}),title:n})),action:()=>{this.updateInviteTargetsStateWithPossibleRoleChange(oe({},this.stores.permissionsInviteStore.state,{inviteTargets:[...this.stores.permissionsInviteStore.state.inviteTargets,e],tokenQuery:""}))}}}),C=[],{permissionsInviteStore:{state:{inviteTargets:k}}}=this.stores,P=k.some(e=>"bot"===e.type);if(p.length>0&&(0===k.length||!P)&&C.push({key:"user results",render:e=>i.createElement(H,Object.assign({},e,{loading:!o})),items:p}),g.length>0&&(0===k.length||P)&&C.push({key:"bot results",render:e=>i.createElement(f.a,Object.assign({},e,{title:"Select a bot",loading:!o})),items:g}),s&&M.length>0&&(0===k.length||!P)&&C.push({key:"group results",render:e=>i.createElement(f.a,Object.assign({},e,{title:i.createElement(A.b,{id:"inviteUserModal.searchDropdown.selectGroupTitle",defaultMessage:"Select a group"}),loading:!o})),items:M}),0===C.length){const t=Object(T.b)(e.state.tokenQuery);if(t){const e={type:"newUser",value:{email:t}},n=this.alreadyInvitingTarget(e);if(!n)return;if(n)return i.createElement(H,{loading:!o},i.createElement(E.a,{title:i.createElement(A.b,{id:"inviteUserModal.userAlreadyInvitedMessage",defaultMessage:"Already inviting {user}.",values:{user:i.createElement("span",{style:{fontWeight:m.a.fontWeight.bold}},this.getTargetName(n))}})}));const a=(r&&r.inviteUsers||[]).find(e=>"existingUser"===e.type&&e.value.email===t);if(a&&"existingUser"===a.type&&this.targetHasPermission(a))return i.createElement(H,{loading:!o},i.createElement(E.a,{title:i.createElement(A.b,{id:"inviteUserModal.userAlreadyHasPermissionMessage",defaultMessage:"{user} already has permission.",values:{user:i.createElement("span",{style:{fontWeight:m.a.fontWeight.bold}},Object(I.d)(a.value))}})}))}return i.createElement(H,{loading:!o},i.createElement(E.a,{title:i.createElement(A.b,{id:"inviteUserModal.searchPersonDropdown.noSearchResultsMessage",defaultMessage:"Type or paste in emails above, separated by commas."})}))}return i.createElement(b.a,{type:b.a.Type.Vertical,initialFocus:n.length>0?0:void 0,sections:C})}},{device:d}=this.environment,u=this.props.isSpace?this.props.intl.formatMessage({id:"inviteUserModal.searchInput.placeholder",defaultMessage:"Search name or emails"}):this.props.intl.formatMessage({id:"permissionsInvite.searchInput.placeholder",defaultMessage:"Search emails, names, or groups"}),C=i.createElement(M.a,{focus:!d.isMobile||void 0,focusInitial:d.isMobile,focusAfterAnimation:!0,format:M.a.Format.Share,value:n,onChange:this.handleInputChange,type:"email",tokens:l,disabled:!1,placeholder:u,onRemoveLastToken:()=>{this.updateInviteTargetsStateWithPossibleRoleChange(oe({},this.stores.permissionsInviteStore.state,{inviteTargets:this.stores.permissionsInviteStore.state.inviteTargets.slice(0,this.stores.permissionsInviteStore.state.inviteTargets.length-1)}))},right:!d.isMobile&&this.renderDesktopInputRightInner(),onEmptyEnter:this.handleInviteClick,dontShowBorderBottom:d.isAndroid});let k;return k=d.isMobile?{menuType:v.b.MenuType.Modal,title:this.props.isSpace?i.createElement(A.b,{id:"inviteUserModal.addMemberMenu.title",defaultMessage:"Add members"}):i.createElement(A.b,{id:"inviteUserModal.invitePersonMenu.title",defaultMessage:"Invite a person"}),right:i.createElement("div",{style:{color:p.f.blue}},i.createElement(A.b,{id:"inviteUserModal.mobile.inviteButton.label",defaultMessage:"Invite"})),left:i.createElement(N.CancelMenuText,null),onClickLeft:this.handleModalDismiss,onClickRight:this.handleInviteClick,header:C}:{menuType:v.b.MenuType.Popup,width:480,height:"60vh",header:C,tokenInputHeader:!0,footer:this.renderHelpButton()},i.createElement(v.b,Object.assign({},k,{className:P.z}),i.createElement(i.Fragment,null,d.isMobile&&i.createElement(f.a,{title:i.createElement(A.b,{id:"inviteUserModal.permissionLevel.title",defaultMessage:"Permission level"})},this.renderDesktopInputRightInnerSelect()),i.createElement(g.a,Object.assign({},c)),d.isMobile&&this.renderHelpButton()))},this.handleTrialClick=()=>{V.a(this.environment,{from:this.props.upgradeButtonName,for:"team_free"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()},this.handleUpgradeClick=()=>{V.a(this.environment,{from:this.props.upgradeButtonName,for:"team"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()},this.handleButtonClick=()=>{this.stores.permissionsInviteStore.setState({modalOpen:!0,tokenQuery:"",inviteTargets:[],inviteRole:this.getDefaultRole()}),this.props.isSpace?d.Sc(this.environment):d.Kc(this.environment)},this.handleInviteClick=async()=>{const{store:e,isSpace:t}=this.props,{permissionsInviteStore:n}=this.stores,{tokenQuery:r}=n.state;if(Object(T.c)(r.trim())){const e={type:"newUser",value:{email:r.trim()}};this.alreadyInvitingTarget(e)||this.updateInviteTargetsStateWithPossibleRoleChange(oe({},this.stores.permissionsInviteStore.state,{inviteTargets:[...n.state.inviteTargets,e],tokenQuery:""}))}const{inviteTargets:i,inviteRole:a}=n.state;i.length>0&&(this.props.onInviteClick&&this.props.onInviteClick(),n.reset(),await s.c({environment:this.environment,store:e,inviteTargets:i,inviteRole:a,isSpace:t,isOnboarding:!1})),this.props.onInviteComplete&&this.props.onInviteComplete()},this.handleModalDismiss=()=>{this.stores.permissionsInviteStore.setState(oe({},this.stores.permissionsInviteStore.state,{modalOpen:!1}))},this.handleInputChange=e=>{const t=e.target.value,{extractedEmails:n,newInputValue:r}=Object(T.a)(t),i=n.map(e=>({type:"newUser",value:{email:e}})).filter(e=>!this.alreadyInvitingTarget(e));this.updateInviteTargetsStateWithPossibleRoleChange(oe({},this.stores.permissionsInviteStore.state,{inviteTargets:[...this.stores.permissionsInviteStore.state.inviteTargets,...i],tokenQuery:r}))},this.handleClickRemoveToken=e=>{this.updateInviteTargetsStateWithPossibleRoleChange(oe({},this.stores.permissionsInviteStore.state,{inviteTargets:this.stores.permissionsInviteStore.state.inviteTargets.filter(t=>t!==e)}))}}async willMount(){await C.f(this.environment)}renderComponent(){const{isSpace:e,store:t}=this.props,{device:n}=this.environment,{modalOpen:r}=this.stores.permissionsInviteStore.state;let a,s,o=!1;return t.canAdmin()?t.canAdmin()&&e&&O.a.state.data&&!w.I(this.environment)?(a=!1,o=!0,s=i.createElement(Q.a,{imageURL:K.a.images.tooltips.upsells.spaceReadAndWritePng,imageWidth:240,imageHeight:100,caption:i.createElement(A.b,{defaultMessage:"Members are teammates you invite to your workspace. They can access and add pages for all members to see, or be added to pages with permissions for private collaboration.",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.caption"}),title:i.createElement(A.b,{defaultMessage:"Upgrade to add members",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.title"})})):a=!0:(a=!1,s=e?i.createElement(A.b,{id:"inviteUserButton.tooltip.adminsOnlyMessage",defaultMessage:"Only admins can add members."}):i.createElement(A.b,{id:"inviteUserButton.tooltip.fullAccessOnlyMessage",defaultMessage:"Only those with full access can add people."})),i.createElement("div",null,e?i.createElement(Z.a,{open:r,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:i.createElement(h.a,{renderTooltip:()=>s,disableTooltip:a,render:e=>i.createElement(k.a,Object.assign({isLarge:!0,onClick:o?this.handleTrialClick:this.handleButtonClick,disabled:!a&&!o,style:oe({flex:this.props.shouldGrow?1:0},this.props.buttonStyle)},e),i.createElement(A.b,{id:"inviteUserButton.addMemberLabel",defaultMessage:"Add members"}))})}):i.createElement(Z.a,{open:r,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:i.createElement(h.a,{renderTooltip:()=>s,disableTooltip:a,render:e=>i.createElement("div",{style:{display:"flex",alignItems:"center"}},i.createElement(ne,{onClick:o?this.handleTrialClick:this.handleButtonClick,disabled:!a&&!o,style:{flex:1,justifyContent:"flex-start",height:n.isMobile?34:26,borderTopRightRadius:0,borderBottomRightRadius:0}},i.createElement(A.b,{defaultMessage:"Add people, groups, or emails",id:"inviteUserButton.addGuestsAndGroupsLabel"})),i.createElement(k.a,Object.assign({onClick:o?this.handleTrialClick:this.handleButtonClick,disabled:!a&&!o,style:{height:n.isMobile?36:28,borderTopLeftRadius:0,borderBottomLeftRadius:0}},e),i.createElement(A.b,{id:"inviteUserButton.invitePersonLabel",defaultMessage:"Add people"})))})}))}renderHelpButton(){return i.createElement(f.a,{topBorder:!0,disableDesktopPadding:!0},i.createElement(D.a,{title:i.createElement(A.b,{id:"inviteUserModal.helpButton.caption",defaultMessage:"Learn how to invite people and set permissions"}),href:Object(Y.a)("guides.invitePerson"),analyticsFrom:"invite_person"}))}renderDesktopInputRightInner(){return i.createElement("div",{style:{marginLeft:8,display:"flex",alignItems:"center"}},this.renderDesktopInputRightInnerSelect(),this.renderDesktopInputRightInnerButton())}renderDesktopInputRightInnerButton(){const{disabled:e}=this.props,{permissionsInviteStore:t}=this.stores,{inviteTargets:n}=t.state,r=n.filter(e=>{let{type:t}=e;return"newUser"===t}).map(e=>{let{value:t}=e;return t.email}),a=n.filter(e=>{let{type:t}=e;return"existingUser"===t}).map(e=>{let{value:t}=e;return t.id}),s=e||Object(z.d)({environment:this.environment,userIds:[...r,...a],includesOwner:!0});return i.createElement(h.a,{textWrap:!0,alignment:G.a.Center,disableTooltip:!s,renderTooltip:()=>i.createElement(i.Fragment,null,i.createElement("div",{style:{width:280}},i.createElement(A.b,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your personal plan allows up to 5 unique guests."})),i.createElement("div",null,i.createElement(A.b,{id:"inviteUserButton.modalTooltip.guestLimitLine2",defaultMessage:"Upgrade to go unlimited."}))),render:e=>i.createElement(k.a,Object.assign({style:{minWidth:ce.inviteButtonWidth},onClick:s?this.handleUpgradeClick:this.handleInviteClick},e),s?i.createElement(A.b,{id:"inviteUserModal.inviteButton.upgradeLabel",defaultMessage:"Upgrade"}):i.createElement(A.b,{id:"inviteUserModal.inviteButton.label",defaultMessage:"Invite"}))})}renderDesktopInputRightInnerSelect(){const{device:e}=this.environment,{isSpace:t,isSubscribed:n}=this.props,{permissionsInviteStore:r}=this.stores,{inviteRole:a,inviteTargets:s}=r.state,o=this.inviteTargetsContainBots(s);return i.createElement(c.a,{role:a,isSpace:t,isSubscribed:n,isUser:!o,isBot:o,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",marginTop:e.isMobile?4:0,color:p.f.uiGray},isMenuItem:e.isMobile,onChange:e=>{r.setState(oe({},r.state,{inviteRole:e}))}})}getDefaultRole(){const{isSpace:e,isSubscribed:t}=this.props;return this.inviteTargetsContainBots(this.stores.permissionsInviteStore.state.inviteTargets)?"read_and_write":e?t?"read_and_write":"editor":w.N(this.environment)?"editor":"read_and_write"}canAvailableRoleChange(e){return this.inviteTargetsContainBots(e)!==this.inviteTargetsContainBots(this.stores.permissionsInviteStore.state.inviteTargets)}updateInviteTargetsStateWithPossibleRoleChange(e){const{inviteTargets:t}=e,n=this.canAvailableRoleChange(t);this.stores.permissionsInviteStore.setState(e),n&&this.stores.permissionsInviteStore.setState(oe({},this.stores.permissionsInviteStore.state,{inviteRole:this.getDefaultRole()}))}inviteTargetsContainBots(e){return e.some(e=>"bot"===e.type)}alreadyInvitingTarget(e){return this.stores.permissionsInviteStore.state.inviteTargets.find(t=>"newUser"===e.type?"newUser"===t.type&&e.value.email===t.value.email:t.type===e.type&&t.value.id===e.value.id)}targetHasPermission(e){const t=this.props.store.getValue();return!!t&&Object(W.h)(t).some(t=>{switch(e.type){case"existingUser":return Object(_.n)(t)&&t.user_id===e.value.id;case"bot":return Object(_.f)(t)&&t.bot_id===e.value.id;case"group":return Object(_.h)(t)&&t.group_id===e.value.id;default:return!1}})}getTargetName(e){const{intl:t}=this.props;switch(e.type){case"newUser":return e.value.email;case"existingUser":return Object(U.d)(t,e.value);case"bot":return Object(x.a)(e.value);case"group":return Object(B.a)({intl:t,group:e.value});default:throw Object(F.e)(e)}}getBadgeStyle(){const{device:e}=this.environment;return{display:"inline-flex",height:18,textTransform:"uppercase",fontSize:10,marginBottom:2,fontWeight:m.a.fontWeight.medium,letterSpacing:1,color:p.f.uiLightGray,border:"1px solid ".concat(p.f.uiLightGray),minWidth:ce.inviteButtonWidth,alignItems:"center",justifyContent:"center",paddingTop:e.isAndroid?2:1,paddingBottom:1,paddingLeft:3,paddingRight:3,borderRadius:3}}}ce.avatarSize=24,ce.inviteButtonWidth=70;t.default=Object(A.h)(ce)},1156:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(497),a=n(3),s=n(45),o=n(1),l=n(726),c=(n(15),n(12),n(11)),d=n(94),u=n(24),p=n(156),m=n(43),h=n(318),g=n(21),b=n(160),f=n(216),y=n(332),S=n(771),v=n(107),E=n(8),M=n(369),w=n(136),C=n(91),O=n(88),k=n(116),P=n(59),T=n(162),D=n(79);class I extends a.a{constructor(){super(...arguments),this.storeTypes={hovered:P.a.of(!1),buttonPopupStore:P.a.of(new D.a)}}renderComponent(){const{schema:e,visibility:t,property:n,format:a}=this.props,s=e[n];if(!s)return;const o=this.getPropertyVisibility(s);return r.createElement(T.b,{onMouseEnter:()=>this.stores.hovered.set(!0),onMouseLeave:()=>this.stores.hovered.set(!1),focused:this.stores.hovered.get(),key:n,showDragHandle:!this.environment.device.isMobile,showExtensionArrow:!1,propertySchema:s,format:T.b.DisplayFormat.Name,dontShrinkRight:!0,ignoreLocalHoverState:!0,locked:this.props.locked,onClick:()=>{if(!this.props.locked){const e=this.stores.buttonPopupStore.get();e.setState({open:!e.state.open})}},right:r.createElement(S.a,{buttonPopupStore:this.stores.buttonPopupStore.get(),visibility:o,locked:this.props.locked,onSelect:e=>{i.e({environment:this.environment,property:n,visibility:e,format:a,store:this.props.store})},onClose:()=>this.stores.hovered.set(!1),type:"property",propertySchema:s})})}getPropertyVisibility(e){const{visibility:t}=this.props;switch(t){case"hide_if_empty":return h.d({propertySchema:e})?"hide_if_empty":"show";default:return t}}}var j=I,x=n(22),B=n(77),A=n(843),F=n(114),R=n(68);function L(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function U(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?L(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):L(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class W extends a.a{constructor(){super(...arguments),this.storeTypes={lockStore:A.a},this.handleDraggableDrop=e=>{const t=this.getCollectionPageProperties();if(t){const n=e.map(e=>t.find(t=>t.property===e));i.c({environment:this.environment,properties:n,store:this.props.store})}},this.handleToggleLockClick=()=>{const e=h.a();if(!e)return!1;const t=e.getParentBlockStore();t&&(c.d(this.environment,e=>{d.e({environment:this.environment,store:t,isLocked:!h.b(),transaction:e})}),this.stores.lockStore.setState({justUnlocked:!this.stores.lockStore.state.justUnlocked}))}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:g.b.MenuType.Modal,right:r.createElement(C.DoneMenuText,null),onClickRight:i.a,title:this.props.intl.formatMessage({id:"customizePageMenu.mobileHeader.label",defaultMessage:"Customize page"})}:{menuType:g.b.MenuType.Popup,minWidth:400};const n=this.getNormalizedFormat();return r.createElement(g.b,Object.assign({},t,{header:this.renderHeader()}),(this.props.locked||this.stores.lockStore.state.justUnlocked)&&this.renderLockControls(),this.renderPageSectionsSectionMenuItem(n),this.renderPropertiesSectionMenuItem(n))}renderLockControls(){return r.createElement("div",{style:{fontSize:12,display:"flex",justifyContent:"center",alignItems:"center",borderTop:"1px solid ".concat(this.theme.regularDividerColor),borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.sidebarBackground,color:this.theme.mediumTextColor,paddingTop:6,paddingBottom:6}},r.createElement("span",{style:{display:"inline-block",verticalAlign:"middle",paddingRight:6}},this.stores.lockStore.state.justUnlocked?E.a.unlocked({height:12,width:12,fill:this.theme.mediumIconColor}):E.a.locked({height:12,width:12,fill:this.theme.mediumIconColor})),this.stores.lockStore.state.justUnlocked?r.createElement(o.b,{id:"customizePageMenu.unlocked.header",defaultMessage:"Settings unlocked on parent database."}):r.createElement(o.b,{id:"customizePageMenu.locked.header",defaultMessage:"Settings locked on parent database."}),r.createElement(B.a,{style:{fontSize:12,color:this.theme.mediumTextColor,fontWeight:x.a.fontWeight.semibold,marginLeft:2,paddingLeft:4,paddingRight:4,height:20},onClick:this.handleToggleLockClick},this.stores.lockStore.state.justUnlocked?r.createElement(o.b,{id:"customizePageMenu.lock.label",defaultMessage:"Re-lock"}):r.createElement(o.b,{id:"customizePageMenu.unlock.label",defaultMessage:"Unlock"})))}renderPropertiesSectionMenuItem(e){const t=this.getSchema();if(!t||"page"===this.props.type)return;const n=this.getPageCustomization(e);if(!n)return;const{propertyVisibility:i}=n;if(!i)return;const a=i.reduce((e,t)=>(e[t.property]=t.visibility,e),{});return r.createElement(u.a,{style:{opacity:this.props.locked?.5:1},isTitleUppercase:!0,title:r.createElement(o.b,{id:"customizePageMenu.propertiesSection.header",defaultMessage:"Properties"})},r.createElement(p.b,{direction:p.a.Vertical,keys:this.getCollectionPageProperties().map(e=>e.property),renderKey:n=>{if("collection"===this.props.type)return r.createElement(j,{schema:t,visibility:a[n],property:n,format:e,store:this.props.store,locked:this.props.locked})},onDrop:this.handleDraggableDrop}))}renderPageSectionsSectionMenuItem(e){const t=this.getPageCustomization(e);if(!t)return;const{pageSectionVisibility:n}=t;return n?r.createElement(u.a,{style:{opacity:this.props.locked?.5:1},title:r.createElement(o.b,{id:"customizePageMenu.sectionsSection.header",defaultMessage:"Sections"}),isTitleUppercase:!0,topBorder:!this.props.locked&&!this.stores.lockStore.state.justUnlocked},r.createElement(b.a,{title:r.createElement(o.b,{id:"customizePageMenu.pageSections.backlinksTitle",defaultMessage:"Backlinks"}),icon:E.a.alias({height:16,width:16,transform:"rotate(180deg)"}),right:r.createElement(S.a,{visibility:n.backlinks,locked:this.props.locked,onSelect:t=>{i.d({environment:this.environment,pageSection:"backlinks",visibility:t,store:this.props.store,format:e})},type:"page"})}),r.createElement(b.a,{title:r.createElement(o.b,{id:"customizePageMenu.pageSections.commentsTitle",defaultMessage:"Page comments"}),icon:E.a.speechBubbleThick({height:16,width:16}),right:r.createElement(S.a,{visibility:n.comments,visibilityLevels:["section_show","section_hide"],locked:this.props.locked,onSelect:t=>{i.d({environment:this.environment,pageSection:"comments",visibility:t,store:this.props.store,format:e})},type:"page"})})):void 0}renderHeader(){if(this.environment.device.isMobile)return;const{store:e}=this.props;if(e){const t=e.getIcon(),n="collection"===this.props.type?this.props.store.getParentBlockStore():void 0,a=t&&r.createElement(O.a,{icon:t,isEmptyPage:!1,size:14,disabled:!0,style:{display:"inline-flex",marginRight:2}}),s=r.createElement(k.a,{store:e,style:{display:"inline"}}),l=r.createElement(y.a,{prefix:r.createElement(o.b,{id:"customizePageMenu.header.label",defaultMessage:"Page view for "}),viewName:n?r.createElement(r.Fragment,null,r.createElement(F.a,{onClick:i.a,href:Object(R.a)({store:n,fullyQualified:!1}),inline:!0},a,s)):r.createElement(r.Fragment,null,a,s)});return r.createElement(b.a,{style:U({},f.d.headingStyle),title:l,right:r.createElement(M.a,{helpButtonContext:"collection_properties_menu",href:Object(w.a)("guides.databaseProperties")})})}}getSchema(){if("collection"!==this.props.type)return this.props.store.getSchema();{const e=this.props.store.getValue();if(e)return m.e(e.schema)}}getNormalizedFormat(){const e=this.props.store.getFormat(),t=this.getSchema();return t?v.i(e,t,void 0,[],v.a.Collection):{}}getCollectionPageProperties(){if("collection"!==this.props.type)return[];return this.getNormalizedFormat().collection_page_properties||[]}getPageCustomization(e){return{propertyVisibility:e.property_visibility,pageSectionVisibility:e.page_section_visibility}}}var q=W,N=n(72),z=n(17);class V extends a.a{constructor(){super(...arguments),this.renderModal=()=>{if(!l.a.state.isOpen)return;const e=h.a(),{currentBlockStore:t}=z.a.state,n=N.c.state.open&&N.c.state.target||t;return e?r.createElement(q,{store:e,type:"collection",intl:this.props.intl,locked:h.b()}):n?r.createElement(q,{store:n,type:"page",intl:this.props.intl,locked:!1}):void 0}}renderComponent(){const{device:e}=this.environment,t=l.a.state;return r.createElement(s.c,{popupType:e.isMobile?s.c.PopupType.SlideUp:s.c.PopupType.Popup,alignmentToOrigin:s.c.Alignment.Center,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>i.a()})}}t.default=Object(o.h)(V)},1157:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(3),a=n(1495),s=n(171),o=n(8),l=n(1),c=n(22),d=n(16);class u extends d.a{getInitialState(){return{starRating:void 0,step:"rate"}}}var p=u,m=n(2),h=n(126),g=n(153),b=n(5),f=n(760),y=n(244);function S(e,t,n){if(n){const{templateId:r}=n;return e.some(e=>e.milestone===t&&e.template_id===r)}return e.some(e=>e.milestone===t)}var v=n(342),E=n(20),M=n(40),w=n(17),C=n(105),O=n(34),k=n(106),P=n(88),T=n(755),D=n(299);function I(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){B(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const A=Object(l.g)({additionalFeedbackPlaceholder:{id:"csatPopup.additionalFeedback.placeholder",defaultMessage:"Tell us more..."}});class F extends i.a{constructor(){super(...arguments),this.storeTypes={csatPopupStore:p},this.renderCancel=()=>r.createElement(O.a,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},o.a.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderStep=()=>{const{step:e}=this.stores.csatPopupStore.state,{currentSpaceStore:t}=w.a.state;let n;if(t){const e=t.getValue();e&&e.initial_use_cases&&(n=m.sample(e.initial_use_cases))}return r.createElement(r.Fragment,null,r.createElement(h.a,{isVisible:"rate"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0,translateY:-120},render:()=>r.createElement("div",{style:{paddingBottom:40}},this.renderIcon(),this.renderFeedbackPrompt(n))}),r.createElement(h.a,{isVisible:"rate"===e||"send"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.createElement("div",{style:this.getSlideContainerStyle()},this.renderStars(n),this.renderInput(),this.renderSendButton())}),r.createElement(h.a,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}))},this.renderThanks=()=>r.createElement("div",null,r.createElement("img",{style:{width:165,height:80},src:E.a.images.feedbackThankYouPng}),r.createElement("div",{style:this.getThanksHeaderStyle()},r.createElement(l.b,{defaultMessage:"Thanks for your feedback!",id:"csatPopup.thanks.header"})),r.createElement("div",{style:this.getThanksDescriptionStyle()},r.createElement(l.b,{defaultMessage:"Your feedback will help us make Notion better.",id:"csatPopup.thanks.description"}))),this.renderIcon=()=>{const{currentBlockStore:e}=w.a.state;if(e){const t=e.getIcon();if(t)return r.createElement(T.a,{justifyContent:"center",alignItems:"center"},r.createElement(P.a,{icon:t,isEmptyPage:!1,size:32,disabled:!0}))}return r.createElement(T.a,{justifyContent:"center",alignItems:"center"},o.a.notionLogo({width:32,height:32}))},this.renderFeedbackPrompt=e=>{switch(e){case"doc_notes":return r.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.createElement(l.b,{defaultMessage:"How satisfied are you with using Notion for notes & docs?",id:"csatPopup.feedbackPrompt.docNotesLabel"}));case"project_management":return r.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.createElement(l.b,{defaultMessage:"How satisfied are you with managing projects and tasks in Notion?",id:"csatPopup.feedbackPrompt.projManagementLabel"}));case"wiki":return r.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.createElement(l.b,{defaultMessage:"How satisfied are you with using Notion for team wikis?",id:"csatPopup.feedbackPrompt.wikiLabel"}));default:return this.shouldRenderAsNPS(e)?r.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.createElement(l.b,{defaultMessage:"How likely are you to recommend Notion to a friend?",id:"csatPopup.feedbackPrompt.enterpriseDefaultLabel"})):r.createElement("div",{style:this.getFeedbackPromptStyle(),key:"feedback-prompt"},r.createElement(l.b,{defaultMessage:"How satisfied are you with using Notion? ",id:"csatPopup.feedbackPrompt.defaultlabel"}))}},this.renderInput=()=>{const{step:e,additionalFeedback:t}=this.stores.csatPopupStore.state;return r.createElement(C.a,{capture:!0,onBackspace:m.identity,onLeft:m.identity,onRight:m.identity,onSelectAll:m.identity,onRedo:m.identity,onUndo:m.identity,onCut:m.identity,onCopy:m.identity,onPaste:m.identity,onKeypress:m.identity,onDelete:m.identity,onTab:m.identity},r.createElement(g.b,{textarea:!0,style:this.getInputContainerStyle(),focus:"send"===e,value:t,placeholder:b.a.formatMessage(A.additionalFeedbackPlaceholder),onChange:e=>{this.stores.csatPopupStore.setState(x({},this.stores.csatPopupStore.state,{additionalFeedback:e.target.value}))}}))},this.renderSendButton=()=>r.createElement(v.a,{isLarge:!0,style:this.getButtonStyle(),onClick:this.handleSend},r.createElement(l.b,{id:"csatPopup.sendButton.label",defaultMessage:"Send"})),this.renderStars=e=>{const{starRating:t,step:n}=this.stores.csatPopupStore.state,i=e=>{let{rating:i}=e;return r.createElement("div",{style:this.getStarStyle(),onMouseEnter:()=>{"rate"===n&&this.stores.csatPopupStore.setState(x({},this.stores.csatPopupStore.state,{starRating:i}))},onClick:()=>{this.stores.csatPopupStore.setState({starRating:i,step:"send"})}},o.a.star({width:18,fill:this.theme.mediumIconColor,position:"absolute",opacity:t&&t>=i?0:1}),o.a.starFilled({width:18,fill:"#F6C050",position:"absolute",opacity:t&&t>=i?1:0}))};return r.createElement("div",{onMouseLeave:()=>{m.delay(()=>{"rate"===this.stores.csatPopupStore.state.step&&this.stores.csatPopupStore.setState(x({},this.stores.csatPopupStore.state,{starRating:void 0}))},500)},style:this.getStarsContainerStyle()},r.createElement("div",{style:this.getStarsStyle()},r.createElement(i,{rating:1}),r.createElement(i,{rating:2}),r.createElement(i,{rating:3}),r.createElement(i,{rating:4}),r.createElement(i,{rating:5})),r.createElement("div",{style:this.getStarLabelStyle()},r.createElement(()=>{const n=this.shouldRenderAsNPS(e);switch(t){case 1:return n?r.createElement(l.b,{defaultMessage:"Very unlikely",id:"csatPopup.stars.1StarLabelNps"}):r.createElement(l.b,{defaultMessage:"Very dissatisfied",id:"csatPopup.stars.1StarLabel"});case 2:return n?r.createElement(l.b,{defaultMessage:"Somewhat unlikely",id:"csatPopup.stars.2StarLabelNps"}):r.createElement(l.b,{defaultMessage:"Somewhat dissatisfied",id:"csatPopup.stars.2StarLabel"});case 3:return n?r.createElement(l.b,{defaultMessage:"Not likely nor unlikely",id:"csatPopup.stars.3StarLabelNps"}):r.createElement(l.b,{defaultMessage:"Not dissatisfied nor satisfied",id:"csatPopup.stars.3StarLabel"});case 4:return n?r.createElement(l.b,{defaultMessage:"Somewhat likely",id:"csatPopup.stars.4StarLabelNps"}):r.createElement(l.b,{defaultMessage:"Somewhat satisfied",id:"csatPopup.stars.4StarLabel"});case 5:return n?r.createElement(l.b,{defaultMessage:"Very likely",id:"csatPopup.stars.5StarLabelNps"}):r.createElement(l.b,{defaultMessage:"Very satisfied",id:"csatPopup.stars.5StarLabel"});default:return r.createElement(l.b,{defaultMessage:"Select an option",id:"csatPopup.stars.notSpecifiedLabel"})}},null)))},this.handleCancel=async()=>{const{state:e}=a.a;if(!e.open)return;const{open:t}=e,n=I(e,["open"]);if(t&&"trigger"===n.type){const{currentSpaceStore:e}=w.a.state;if(!e)return;await M.ac(this.environment,x({spaceId:e.id,rating:void 0,additionalFeedback:void 0,templateId:void 0},n,{useCase:"legacy"===n.useCase?void 0:n.useCase}))}a.a.setState(x({},a.a,{open:!1}))},this.handleSend=async()=>{const{additionalFeedback:e,starRating:t}=this.stores.csatPopupStore.state,{currentSpaceStore:n}=w.a.state;if(!n||!t)return;const{state:r}=a.a;if(!r.open)return;const{open:i}=r,s=I(r,["open"]),o="passive"===s.type?await M.ac(this.environment,{spaceId:n.id,rating:t,additionalFeedback:e,type:s.type,milestone:void 0,templateId:void 0}):await M.ac(this.environment,x({spaceId:n.id,rating:t,additionalFeedback:e,templateId:void 0},s,{useCase:"legacy"===s.useCase?void 0:s.useCase}));if("success"!==o.type)throw o.error;this.stores.csatPopupStore.setState(x({},this.stores.csatPopupStore.state,{step:"thanks"})),m.delay(()=>{a.a.setState(x({},a.a,{open:!1})),m.delay(()=>{this.stores.csatPopupStore.reset()},1e3)},2e3)},this.flexCenteredStyle={display:"flex",alignItems:"center",flexDirection:"column"}}willMount(){const{userSettingsStore:e,blockStore:t,spaceStore:n}=this.props;if(e&&t&&n){const r=this.environment;if("CsatMilestoneStore"in r){const i=D.a.withListenerIgnored(()=>function(e,t){const{userSettingsStore:n,blockStore:r,spaceStore:i}=t,a=n.getSettings(),{signup_time:s}=a,{CsatMilestoneStore:o}=e,{data:l}=o.state,c=e=>Math.floor(((new Date).getTime()-e)/864e5),d=i.getValue();if(!d||!l)return;const{milestones:u}=l;if(!u)return;if(Math.max(...u.map(e=>e.created_time))>(new Date).getTime()-24192e5)return;if(s){const e=c(s),t=m.sample(d.initial_use_cases)||"legacy";if(e>=180){if(!S(u,f.b))return{milestone:f.b,useCase:t}}else if(e>=90){if(!S(u,f.e))return{milestone:f.e,useCase:t}}else if(e>=28){if(!S(u,f.c))return{milestone:f.c,useCase:t}}else if(e>=7&&!S(u,f.d))return{milestone:f.d,useCase:t}}const p=r.getValue();return p&&p.copied_from&&Object(y.h)(p.copied_from)&&c(p.created_time)>=7&&!S(u,f.a,{templateId:p.copied_from})?{milestone:f.a,useCase:"legacy",templateId:p.copied_from}:void 0}(r,{userSettingsStore:e,blockStore:t,spaceStore:n}));if(i){const{milestone:e,useCase:t,templateId:n}=i;m.delay(()=>{a.a.setState({open:!0,milestone:e,type:"trigger",useCase:t,templateId:n})},2e3)}}}}renderComponent(){const{device:e}=this.environment;if(e.isMobile)return;const{currentSpaceStore:t}=w.a.state;return t&&t.canRead()?r.createElement(h.a,{isVisible:a.a.state.open,animationStyle:this.getAnimationStyle(a.a.state.open),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),springConfig:this.getSpringConfig(),render:()=>r.createElement("div",{style:this.getContainerStyle()},this.renderCancel(),r.createElement("div",{style:this.getInnerContainerStyle()},this.renderStep()))}):void 0}shouldRenderAsNPS(e){const t=k.i(this.environment),{state:n}=a.a,r=n.open&&"trigger"===n.type;return"enterprise"===t&&!e&&r}getSpringConfig(){return{scale:{stiffness:58,damping:4.3}}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:c.a.fontWeight.semibold,fontSize:14}}getThanksDescriptionStyle(){return{color:this.theme.mediumTextColor,fontSize:12}}getButtonStyle(){return{width:"calc(100% - 30px)"}}getInputContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return{width:"calc(100% - 30px)",display:"block",background:this.theme.popoverBackground,height:80,marginTop:10,marginBottom:10,opacity:"rate"===e?0:1}}getStarLabelStyle(){return{fontSize:12,color:this.theme.mediumTextColor,paddingTop:4}}getFeedbackPromptStyle(){return{paddingTop:12,paddingBottom:12,color:this.theme.regularTextColor,fontWeight:c.a.fontWeight.semibold,fontSize:14,lineHeight:1.4,width:188}}getStarStyle(){return{display:"inline-flex",position:"relative",width:20,height:20,marginRight:3}}getSlideContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return x({},this.flexCenteredStyle,{position:"absolute",transition:"transform 200ms ease",width:240,transform:"rate"===e?"translateY(120px)":"translateY(0px)"})}getStarsContainerStyle(){return x({width:"100%"},this.flexCenteredStyle)}getStarsStyle(){return{display:"flex",cursor:"pointer"}}getContainerStyle(){const{device:e}=this.environment;return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow,position:"absolute",bottom:65+e.scrollbarWidth,right:16+e.scrollbarWidth,zIndex:s.e}}getInnerContainerStyle(){return x({},this.flexCenteredStyle,{width:240,height:195,overflow:"hidden",position:"relative",padding:12,cursor:"default",textAlign:"center",justifyContent:"center"})}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}}t.default=Object(l.h)(F)},1158:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(3),a=n(1323),s=n(742),o=n(34),l=n(8),c=n(755),d=n(22),u=n(19),p=n(153),m=n(77),h=n(342),g=n(1),b=n(331),f=n(53),y=n(295);function S(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function v(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?S(Object(n),!0).forEach((function(t){E(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class M extends i.a{renderComponent(){const{intl:e,question:t}=this.props,n={setup_trial:r.createElement(g.b,{id:"enterpriseContactModalQuestionSelect.question.setup_trial",defaultMessage:"Setup an enterprise trial"}),live_demo:r.createElement(g.b,{id:"enterpriseContactModalQuestionSelect.question.live_demo",defaultMessage:"Schedule a live demo"}),plan_help:r.createElement(g.b,{id:"enterpriseContactModalQuestionSelect.question.plan_help",defaultMessage:"Need help choosing a plan"}),other:r.createElement(g.b,{id:"enterpriseContactModalQuestionSelect.question.other",defaultMessage:"Other"})},i={menuTitle:e.formatMessage({defaultMessage:"Your question",id:"enterpriseContactModal.yourQuestion.title"}),items:["setup_trial","live_demo","plan_help","other"],width:280,getKey:e=>e,selectedItem:t,originGap:4,onSelect:e=>{this.props.onSelect(e)},renderItem:e=>r.createElement(f.a,Object.assign({title:n[e.key]},e)),renderOrigin:e=>r.createElement(y.a,{isLarge:!0,onClick:t=>e.onClick(t),style:v({},this.getInputStyle(),{},this.props.invalid&&{border:"1px solid ".concat(u.f.red)})},r.createElement("div",{style:{display:"flex",alignItems:"center",color:t?this.theme.regularTextColor:this.theme.lightTextColor}},t?n[t]:r.createElement(g.b,{defaultMessage:"Select question",id:"enterpriseContactModal.selectQuestion.label"})),l.a.expand({width:10,fill:this.theme.lightIconColor}))};return r.createElement(b.a,Object.assign({key:"onboarding"},i))}getInputStyle(){const{device:e}=this.environment;return v({backgroundColor:this.theme.whiteButtonBackground,height:31},e.isMobile&&{height:42},{padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:"0 0 0 1px ".concat(this.theme.outlineButtonBorder),background:this.theme.buttonBackground})}}var w=Object(g.h)(M),C=n(16);class O extends C.a{getInitialState(){return{step:"initial"}}}var k=O,P=n(20),T=n(126),D=n(105),I=n(2),j=n(5),x=n(14),B=n(263);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){R(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const L=Object(g.g)({additionalFeedbackPlaceholder:{id:"enterpriseContactModal.additionalFeedback.placeholder",defaultMessage:"What would you like to learn more about?"}});class U extends i.a{constructor(){super(...arguments),this.storeTypes={store:k},this.renderMenu=()=>r.createElement("div",{style:this.getContainerStyle()},this.renderCancel(),r.createElement(c.a,{style:this.getInnerContainerStyle(),alignItems:"center",alignContent:"center"},this.renderStep())),this.renderInitial=()=>{const{invalidField:e}=this.stores.store.state;if(a.a.state.open)return r.createElement("div",{style:F({},this.getSlideUpStyle(),{padding:20})},l.a.speechBubbleThin({width:"100%",height:24}),r.createElement("div",{style:{fontSize:14,fontWeight:d.a.fontWeight.semibold,paddingTop:6,paddingBottom:4}},r.createElement(g.b,{id:"enterpriseContactModal.initial.header",defaultMessage:"Get in touch with sales"})),r.createElement("div",{style:{fontSize:12,color:this.theme.mediumTextColor,width:200,margin:"0 auto"}},r.createElement(g.b,{id:"enterpriseContactModal.initial.caption",defaultMessage:"We'll work with you on your setup and help you land on the best plan."})),r.createElement("div",{style:F({},this.getLabelStyle(),{marginTop:24})},r.createElement(g.b,{id:"enterpriseContactModal.initial.nameLabel",defaultMessage:"Your name"})),r.createElement(p.b,{focusInitial:!0,value:this.getName(),placeholder:"Ada Lovelace",style:F({marginRight:4},this.getInputStyle(),{},"name"===e&&this.getInvalidInputStyle()),onChange:e=>{a.a.setState(F({},a.a.state,{open:!0,name:void 0})),this.stores.store.setState(F({},this.stores.store.state,{name:e.target.value}))}}),r.createElement("div",{style:this.getLabelStyle()},r.createElement(g.b,{id:"enterpriseContactModal.initial.emailLabel",defaultMessage:"Your work email"})),r.createElement(p.b,{value:this.getEmail(),placeholder:"ada@lovelace.app",type:"email",style:F({marginRight:4},this.getInputStyle(),{},"email"===e&&this.getInvalidInputStyle()),onChange:e=>{a.a.setState(F({},a.a.state,{open:!0,email:void 0})),this.stores.store.setState(F({},this.stores.store.state,{email:e.target.value}))}}),r.createElement("div",{style:this.getLabelStyle()},r.createElement(g.b,{id:"enterpriseContactModal.initial.companySizeLabel",defaultMessage:"Company size"})),r.createElement(c.a,null,this.getCompanySizeButtonData().map(e=>{let{type:t,message:n,style:i}=e;return r.createElement(m.a,{isLightGray:!0,isLarge:!0,style:F({},this.getBaseButtonStyle(),{},this.stores.store.state.companySize===t&&this.getSelectedButtonStyle(),{},i),onClick:()=>{this.stores.store.setState(F({},this.stores.store.state,{companySize:t}))}},n)})),r.createElement("div",{style:this.getLabelStyle()},r.createElement(g.b,{id:"enterpriseContactModal.initial.questionLabel",defaultMessage:"Your question"})),r.createElement(w,{question:this.stores.store.state.question,invalid:"question"===e,onSelect:e=>{this.stores.store.setState(F({},this.stores.store.state,{question:e,step:"other"===e?"additional_input":"initial"}))}}),r.createElement(p.b,{textarea:!0,style:this.getTextAreaStyle(),focus:"additional_input"===this.stores.store.state.step,value:this.stores.store.state.additionalFeedback,placeholder:j.a.formatMessage(L.additionalFeedbackPlaceholder),onChange:e=>{this.stores.store.setState(F({},this.stores.store.state,{additionalFeedback:e.target.value}))}}))},this.renderCancel=()=>r.createElement(o.a,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},l.a.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderThanks=()=>r.createElement("div",null,r.createElement("img",{style:{width:165,height:80},src:P.a.images.feedbackThankYouPng}),r.createElement("div",{style:this.getThanksHeaderStyle()},r.createElement(g.b,{id:"enterpriseContactModal.thanks.caption",defaultMessage:"We've received your inquiry and will be contacting you via email shortly."}))),this.handleCancel=async()=>{a.a.setState({open:!1})}}renderComponent(){return r.createElement(s.a,{preventHideChildrenWhileOpening:!0,open:a.a.state.open,render:this.renderMenu,onDismiss:this.handleCancel})}renderStep(){const{step:e}=this.stores.store.state;return r.createElement(r.Fragment,null,r.createElement(T.a,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.createElement(D.a,{capture:!0,onBackspace:I.identity,onLeft:I.identity,onRight:I.identity,onSelectAll:I.identity,onRedo:I.identity,onUndo:I.identity,onCut:I.identity,onCopy:I.identity,onPaste:I.identity,onKeypress:I.identity,onDelete:I.identity,onTab:I.identity},this.renderInitial())}),r.createElement(T.a,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}),r.createElement(T.a,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>r.createElement(h.a,{isLarge:!0,style:{marginTop:17,width:284,position:"absolute",bottom:20},onClick:()=>{const e=this.getInvalidField();if(e){const{question:t}=this.stores.store.state;this.stores.store.setState(F({},this.stores.store.state,{step:"initial",invalidField:e,question:"other"===t?void 0:t}))}else this.stores.store.setState(F({},this.stores.store.state,{invalidField:void 0,step:"thanks"})),a.a.state.open&&x.Db(this.environment,F({email:a.a.state.email,name:a.a.state.name},this.stores.store.state)),I.delay(()=>{a.a.reset(),I.delay(()=>{this.stores.store.reset()},1e3)},2e3)}},r.createElement(g.b,{id:"enterpriseContactModal.initial.sendLabel",defaultMessage:"Send"}))}))}getName(){if(a.a.state.open)return this.stores.store.state.name||a.a.state.name}getEmail(){if(a.a.state.open)return this.stores.store.state.email||a.a.state.email}getInvalidField(){const e=this.getEmail(),t=this.getName(),{question:n,companySize:r}=this.stores.store.state;return t?e&&B.test(e,"email")?r?n?void 0:"question":"company_size":"email":"name"}getCompanySizeButtonData(){return[{type:"1_100",message:r.createElement(g.b,{id:"enterpriseContactModal.initial.1_100Label",defaultMessage:"1-100"})},{type:"101_1000",message:r.createElement(g.b,{id:"enterpriseContactModal.initial.101_1000Label",defaultMessage:"101-1,000"}),style:{marginLeft:8,marginRight:8}},{type:"1001+",message:r.createElement(g.b,{id:"enterpriseContactModal.initial.1000PlusLabel",defaultMessage:"1,001+"})}]}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:d.a.fontWeight.semibold,fontSize:14}}getContainerStyle(){return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}getInnerContainerStyle(){return{width:320,height:470,overflow:"hidden",position:"relative",padding:20,cursor:"default",textAlign:"center",justifyContent:"center"}}getLabelStyle(){return{marginTop:17,fontSize:12,color:this.theme.mediumTextColor,fontWeight:d.a.fontWeight.medium,lineHeight:"135%",marginBottom:4,textAlign:"left"}}getInputStyle(){return{backgroundColor:this.theme.whiteButtonBackground,height:31}}getInvalidInputStyle(){return{border:"1px solid ".concat(u.f.red)}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getBaseButtonStyle(){return{border:"1px solid #E7E6E5",flexGrow:1,justifyContent:"center"}}getSelectedButtonStyle(){return{color:u.f.blue,border:"1px solid ".concat(u.f.blue)}}getSlideUpStyle(){const{step:e}=this.stores.store.state;return{position:"absolute",transition:"transform 200ms ease",transform:"initial"===e?"translateY(153px)":"translateY(-180px)"}}getTextAreaStyle(){return{width:"100%",background:this.theme.popoverBackground,display:"block",padding:"7px 10px",height:310,marginTop:17,marginBottom:17,transition:"opacity 200ms ease-in",opacity:"additional_input"===this.stores.store.state.step?1:.001}}}t.default=U},1159:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r=n(0),i=n(2),a=n(3),s=n(13),o=(n(885),n(886),n(765)),l=n.n(o),c=n(70),d=n(331),u=n(256),p=(n(159),n(169),n(56));const m=p.a.tz.names().map(e=>{const t=p.a.tz(e);return{name:e,displayName:"GMT".concat(t.format("Z")," - ").concat(e.replace(/_/g," ")," (").concat(t.format("z"),")"),utcOffset:t.utcOffset()}}).sort((e,t)=>e.utcOffset-t.utcOffset);m.map(e=>e.displayName),i.memoize(e=>{if(0===e)return p.a.utc("1990-12-28").zoneAbbr();const t=m.find(t=>e===t.utcOffset);return t?t.name:void 0});var h,g,b=n(16);!function(e){e.StartDate="startDate",e.StartTime="startTime",e.EndDate="endDate",e.EndTime="endTime"}(h||(h={})),function(e){e.InvalidDate="Invalid date",e.InvalidTime="Invalid time",e.InvalidRange="Invalid range"}(g||(g={}));class f extends b.a{getInitialState(){return{focus:h.StartDate,inputIsFocused:!1,inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}}}var y=f,S=n(49),v=n(153),E=n(39),M=n(31),w=n(271),C=n(407),O=n(53),k=n(24),P=n(59),T=n(21),D=n(167),I=n(55),j=n(154),x=n(8),B=n(171),A=n(617),F=n(689),R=n(206),L=n(413),U=n(14),_=n(19),W=n(151),q=n(360),N=n(588),z=n(84),V=n(1),H=n(91),G=n(136),Y=n(607),Q=n(184),K=n(1497);function Z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Z(Object(n),!0).forEach((function(t){$(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class J extends a.a{constructor(){super(...arguments),this.storeTypes={store:y,timezoneQuery:P.a.of("")},this.renderNavbarElement=e=>{let{onPreviousClick:t,onNextClick:n}=e;const{device:i}=this.environment;return r.createElement("div",{style:i.isMobile?J.mobileNavStyle:J.desktopNavStyle},r.createElement(W.a,{mobileFeedback:i.isMobile,icon:x.a.chevronLeft,onClick:()=>t()}),r.createElement(W.a,{mobileFeedback:i.isMobile,icon:x.a.chevronRight,onClick:()=>n()}))},this.handleDateFormatChange=e=>{this.props.onChangeDateFormat(e)},this.handleTimeFormatChange=e=>{const t=this.getTimeFormatOptions()[e];this.props.onChangeTimeFormat(t)},this.handleChangeReminder=e=>{const t=this.getDateValue();e?s.X(e)?this.props.onChangeValue(X({},t,{reminder:e})):"datetime"!==t.type&&"datetimerange"!==t.type||this.props.onChangeValue(X({},t,{reminder:e})):this.props.onChangeValue(X({},t,{reminder:e})),U.Ld(this.environment,{date:t,reminder:e})},this.handleInputChange=e=>{const{device:t}=this.environment,{store:n}=this.stores;n.setState(X({},n.state,{inputTemporaryValue:X({},n.state.inputTemporaryValue,{[n.state.focus]:e.target.value||""})})),t.isAndroid&&this.handleInputBlur()},this.handleStartDateInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.startDate;if(!t)return;const n=this.parseInputDateValue(t);if(!n)return g.InvalidDate;const r=this.getDateValue();if(s.W(r)||s.Y(r)){const{newDate:e,currentMonth:t}=s.N({previous:r,updatedStartDate:n});this.applyValidDateState({newDate:e,currentMonth:t,resetField:h.StartDate})}else{const e=X({},r,{start_date:n}),t=s.L(e);this.applyValidDateState({newDate:e,currentMonth:t.start,resetField:h.StartDate})}},this.handleStartTimeInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.startTime;if(!t)return;const n=this.parseInputTimeValue(t);if(!n)return g.InvalidTime;const r=this.getDateValue();if(s.Y(r)){const{newDate:e,currentMonth:t}=s.O({previous:r,updatedStartTime:n});this.applyValidDateState({newDate:e,currentMonth:t,resetField:h.StartTime}),this.resetInputState(h.EndDate),this.resetInputState(h.EndTime)}else{const e=X({},r,{start_time:n}),t=s.L(e);this.applyValidDateState({newDate:e,currentMonth:t.start,resetField:h.StartTime})}},this.handleEndDateInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.endDate;if(!t)return;const n=this.parseInputDateValue(t);if(!n)return g.InvalidDate;const r=X({},this.getDateValue(),{end_date:n}),i=s.L(r);if(!i)return g.InvalidRange;this.applyValidDateState({newDate:r,currentMonth:i.end,resetField:h.EndDate})},this.handleEndTimeInputChange=()=>{const{inputTemporaryValue:e}=this.stores.store.state,t=e.endTime;if(!t)return;const n=this.parseInputTimeValue(t);if(!n)return g.InvalidTime;const r=X({},this.getDateValue(),{end_time:n}),i=s.L(r);if(!i)return g.InvalidRange;this.applyValidDateState({newDate:r,currentMonth:i.end,resetField:h.EndTime})},this.handleInputBlur=e=>{const{focus:t}=this.stores.store.state;let n=void 0;t===h.StartDate?n=this.handleStartDateInputChange():t===h.StartTime?n=this.handleStartTimeInputChange():t===h.EndDate?n=this.handleEndDateInputChange():t===h.EndTime&&(n=this.handleEndTimeInputChange()),n?this.stores.store.setState(X({},this.stores.store.state,{error:X({},this.stores.store.state.error,{[t]:n})})):this.stores.store.setState(X({},this.stores.store.state,{inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},inputIsFocused:!1,error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}))},this.handleInputSubmit=()=>{const{focus:e}=this.stores.store.state;let t=void 0;e===h.StartDate?t=this.handleStartDateInputChange():e===h.StartTime?t=this.handleStartTimeInputChange():e===h.EndDate?t=this.handleEndDateInputChange():e===h.EndTime&&(t=this.handleEndTimeInputChange()),t?this.stores.store.setState(X({},this.stores.store.state,{error:X({},this.stores.store.state.error,{[e]:t})})):this.stores.store.setState(X({},this.stores.store.state,{inputTemporaryValue:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0},error:{startDate:void 0,startTime:void 0,endDate:void 0,endTime:void 0}}))},this.handleDayPickerDayClick=e=>{if(this.props.disabled)return;const t=i.cloneDeep(this.getDateValue()),{focus:n}=this.stores.store.state,r=Object(c.a)(e).locale(s.jb).format(s.ib);if("daterange"===t.type||"datetimerange"===t.type){const e=n===h.StartDate||n===h.StartTime?h.EndDate:h.StartDate;if(r===t[e===h.StartDate?"start_date":"end_date"])return void this.stores.store.setState(X({},this.stores.store.state,{focus:e}));n===h.StartDate||n===h.StartTime?t.start_date=r:n!==h.EndDate&&n!==h.EndTime||(t.end_date=r);const i=s.K(t,s.m);if(i.end&&i.end.isBefore(i.start)){if("datetimerange"===t.type){const{start_date:e,start_time:n,end_date:r,end_time:i}=t;t.start_date=r,t.start_time=i,t.end_date=e,t.end_time=n}else{const{start_date:e,end_date:n}=t;t.start_date=n,t.end_date=e}this.stores.store.setState(X({},this.stores.store.state,{focus:n===h.StartDate||n===h.StartTime?h.EndDate:h.StartDate}))}this.props.onChangeValue(t),this.resetInputState(n)}else t.start_date=r,this.props.onChangeValue(t),this.resetInputState(n)},this.handleDayPickerMonthChange=e=>{this.stores.store.setState(X({},this.stores.store.state,{currentMonth:Object(c.a)(e)}))},this.handleEndDateControlChange=()=>{const e=this.getDateValue();if("datetimerange"===e.type){const t={type:"datetime",start_date:e.start_date,start_time:e.start_time,time_zone:e.time_zone,reminder:e.reminder};this.props.onChangeValue(t)}else if("daterange"===e.type){const t={type:"date",start_date:e.start_date,reminder:e.reminder};this.props.onChangeValue(t)}else if("datetime"===e.type){const t={type:"datetimerange",start_date:e.start_date,start_time:e.start_time,end_date:e.start_date,end_time:e.start_time,time_zone:e.time_zone,reminder:e.reminder};this.props.onChangeValue(t),this.stores.store.setState(X({},this.stores.store.state,{focus:h.EndDate}))}else{const t={type:"daterange",start_date:e.start_date,end_date:e.start_date,reminder:e.reminder};this.props.onChangeValue(t),this.stores.store.setState(X({},this.stores.store.state,{focus:h.EndDate}))}},this.handleAllDayChange=()=>{const e=this.getDateValue();if("date"===e.type){const t={type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:s.m,reminder:e.reminder&&s.k(e.reminder)};this.props.onChangeValue(t)}else if("daterange"===e.type){const t={type:"datetimerange",start_date:e.start_date,start_time:"00:00",end_date:e.end_date,end_time:"00:00",time_zone:s.m,reminder:e.reminder&&s.k(e.reminder)};this.props.onChangeValue(t)}else if("datetime"===e.type){const t={type:"date",start_date:e.start_date,reminder:e.reminder&&s.j(e.reminder)};this.props.onChangeValue(t)}else{const t={type:"daterange",start_date:e.start_date,end_date:e.end_date,reminder:e.reminder&&s.j(e.reminder)};this.props.onChangeValue(t)}},this.handleTimeZoneChange=e=>{const t=m.find(t=>t.displayName===e);if(!t)return;const n=t.name,r=this.getDateValue();if("datetime"===r.type||"datetimerange"===r.type){const e=X({},r,{time_zone:n});this.props.onChangeValue(e)}},this.handleStartInputDateFocus=()=>{const e=this.getDateValue(),t=s.K(e,s.m);this.stores.store.setState(X({},this.stores.store.state,{focus:h.StartDate,inputIsFocused:!0,currentMonth:t.start}))},this.handleStartInputTimeFocus=()=>{const e=this.getDateValue(),t=s.K(e,s.m);this.stores.store.setState(X({},this.stores.store.state,{focus:h.StartTime,inputIsFocused:!0,currentMonth:t.start}))},this.handleEndInputDateFocus=()=>{const e=this.getDateValue(),t=s.K(e,s.m);t.end&&this.stores.store.setState(X({},this.stores.store.state,{focus:h.EndDate,inputIsFocused:!0,currentMonth:t.end}))},this.handleEndInputTimeFocus=()=>{const e=this.getDateValue(),t=s.K(e,s.m);t.end&&this.stores.store.setState(X({},this.stores.store.state,{focus:h.EndTime,inputIsFocused:!0,currentMonth:t.end}))},this.handleClearClick=()=>{this.props.onChangeValue(void 0)},this.getTimeFormatOptions=()=>Object(Y.a)(Q.a).time,this.getSelectedTimeFormatType=()=>{const e=this.getTimeFormat(),t=this.getTimeFormatOptions();for(const n in t)if(t[n]===e)return n;return"12h"},this.getTimeZoneItemsSync=e=>Object(w.b)(e,m,e=>e.displayName).map((e,t)=>({key:e.displayName,render:t=>r.createElement(O.a,Object.assign({},t,{title:e.displayName})),action:()=>{this.handleTimeZoneChange(e.displayName)}})),this.tooltipOriginGap=12}willMount(e){super.willMount(e),this.openTimeFormat=s.nb(s.m)}renderComponent(){const{device:e,WindowSizeStore:t}=this.environment,{disabled:n,locked:i,shouldShowReminder:a}=this.props,{inputIsFocused:s}=this.stores.store.state,o=this.getDateValue(),l="datetime"===o.type||"datetimerange"===o.type,c="daterange"===o.type||"datetimerange"===o.type,d=r.createElement("div",{style:X({paddingTop:e.isMobile?16:8,paddingBottom:e.isMobile?16:8,paddingLeft:e.isMobile?t.getSafePaddingLeftCSS(16):14,paddingRight:e.isMobile?t.getSafePaddingRightCSS(16):14,display:l?"block":"flex"},e.isMobile&&{boxShadow:"\n\t\t\t\t\t\t\t0 1px 0 ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t"),position:"relative",zIndex:2},{background:e.isMobile?this.theme.popoverBackground:void 0})},this.renderStartInput(),c&&r.createElement("div",{style:{width:12,height:8}}),this.renderEndInput(),this.renderTimeZone());let u;return u=e.isMobile?{menuType:T.b.MenuType.Modal,title:r.createElement(V.b,{defaultMessage:"Date",id:"datePropertyMenu.mobileDate.title"}),right:r.createElement(V.b,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneButton.label"}),left:a?this.renderRemindersHelp():void 0,onClickRight:this.props.onDismiss,header:d}:{menuType:T.b.MenuType.Popup,maxHeight:"none",width:270},r.createElement(C.a,{capture:s,allowEsc:!0,allowTabUntab:!1},r.createElement(C.a,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1},r.createElement(T.b,Object.assign({},u),r.createElement(L.a,{show:s}),r.createElement(k.a,null,!e.isMobile&&d,r.createElement("div",{style:X({padding:e.isMobile?"16px 14px 16px":"4px 0 4px",textAlign:"center"},e.isMobile&&{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.popoverBackground})},this.renderCalendar())),!n&&this.renderControls(),!n&&!i&&r.createElement(k.a,{topBorder:!0},this.renderFormatPopup()),!n&&r.createElement(k.a,{topBorder:!0},this.renderClearButton()),!n&&!e.isMobile&&a&&r.createElement(k.a,{topBorder:!0},this.renderRemindersHelp()))))}renderStartInput(){const{device:e}=this.environment,{disabled:t}=this.props,{focus:n,inputTemporaryValue:i,error:a}=this.stores.store.state,o=this.getDateValue(),l=s.K(o,s.m),c=Boolean(a.startDate||a.startTime),d="datetime"===o.type||"datetimerange"===o.type,u="daterange"===o.type||"datetimerange"===o.type,p=n===h.StartDate||n===h.StartTime,m=Object(M.h)(i.startDate)?l.start.locale(!1).format(this.getDateDisplayFormat()):i.startDate,g=Object(M.h)(i.startTime)?l.start.locale(!1).format(this.getTimeFormat()):i.startTime,b=Object(M.h)(i.startDate)?l.start.format(s.ib):i.startDate,f=Object(M.h)(i.startTime)?l.start.format(s.kb):i.startTime;return r.createElement("div",{style:X({},c?this.getInputWrapErrorStyle():p&&u?this.getInputWrapActiveStyle():this.getInputWrapInactiveStyle(),{fontSize:e.isMobile?16:14})},r.createElement(E.a,{renderTooltip:()=>this.getInputErrorMessage(a.startDate),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(a.startDate),placement:E.a.Placement.Left,render:()=>e.isMobile?r.createElement(v.b,{type:"date",format:v.a.Transparent,value:b,onChange:this.handleInputChange,onFocus:this.handleStartInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,disabled:t,size:1}):r.createElement(v.b,{format:v.a.Transparent,value:m,focusInitial:n===h.StartDate,onChange:this.handleInputChange,onFocus:this.handleStartInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,disabled:t,size:1})}),d&&this.getInputSeparator(),d&&r.createElement(E.a,{renderTooltip:()=>this.getInputErrorMessage(a.startTime),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(a.startTime),placement:E.a.Placement.Right,render:()=>e.isMobile?r.createElement(v.b,{type:"time",format:v.a.Transparent,value:f,onChange:this.handleInputChange,onFocus:this.handleStartInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t}):r.createElement(v.b,{format:v.a.Transparent,value:g,focusInitial:n===h.StartTime,onChange:this.handleInputChange,onFocus:this.handleStartInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}))}renderEndInput(){const{device:e}=this.environment,{disabled:t}=this.props,n=this.getDateValue(),i=s.K(n,s.m),a="datetime"===n.type||"datetimerange"===n.type;if(i.end){const{focus:n,error:o,inputTemporaryValue:l}=this.stores.store.state,c=Boolean(o.endDate||o.endTime),d=n===h.EndDate||n===h.EndTime,u=Object(M.h)(l.endDate)?i.end.locale(!1).format(this.getDateDisplayFormat()):l.endDate,p=Object(M.h)(l.endTime)?i.end.locale(!1).format(this.getTimeFormat()):l.endTime,m=Object(M.h)(l.endDate)?i.end.format(s.ib):l.endDate,g=Object(M.h)(l.endTime)?i.end.format(s.kb):l.endTime,b=this.getDateRangeBounds(),f=b&&b.earliestValidEnd;return r.createElement("div",{style:X({},c?this.getInputWrapErrorStyle():d?this.getInputWrapActiveStyle():this.getInputWrapInactiveStyle(),{fontSize:e.isMobile?16:14})},r.createElement(E.a,{renderTooltip:()=>this.getInputErrorMessage(o.endDate),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(o.endDate),placement:E.a.Placement.Left,render:()=>e.isMobile?r.createElement(v.b,{type:"date",format:v.a.Transparent,value:m,onChange:this.handleInputChange,onFocus:this.handleEndInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t,inputElementAttributes:{min:f}}):r.createElement(v.b,{format:v.a.Transparent,value:u,focusInitial:n===h.EndDate,onChange:this.handleInputChange,onFocus:this.handleEndInputDateFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}),a&&this.getInputSeparator(),a&&r.createElement(E.a,{renderTooltip:()=>this.getInputErrorMessage(o.endTime),originGap:this.tooltipOriginGap,forceVisibleState:Boolean(o.endTime),placement:E.a.Placement.Right,render:()=>e.isMobile?r.createElement(v.b,{type:"time",format:v.a.Transparent,value:g,onChange:this.handleInputChange,onFocus:this.handleEndInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t}):r.createElement(v.b,{format:v.a.Transparent,value:p,focusInitial:n===h.EndTime,onChange:this.handleInputChange,onFocus:this.handleEndInputTimeFocus,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,size:1,disabled:t})}))}}renderTimeZone(){const{device:e}=this.environment,t=this.getDateValue(),n=s.K(t,s.m),i=c.a.tz(n.start,s.m);if(("datetime"===t.type||"datetimerange"===t.type)&&i.utcOffset()!==n.start.utcOffset()){const n=m.find(e=>e.name===t.time_zone);if(n)return r.createElement(z.a,{isSmall:!0,isMobile:e.isMobile,style:{marginTop:8}},n.displayName)}}renderCalendar(){const{firstDayOfWeek:e}=this.props,t=this.getDateValueForceCurrentTimeZone(),n=s.K(t,s.m),i=this.stores.store.state.currentMonth||n.start,{focus:a}=this.stores.store.state;if(n.end){const t=n.start.toDate(),s=n.end.toDate(),o=a===h.StartDate||a===h.StartTime;return r.createElement(l.a,{className:"notion-calendar-picker notranslate",firstDayOfWeek:e,numberOfMonths:1,initialMonth:i.toDate(),month:i.toDate(),locale:Q.a,localeUtils:K.a,modifiers:X({range:{from:t,to:s}},o?{end:s,start:t}:{start:t,end:s}),modifiersStyles:{range:J.dayPickerRangeDayStyle,start:o?this.getDayPickerActiveDayStyle():this.getDayPickerInactiveDayStyle(),end:o?this.getDayPickerInactiveDayStyle():this.getDayPickerActiveDayStyle()},showOutsideDays:!0,fixedWeeks:!0,onDayClick:this.handleDayPickerDayClick,navbarElement:this.renderNavbarElement,onMonthChange:this.handleDayPickerMonthChange})}{const t=n.start.toDate();return r.createElement(l.a,{className:"notion-calendar-picker notranslate",numberOfMonths:1,firstDayOfWeek:e,initialMonth:i.toDate(),month:i.toDate(),locale:Q.a,localeUtils:K.a,selectedDays:[t],modifiers:{start:t},modifiersStyles:{start:this.getDayPickerActiveDayStyle()},showOutsideDays:!0,fixedWeeks:!0,navbarElement:this.renderNavbarElement,onDayClick:this.handleDayPickerDayClick,onMonthChange:this.handleDayPickerMonthChange})}}renderControls(){const{device:e}=this.environment,{shouldShowReminder:t}=this.props;return e.isMobile?r.createElement(k.a,{topBorder:!0},t&&this.renderReminderControl(),this.renderEndDateControl(),this.renderAllDayControl()):r.createElement(r.Fragment,null,t&&r.createElement(k.a,{topBorder:!0},this.renderReminderControl()),r.createElement(k.a,{topBorder:!0},this.renderEndDateControl(),this.renderAllDayControl()))}renderEndDateControl(){const{device:e}=this.environment,t=this.getDateValue();return r.createElement(O.a,{focused:!1,onClick:this.handleEndDateControlChange,title:r.createElement(V.b,{defaultMessage:"End date",id:"datePropertyMenu.menuItem.endDate.label"}),right:r.createElement(u.a,{on:"daterange"===t.type||"datetimerange"===t.type,onClick:this.handleEndDateControlChange,isAndroid:e.isAndroid})})}renderAllDayControl(){const{device:e}=this.environment,t=this.getDateValue();return r.createElement(O.a,{focused:!1,onClick:this.handleAllDayChange,title:r.createElement(V.b,{defaultMessage:"Include time",id:"datePropertyMenu.menuItem.includeTime.label",description:"Shown in the date property menu as an option for whether this date includes a time."}),right:r.createElement(u.a,{on:"date"!==t.type&&"daterange"!==t.type,onClick:this.handleAllDayChange,isAndroid:e.isAndroid})})}renderReminderControl(){const{device:e}=this.environment,{intl:t}=this.props,n=this.getDateValue();return r.createElement(S.a,{popupType:e.isMobile?S.a.PopupType.SlideUp:S.a.PopupType.Popup,placementToOrigin:S.a.Placement.Right,renderOrigin:i=>r.createElement(A.a,Object.assign({},i,{icon:x.a.alarmClock({width:14}),title:r.createElement(V.b,{defaultMessage:"Remind",id:"datePropertyMenu.menuItem.remind.label"}),focused:!1,showExtensionArrow:e.isMobile,right:Object(R.b)({reminder:n.reminder,intl:t})})),render:i=>{let a;a=e.isMobile?{menuType:T.b.MenuType.Modal,title:r.createElement(V.b,{defaultMessage:"Remind",id:"datePropertyMenu.mobileRemindModal.title"}),right:r.createElement(V.b,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneReminderButton.label"}),onClickRight:i.close}:{menuType:T.b.MenuType.Popup,width:250};const o=("date"===n.type||"daterange"===n.type?s.q:s.t).map(e=>{const n=Object(R.b)({reminder:e,shouldShowTime:!0,intl:t});return{key:n,action:t=>{this.handleChangeReminder(e),i.close()},render:(e,t)=>r.createElement(O.a,Object.assign({},e,{title:n}))}});return r.createElement(T.b,Object.assign({},a),r.createElement(I.a,{type:I.a.Type.Vertical,sections:[{key:"reminder section",render:e=>r.createElement(k.a,Object.assign({},e)),items:o}],initialFocus:void 0}))}})}renderFormatPopup(){const{device:e}=this.environment;return r.createElement(S.a,{popupType:e.isMobile?S.a.PopupType.SlideUp:S.a.PopupType.Popup,placementToOrigin:S.a.Placement.Right,renderOrigin:t=>r.createElement(O.a,Object.assign({},t,{icon:x.a.sidebarSettings({width:14}),title:r.createElement(V.b,{defaultMessage:"Date format & timezone",id:"datePropertyMenu.menuItem.formatAndTimezone.label"}),focused:!1,showExtensionArrow:e.isMobile})),render:t=>{let n;return n=e.isMobile?{menuType:T.b.MenuType.Modal,title:r.createElement(V.b,{defaultMessage:"Date format",id:"datePropertyMenu.mobileDateFormatModal.title"}),right:r.createElement(V.b,{defaultMessage:"Done",id:"datePropertyMenu.mobileDoneButton.label"}),onClickRight:t.close}:{menuType:T.b.MenuType.Popup,width:250},r.createElement(T.b,Object.assign({},n),r.createElement(k.a,null,this.renderDateFormatControl(),this.renderTimeFormatControl(),this.renderTimeZoneControl()))}})}renderDateFormatControl(){const e=this.props.dateFormat||s.v,{intl:t}=this.props,n={menuTitle:t.formatMessage({defaultMessage:"Date format",id:"datePropertyMenu.dateFormatDropdownButton.label"}),items:s.c,getKey:e=>e,selectedItem:e,onSelect:this.handleDateFormatChange,renderItem:e=>r.createElement(O.a,Object.assign({},e,{title:t.formatMessage(s.b[e.value])})),renderOrigin:n=>r.createElement(A.a,Object.assign({focused:!1,title:r.createElement(V.b,{defaultMessage:"Date format",id:"datePropertyMenu.menuItem.format.label"}),right:e?t.formatMessage(s.b[e]):r.createElement(V.b,{defaultMessage:"Empty",id:"datePropertyMenu.formatMenu.emptyButton.label"})},n))};return r.createElement(d.a,Object.assign({},n))}renderTimeFormatControl(){const e=this.getDateValue(),t="date"===e.type||"daterange"===e.type,n=this.getTimeFormat(),{intl:i}=this.props,a=this.getSelectedTimeFormatType(),o={menuTitle:i.formatMessage({defaultMessage:"Time format",id:"datePropertyMenu.timeFormatMenu.title"}),items:s.e,getKey:e=>e,selectedItem:a,onSelect:this.handleTimeFormatChange,renderItem:e=>r.createElement(O.a,Object.assign({},e,{title:i.formatMessage(s.a[e.value])})),disabled:t,renderOrigin:e=>r.createElement(A.a,Object.assign({focused:!1,title:r.createElement(V.b,{defaultMessage:"Time format",id:"datePropertyMenu.menuItem.timeFormat.label"}),disabled:t,right:!t&&(n?i.formatMessage(s.a[a]):r.createElement(V.b,{defaultMessage:"Empty",id:"datePropertyMenu.timeFormatMenu.emptyButton.label"}))},e))};return r.createElement(d.a,Object.assign({},o))}renderTimeZoneControl(){const{device:e}=this.environment,t=this.getDateValue(),n="date"===t.type||"daterange"===t.type,i=this.getCurrentTimeZone(),a=m.find(e=>e.name===i),{intl:s}=this.props;if(a)return r.createElement(S.a,{popupType:e.isMobile?S.a.PopupType.SlideUp:S.a.PopupType.Popup,disabled:n,onClick:()=>this.stores.timezoneQuery.set(""),renderOrigin:e=>r.createElement(A.a,Object.assign({focused:!1,title:r.createElement(V.b,{defaultMessage:"Timezone",id:"datePropertyMenu.menuItem.time.label"}),disabled:n,right:!n&&c.a.tz.zone(a.name).abbr(Date.now())},e)),render:t=>{const n=this.stores.timezoneQuery.get(),i=this.getTimeZoneItemsSync(n),a=r.createElement(k.a,{isInput:!0},r.createElement(D.a,{focus:!e.isMobile||void 0,focusAfterAnimation:!0,value:this.stores.timezoneQuery.get(),onChange:e=>this.stores.timezoneQuery.set(e.target.value),placeholder:s.formatMessage({defaultMessage:"Search for a timezone…",id:"datePropertyMenu.timeSearch.placeholder"})}));let o;return o=e.isMobile?{menuType:T.b.MenuType.Modal,title:r.createElement(V.b,{defaultMessage:"Timezone",id:"datePropertyMenu.mobileTimezoneMenu.title"}),right:r.createElement(H.CancelMenuText,null),onClickRight:t.close,header:a}:{menuType:T.b.MenuType.Popup,header:a},r.createElement(T.b,Object.assign({},o),0===i.length?r.createElement(k.a,{title:r.createElement(V.b,{defaultMessage:"Select a timezone",id:"datePropertyMenu.timezoneMenu.select.placeholder"})},r.createElement(j.a,{title:r.createElement(V.b,{defaultMessage:"No results",id:"datePropertyMenu.timezoneMenu.noResults"})})):r.createElement(I.a,{type:I.a.Type.Vertical,initialFocus:0,sections:[{key:"timezone section",render:e=>r.createElement(k.a,Object.assign({},e,{title:r.createElement(V.b,{defaultMessage:"Select a timezone",id:"datePropertyMenu.menuItem.select.title"})})),items:i}],onAccept:t.close}))}})}renderClearButton(){return r.createElement(O.a,{focused:!1,onClick:this.handleClearClick,title:r.createElement(V.b,{defaultMessage:"Clear",id:"datePropertyMenu.clearButton.label"})})}renderRemindersHelp(){const{device:e}=this.environment;return e.isMobile?r.createElement(N.a,{href:Object(G.a)("guides.reminders"),analyticsFrom:"date_selector"}):r.createElement(q.a,{title:r.createElement(V.b,{defaultMessage:"Learn about reminders",id:"datePropertyMenu.learnMore.helpButton.label"}),href:Object(G.a)("guides.reminders"),analyticsFrom:"date_selector"})}getDateValue(){const{value:e}=this.props;return e&&!i.isNaN(e)?e:this.openTimeFormat}getDateRangeBounds(){const e=this.getDateValue();if(s.W(e)||s.Y(e)){const t=s.K(e,s.m);return{earliestValidEnd:t.start.format(s.ib),latestValidStart:t.end.format(s.ib)}}}getDateValueForceCurrentTimeZone(){const{value:e}=this.props;return e&&!i.isNaN(e)?"datetime"===e.type||"datetimerange"===e.type?X({},e,{time_zone:s.m}):e:this.openTimeFormat}getDateDisplayFormat(){const e=this.props.dateFormat||s.v;return"relative"===e?s.v:e}getTimeFormat(){return this.props.timeFormat||s.x}getCurrentTimeZone(){const e=this.getDateValue();return"datetime"===e.type||"datetimerange"===e.type?e.time_zone:s.m}parseInputDateValue(e){const{intl:t}=this.props;return this.environment.device.isMobile?Object(F.b)(e,s.ib,t):Object(F.b)(e,this.getDateDisplayFormat(),t)}parseInputTimeValue(e){const t=Object(c.a)(e,this.getTimeFormat(),!0);return t.isValid()?t.locale(s.jb).format(s.kb):Object(F.f)(e,this.props.intl)}applyValidDateState(e){const{newDate:t,currentMonth:n,resetField:r}=e;this.props.onChangeValue(t),this.stores.store.setState(X({},this.stores.store.state,{currentMonth:n})),this.resetInputState(r)}resetInputState(e){const{state:t}=this.stores.store;this.stores.store.setState(X({},t,{error:X({},t.error,{[t.focus]:void 0}),inputTemporaryValue:X({},t.inputTemporaryValue,{[t.focus]:void 0})}))}getInputErrorMessage(e){const{intl:t}=this.props;switch(e){case g.InvalidDate:return t.formatMessage({id:"datePropertyMenu.invalidDateError.tooltip",defaultMessage:"Invalid date"});case g.InvalidRange:return t.formatMessage({id:"datePropertyMenu.invalidDateOrTimeRangeError.tooltip",defaultMessage:"Invalid range"});case g.InvalidTime:return t.formatMessage({id:"datePropertyMenu.invalidTimeError.tooltip",defaultMessage:"Invalid time"});default:return}}getInputSeparator(){return r.createElement("div",{style:{height:14,width:1,background:this.theme.regularDividerColor,marginLeft:6,marginRight:12,flexShrink:0}})}getInputWrapStyle(){return{display:"flex",alignItems:"center",borderRadius:3,height:28,lineHeight:1.2,background:this.theme.inputBackground,paddingLeft:8,paddingRight:8,flexBasis:"50%"}}getInputWrapInactiveStyle(){return X({},this.getInputWrapStyle(),{boxShadow:this.theme.inputBoxShadow,flexGrow:1})}getInputWrapErrorStyle(){return X({},this.getInputWrapStyle(),{boxShadow:"inset 0 0 0 2px ".concat(_.f.red),background:_.f.redWithAlpha(.15),flexGrow:1})}getInputWrapActiveStyle(){return X({},this.getInputWrapStyle(),{boxShadow:"inset 0 0 0 2px ".concat(_.f.blue),background:_.f.blueWithAlpha(.15),flexGrow:1})}getDayPickerActiveDayStyle(){return{backgroundColor:_.f.blue,color:_.f.white}}getDayPickerInactiveDayStyle(){return{backgroundColor:_.f.blueWithAlpha(.5)}}}J.dayPickerRangeDayStyle={backgroundColor:_.f.blueWithAlpha(.15)},J.desktopNavStyle={display:"flex",position:"absolute",top:0,right:4,zIndex:B.i},J.mobileNavStyle={display:"flex",position:"absolute",top:-2,right:4,zIndex:B.i};t.default=Object(V.h)(J)},1160:function(e,t,n){"use strict";n.r(t);n(15),n(12);var r,i=n(2),a=n(0),s=n(48),o=n(250),l=n(8),c=n(298),d=n(69),u=n(26),p=n(68),m=n(192),h=n(3),g=n(79),b=n(114),f=n(691),y=n(116),S=n(14),v=n(256),E=n(39),M=n(34),w=n(20),C=n(258),O=n(84),k=n(1),P=n(295),T=n(153),D=n(59),I=n(77),j=n(106),x=n(616);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function A(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){F(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}!function(e){e[e.Web=0]="Web",e[e.Workspace=1]="Workspace",e[e.User=2]="User"}(r||(r={}));class R extends h.a{constructor(){super(...arguments),this.copiedLink=new D.a(!1),this.showLinkOptions=new D.a(!1),this.storeTypes={buttonPopupStore:g.a},this.renderLinkOptionsButton=()=>a.createElement(I.a,{onClick:this.handleShowLinkOptionsClick,style:A({},this.getPublicAccessOptionStyle())},a.createElement(O.a,{isSmall:!0},a.createElement(k.b,{defaultMessage:"Show link options",id:"pagePermissionItem.showLinkOptions.label"}),l.a.chevronDown({width:9,height:9,marginLeft:4,display:"inline"}))),this.renderAllowEditsTooltip=()=>a.createElement(C.a,{caption:a.createElement(k.b,{defaultMessage:"Any logged in Notion user can edit this page. Share the secret link with people you trust.",id:"pagePermissionItem.allowEdits.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowEditingPng}),this.renderAllowCommentsTooltip=()=>a.createElement(C.a,{caption:a.createElement(k.b,{defaultMessage:"Any logged in Notion user can comment on this page.",id:"pagePermissionItem.allowComments.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowCommentsPng}),this.renderAllowSearchEngineTooltip=()=>a.createElement(C.a,{caption:a.createElement(k.b,{defaultMessage:"If allowed, your public page may appear in search engines such as Google, but only if you or someone else links to it elsewhere on the web.",id:"pagePermissionItem.allowSearchEngine.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowSearchEnginesPng}),this.renderAllowSearchEngineUpgradeTooltip=()=>a.createElement(C.a,{imageURL:w.a.images.tooltips.upsells.searchEngineIndexingPng,imageWidth:240,imageHeight:100,title:a.createElement(k.b,{defaultMessage:"Upgrade for search engine indexing",id:"pagePermissionItem.searchEngineUpgradeTooltip.title"}),caption:a.createElement(k.b,{defaultMessage:"Have your page appear in search engine results.",id:"pagePermissionItem.searchEngineUpgradeTooltip.caption"})}),this.renderAllowDuplicateTooltip=()=>a.createElement(C.a,{caption:a.createElement(k.b,{defaultMessage:"If allowed, this will allow other people to duplicate your public page to their workspace.",id:"pagePermissionItem.allowDuplicateTemplate.tooltip"}),imageHeight:120,imageWidth:240,imageURL:w.a.images.tooltips.share.allowDuplicatePng}),this.handleCopy=()=>{const e=Object(p.a)({store:this.props.currentBlockStore});o.c({environment:this.environment,stringValue:e}),clearTimeout(this.copiedLinkTimeout),this.copiedLink.set(!0),this.copiedLinkTimeout=window.setTimeout(()=>{this.copiedLink.set(!1)},1e3)},this.handleShowLinkOptionsClick=()=>{this.showLinkOptions.set(!0)},this.handleToggleAllowEdits=()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange(A({},e,{role:"read_and_write"===e.role?"comment_only":"read_and_write"}))},this.handleToggleAllowComments=()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange(A({},e,{role:"comment_only"===e.role||"read_and_write"===e.role?"reader":"comment_only"}))},this.handleToggleSearchEngine=()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,n=Boolean(t.allow_search_engine_indexing),r=i.clone(t),a=!n;r.allow_search_engine_indexing=a,this.props.onChange(r),S.me(this.environment,{allow_search_engine_indexing:a})}},this.handleToggleDuplicate=()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,n=void 0===t.allow_duplicate||!0===t.allow_duplicate,r=i.clone(t),a=!n;r.allow_duplicate=a,this.props.onChange(r),S.le(this.environment,{allow_duplicate:a})}},this.handleRoleSelect=e=>{const t=i.clone(this.props.permissionItem);t.role=e,this.props.onChange(t)},this.handleSwitcherButtonClick=()=>{"none"===this.role?this.handleRoleSelect(this.props.switcherRole||"editor"):this.handleRoleSelect("none")},this.handleUserItemClick=()=>{this.stores.buttonPopupStore.setState(A({},this.stores.buttonPopupStore.state,{open:!0}))}}willMount(e){super.willMount(e),s.k(e.permissionItem)&&"none"===e.permissionItem.role&&this.showLinkOptions.set(!0)}renderComponent(){const{device:e}=this.environment,{tooltip:t}=this.props,n=this.isUserItem()||!this.isPublicPermissionItem?this.handleUserItemClick:this.handleSwitcherButtonClick;return t?a.createElement(a.Fragment,null,a.createElement(E.a,{delayThreshold:0,renderTooltip:()=>t,render:t=>a.createElement(M.a,Object.assign({disabled:this.props.disabled,mobileFeedback:e.isMobile,style:A({},this.props.disabled?{cursor:"not-allowed"}:{}),onClick:n},t),this.renderMenuItem()),placement:E.a.Placement.Left}),this.renderPublicPermissionSettings()):a.createElement(a.Fragment,null,a.createElement(M.a,{disabled:this.props.disabled,style:A({},this.props.disabled?{cursor:"not-allowed"}:{}),onClick:n},this.renderMenuItem()),this.renderPublicPermissionSettings())}renderMenuItem(){const{device:e}=this.environment,{isInherited:t,permissionItem:n}=this.props,r=this.isUserItem(),i=this.isBotPermissionItem(),o=!r&&!i,l=s.m(n)||s.h(n),c=!(this.isPublicPermissionItem||l&&"none"===this.role);return a.createElement("div",{className:"notranslate",style:this.getMenuItemStyle(r)},a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,marginRight:e.isMobile?12:10}},this.props.icon),a.createElement("div",{style:{marginRight:"auto",minWidth:0}},a.createElement(O.a,{style:A({},!r&&{fontWeight:400})},this.props.title),this.props.subtitle&&a.createElement(O.a,{isSmall:!0},this.props.subtitle),t&&this.renderInheritedRecordTitle()),a.createElement("div",{style:{display:"flex",alignItems:"center",flexShrink:0,marginLeft:8}},this.isPublicPermissionItem?a.createElement(a.Fragment,null,c&&!l&&a.createElement(f.a,{role:this.role,isSpace:!1,isPublic:this.isPublicPermissionItem,disabled:this.props.disabled,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(n),isBot:i,isUser:s.n(n),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:e.isMobile||r||i?-6:8,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12}}),o&&a.createElement(v.a,{on:"none"!==this.role,onClick:this.handleSwitcherButtonClick,disabled:this.props.disabled,isAndroid:e.isAndroid})):a.createElement(f.a,{role:this.role,isPublic:this.isPublicPermissionItem,isUser:s.n(n),isGroup:s.h(n),isBot:i,disabled:this.props.disabled,isSpace:!1,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(n),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:-6,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12},showPermissionOverrideWarning:this.props.isInherited})))}getPublicPermissionSettingsHeight(e){const{device:t}=this.environment;return e?0:t.isMobile?this.showLinkOptions.get()?214:94:this.showLinkOptions.get()?184:88}renderPublicPermissionSettings(){const{device:e}=this.environment,{permissionItem:t}=this.props;if(s.k(t)){const n="none"===this.role;return a.createElement("div",{style:{maxHeight:this.getPublicPermissionSettingsHeight(n),transition:"max-height ease 200ms, padding-bottom ease 200ms",overflow:"hidden",paddingBottom:n?0:this.showLinkOptions.get()?12:8}},!e.isMobile&&this.renderPageLinkButton(),this.showLinkOptions.get()?a.createElement(a.Fragment,null,a.createElement(a.Fragment,null,a.createElement(E.a,{placement:E.a.Placement.Left,renderTooltip:this.renderAllowEditsTooltip,render:n=>a.createElement(M.a,Object.assign({onClick:this.handleToggleAllowEdits,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},n),a.createElement(O.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},a.createElement(k.b,{defaultMessage:"Allow editing",id:"pagePermissionItem.allowEdits.setting"})),a.createElement(v.a,{on:"read_and_write"===t.role,onClick:this.handleToggleAllowEdits,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),a.createElement(E.a,{placement:E.a.Placement.Left,renderTooltip:this.renderAllowCommentsTooltip,render:t=>a.createElement(M.a,Object.assign({onClick:this.handleToggleAllowComments,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},t),a.createElement(O.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},a.createElement(k.b,{defaultMessage:"Allow comments",id:"pagePermissionItem.allowComments.setting"})),a.createElement(v.a,{on:"comment_only"===this.role||"read_and_write"===this.role,onClick:this.handleToggleAllowComments,disabled:this.props.disabled,isAndroid:e.isAndroid}))})),a.createElement(E.a,{placement:E.a.Placement.Left,renderTooltip:this.renderAllowDuplicateTooltip,render:n=>a.createElement(M.a,Object.assign({onClick:this.handleToggleDuplicate,disabled:this.props.disabled,style:this.getPublicAccessOptionStyle()},n),a.createElement(O.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},a.createElement(k.b,{defaultMessage:"Allow duplicate as template",id:"pagePermissionItem.allowDuplicateTemplate.setting"})),a.createElement(v.a,{on:!1!==t.allow_duplicate,onClick:this.handleToggleDuplicate,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),a.createElement(x.a,{requireUpgradeToTier:!Object(j.J)(this.environment)&&Object(j.k)(this.environment),alwaysAllowClick:t.allow_search_engine_indexing,analyticsName:"allow_search_engine_indexing",onClick:this.handleToggleSearchEngine,onUpgradeClick:this.props.onUpgradeButtonClick,tooltipPlacement:E.a.Placement.Left,renderTooltip:this.renderAllowSearchEngineTooltip,renderUpgradeTooltip:this.renderAllowSearchEngineUpgradeTooltip,render:(n,r)=>a.createElement(M.a,Object.assign({style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},n),a.createElement(O.a,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},a.createElement(k.b,{defaultMessage:"Search engine indexing",id:"pagePermissionItem.allowSearchEngines.setting"})," ",r),a.createElement(v.a,{on:Boolean(t.allow_search_engine_indexing),onClick:this.handleToggleSearchEngine,disabled:this.props.disabled||Boolean(r),isAndroid:e.isAndroid}))})):this.renderLinkOptionsButton())}}renderPageLinkButton(){const e=Object(p.a)({store:this.props.currentBlockStore});return a.createElement("div",{style:A({},this.getPublicAccessOptionStyle(),{height:"auto"})},a.createElement("div",{style:{flex:1}},a.createElement("div",{style:{display:"flex",padding:"1px 0"}},a.createElement(T.b,{value:e,disabled:!0,style:{flex:1,borderTopRightRadius:0,borderBottomRightRadius:0,paddingRight:0}}),a.createElement(P.a,{onClick:this.handleCopy,style:{height:28,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none",minWidth:88}},this.copiedLink.get()?a.createElement(k.b,{id:"pageShareMenu.copiedLinkButton.label",defaultMessage:"✓ Copied"}):a.createElement(k.b,{id:"pageShareMenu.copyLinkButton.label",defaultMessage:"Copy link"})))))}renderInheritedRecordTitle(){const e=this.props.store,t=Object(p.a)({store:e,fullyQualified:!1});return a.createElement(O.a,{isSmall:!0,style:{lineHeight:1.4}},a.createElement(k.b,{defaultMessage:"Based on {linkBoxWithPageTitle}",description:"This text tells the user that this permission setting for the page is inherited from the parent page. ",id:"pagePermissionItem.inheritedRecordPermissions.setting",values:{linkBoxWithPageTitle:a.createElement(b.a,{underline:!0,inline:!0,href:t},a.createElement(y.a,{store:e,style:{display:"inline"}}))}}))}permissionItemIsUserItem(e){const t=this.environment.currentUser.id;return"user_permission"===e.type&&e.user_id===t}isUserItem(){return this.props.format===r.User}get role(){return this.props.permissionItem.role}get isPublicPermissionItem(){return s.k(this.props.permissionItem)}isBotPermissionItem(){return s.f(this.props.permissionItem)}getMenuItemStyle(e){const{WindowSizeStore:t}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:8,paddingBottom:8,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;let n;return n=e.isMobile?36:30,{display:"flex",alignItems:"center",width:"100%",height:n,paddingTop:5,paddingBottom:5,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionLabelStyle(e){return{marginRight:"auto",opacity:e?.6:1}}}R.Format=r,R.iconSize=32;var L=R,U=n(170),_=n(21),W=n(747),q=n(11),N=n(88),z=n(22),V=n(37),H=n(407),G=n(745),Y=n(463),Q=n(17),K=n(80),Z=n(125),X=n(33),$=n(67),J=n(161),ee=n(152),te=n(41),ne=n(193),re=n(211),ie=n(54),ae=n(83),se=n(91),oe=n(588),le=n(136),ce=n(120),de=n(24),ue=n(53),pe=n(151),me=n(108),he=n(839),ge=n(182);class be extends h.a{renderComponent(){const{device:e,WindowSizeStore:t}=this.environment;return a.createElement(ge.a,{href:Object(le.a)("guides.sharing"),onClick:()=>S.A(this.environment,{from:"sharing"}),style:{width:e.isMobile?"100%":void 0},external:!0},a.createElement(I.a,{mobileFeedback:e.isMobile,isSmall:!0,style:{display:"flex",alignItems:"center",width:e.isMobile?"100%":void 0,height:e.isMobile?44:24,paddingTop:e.isMobile?12:4,paddingBottom:e.isMobile?12:4,paddingLeft:t.getSafePaddingLeftCSS(8),paddingRight:t.getSafePaddingRightCSS(12)}},a.createElement("div",{style:{marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}},l.a.help({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:e.isMobile?this.theme.mediumIconColor:this.theme.lightIconColor})),a.createElement(O.a,{isSmall:!0,isMobile:e.isMobile,isSecondaryColor:!e.isMobile},a.createElement(k.b,{defaultMessage:"Learn about sharing",id:"blockPermissionsSettings.learnMore.prompt"}))))}}var fe=be,ye=n(500),Se=n(9),ve=n(586),Ee=n(418),Me=n(10),we=n(235);function Ce(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ce(Object(n),!0).forEach((function(t){ke(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ce(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ke(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Pe extends h.a{constructor(){super(...arguments),this.sidebarState=this.createComputedStore(()=>Object(ae.i)(this.environment)),this.storeTypes={showAncestors:D.a.of(!1),showShowAncestors:D.a.of(!0),restrictConfirmationModalStore:D.a.of({open:!1,onClose:void 0})},this.renderBotPermissionTooltip=()=>a.createElement(C.a,{imageWidth:240,caption:a.createElement(k.b,{defaultMessage:"This is a bot inside your workspace.",id:"blockPermissionsSettings.botPermission.tooltip"})}),this.renderPublicPermissionTooltip=()=>a.createElement(C.a,{imageURL:w.a.images.tooltips.share.publicPagePng,imageWidth:240,imageHeight:120,caption:a.createElement(k.b,{defaultMessage:"Anybody with the link can access the page.",id:"blockPermissionsSettings.publicPermission.tooltip"})}),this.renderSpacePermissionTooltip=()=>a.createElement(C.a,{imageURL:w.a.images.tooltips.share.workspacePng,imageWidth:240,imageHeight:180,caption:a.createElement(k.b,{defaultMessage:"For all members in your workspace, this page will show up in the <boldtext>Workspace</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.createElement("span",{style:{fontWeight:z.a.fontWeight.bold}},t)}},id:"blockPermissionsSettings.spacePermission.tooltip"})}),this.renderGroupPermissionTooltip=e=>{const{currentSpaceStore:t}=Q.a.state,{countRemainingUsers:n,limitedUserValues:r}=G.b({group:e,spaceStore:t,limit:15});if(r.length>0)return a.createElement("div",{style:{marginBottom:4}},r.map(e=>a.createElement("div",{key:e.id,style:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4}},a.createElement(ye.a,{style:{flexGrow:1},userValue:e,avatarSize:18}))),n>0&&a.createElement("div",{style:{marginLeft:2,marginTop:2,color:this.theme.mediumInvertedTextColor}},a.createElement(k.b,{id:"blockPermissionsSettings.groupPermissionUsers.tooltip",defaultMessage:"{countRemainingUsers} more…",values:{countRemainingUsers:n}})));const i=Object(G.a)({intl:this.props.intl,group:e});return a.createElement(C.a,{imageURL:w.a.images.tooltips.share.sharedPng,imageWidth:240,imageHeight:120,caption:a.createElement(k.b,{defaultMessage:"For all members of the {groupName} group, this page will show up in the <boldtext>Shared</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.createElement("span",{style:{fontWeight:z.a.fontWeight.bold}},t)},groupName:i},id:"blockPermissionsSettings.groupPermission.tooltip"})})},this.renderUserPermissionItem=e=>{const{store:t}=this.props,n=u.a.createChildStore(t,{table:Me.b,id:e.blockId}),r=m.a.createChildStore(t,{table:V.a,id:e.permissionItem.user_id}).getValue(),i=n.id!==t.id,o=e=>a.createElement("div",{style:Oe({},e.style,{background:this.theme.lightDividerColor})}),c=r?a.createElement(re.a,{userValue:r,size:L.iconSize}):a.createElement(o,{style:{height:L.iconSize,width:L.iconSize,borderRadius:20}}),{data:d}=Z.a.state,p=(d?j.u(d):[]).find(t=>t.userId===e.permissionItem.user_id),h=Boolean(p&&!s.a(p.role)&&!s.c(p.role)),g=r&&r.email?h?a.createElement("div",{style:z.a.textOverflowStyle},l.a.globe2({width:14,fill:"#CF8807",display:"inline",verticalAlign:"middle"})," ",a.createElement("span",{style:{color:"#CF8807",fontWeight:500}},a.createElement(k.b,{defaultMessage:"Guest",id:"blockPermissionsSettings.permissionsForUserGuest.label"}))," • ",r.email):r.email:void 0;return a.createElement("div",{key:e.permissionItem.user_id},a.createElement(L,{format:L.Format.User,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:c,title:r?Object(V.d)(r)||a.createElement(k.b,{defaultMessage:"Invitation sent",id:"blockPermissionsSettings.sentInvitation.message"}):a.createElement(o,{style:{height:8,width:81,borderRadius:3}}),subtitle:r?g:a.createElement(o,{style:{height:8,width:139,borderRadius:3,marginTop:10}}),isSubscribed:this.isSubscribed(),isInherited:i,tooltip:i?this.renderInheritedPermissionTooltip(n):void 0,upgradeButtonName:"user_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:i,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))},this.renderBotPermissionItem=e=>{const{store:t}=this.props,n=u.a.createChildStore(t,{table:Me.b,id:e.blockId}),r=Object(te.c)(t,{table:ne.a,id:e.permissionItem.bot_id}),i=r.getValue(),s=n.id!==t.id,o=i&&i.name||a.createElement(k.b,{id:"blockPermissionsSetings.untitledBotPlaceholder",defaultMessage:"Untitled Bot"}),c=a.createElement("div",{style:z.a.textOverflowStyle},l.a.bot({width:12,display:"inline",verticalAlign:"middle"})," ",a.createElement(k.b,{defaultMessage:"Bot",id:"blockPermissionsSettings.permissionsForBot.label",description:"Inform user that this page is shared with a bot."})),d=a.createElement(Ee.a,{botValue:i,size:L.iconSize});return a.createElement("div",{key:r.id,style:this.getPermissionItemWrapStyle()},a.createElement(L,{format:L.Format.Workspace,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:d,title:o,tooltip:s?this.renderInheritedPermissionTooltip(n):this.renderBotPermissionTooltip(),subtitle:c,isSubscribed:this.isSubscribed(),isInherited:s,upgradeButtonName:"bot_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:s,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))},this.handleCopy=()=>{const e=Object(p.a)({store:this.props.store});o.c({environment:this.environment,stringValue:e}),this.props.buttonPopupStore.setState({open:!1})},this.handleReactNativeShareClick=()=>{const{reactNative:e}=this.environment,t=Y.a({schemeUrl:window.location.href,baseUrl:X.a.baseURL});e&&e.share(t)},this.handleCloseRestrictConfirmationModal=()=>{this.stores.restrictConfirmationModalStore.setState({open:!1,onClose:void 0})},this.handlePermissionItemChange=async e=>{const{isInherited:t,oldPermissionItem:n,newPermissionItem:r}=e;if(!Object(ee.l)(n,r))throw new Error("Permission type mismatch.");const i=Object(ee.e)(n.role,r.role);if(t&&i!==r.role)return void this.handleRestrictPermission(r);const o=this.props.store.isTopLevel();if(o&&s.m(r)){const{data:e}=Z.a.state,t=e?j.t(e):1;if(s.d(n.role)&&!s.d(r.role)&&t>1){if(!(await ie.a({message:a.createElement("span",null,a.createElement(k.b,{defaultMessage:"Are you sure you want to make this page private? <semibold>Only you will be able to access it.</semibold>",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.createElement("span",{style:{fontWeight:z.a.fontWeight.semibold}},t)}},id:"blockPermissionsSettings.confirmationDialog.private.message"})),acceptLabel:a.createElement(k.b,{defaultMessage:"Move to Private",id:"blockPermissionsSettings.confirmationDialog.privateButton.label"})})))return}else if(o&&!s.d(n.role)&&s.d(r.role)){if(!(await ie.a({message:a.createElement("span",null,a.createElement(k.b,{defaultMessage:"Are you sure you want to share this page with the workspace? <semibold>It will be accessible by all {memberCount} members.</semibold>",id:"blockPermissionsSettings.confirmationDialog.workspace.message",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return a.createElement("span",{style:{fontWeight:z.a.fontWeight.semibold}},t)},memberCount:t}})),acceptLabel:a.createElement(k.b,{defaultMessage:"Move to workspace",id:"blockPermissionsSettings.confirmationDialog.workspaceButton.label"})})))return}}!o&&n.role!==r.role&&i!==n.role&&S.ye(this.environment),q.d(this.environment,async e=>{c.f({environment:this.environment,store:this.props.store,permissionItems:[r],transaction:e})})},this.handleRestrictPermission=e=>{const t=()=>{q.d(this.environment,async t=>{await c.e({environment:this.environment,store:this.props.store,permissionItem:e,transaction:t})})};"none"===e.role?this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"remove",permissionItem:e,onAccept:t}):this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"restrict",onAccept:t})}}renderComponent(){return this.props.DEV_ONLY_isAncestor?this.renderPermissions():this.renderMenu()}renderMenu(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:_.b.MenuType.Modal,title:a.createElement(k.b,{defaultMessage:"Share",id:"blockPermissionsSettings.mobileShareMenu.title"}),left:this.renderMobileHelpButton(),right:a.createElement(se.DoneMenuText,null),onClickRight:this.props.onClose}:{menuType:_.b.MenuType.Popup},a.createElement(a.Fragment,null,a.createElement(he.a,Object.assign({},this.stores.restrictConfirmationModalStore.state)),a.createElement(_.b,Object.assign({},t,{className:$.db}),a.createElement(H.a,{capture:!0,allowEsc:!0},a.createElement(W.a,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!1,focusOffscreenInput:!1,render:()=>K.a.state.online?this.stores.showAncestors.state?this.renderAncestors():this.renderPermissions():this.renderOfflineMessage()}))))}renderAncestors(){const e=d.c(this.props.store).reverse().map((e,t)=>{const n=e.getIcon();return a.createElement(de.a,{key:e.id,topBorder:t>0,title:a.createElement("span",null,a.createElement(N.a,{disabled:!0,icon:n,isEmptyPage:e.isEmptyPage(),size:14,style:{marginRight:4,display:"inline-block"}}),a.createElement(y.a,{store:e,style:{display:"inline"}}))},a.createElement(Pe,{store:e,intl:this.props.intl,buttonPopupStore:this.props.buttonPopupStore,DEV_ONLY_isAncestor:!0}))});return a.createElement(a.Fragment,null,e,this.renderAncestorSwitch())}renderMobileHelpButton(){return a.createElement(oe.a,{href:Object(le.a)("guides.sharing"),analyticsFrom:"sharing"})}renderOfflineMessage(){const{device:e}=this.environment;return a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:160}},a.createElement(O.a,{isMobile:e.isMobile,isSecondaryColor:!0,isMultiline:!0,style:{textAlign:"center"}},a.createElement(k.b,{defaultMessage:"Please go online to publish & share.",id:"blockPermissionsSettings.offline.prompt"})))}renderPermissions(){const{device:e,WindowSizeStore:t}=this.environment,{currentSpaceStore:n}=Q.a.state,{store:r}=this.props,o=Object(J.b)(r);let c=[];if(n){const e=n.getValue();e&&e.permission_groups&&(c=e.permission_groups)}let d={permissionItem:{type:"public_permission",role:"none"},blockId:r.id},u={permissionItem:{type:"space_permission",role:"none"},blockId:r.id};for(const i of o)if(s.k(i.permissionItem)){d=i}else if(s.m(i.permissionItem)){u=i}let p=o.filter(e=>{let{permissionItem:t}=e;return s.h(t)});p=i.sortBy(p,e=>{if(n){const t=n.getValue();if(t&&t.permission_groups)return t.permission_groups.findIndex(t=>t.id===e.permissionItem.group_id)}return e.permissionItem.group_id});const m=o.filter(e=>{let{permissionItem:t}=e;return s.n(t)}),h=o.filter(e=>{let{permissionItem:t}=e;return s.f(t)}),g={};let b=U.b.OverflowType.Y;e.isMobile?(g.backgroundColor=this.theme.contentBackground,b=U.b.OverflowType.None):g.maxHeight="calc(70vh - 80px)";const f=n&&!n.getDisablePublicAccess(),y=this.sidebarState.state,S=y&&y.showWorkspaceSection||n&&"team"===n.getPlanType(),v=S||m.length>1||m.length&&!s.a(m[0].permissionItem.role)||p.length||s.d(u.permissionItem.role),M=o.some(e=>s.l(e.permissionItem)&&e.blockId===r.id);return a.createElement("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column"}},e.isMobile&&a.createElement(a.Fragment,null,M&&this.renderRestrictedPermissionBanner(),a.createElement("div",{style:{display:"flex",paddingTop:10,paddingBottom:10,paddingRight:t.getSafePaddingRightCSS(14),background:this.theme.sidebarBackground}},this.renderPageLinkButton()),a.createElement("div",{style:{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)}})),a.createElement(U.b,{style:g,type:b},!e.isMobile&&M&&this.renderRestrictedPermissionBanner(),f&&this.renderPublicPermissionItem(d),this.renderAddGuests(),S&&this.renderSpacePermissionItem(u),a.createElement("div",{style:this.getPermissionItemWrapStyle()},this.renderGroupPermissions({spacePermissionGroups:c,mostPermissiveGroupPermissions:p}),v&&a.createElement("div",{style:{paddingBottom:m.length>0?8:void 0}},m.map(this.renderUserPermissionItem))),h.map(this.renderBotPermissionItem)),a.createElement("div",{style:Oe({display:"flex",alignItems:e.isMobile?"flex-start":"center",boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor),paddingLeft:t.getSafePaddingRightCSS(8),paddingRight:t.getSafePaddingRightCSS(8),flexDirection:"column-reverse"},!e.isMobile&&{flexDirection:"row",justifyContent:"space-between",padding:"4px 4px"})},!e.isMobile&&a.createElement(a.Fragment,null,a.createElement(fe,null),a.createElement(E.a,{delayThreshold:0,placement:E.a.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>a.createElement(I.a,Object.assign({isSmall:!0,onClick:e.isReactNative?this.handleReactNativeShareClick:this.handleCopy,mobileFeedback:e.isMobile,style:{height:e.isMobile?44:24,width:e.isMobile?"100%":void 0,paddingLeft:8,paddingRight:8,color:this.theme.regularTextColor}},t),l.a.link({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:this.theme.regularIconColor,marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}),a.createElement(O.a,{isSmall:!0,isMobile:e.isMobile,style:{color:this.theme.regularTextColor}},a.createElement(k.b,{id:"blockPermissionsSettings.copyLinkButton.label",defaultMessage:"Copy link"})))}))),this.renderAncestorSwitch())}renderAncestorSwitch(){if("on"!==me.a.getGroup(this.environment,"sharing-show-ancestors"))return;if(this.props.DEV_ONLY_isAncestor)return;if(!this.stores.showShowAncestors.state)return;const{device:e}=this.environment,t=this.stores.showAncestors.state,n=()=>{this.stores.showAncestors.setState(!t)};return a.createElement(de.a,{topBorder:!0},a.createElement(ue.a,{focused:!1,desktopTitleStyle:{marginLeft:0},title:a.createElement(O.a,{isSmall:!0,isMobile:e.isMobile,isSecondaryColor:!e.isMobile},a.createElement(k.b,{id:"pageShareMenu.showAncestors.label",defaultMessage:"Show all ancestors (development only)",description:"This feature is for internal developer use."})),onClick:n,icon:a.createElement(pe.a,{icon:l.a.closeSmall,onClick:()=>{this.stores.showAncestors.setState(!1),this.stores.showShowAncestors.setState(!1)},style:{marginLeft:-6}}),right:a.createElement(v.a,{on:t,onClick:n})}))}renderInviteButton(){const{currentSpaceStore:e}=Q.a.state,{device:t}=this.environment,{store:n}=this.props;return a.createElement(we.h,{store:n,disabled:!this.canEdit(),membersOnly:Boolean(e&&e.getDisableGuests()),isSpace:!1,isSubscribed:this.isSubscribed(),onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:"invite_permission_block",shouldGrow:!0,buttonStyle:{height:t.isMobile?36:28}})}renderPageLinkButton(){const{device:e}=this.environment;return a.createElement(E.a,{delayThreshold:0,placement:E.a.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>a.createElement(P.a,Object.assign({isLarge:!0,onClick:e.isReactNative?this.handleReactNativeShareClick:this.handleCopy,style:{marginLeft:12,flex:1,height:this.environment.device.isMobile?36:void 0,background:this.theme.contentBackground}},t),e.isReactNative?a.createElement(k.b,{id:"pageShareMenu.sharePageLinkButton.label",defaultMessage:"Share page link"}):a.createElement(k.b,{id:"pageShareMenu.copyPageLinkButton.label",defaultMessage:"Copy page link"}))})}renderRestrictedPermissionBanner(){const{device:e}=this.environment,{store:t}=this.props,n=d.b(t,1),r=Se.Db([Se.l,Se.b([Se.yb,Se.Cb(Se.l)])])({environment:this.environment,blocks:[t]});if(n&&n.canRead())return a.createElement("div",null,a.createElement("div",{style:Oe({},this.getPermissionItemWrapStyle(),{},this.getMenuItemStyle(),{backgroundColor:e.isMobile?this.theme.darkBannerBackground:this.theme.sidebarSecondaryBackground,flexDirection:e.isMobile?"column":"row",alignItems:e.isMobile?"flex-start":"center",paddingTop:e.isMobile?14:10})},a.createElement("div",{style:{display:"flex",alignItems:"flex-start",marginRight:e.isMobile?void 0:6}},l.a.eyeHide({width:e.isMobile?20:16,marginTop:e.isMobile?3:2,marginRight:e.isMobile?10:8,marginLeft:e.isMobile?2:0,fill:this.theme.regularIconColor}),a.createElement(O.a,{isMultiline:!0,isMobile:e.isMobile,isSmall:!0,style:{color:this.theme.regularTextColor}},a.createElement(k.b,{id:"pageShareMenu.restrictedAccessBanner.label",defaultMessage:"Access restricted. May not be shared with everyone from {linkBoxWithPageTitle}.",description:"This text tells the user that this permission setting for the page is NOT inherited from the parent page.",values:{linkBoxWithPageTitle:a.createElement(b.a,{style:{color:this.theme.mediumTextColor},underline:!0,inline:!0,href:Object(p.a)({store:n,fullyQualified:!1})},a.createElement(y.a,{shouldWrap:!0,maxLength:30,store:n,style:{display:"inline"}}))}}))),r&&a.createElement(I.a,{isSmall:!e.isMobile||void 0,style:{fontSize:e.isMobile?14:12,marginTop:e.isMobile?2:void 0,marginLeft:e.isMobile?24:void 0,fontWeight:e.isMobile?z.a.fontWeight.medium:void 0},onClick:()=>{const e=t.getPermissionItems(),n=d.e(t),r=n?Object(ee.c)(d.g(n)):[],i=Object(ee.g)(e,r);this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"restore",permissionChanges:i,onAccept:()=>{t.getPermissionsStore().canAdmin()?q.d(this.environment,async e=>{await c.d({environment:this.environment,store:t,transaction:e})}):c.a({environment:this.environment,store:t})}})}},a.createElement(k.b,{id:"pageShareMenu.restrictedAccessBanner.restore",defaultMessage:"Restore",description:"Action for when user wants to remove restricted access to a page."}))),e.isMobile?a.createElement(ve.a,{size:1,style:{opacity:"75%"}}):void 0)}renderPublicPermissionItem(e){const{store:t}=this.props,n=u.a.createChildStore(t,{table:Me.b,id:e.blockId}),r=n.id!==t.id;return a.createElement("div",{style:this.getPermissionItemWrapStyle(),className:$.f},a.createElement(L,{format:L.Format.Web,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:l.a.globe({width:26,height:26,fill:this.theme.lightIconColor}),title:a.createElement(k.b,{defaultMessage:"Share to web",id:"blockPermissionsSettings.permissionItem.linkSharing"}),subtitle:s.c(e.permissionItem.role)?a.createElement(k.b,{defaultMessage:"Anyone with the link can edit and comment",id:"blockPermissionsSettings.publicPermission.canEdit"}):s.b(e.permissionItem.role)?a.createElement(k.b,{defaultMessage:"Anyone with the link can comment",id:"blockPermissionsSettings.publicPermission.canComment"}):s.d(e.permissionItem.role)?a.createElement(k.b,{defaultMessage:"Anyone with the link can view",id:"blockPermissionsSettings.publicPermission.canRead"}):a.createElement(k.b,{defaultMessage:"Publish and share link with anyone",id:"blockPermissionsSettings.publicPermission.none"}),tooltip:r?this.renderInheritedPermissionTooltip(n):this.renderPublicPermissionTooltip(),isSubscribed:this.isSubscribed(),isInherited:r,upgradeButtonName:"public_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,switcherRole:"reader",onChange:async t=>{await this.handlePermissionItemChange({isInherited:r,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderSpacePermissionItem(e){const{store:t}=this.props,n=u.a.createChildStore(t,{table:Me.b,id:e.blockId}),r=d.h(t)||Q.a.state.currentSpaceStore;if(!r||!r.getValue())return;const i=Object(ce.getSpacePermissionItems)(r).filter(e=>s.c(s.e(e))),o=n.id!==t.id;return a.createElement("div",{style:{width:"100%"},className:$.g},a.createElement(L,{format:L.Format.Workspace,currentBlockStore:t,store:n,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:this.renderSpaceIcon(),title:a.createElement(k.b,{defaultMessage:"Everyone at {workspaceName}",id:"blockPermissionsSettings.permissionItem.workspaceAccessNew",values:{workspaceName:Object(ce.getSpaceName)(this.environment,r)}}),tooltip:o?this.renderInheritedPermissionTooltip(n):this.renderSpacePermissionTooltip(),subtitle:a.createElement(k.b,{defaultMessage:"{numberOfWorkspaceMembers, plural, one {{numberOfWorkspaceMembers} workspace member} other {{numberOfWorkspaceMembers} workspace members}}",id:"blockPermissionsSettings.spacePermission.none",values:{numberOfWorkspaceMembers:i.length}}),isSubscribed:this.isSubscribed(),isInherited:o,upgradeButtonName:"space_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:o,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderInheritedPermissionTooltip(e){const t=e.getIcon();return a.createElement("div",{style:{whiteSpace:"normal",width:180}},a.createElement(k.b,{defaultMessage:"This access is based on {inlineIconAndName}. Changing this access will restrict permissions of this page.",id:"blockPermissionsSettings.restrictedPermissions.tooltip",values:{inlineIconAndName:a.createElement("span",{style:{whiteSpace:"nowrap",fontWeight:z.a.fontWeight.bold}},t&&a.createElement(N.a,{disabled:!0,icon:t,isEmptyPage:!1,size:12,style:{marginRight:4,display:"inline-block"}}),a.createElement(y.a,{store:e,style:{display:"inline"}}))}}))}renderSpaceIcon(){const{currentSpaceStore:e}=Q.a.state;return e?a.createElement(N.a,{disabled:!0,title:Object(ce.getSpaceName)(this.environment,e),icon:Object(ce.getSpaceIcon)(this.environment,e),isEmptyPage:!1,size:L.iconSize}):l.a.team()}renderGroupPermissions(e){const{currentSpaceStore:t}=Q.a.state,{spacePermissionGroups:n,mostPermissiveGroupPermissions:r}=e;return r.map(e=>{const r=e.permissionItem.group_id,i=n.find(e=>e.id===r);if(i&&t)return this.renderGroupPermissionItem(e,i,t.id)})}renderGroupPermissionItem(e,t,n){const{store:r,intl:i}=this.props,s=u.a.createChildStore(r,{table:Me.b,id:e.blockId}),o=t.user_ids||[],l=Object(G.a)({intl:i,group:t}),c=s.id!==r.id,d=a.createElement(N.a,{disabled:!0,title:l,icon:t.icon?{table:"space",id:n,icon:t.icon}:void 0,isEmptyPage:!1,size:L.iconSize});return a.createElement("div",{key:t.id,style:{fontWeight:400},className:$.e},a.createElement(L,{format:L.Format.Workspace,currentBlockStore:r,store:s,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:d,title:l,tooltip:c?this.renderInheritedPermissionTooltip(s):this.renderGroupPermissionTooltip(t),subtitle:a.createElement(k.b,{defaultMessage:"{numberOfGroupMembers, plural, one {{numberOfGroupMembers} group member} other {{numberOfGroupMembers} group members}}",id:"blockPermissionsSettings.groupPermission.none",values:{numberOfGroupMembers:o.length}}),isSubscribed:this.isSubscribed(),isInherited:c,upgradeButtonName:"group_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:c,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderAddGuests(){const{device:e}=this.environment,{WindowSizeStore:t}=this.environment;return a.createElement(M.a,{mobileFeedback:e.isMobile,disabled:!0},a.createElement("div",{style:Oe({},this.getMenuItemStyle(),{paddingTop:e.isMobile?12:10,paddingBottom:e.isMobile?12:10,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)})},a.createElement("div",{style:{width:"100%"}},this.renderInviteButton())))}getPermissionItemWrapStyle(){return{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),width:"100%"}}getMenuItemStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:10,paddingBottom:10,paddingLeft:e.getSafePaddingLeftCSS(16),paddingRight:e.getSafePaddingRightCSS(12)}}isSubscribed(){const{data:e}=Z.a.state;return Boolean(e&&j.z(e))}canEdit(){return s.a(this.props.store.getRole()||"editor")}getPageLinkInfoTooltip(){const e=Object(J.b)(this.props.store).map(e=>{let{permissionItem:t}=e;return t}),t=e.find(e=>"public_permission"===e.type),n=e.find(e=>"space_permission"===e.type),r=e.filter(e=>"user_permission"===e.type);return t?a.createElement("div",null,a.createElement(k.b,{defaultMessage:"This page has public link access, so anyone{br}with the link will be able to view the page.",id:"blockPermissionsSettings.publicLinkInfo.tooltip",values:{br:a.createElement("br",null)}})):n?a.createElement("div",null,a.createElement(k.b,{defaultMessage:"This page has workspace access, so anyone{br}in the workspace will be able to view the link.",id:"blockPermissionsSettings.workspacePermissions.tooltip",values:{br:a.createElement("br",null)}})):r.length>1?a.createElement("div",null,a.createElement(k.b,{defaultMessage:"Only you and other invited members{br}and guests will be able to view the link.",id:"blockPermissionsSettings.userPermissions.tooltip",values:{br:a.createElement("br",null)}})):a.createElement("div",null,a.createElement(k.b,{defaultMessage:"Only you can access this page,{br}so the link will only work for you.",id:"blockPermissionsSettings.privatePermissions.tooltip",values:{br:a.createElement("br",null)}}))}}t.default=Object(k.h)(Pe)},1291:function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return c}));n(15),n(12);var r=n(247),i=n(16);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const l=20;var c;!function(e){e.Default="Default",e.Results="Results"}(c||(c={}));class d extends i.a{constructor(){super(...arguments),this.resetQuery=e=>{let{resetFilters:t}=e;this.setState(s({},this.state,{mode:c.Default,query:s({},this.state.query,{text:""},t&&{filters:Object(r.e)()}),limit:l,allResultsLoaded:!1}))},this.updateFilters=e=>{const t=this.state.query.filters,n=Object(r.f)(t,e);this.state.mode,c.Default,this.setState(s({},this.state,{query:s({},this.state.query,{filters:n})}))}}getInitialState(){return{mode:c.Default,isSidebarOpen:!1,query:{text:"",filters:Object(r.e)(),sort:"Relevance"},limit:l,allResultsLoaded:!1}}isSidebarOpen(){if(this.state.isSidebarOpen){const{state:e}=this;return!0}return!1}}d.Mode=c,t.c=d},1395:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return l}));n(15),n(12);var r=n(74),i=n(1477);function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const o=function(e){const t=r.c();return i.a.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e,{open:!0,onComplete:t.resolve,inputValue:""})),t.promise},l=function(e){const t=i.a.state;t.open&&(t.onComplete(e.didConfirm),i.a.reset())}},1397:function(e,t,n){"use strict";var r=n(79);t.a=new r.a},1398:function(e,t,n){"use strict";var r=n(79);t.a=new r.a},1399:function(e,t,n){"use strict";var r=n(79);t.a=new r.a},1401:function(e,t,n){"use strict";n(15),n(12);var r=n(0),i=n(3),a=n(1),s=n(8),o=n(22),l=n(39),c=n(752),d=n(296),u=n(719),p=n(106),m=n(19),h=n(762),g=n(33);function b(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?b(Object(n),!0).forEach((function(t){y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class S extends i.a{renderComponent(){return r.createElement(r.Fragment,null,s.a.notionLogoStroked({width:34,height:34,marginBottom:18}),r.createElement("div",{style:f({},this.getPrimaryTextStyle(),{marginBottom:6})},this.getPlanTitle()),r.createElement("div",{style:this.getSecondaryTextStyle()},this.getOneLiner()),this.renderPriceAndTerms(),this.renderBlockLimit(),this.renderPlanFeatures(),this.renderLearnMore())}renderBlockLimit(){const{planInfo:e}=this.props;if("team_free"===e.subscriptionTier)return r.createElement(r.Fragment,null,r.createElement("div",{style:{fontWeight:o.a.fontWeight.semibold,fontSize:24}},r.createElement(a.b,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.title",defaultMessage:"Free"})),r.createElement("div",{style:this.getSecondaryTextStyle()},r.createElement(a.b,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.description",defaultMessage:"For the first 1,000 blocks"}),r.createElement(l.a,{renderTooltip:()=>r.createElement(a.b,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.tooltip",defaultMessage:"Blocks are pieces of content you add to a page, like a paragraph or to-do item.{br}Some features on the Team Plan are not available on the Team Trial.",values:{br:r.createElement("br",null)}}),placement:l.a.Placement.Top,render:e=>r.createElement("span",Object.assign({},e),s.a.help({marginLeft:6,width:14,fill:m.f.mediumIconColor,verticalAlign:"middle",display:"inline-block"}))})))}renderPriceAndTerms(){const{planInfo:e,intl:t}=this.props;if("team_free"!==e.subscriptionTier)return r.createElement(r.Fragment,null,r.createElement("div",{style:this.getPrimaryTextStyle()},r.createElement(a.b,{id:"subscriptionUpgradeDetails.price",defaultMessage:"{price}",description:"Price is already formatted, e.g. $10",values:{price:Object(p.j)({subscriptionTier:e.subscriptionTier,billingInterval:e.billingInterval,intl:t})}})),r.createElement("div",{style:this.getSecondaryTextStyle()},this.getFormattedTerm()))}getFormattedTerm(){const{planInfo:e,intl:t}=this.props,n=Object(u.d)(g.a,t),i={personal:n.terms.pro,team:n.terms.team,enterprise:n.terms.enterprise}[e.subscriptionTier];return{per_month:r.createElement(a.b,{id:"subscriptionUpgradeDetails.perMonthPricing.label",defaultMessage:"per month",description:"Appears after the price per month for a given plan, e.g. $10 per month"}),per_member_per_month:r.createElement(a.b,{id:"subscriptionUpgradeDetails.perUserPerMonthPricing.label",defaultMessage:"per member, per month",description:"Appears after the price per member, per month for a given plan, e.g. $10 per member, per month"})}[i]}renderPlanFeatures(){var e=this;const{planInfo:t}=this.props;return r.createElement(r.Fragment,null,r.createElement(l.a,{delayThreshold:0,placement:l.a.Placement.Left,renderTooltip:()=>this.renderPreviousPlanTierFeatures(),render:t=>r.createElement("span",Object.assign({},t,{style:{cursor:"help",fontSize:14}}),r.createElement(a.b,{id:"subscriptionUpgradeDetails.features",defaultMessage:"<span>Everything in {planName},</span> plus:",description:"Shown when comparing plan tier features in upgrade modal; 'planName' will be Personal, Team Trial, or Team",values:{span:function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.createElement("span",{style:{paddingBottom:1,borderBottom:"1px dotted ".concat(e.theme.lightTextColor)}},n)},planName:this.getPreviousPlanName()}}))}),this.getFeaturesByPlanKey(t.subscriptionTier).map((e,n)=>r.createElement("div",{key:"".concat(t.subscriptionTier,"-feature-").concat(n),style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},s.a.thinCheck({width:14,height:14,marginRight:5,color:this.theme.lightTextColor}),e.label,e.isComingSoon&&r.createElement("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap"}},u.b))))}renderPreviousPlanTierFeatures(){const e=this.getTierBelowKey();return this.getFeaturesByPlanKey(e).map((t,n)=>r.createElement("div",{key:"".concat(e,"-feature-").concat(n),style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},s.a.thinCheck({width:14,height:14,marginRight:5,color:this.theme.regularInvertedTextColor}),t.label))}renderLearnMore(){return r.createElement("div",{style:{fontWeight:o.a.fontWeight.regular,fontSize:14,marginBottom:16,color:this.theme.mediumTextColor,textDecoration:"underline",marginTop:8,cursor:"pointer"},onClick:()=>{c.a.reset(),h.a.reset(),d.a.setState({open:!0,currentTab:"plans"})}},r.createElement(a.b,{id:"subscriptionUpgradeDetails.learnMore",defaultMessage:"Learn more"}))}getPlanTitle(){const{planInfo:e}=this.props;return{personal:r.createElement(a.b,{id:"subscriptionUpgradeDetails.title.personal",defaultMessage:"Upgrade to Personal Pro"}),team:r.createElement(a.b,{id:"subscriptionUpgradeDetails.title.team",defaultMessage:"Upgrade to Team"}),enterprise:r.createElement(a.b,{id:"subscriptionUpgradeDetails.title.enterprise",defaultMessage:"Upgrade to Enterprise"}),team_free:r.createElement(a.b,{id:"subscriptionUpgradeDetails.title.teamFree",defaultMessage:"Upgrade to Team Trial"})}[e.subscriptionTier]}getOneLiner(){const{planInfo:e}=this.props;switch(e.subscriptionTier){case"personal":return r.createElement(a.b,{id:"subscriptionUpgradeDetails.oneLiner.personal",defaultMessage:"For power users who want to do even more."});case"team":case"team_free":return r.createElement(a.b,{id:"subscriptionUpgradeDetails.oneLiner.team",defaultMessage:"For teams to write, plan, and work together in one spot."});case"enterprise":return r.createElement(a.b,{id:"subscriptionUpgradeDetails.oneLiner.enterprise",defaultMessage:"Controls and support to run your company."})}}getPreviousPlanName(){return{personal:r.createElement(a.b,{id:"subscriptionUpgradeDetails.planName.personal",defaultMessage:"Pro"}),personal_free:r.createElement(a.b,{id:"subscriptionUpgradeDetails.planName.free",defaultMessage:"Personal"}),team_free:r.createElement(a.b,{id:"subscriptionUpgradeDetails.planName.teamTrial",defaultMessage:"Team Trial"}),team:r.createElement(a.b,{id:"subscriptionUpgradeDetails.planName.team",defaultMessage:"Team"})}[this.getTierBelowKey()]}getTierBelowKey(){const{planInfo:e}=this.props;return{personal:"personal_free",team:"team_free",team_free:"personal",enterprise:"team"}[e.subscriptionTier]}getFeaturesByPlanKey(e){return{personal_free:[u.a.unlimitedBlocks,u.a.shareWithLimitedGuests,u.a.syncAcrossDevices],personal:[u.a.unlimitedFileUploads,u.a.unlimitedGuests,u.a.versionHistory,u.a.contentApi],team_free:[u.a.unlimitedTeamMembers,u.a.collaborativeWorkspace,u.a.adminTools],team:[u.a.unlimitedBlocks,u.a.unlimitedFileUploads,u.a.versionHistory,u.a.advancedPermissions],enterprise:[u.a.sso,u.a.scimApi,u.a.advancedSecurity,u.a.dedicatedManager,u.a.customContract]}[e]}getPrimaryTextStyle(){return{fontWeight:o.a.fontWeight.bold,fontSize:22,lineHeight:1.1,marginBottom:2}}getSecondaryTextStyle(){return{fontWeight:o.a.fontWeight.regular,fontSize:14,lineHeight:1.4,marginBottom:22,color:this.theme.mediumTextColor}}}t.a=Object(a.h)(S)},1477:function(e,t,n){"use strict";var r=n(16);class i extends r.a{getInitialState(){return{open:!1}}}t.a=new i},1481:function(e,t,n){"use strict";var r=n(0),i=n(3),a=n(1195),s=n(84),o=n(1);class l extends i.a{renderComponent(){return r.createElement(a.a,null,r.createElement(s.a,{isSmall:!0,style:{textAlign:"center"}},r.createElement(o.b,{id:"spaceSubscriptionPlans.offlineMessage",defaultMessage:"Please go online to manage your plan."})))}}t.a=l},1482:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(40),i=n(491),a=n(64),s=n(173),o=n(33),l=n(347),c=n(111),d=n(54),u=n(14),p=n(1397),m=n(486),h=n(1);const g=Object(h.g)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,h=Object(l.b)(t);let b=Object(s.d)(o.a.baseURL,{authType:h,userId:t.currentUser.id});b=h.redirectToAuth?b:await Object(l.c)(t,b);const f=await i.a(t,{width:580,height:700,url:b,titleMessage:g.titleMessage});if(!f)return;const y=a.d(f),S=y.query.oauth_token,v=y.query.oauth_verifier;if(!S||!v)return;c.b({message:g.authenticatingWithEvernote});const E=await r.f(t,{requestToken:S,verifier:v});if("failed"===E.type)return console.error(E.error),d.d(E),void c.a();u.n(t,{name:"evernote"}),await n.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a()}},1483:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(40),i=n(491),a=n(64),s=n(173),o=n(33),l=n(347),c=n(111),d=n(54),u=n(14),p=n(1398),m=n(486),h=n(1);const g=Object(h.g)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,h=Object(l.b)(t);let b=Object(s.c)(o.a.baseURL,{authType:h,userId:t.currentUser.id});b=h.redirectToAuth?b:await Object(l.c)(t,b);const f=await i.a(t,{width:580,height:800,url:b,titleMessage:g.titleMessage});if(!f)return;const y=a.d(f);if(!y.query.code||!y.query.state)return;c.b({message:g.authenticatingWithAsana});const S=await r.e(t,{code:y.query.code,encryptedState:y.query.state});"failed"===S.type?(console.error(S.error),d.d(S),c.a()):(u.n(t,{name:"asana"}),await n.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a())}},1484:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(40),i=n(491),a=n(64),s=n(173),o=n(33),l=n(347),c=n(111),d=n(54),u=n(14),p=n(1399),m=n(486),h=n(1);const g=Object(h.g)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function b(e){const{environment:t,requestStore:n}=e,h=Object(l.b)(t);let b=Object(s.i)(o.a.baseURL,{authType:h,userId:t.currentUser.id});b=h.redirectToAuth?b:await Object(l.c)(t,b);const f=await i.a(t,{width:580,height:700,url:b,titleMessage:g.titleMessage});if(!f)return;const y=a.d(f),S=y.query.oauth_token,v=y.query.oauth_verifier;if(!S||!v)return;c.b({message:g.authenticatingWithTrello});const E=await r.i(t,{requestToken:S,verifier:v});"failed"===E.type?(console.error(E.error),d.d(E),c.a()):(u.n(t,{name:"trello"}),await n.refresh(),p.a.setState({open:!0}),m.a.setState({open:!0}),c.a())}},1492:function(e,t,n){"use strict";var r=n(499);t.a=new r.a},1496:function(e,t,n){"use strict";n(15),n(12);var r=n(0),i=n(3),a=n(742),s=n(45),o=n(1287);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class d extends i.a{renderComponent(){const{device:e}=this.environment;return e.isMobile?r.createElement(s.c,{popupType:e.isMobile?s.c.PopupType.SlideUp:s.c.PopupType.Popup,open:this.props.open,render:this.props.renderContent,onDismiss:this.props.onDismiss,origin:this.props.origin}):r.createElement(a.a,{open:this.props.open,preventHideChildrenWhileOpening:!0,style:{alignItems:"flex-start"},innerStyle:this.getModalStyle(),onDismiss:this.props.onDismiss,render:this.props.renderContent,origin:this.props.origin,disableAnimation:this.props.disableAnimation})}getTopbarHeight(){const{device:e}=this.environment;return e.isElectronMac?o.a.desktopMacHeight:o.a.defaultHeight}getModalStyle(){const{modalStyle:e}=this.props;return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({top:2*this.getTopbarHeight(),borderRadius:3,overflow:"hidden",boxShadow:this.theme.largeBoxShadow,background:this.theme.contentBackground},e)}}t.a=d},1497:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(70),i=n(607),a=n(184);const s={getMonths:function(){for(var e=[],t=0;t<12;)e.push(Object(r.a)().month(t).format("MMMM")),t+=1;return e},formatDay:function(e){return Object(r.a)(e).format("ddd ll")},formatMonthTitle:function(e){const t=Object(i.a)(a.a).month;return Object(r.a)(e).format(t)},formatWeekdayShort:function(e){return r.a.weekdaysMin()[e]},formatWeekdayLong:function(e){return r.a.weekdays()[e]},getFirstDayOfWeek:function(){return r.a.localeData().firstDayOfWeek()}}},1656:function(e,t,n){"use strict";var r=n(0),i=n(3),a=n(153),s=n(16);class o extends s.a{getInitialState(){return{inputValue:void 0}}}var l=o;class c extends i.a{constructor(){super(...arguments),this.storeTypes={store:l},this.handleInputChange=e=>{const{store:t}=this.stores,n=e.target.value,r=this.inputValueToCents(n);let i;i=n?void 0!==r?n:this.getCurrentInputValue():"",t.setState({inputValue:i}),this.forceUpdate(),this.props.onChange(this.inputValueToCents(i)||0)}}renderComponent(){const{focus:e,selectAll:t,availableCredit:n}=this.props,i=this.getCurrentInputValue();return r.createElement(a.b,{value:i,onChange:this.handleInputChange,focus:e,selectAll:t,disabled:n<=0,style:{maxWidth:120},inputStyle:{textAlign:"right"}})}getCurrentInputValue(){const{availableCredit:e}=this.props,{inputValue:t}=this.stores.store.state;return void 0===t?"".concat(Math.floor(e/100)):t}inputValueToCents(e){const{availableCredit:t}=this.props,n=Math.floor(100*parseFloat(e));if(!isNaN(n)&&n<=t&&n>=0)return n}}t.a=c}}]);